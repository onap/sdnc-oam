[
  {
    "id": "61863820.711ea8",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 88,
    "y": 36,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "14f9537d.79772d"
      ]
    ]
  },
  {
    "id": "14f9537d.79772d",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 271.00000381469727,
    "y": 110.00001811981201,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "d19b9445.194798"
      ]
    ]
  },
  {
    "id": "d19b9445.194798",
    "type": "method",
    "name": "sdwan-attachment-topology-operation-create",
    "xml": "<method rpc='sdwan-attachment-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 259.0001220703125,
    "y": 198.00000095367432,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "3526110c.60448e"
      ]
    ]
  },
  {
    "id": "3526110c.60448e",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 179.00005340576172,
    "y": 947.0002489089966,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "99952776.e81ae8",
        "9b94537c.a4dfa",
        "9596dbd6.648298",
        "636ccd57.e35144",
        "43bd9b90.f9bb04",
        "4e3d9f6f.e48ca",
        "a91b49df.3ab368",
        "af03f775.1849d8",
        "a399f576.497928",
        "86a651b6.fa2c1",
        "27a69ba7.020164",
        "e417171b.b17d78",
        "a85450f9.54be5",
        "8337596d.6afa48",
        "5db0bc82.831f24",
        "757f6754.1033f8",
        "e6e8c666.3550b8",
        "7955fe12.58b57",
        "9077e61b.e6a3a8",
        "8e980e4e.121e8",
        "8bf022a6.d0cbb",
        "3aa5d5fd.f4649a"
      ]
    ]
  },
  {
    "id": "aa8c6e8b.e30e",
    "type": "comment",
    "name": "Set allotted resource id if not sent by SO",
    "info": "",
    "comments": "",
    "x": 663.0767517089844,
    "y": 107.43391990661621,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "99952776.e81ae8",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 609.0000305175781,
    "y": 162.99999332427979,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "6811d51c.3757dc",
        "513b9b13.594134"
      ]
    ]
  },
  {
    "id": "6811d51c.3757dc",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 807.0001182556152,
    "y": 132.999981880188,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "7f9fc121.cd5a5"
      ]
    ]
  },
  {
    "id": "513b9b13.594134",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 806.0000267028809,
    "y": 169.99999237060547,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "28a76577.73245a"
      ]
    ]
  },
  {
    "id": "28a76577.73245a",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-id",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n",
    "comments": "",
    "x": 1004.0000152587891,
    "y": 167.0000114440918,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "9b94537c.a4dfa",
    "type": "set",
    "name": "set tmp.ar.self-link",
    "xml": "<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:connection-attachment-allotted-resources/connection-attachment-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/connection-attachment-topology/'` \" />\n\n",
    "comments": "",
    "x": 576.9999542236328,
    "y": 384.0001001358032,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "9596dbd6.648298",
    "type": "execute",
    "name": "execute Properties",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n",
    "comments": "",
    "outputs": 1,
    "x": 577.2618713378906,
    "y": 465.6667814254761,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "636ccd57.e35144",
    "type": "execute",
    "name": "generate allotted-resource tmp.ar-url",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.connection-attachment-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 630.2619323730469,
    "y": 552.6666994094849,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "7f9fc121.cd5a5",
    "type": "execute",
    "name": "execute tmp.ar.allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"tmp.ar.allotted-resource-id\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1022.0000953674316,
    "y": 133.9999876022339,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "88221720.7c95b8"
      ]
    ]
  },
  {
    "id": "88221720.7c95b8",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1240.0001373291016,
    "y": 133.99995136260986,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "aa4b0ebd.72265"
      ]
    ]
  },
  {
    "id": "aa4b0ebd.72265",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value=\"An error occured while generation allotted resource ID\" />\n",
    "comments": "",
    "x": 1406.0000915527344,
    "y": 133.9999656677246,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "1ec18fe8.aa439",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1136.0002307891846,
    "y": 624.7778720855713,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "14fc1138.5da1ef"
      ]
    ]
  },
  {
    "id": "9378fa3a.19c018",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: Existing connection attachment allotted resource\" />\n    \n",
    "comments": "",
    "x": 1869.5186100006104,
    "y": 625.8439435958862,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "b12c1e8e.81e23",
    "type": "comment",
    "name": "Check for non existence of allotted resource",
    "info": "",
    "comments": "",
    "x": 992.0001525878906,
    "y": 558.7779388427734,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "da203e6.ea028c",
    "type": "for",
    "name": "for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]",
    "xml": "<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1512.6666984558105,
    "y": 769.0000512599945,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "98ae415a.0e4e6"
      ]
    ]
  },
  {
    "id": "4e3d9f6f.e48ca",
    "type": "switchNode",
    "name": "switch service-data.consumed-allotted-resources_length",
    "xml": "<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 694.6660232543945,
    "y": 745.7140836715698,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "210abe50.d12562",
        "fd87de34.5f561"
      ]
    ]
  },
  {
    "id": "210abe50.d12562",
    "type": "other",
    "name": "outcome Null",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 998.8089218139648,
    "y": 714.5715208053589,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "230c326a.73559e"
      ]
    ]
  },
  {
    "id": "fd87de34.5f561",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 975.8089714050293,
    "y": 775.571475982666,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "6fcbf8ba.f19558"
      ]
    ]
  },
  {
    "id": "6fcbf8ba.f19558",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1135.9360618591309,
    "y": 773.697452545166,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "da203e6.ea028c",
        "aac67e51.e0669",
        "1472489a.f6dd67"
      ]
    ]
  },
  {
    "id": "230c326a.73559e",
    "type": "set",
    "name": "set cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n",
    "comments": "",
    "x": 1148.6659049987793,
    "y": 712.2855710983276,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "a91b49df.3ab368",
    "type": "set",
    "name": "set consumed allotted resources",
    "xml": "<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n",
    "comments": "",
    "x": 623.5233154296875,
    "y": 849.2856483459473,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "aac67e51.e0669",
    "type": "switchNode",
    "name": "switch tmp.found-cidx",
    "xml": "<switch test='`$tmp.found-cidx`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1325.0511093139648,
    "y": 805.708975315094,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "83192091.f2dbe"
      ]
    ]
  },
  {
    "id": "83192091.f2dbe",
    "type": "outcomeTrue",
    "name": "false",
    "xml": "<outcome value='false'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1515.0510635375977,
    "y": 805.7089123725891,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "edcd9f1b.5f174"
      ]
    ]
  },
  {
    "id": "edcd9f1b.5f174",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1681.0510635375977,
    "y": 805.7089123725891,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "41ea1034.cd583"
      ]
    ]
  },
  {
    "id": "98ae415a.0e4e6",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n",
    "comments": "",
    "outputs": 1,
    "x": 1929.7783279418945,
    "y": 766.000078201294,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "f6ba2e93.3a869"
      ]
    ]
  },
  {
    "id": "f6ba2e93.3a869",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2111.587902069092,
    "y": 766.4645252227783,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "135a37d3.398c28"
      ]
    ]
  },
  {
    "id": "41ea1034.cd583",
    "type": "set",
    "name": "set tmp.cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n",
    "comments": "",
    "x": 1842.924446105957,
    "y": 805.2206134796143,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "3a0c681c.87b8c8",
    "type": "comment",
    "name": "Add to consumed service consumed-allotted-resources in mdsal",
    "info": "Prepare data and add to service-data",
    "comments": "",
    "x": 715.667236328125,
    "y": 676.0000476837158,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "4601b662.be85f8",
    "type": "comment",
    "name": "This set resource will be added to MDSAL by provider code",
    "info": "Below we add to service-data.consumed-allotted-resource at last index",
    "comments": "",
    "x": 703.0001525878906,
    "y": 814.7781400680542,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "6c13b6ba.f1d808",
    "type": "update",
    "name": "update AAI allotted-resource",
    "xml": "<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $connection-attachment-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $connection-attachment-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n    <parameter name=\"id\" value=\"`$tmp.ar.allotted-resource-id`\" />\n\t<parameter name=\"name\" value=\"`$prop.connection-attachment.sotnVpnName`\" />\n\t<parameter name=\"access-provider-id\" value=\"`$prop.connection-attachment.access-provider-id`\" />\n\t<parameter name=\"access-client-id\" value=\"`$prop.connection-attachment.access-client-id`\" />\n\t<parameter name=\"access-topology-id\" value=\"`$prop.connection-attachment.access-topology-id`\" />\n\t<parameter name=\"access-node-id\" value=\"`$prop.connection-attachment.access-node-id`\" />\n\t<parameter name=\"access-ltp-id\" value=\"`$prop.connection-attachment.access-ltp-id`\" />\t\n\t<parameter name=\"cvlan\" value=\"`$prop.connection-attachment.cVLAN`\" />\n    <parameter name=\"vpn-name\" value=\"`$prop.connection-attachment.sotnVpnName`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid`\" />\n\t<parameter name=\"operational-status\" value=\"Created\" />\n",
    "comments": "",
    "outputs": 1,
    "x": 613.6908569335938,
    "y": 1774.531904220581,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "cc11f86f.a05c98",
        "2748d678.9b155a"
      ]
    ]
  },
  {
    "id": "cc11f86f.a05c98",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 808.4527931213379,
    "y": 1765.4845056533813,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "ad7d0ba7.e370e8"
      ]
    ]
  },
  {
    "id": "ad7d0ba7.e370e8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n",
    "comments": "",
    "x": 974.9766731262207,
    "y": 1777.1035766601562,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "2748d678.9b155a",
    "type": "failure",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 815.5480804443359,
    "y": 1798.246473312378,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "ad7d0ba7.e370e8"
      ]
    ]
  },
  {
    "id": "65ec4e22.c3de6",
    "type": "comment",
    "name": "Save Resource to AAI",
    "info": "",
    "comments": "",
    "x": 647.5005340576172,
    "y": 1742.833875656128,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "cf325757.026c08",
    "type": "comment",
    "name": "Set allotted resource type if not sent by SO",
    "info": "",
    "comments": "",
    "x": 649,
    "y": 216.00000095367432,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "43bd9b90.f9bb04",
    "type": "switchNode",
    "name": "switch allotted-resource-type",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 610.9233093261719,
    "y": 256.5660572052002,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "b8faf677.a88b58",
        "cb37a8ac.844d88"
      ]
    ]
  },
  {
    "id": "b8faf677.a88b58",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 813.9234619140625,
    "y": 241.56606006622314,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "fb16264e.206978"
      ]
    ]
  },
  {
    "id": "cb37a8ac.844d88",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 806.9232902526855,
    "y": 281.5660800933838,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "46a12ee1.3eb2e"
      ]
    ]
  },
  {
    "id": "46a12ee1.3eb2e",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`' />\n",
    "comments": "",
    "x": 1038.9232749938965,
    "y": 281.56608486175537,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "e0d4b358.f0111",
    "type": "comment",
    "name": "For storage in AAI connection-attachment-topology",
    "info": "",
    "comments": "",
    "x": 673.9999618530273,
    "y": 351.0000009536743,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "2c1dc14e.d8696e",
    "type": "comment",
    "name": "Obtain different URL, template location etc",
    "info": "For saving resource information to MDSAL & for AAI",
    "comments": "",
    "x": 648.9999465942383,
    "y": 432.8889102935791,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "41be4404.2062fc",
    "type": "comment",
    "name": "Used for Put AR by id to MDSAL",
    "info": "",
    "comments": "",
    "x": 615.0000305175781,
    "y": 521.8889274597168,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "e088f78d.0cd8b8",
    "type": "comment",
    "name": "Obtain the last index in services",
    "info": "ServiceData is added by Provider code",
    "comments": "",
    "x": 616.4444732666016,
    "y": 707.8888721466064,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "9077e61b.e6a3a8",
    "type": "set",
    "name": "set output to api handler",
    "xml": "<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='connection-attachment-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $connection-attachment-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n",
    "comments": "",
    "x": 599.2681427001953,
    "y": 1681.359203338623,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "8e980e4e.121e8",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 567.6812286376953,
    "y": 1843.9749298095703,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "fb16264e.206978",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value=\"SDWANAttachmentInstance\" />\n",
    "comments": "",
    "x": 1053.0001487731934,
    "y": 241.99998664855957,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "7955fe12.58b57",
    "type": "execute",
    "name": "execute RestApiCallNode - PUT AR by id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.sdwan-attachment.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 650.0002746582031,
    "y": 1615.00013256073,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "7e102bff.eb07f4",
        "11a3c1ef.0f585e",
        "cbe02c45.fd392"
      ]
    ]
  },
  {
    "id": "7e102bff.eb07f4",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 899.6416282653809,
    "y": 1653.3314628601074,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "d199a2ac.4c653"
      ]
    ]
  },
  {
    "id": "11a3c1ef.0f585e",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 890.6416778564453,
    "y": 1621.831488609314,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "d199a2ac.4c653"
      ]
    ]
  },
  {
    "id": "cbe02c45.fd392",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 894.391716003418,
    "y": 1592.1885934844613,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "d05ce36c.67312"
      ]
    ]
  },
  {
    "id": "d199a2ac.4c653",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1060.391716003418,
    "y": 1622.5815124511719,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "d05ce36c.67312",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1036.0476837158203,
    "y": 1588.3807626739144,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "27a69ba7.020164",
    "type": "execute",
    "name": "execute RestApiCallNode - Update parent provided service AR",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 714.9999542236328,
    "y": 1131.000165939331,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "2ac08c5a.9ea264",
        "9091e2db.32589",
        "bcd16107.cb13d"
      ]
    ]
  },
  {
    "id": "2ac08c5a.9ea264",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1023.3080139160156,
    "y": 1162.998441696167,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "900f543a.444328"
      ]
    ]
  },
  {
    "id": "9091e2db.32589",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1014.3080635070801,
    "y": 1131.4984674453735,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "900f543a.444328"
      ]
    ]
  },
  {
    "id": "bcd16107.cb13d",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1018.0581016540527,
    "y": 1101.8555723205209,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "1404ab79.5b1245"
      ]
    ]
  },
  {
    "id": "900f543a.444328",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1184.0581016540527,
    "y": 1132.2484912872314,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "1404ab79.5b1245",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1159.714069366455,
    "y": 1098.047741509974,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "39d4184a.092378",
    "type": "comment",
    "name": "Put the parent allotted resource in mdsal",
    "info": "",
    "comments": "",
    "x": 643.9999008178711,
    "y": 1093.000072479248,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "a85450f9.54be5",
    "type": "set",
    "name": "set connection-attachment-ar-identifiers",
    "xml": "<set>\n<parameter name='connection-attachment-ar-identifiers.consuming-service-instance-id' value=\"`$connection-attachment-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n",
    "comments": "",
    "x": 640.3570861816406,
    "y": 1295.5716915130615,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "e417171b.b17d78",
    "type": "set",
    "name": "set ar-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.action' value=\"`$connection-attachment-topology-operation-input.request-information.request-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-name' value=\"connection-attachment-topology-operation\" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-action' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$connection-attachment-topology-operation-input.request-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$connection-attachment-topology-operation-input.service-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.' value=\"`$connection-attachment-topology-operation-input.connection-attachment-request-input.` \" />",
    "comments": "",
    "x": 560.2139129638672,
    "y": 1263.381194114685,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "8337596d.6afa48",
    "type": "set",
    "name": "set identifiers in overall structure",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.allotted-resource-identifiers.' \nvalue=\"`$connection-attachment-ar-identifiers.`\" />\n\n\n",
    "comments": "",
    "x": 619.1668853759766,
    "y": 1329.6668767929077,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "5db0bc82.831f24",
    "type": "execute",
    "name": "execute getTime",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 571.4997253417969,
    "y": 1403.0004043579102,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "757f6754.1033f8",
    "type": "set",
    "name": "set allotted-resource-oper-status",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Created' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$connection-attachment-topology-operation-input.request-information.request-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n",
    "comments": "",
    "x": 622.4867630004883,
    "y": 1458.9516372680664,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "e6e8c666.3550b8",
    "type": "set",
    "name": "set model-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.onap-model-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.` \" />",
    "comments": "",
    "x": 567.0553817749023,
    "y": 1364.5557622909546,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "99a7dd56.4fb72",
    "type": "comment",
    "name": "Prepare data for allotted-resource addition to MDSAL",
    "info": "This will add to allotted-resource which is present inside service.",
    "comments": "",
    "x": 684.3888702392578,
    "y": 1229.5556087493896,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "86a651b6.fa2c1",
    "type": "execute",
    "name": "generate parent-ar url - replace allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.parent-ar-url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 679.5000152587891,
    "y": 1057.0000114440918,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "a399f576.497928",
    "type": "execute",
    "name": "generate parent-ar url - replace service-instance-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.parent-provided-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 675.4999389648438,
    "y": 1014.000147819519,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "b106df9f.5ad7c",
    "type": "comment",
    "name": "Prepare Parent AR URL",
    "info": "Preparation to set provided-allotted-resource in parent service instance",
    "comments": "",
    "x": 593.5003967285156,
    "y": 943.0001010894775,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "af03f775.1849d8",
    "type": "set",
    "name": "set tmp.ar.parent-service-instance-id",
    "xml": "<set>\n<parameter name='tmp.ar.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n\n",
    "comments": "",
    "x": 632.5001907348633,
    "y": 976.5000405311584,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "135a37d3.398c28",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource as cosumed allotted resource already exists.\" />\n",
    "comments": "",
    "x": 2189.7569732666016,
    "y": 814.645830154419,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "1472489a.f6dd67",
    "type": "set",
    "name": "set tmp.found-cidx",
    "xml": "<set>\n<parameter name='tmp.found-cidx' value=\"`false`\" />\n\n\n",
    "comments": "",
    "x": 1315.6461448669434,
    "y": 726.3125731945038,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "a78b3889.5b8998",
    "type": "comment",
    "name": "Add to parent services provided-allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 704.2015075683594,
    "y": 910.9792575836182,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "67269130.185f5",
    "type": "comment",
    "name": "Add to allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 624.9686965942383,
    "y": 1196.9689378738403,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "14fc1138.5da1ef",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1298.000051498413,
    "y": 624.2777614593506,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "4695b038.898f5"
      ]
    ]
  },
  {
    "id": "4695b038.898f5",
    "type": "switchNode",
    "name": "switch cr length",
    "xml": "<switch test='`$mdsal-ar.connection-attachment-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1485.8574314117432,
    "y": 624.8968968391418,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "207b23e6.6bd71c"
      ]
    ]
  },
  {
    "id": "207b23e6.6bd71c",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1685.1905536651611,
    "y": 624.896975517273,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "9378fa3a.19c018"
      ]
    ]
  },
  {
    "id": "8bf022a6.d0cbb",
    "type": "execute",
    "name": "execute RestApiCallNode - get-resource connection-attachment-allotted-resource",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 770.0000534057617,
    "y": 619.0000371932983,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "1ec18fe8.aa439",
        "a8c0bcfd.baccb"
      ]
    ]
  },
  {
    "id": "a8c0bcfd.baccb",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1138.0000839233398,
    "y": 589.0000352859497,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "e7c1d5d7.6402e8"
      ]
    ]
  },
  {
    "id": "e7c1d5d7.6402e8",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1290.0000839233398,
    "y": 588.0000352859497,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "3aa5d5fd.f4649a",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 576.0039215087891,
    "y": 1534.2500038146973,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "eae96cd9.5875e",
        "23f6c134.a5bc8e"
      ]
    ]
  },
  {
    "id": "eae96cd9.5875e",
    "type": "for",
    "name": "for each sdwan-get-request-input-param",
    "xml": "<for index='i' start='0' end='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 911.0041198730469,
    "y": 1480.2501260638237,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "34a921aa.b7fb2e"
      ]
    ]
  },
  {
    "id": "b45075fd.7aae48",
    "type": "comment",
    "name": "Required for filling template values",
    "info": "This is done because connection-attachment is generic resource and doesn't have specific parameters",
    "comments": "",
    "x": 933.4486236572266,
    "y": 1514.0832867622375,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "933f50a4.98d0e",
    "type": "comment",
    "name": "Remove VNFC prefix",
    "info": "",
    "comments": "",
    "x": 994.003963470459,
    "y": 1436.6944618225098,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "34a921aa.b7fb2e",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1158.0039672851562,
    "y": 1481.6943712234497,
    "z": "8a925a2b.b01bd8",
    "wires": [
      [
        "d1aee21e.a2d11",
        "7c70d1bd.e91da"
      ]
    ]
  },
  {
    "id": "f68facaa.6f9bc",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 1426.0038146972656,
    "y": 1397.250369310379,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "d1aee21e.a2d11",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1377.0384826660156,
    "y": 1432.2294654846191,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  },
  {
    "id": "7c70d1bd.e91da",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1365.4829559326172,
    "y": 1536.2294359207153,
    "z": "8a925a2b.b01bd8",
    "wires": []
  },
  {
    "id": "23f6c134.a5bc8e",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:sdwan-get-saved-ar-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-saved-ar-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 952.0039672851562,
    "y": 1554.2500658035278,
    "z": "8a925a2b.b01bd8",
    "wires": [
      []
    ]
  }
]
