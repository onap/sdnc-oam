[
  {
    "id": "d0edaee0.371d2",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 130.00390625,
    "y": 68.99999856948853,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "ccac73a.016209"
      ]
    ]
  },
  {
    "id": "ccac73a.016209",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 313.00391006469727,
    "y": 143.00001668930054,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "20c8ba03.7fc266"
      ]
    ]
  },
  {
    "id": "20c8ba03.7fc266",
    "type": "method",
    "name": "sdwan-attachment-topology-operation-create",
    "xml": "<method rpc='sdwan-attachment-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 301.0040283203125,
    "y": 230.99999952316284,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "7fb8a0a8.cc16e"
      ]
    ]
  },
  {
    "id": "7fb8a0a8.cc16e",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 221.00395965576172,
    "y": 980.0002474784851,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "2437dbcf.331264",
        "730eea74.2853a4",
        "3eb4cc5.e84ab34",
        "98a0f1ed.ad821",
        "48d3a6f4.7a9f68",
        "5e870da5.d4b9c4",
        "f395bfa7.29021",
        "a35c1852.b6d228",
        "128728fe.ad5877",
        "7f796e7c.de4f4",
        "52f115fe.31e7bc",
        "6a649bce.b1cf84",
        "549597d0.2434c8",
        "b67f723e.a2fdd",
        "e622a70a.fb3f98",
        "3c5561ef.3b198e",
        "34b5882f.c7cb48",
        "273cbd63.ba5da2",
        "7cadc884.11c378",
        "f028e514.462408",
        "2fe2b50e.b3feea",
        "b0371fd5.a7b76"
      ]
    ]
  },
  {
    "id": "ce81891c.9bbbd8",
    "type": "comment",
    "name": "Set allotted resource id if not sent by SO",
    "info": "",
    "comments": "",
    "x": 705.0806579589844,
    "y": 140.43391847610474,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "2437dbcf.331264",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 651.0039367675781,
    "y": 195.9999918937683,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "ae4415d.9e44fe8",
        "c8d7b3ce.5e5a2"
      ]
    ]
  },
  {
    "id": "ae4415d.9e44fe8",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 849.0040245056152,
    "y": 165.9999804496765,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "349de4b3.2e578c"
      ]
    ]
  },
  {
    "id": "c8d7b3ce.5e5a2",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 848.0039329528809,
    "y": 202.999990940094,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "106c46a5.0a2af9"
      ]
    ]
  },
  {
    "id": "106c46a5.0a2af9",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-id",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n",
    "comments": "",
    "x": 1046.003921508789,
    "y": 200.00001001358032,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "730eea74.2853a4",
    "type": "set",
    "name": "set tmp.ar.self-link",
    "xml": "<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:connection-attachment-allotted-resources/connection-attachment-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/connection-attachment-topology/'` \" />\n\n",
    "comments": "",
    "x": 619.0038604736328,
    "y": 417.00009870529175,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "3eb4cc5.e84ab34",
    "type": "execute",
    "name": "execute Properties",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n",
    "comments": "",
    "outputs": 1,
    "x": 619.2657775878906,
    "y": 498.6667799949646,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "98a0f1ed.ad821",
    "type": "execute",
    "name": "generate allotted-resource tmp.ar-url",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.connection-attachment-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 672.2658386230469,
    "y": 585.6666979789734,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "349de4b3.2e578c",
    "type": "execute",
    "name": "execute tmp.ar.allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"tmp.ar.allotted-resource-id\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1064.0040016174316,
    "y": 166.9999861717224,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "5d37f876.0cc698"
      ]
    ]
  },
  {
    "id": "5d37f876.0cc698",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1282.0040435791016,
    "y": 166.9999499320984,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "b5e2a2dc.0d71c"
      ]
    ]
  },
  {
    "id": "b5e2a2dc.0d71c",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value=\"An error occured while generation allotted resource ID\" />\n",
    "comments": "",
    "x": 1448.0039978027344,
    "y": 166.99996423721313,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "8f7a89d.e442878",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1178.0041370391846,
    "y": 657.7778706550598,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "b23dd04a.37b72"
      ]
    ]
  },
  {
    "id": "7072a3ba.59cbcc",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: Existing connection attachment allotted resource\" />\n    \n",
    "comments": "",
    "x": 1911.5225162506104,
    "y": 658.8439421653748,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "3b5bc99a.d557b6",
    "type": "comment",
    "name": "Check for non existence of allotted resource",
    "info": "",
    "comments": "",
    "x": 1034.0040588378906,
    "y": 591.777937412262,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "340e57cb.5c86a8",
    "type": "for",
    "name": "for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]",
    "xml": "<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1554.6706047058105,
    "y": 802.000049829483,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "3cebd63.269772a"
      ]
    ]
  },
  {
    "id": "5e870da5.d4b9c4",
    "type": "switchNode",
    "name": "switch service-data.consumed-allotted-resources_length",
    "xml": "<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 736.6699295043945,
    "y": 778.7140822410583,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "9df6142.79785e8",
        "58099c96.2c7e34"
      ]
    ]
  },
  {
    "id": "9df6142.79785e8",
    "type": "other",
    "name": "outcome Null",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 1040.8128280639648,
    "y": 747.5715193748474,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "be192375.06e28"
      ]
    ]
  },
  {
    "id": "58099c96.2c7e34",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1017.8128776550293,
    "y": 808.5714745521545,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "96b3b48a.902058"
      ]
    ]
  },
  {
    "id": "96b3b48a.902058",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1177.9399681091309,
    "y": 806.6974511146545,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "340e57cb.5c86a8",
        "718d194e.2e6788",
        "a28f94f9.cae788"
      ]
    ]
  },
  {
    "id": "be192375.06e28",
    "type": "set",
    "name": "set cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n",
    "comments": "",
    "x": 1190.6698112487793,
    "y": 745.2855696678162,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "f395bfa7.29021",
    "type": "set",
    "name": "set consumed allotted resources",
    "xml": "<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n",
    "comments": "",
    "x": 665.5272216796875,
    "y": 882.2856469154358,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "718d194e.2e6788",
    "type": "switchNode",
    "name": "switch tmp.found-cidx",
    "xml": "<switch test='`$tmp.found-cidx`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1367.0550155639648,
    "y": 838.7089738845825,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "144fdd18.b7f4c3"
      ]
    ]
  },
  {
    "id": "144fdd18.b7f4c3",
    "type": "outcomeTrue",
    "name": "false",
    "xml": "<outcome value='false'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1557.0549697875977,
    "y": 838.7089109420776,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "67e912a8.6bc78c"
      ]
    ]
  },
  {
    "id": "67e912a8.6bc78c",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1723.0549697875977,
    "y": 838.7089109420776,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "95e82f8c.b9b06"
      ]
    ]
  },
  {
    "id": "3cebd63.269772a",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n",
    "comments": "",
    "outputs": 1,
    "x": 1971.7822341918945,
    "y": 799.0000767707825,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "77a3d234.ab1d9c"
      ]
    ]
  },
  {
    "id": "77a3d234.ab1d9c",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2153.591808319092,
    "y": 799.4645237922668,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "c2bb18ee.6afb98"
      ]
    ]
  },
  {
    "id": "95e82f8c.b9b06",
    "type": "set",
    "name": "set tmp.cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n",
    "comments": "",
    "x": 1884.928352355957,
    "y": 838.2206120491028,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "f6050ba6.e3a988",
    "type": "comment",
    "name": "Add to consumed service consumed-allotted-resources in mdsal",
    "info": "Prepare data and add to service-data",
    "comments": "",
    "x": 757.671142578125,
    "y": 709.0000462532043,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "950d939a.d6aa9",
    "type": "comment",
    "name": "This set resource will be added to MDSAL by provider code",
    "info": "Below we add to service-data.consumed-allotted-resource at last index",
    "comments": "",
    "x": 745.0040588378906,
    "y": 847.7781386375427,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "fdbceac6.217498",
    "type": "update",
    "name": "update AAI allotted-resource",
    "xml": "<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $connection-attachment-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $connection-attachment-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n    <parameter name=\"id\" value=\"`$tmp.ar.allotted-resource-id`\" />\n\t<parameter name=\"name\" value=\"`$prop.connection-attachment.sotnVpnName`\" />\n\t<parameter name=\"access-provider-id\" value=\"`$prop.connection-attachment.access-provider-id`\" />\n\t<parameter name=\"access-client-id\" value=\"`$prop.connection-attachment.access-client-id`\" />\n\t<parameter name=\"access-topology-id\" value=\"`$prop.connection-attachment.access-topology-id`\" />\n\t<parameter name=\"access-node-id\" value=\"`$prop.connection-attachment.access-node-id`\" />\n\t<parameter name=\"access-ltp-id\" value=\"`$prop.connection-attachment.access-ltp-id`\" />\t\n\t<parameter name=\"cvlan\" value=\"`$prop.connection-attachment.cVLAN`\" />\n    <parameter name=\"vpn-name\" value=\"`$prop.connection-attachment.sotnVpnName`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid`\" />\n\t<parameter name=\"operational-status\" value=\"Created\" />\n",
    "comments": "",
    "outputs": 1,
    "x": 655.6947631835938,
    "y": 1807.5319027900696,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "49ae8647.6b2328",
        "62f42f4e.42781"
      ]
    ]
  },
  {
    "id": "49ae8647.6b2328",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 850.4566993713379,
    "y": 1798.4845042228699,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "c8a49936.3deaf8"
      ]
    ]
  },
  {
    "id": "c8a49936.3deaf8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n",
    "comments": "",
    "x": 1016.9805793762207,
    "y": 1810.1035752296448,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "62f42f4e.42781",
    "type": "failure",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 857.5519866943359,
    "y": 1831.2464718818665,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "c8a49936.3deaf8"
      ]
    ]
  },
  {
    "id": "f380425c.83892",
    "type": "comment",
    "name": "Save Resource to AAI",
    "info": "",
    "comments": "",
    "x": 689.5044403076172,
    "y": 1775.8338742256165,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "c58c2e54.58ab4",
    "type": "comment",
    "name": "Set allotted resource type if not sent by SO",
    "info": "",
    "comments": "",
    "x": 691.00390625,
    "y": 248.99999952316284,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "48d3a6f4.7a9f68",
    "type": "switchNode",
    "name": "switch allotted-resource-type",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 652.9272155761719,
    "y": 289.5660557746887,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "a5628a44.6843d8",
        "9e87888a.c266e8"
      ]
    ]
  },
  {
    "id": "a5628a44.6843d8",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 855.9273681640625,
    "y": 274.56605863571167,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "eafc3b17.674668"
      ]
    ]
  },
  {
    "id": "9e87888a.c266e8",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 848.9271965026855,
    "y": 314.5660786628723,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "1455473e.f663e9"
      ]
    ]
  },
  {
    "id": "1455473e.f663e9",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`' />\n",
    "comments": "",
    "x": 1080.9271812438965,
    "y": 314.5660834312439,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "f29b8b09.a0de68",
    "type": "comment",
    "name": "For storage in AAI connection-attachment-topology",
    "info": "",
    "comments": "",
    "x": 716.0038681030273,
    "y": 383.99999952316284,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "c8d768ea.3ebd78",
    "type": "comment",
    "name": "Obtain different URL, template location etc",
    "info": "For saving resource information to MDSAL & for AAI",
    "comments": "",
    "x": 691.0038528442383,
    "y": 465.8889088630676,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "40de4362.ae07ec",
    "type": "comment",
    "name": "Used for Put AR by id to MDSAL",
    "info": "",
    "comments": "",
    "x": 657.0039367675781,
    "y": 554.8889260292053,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "1f6351e.76805ae",
    "type": "comment",
    "name": "Obtain the last index in services",
    "info": "ServiceData is added by Provider code",
    "comments": "",
    "x": 658.4483795166016,
    "y": 740.888870716095,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "7cadc884.11c378",
    "type": "set",
    "name": "set output to api handler",
    "xml": "<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='connection-attachment-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $connection-attachment-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n",
    "comments": "",
    "x": 641.2720489501953,
    "y": 1714.3592019081116,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "f028e514.462408",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 609.6851348876953,
    "y": 1876.9749283790588,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "eafc3b17.674668",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value=\"SDWANAttachmentInstance\" />\n",
    "comments": "",
    "x": 1095.0040550231934,
    "y": 274.9999852180481,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "273cbd63.ba5da2",
    "type": "execute",
    "name": "execute RestApiCallNode - PUT AR by id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.sdwan-attachment.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 692.0041809082031,
    "y": 1648.0001311302185,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "98032a32.e6e0f8",
        "aa969973.4cd018",
        "1764b80a.4c5668"
      ]
    ]
  },
  {
    "id": "98032a32.e6e0f8",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 941.6455345153809,
    "y": 1686.331461429596,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "2942de2a.1ad962"
      ]
    ]
  },
  {
    "id": "aa969973.4cd018",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 932.6455841064453,
    "y": 1654.8314871788025,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "2942de2a.1ad962"
      ]
    ]
  },
  {
    "id": "1764b80a.4c5668",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 936.395622253418,
    "y": 1625.1885920539498,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "801134b3.e6dc28"
      ]
    ]
  },
  {
    "id": "2942de2a.1ad962",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1102.395622253418,
    "y": 1655.5815110206604,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "801134b3.e6dc28",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1078.0515899658203,
    "y": 1621.380761243403,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "52f115fe.31e7bc",
    "type": "execute",
    "name": "execute RestApiCallNode - Update parent provided service AR",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 757.0038604736328,
    "y": 1164.0001645088196,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "d67d9a08.605298",
        "22fe8dcf.9c57d2",
        "85578012.048c2"
      ]
    ]
  },
  {
    "id": "d67d9a08.605298",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1065.3119201660156,
    "y": 1195.9984402656555,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "5c849a0e.1b8584"
      ]
    ]
  },
  {
    "id": "22fe8dcf.9c57d2",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1056.31196975708,
    "y": 1164.498466014862,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "5c849a0e.1b8584"
      ]
    ]
  },
  {
    "id": "85578012.048c2",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1060.0620079040527,
    "y": 1134.8555708900094,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "6e0abfa0.4ac64"
      ]
    ]
  },
  {
    "id": "5c849a0e.1b8584",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1226.0620079040527,
    "y": 1165.24848985672,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "6e0abfa0.4ac64",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1201.717975616455,
    "y": 1131.0477400794625,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "d900fe90.080fa",
    "type": "comment",
    "name": "Put the parent allotted resource in mdsal",
    "info": "",
    "comments": "",
    "x": 686.0038070678711,
    "y": 1126.0000710487366,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "549597d0.2434c8",
    "type": "set",
    "name": "set connection-attachment-ar-identifiers",
    "xml": "<set>\n<parameter name='connection-attachment-ar-identifiers.consuming-service-instance-id' value=\"`$connection-attachment-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n",
    "comments": "",
    "x": 682.3609924316406,
    "y": 1328.57169008255,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "6a649bce.b1cf84",
    "type": "set",
    "name": "set ar-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.action' value=\"`$connection-attachment-topology-operation-input.request-information.request-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-name' value=\"connection-attachment-topology-operation\" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-action' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$connection-attachment-topology-operation-input.request-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$connection-attachment-topology-operation-input.service-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.' value=\"`$connection-attachment-topology-operation-input.connection-attachment-request-input.` \" />",
    "comments": "",
    "x": 602.2178192138672,
    "y": 1296.3811926841736,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "b67f723e.a2fdd",
    "type": "set",
    "name": "set identifiers in overall structure",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.allotted-resource-identifiers.' \nvalue=\"`$connection-attachment-ar-identifiers.`\" />\n\n\n",
    "comments": "",
    "x": 661.1707916259766,
    "y": 1362.6668753623962,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "e622a70a.fb3f98",
    "type": "execute",
    "name": "execute getTime",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 613.5036315917969,
    "y": 1436.0004029273987,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "3c5561ef.3b198e",
    "type": "set",
    "name": "set allotted-resource-oper-status",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Created' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$connection-attachment-topology-operation-input.request-information.request-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n",
    "comments": "",
    "x": 664.4906692504883,
    "y": 1491.951635837555,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "34b5882f.c7cb48",
    "type": "set",
    "name": "set model-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.onap-model-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.` \" />",
    "comments": "",
    "x": 609.0592880249023,
    "y": 1397.5557608604431,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "f1efc3d3.15b9f",
    "type": "comment",
    "name": "Prepare data for allotted-resource addition to MDSAL",
    "info": "This will add to allotted-resource which is present inside service.",
    "comments": "",
    "x": 726.3927764892578,
    "y": 1262.5556073188782,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "7f796e7c.de4f4",
    "type": "execute",
    "name": "generate parent-ar url - replace allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.parent-ar-url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 721.5039215087891,
    "y": 1090.0000100135803,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "128728fe.ad5877",
    "type": "execute",
    "name": "generate parent-ar url - replace service-instance-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.parent-provided-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 717.5038452148438,
    "y": 1047.0001463890076,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "6a7cea15.b62614",
    "type": "comment",
    "name": "Prepare Parent AR URL",
    "info": "Preparation to set provided-allotted-resource in parent service instance",
    "comments": "",
    "x": 635.5043029785156,
    "y": 976.0000996589661,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "a35c1852.b6d228",
    "type": "set",
    "name": "set tmp.ar.parent-service-instance-id",
    "xml": "<set>\n<parameter name='tmp.ar.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n\n",
    "comments": "",
    "x": 674.5040969848633,
    "y": 1009.500039100647,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "c2bb18ee.6afb98",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource as cosumed allotted resource already exists.\" />\n",
    "comments": "",
    "x": 2231.7608795166016,
    "y": 847.6458287239075,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "a28f94f9.cae788",
    "type": "set",
    "name": "set tmp.found-cidx",
    "xml": "<set>\n<parameter name='tmp.found-cidx' value=\"`false`\" />\n\n\n",
    "comments": "",
    "x": 1357.6500511169434,
    "y": 759.3125717639923,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "c891031.324ba",
    "type": "comment",
    "name": "Add to parent services provided-allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 746.2054138183594,
    "y": 943.9792561531067,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "2273a66f.0415ca",
    "type": "comment",
    "name": "Add to allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 666.9726028442383,
    "y": 1229.9689364433289,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "b23dd04a.37b72",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1340.003957748413,
    "y": 657.2777600288391,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "a6dda7d3.822f38"
      ]
    ]
  },
  {
    "id": "a6dda7d3.822f38",
    "type": "switchNode",
    "name": "switch cr length",
    "xml": "<switch test='`$mdsal-ar.connection-attachment-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1527.8613376617432,
    "y": 657.8968954086304,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "5bd5d251.e9afcc"
      ]
    ]
  },
  {
    "id": "5bd5d251.e9afcc",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1727.1944599151611,
    "y": 657.8969740867615,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "7072a3ba.59cbcc"
      ]
    ]
  },
  {
    "id": "2fe2b50e.b3feea",
    "type": "execute",
    "name": "execute RestApiCallNode - get-resource connection-attachment-allotted-resource",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 812.0039596557617,
    "y": 652.0000357627869,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "8f7a89d.e442878",
        "3a286aef.d7f3b6"
      ]
    ]
  },
  {
    "id": "3a286aef.d7f3b6",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1180.0039901733398,
    "y": 622.0000338554382,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "13ffa20f.c9e16e"
      ]
    ]
  },
  {
    "id": "13ffa20f.c9e16e",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1332.0039901733398,
    "y": 621.0000338554382,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "b0371fd5.a7b76",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 618.0078277587891,
    "y": 1567.2500023841858,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "54125d93.5f9234",
        "a3376785.58e1f8"
      ]
    ]
  },
  {
    "id": "54125d93.5f9234",
    "type": "for",
    "name": "for each sdwan-get-request-input-param",
    "xml": "<for index='i' start='0' end='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 953.0080261230469,
    "y": 1513.2501246333122,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "e2f37c7a.7e92e"
      ]
    ]
  },
  {
    "id": "36f9a762.8e3a68",
    "type": "comment",
    "name": "Required for filling template values",
    "info": "This is done because connection-attachment is generic resource and doesn't have specific parameters",
    "comments": "",
    "x": 975.4525299072266,
    "y": 1547.083285331726,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "5c5d6d04.0459d4",
    "type": "comment",
    "name": "Remove VNFC prefix",
    "info": "",
    "comments": "",
    "x": 1036.007869720459,
    "y": 1469.6944603919983,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "e2f37c7a.7e92e",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1200.0078735351562,
    "y": 1514.6943697929382,
    "z": "28b033ee.a901cc",
    "wires": [
      [
        "c041009d.8b993",
        "2dcd0480.dbffec"
      ]
    ]
  },
  {
    "id": "cfd8cad0.68f218",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 1468.0077209472656,
    "y": 1430.2503678798676,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "c041009d.8b993",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1419.0423889160156,
    "y": 1465.2294640541077,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  },
  {
    "id": "2dcd0480.dbffec",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1407.4868621826172,
    "y": 1569.2294344902039,
    "z": "28b033ee.a901cc",
    "wires": []
  },
  {
    "id": "a3376785.58e1f8",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:sdwan-get-saved-ar-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-saved-ar-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 994.0078735351562,
    "y": 1587.2500643730164,
    "z": "28b033ee.a901cc",
    "wires": [
      []
    ]
  }
]
