[{"id":"ae768186.4826a","type":"dgstart","name":"DGSTART","outputs":1,"x":134.2857208251953,"y":92.41365671157837,"z":"d84650d6.6853b","wires":[["edafbe74.9da96"]]},{"id":"edafbe74.9da96","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":246.7142791748047,"y":132.65176725387573,"z":"d84650d6.6853b","wires":[["b0f5897.9207e78"]]},{"id":"b0f5897.9207e78","type":"method","name":"method vnf-topology-operation-changeassign","xml":"<method rpc='vnf-topology-operation-changeassign' mode='sync'>\n","comments":"","outputs":1,"x":242.42862701416016,"y":172.41365480422974,"z":"d84650d6.6853b","wires":[["670a4655.0f0308"]]},{"id":"1118501d.0e50c","type":"comment","name":"vnf-topology-operation-changeassign","info":"","comments":"","x":528.6305770874023,"y":40.00000047683716,"z":"d84650d6.6853b","wires":[]},{"id":"8d6e003.e53ef","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vnf-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":533.5238342285156,"y":274.12794828414917,"z":"d84650d6.6853b","wires":[["536e7baf.586814","3ee50456.0e95fc"]]},{"id":"536e7baf.586814","type":"outcome","name":"CreateVnfInstance","xml":"<outcome value='CreateVnfInstance'>\n","comments":"","outputs":1,"x":757.6666488647461,"y":248.41365671157837,"z":"d84650d6.6853b","wires":[["57ce7cd7.f2a264"]]},{"id":"3ee50456.0e95fc","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":720.6666717529297,"y":292.4612956047058,"z":"d84650d6.6853b","wires":[["264a3806.603918"]]},{"id":"57ce7cd7.f2a264","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":949.2381057739258,"y":248.41369199752808,"z":"d84650d6.6853b","wires":[[]]},{"id":"264a3806.603918","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'changeassign' then request-action must be 'CreateVnfInstance'\" />\n","comments":"","x":928.0476188659668,"y":292.4613070487976,"z":"d84650d6.6853b","wires":[]},{"id":"dd2ece0d.8f5cf","type":"switchNode","name":"switch order-status","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status`'>\n","comments":"","outputs":1,"x":1219.9524230957031,"y":602.9851970672607,"z":"d84650d6.6853b","wires":[["e6c87065.a3db","591c04ee.ad32ac"]]},{"id":"e6c87065.a3db","type":"other","name":"PendingDelete","xml":"<outcome value='PendingDelete'>\n","comments":"","outputs":1,"x":1421.952480316162,"y":580.6993646621704,"z":"d84650d6.6853b","wires":[["198f754a.21cc0b"]]},{"id":"5bb0ece8.e079f4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"The requested VNF is not pending deletion\" />\n","comments":"","x":1588.095344543457,"y":624.0327425003052,"z":"d84650d6.6853b","wires":[]},{"id":"882bb260.db908","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":937.9524688720703,"y":598.7470188140869,"z":"d84650d6.6853b","wires":[["26e397f2.4cc038","33d8b0b9.4de03","e3cb0.1ccff351","35f1cabd.ad4236","73b1cc70.f76174","3c3e74.be8df18c"]]},{"id":"26e397f2.4cc038","type":"set","name":"set service-object-path","xml":"<set>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $service-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n","comments":"","x":1228.250099182129,"y":959.6637916564941,"z":"d84650d6.6853b","wires":[]},{"id":"33d8b0b9.4de03","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n","comments":"","x":1202.535800933838,"y":1002.5209302902222,"z":"d84650d6.6853b","wires":[]},{"id":"4c011a86.6ca9e4","type":"switchNode","name":"switch vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":519.5237731933594,"y":349.2707953453064,"z":"d84650d6.6853b","wires":[["1d484ab5.212555"]]},{"id":"1d484ab5.212555","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":706.1904525756836,"y":348.6040930747986,"z":"d84650d6.6853b","wires":[["3d72b49a.dfbe0c"]]},{"id":"3d72b49a.dfbe0c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs in MD-SAL\" />\n","comments":"","x":887.8570785522461,"y":348.6040930747986,"z":"d84650d6.6853b","wires":[]},{"id":"3ffdfebf.a94f62","type":"for","name":"for each vnf","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":502.61901092529297,"y":395.74697160720825,"z":"d84650d6.6853b","wires":[["71a91129.2afc7"]]},{"id":"71a91129.2afc7","type":"switchNode","name":"switch this vnf-id == input vnf-id","xml":"<switch test='`$service-data.vnfs.vnf[$idx].vnf-id == $vnf-topology-operation-input.vnf-information.vnf-id`'>\n","comments":"","outputs":1,"x":757.6190986633301,"y":395.4136395454407,"z":"d84650d6.6853b","wires":[["ec4716db.366f98"]]},{"id":"ec4716db.366f98","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":988.9523849487305,"y":395.4136176109314,"z":"d84650d6.6853b","wires":[["b340587a.14bc08"]]},{"id":"b340587a.14bc08","type":"set","name":"set vnf-index","xml":"<set>\n<parameter name='vnf-index' value='`$idx`' />\n","comments":"","x":1164.2855796813965,"y":395.4136395454407,"z":"d84650d6.6853b","wires":[]},{"id":"848ed288.0a323","type":"switchNode","name":"switch vnf-index","xml":"<switch test='`$vnf-index`'>\n","comments":"","outputs":1,"x":514.2856750488281,"y":441.4136414527893,"z":"d84650d6.6853b","wires":[["bf8d4c59.bad85"]]},{"id":"bf8d4c59.bad85","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":695.9522933959961,"y":440.74697160720825,"z":"d84650d6.6853b","wires":[["6b0217ab.13f278"]]},{"id":"6b0217ab.13f278","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"'Could not find VNF ' + $vnf-topology-operation-input.vnf-information.vnf-id + ' in MD-SAL'\" />\n","comments":"","x":862.6189804077148,"y":440.41359758377075,"z":"d84650d6.6853b","wires":[]},{"id":"e3cb0.1ccff351","type":"set","name":"copy ONAP model information","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.`' />\n","comments":"","x":1251.607048034668,"y":862.2500286102295,"z":"d84650d6.6853b","wires":[]},{"id":"35f1cabd.ad4236","type":"set","name":"set vnf-level-oper-status to Created","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n","comments":"","x":1264.202522277832,"y":912.0446929931641,"z":"d84650d6.6853b","wires":[]},{"id":"198f754a.21cc0b","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1571.2858428955078,"y":580.0476360321045,"z":"d84650d6.6853b","wires":[[]]},{"id":"591c04ee.ad32ac","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1396.2858772277832,"y":625.0476264953613,"z":"d84650d6.6853b","wires":[["5bb0ece8.e079f4"]]},{"id":"73b1cc70.f76174","type":"get-resource","name":"get-resource VF_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODEL WHERE customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-model'>\n\n","comments":"","outputs":1,"x":1240.8691940307617,"y":789.6309394836426,"z":"d84650d6.6853b","wires":[["7c79848.c27b07c","afabb41.7670148"]]},{"id":"5cfb938f.c2a60c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No model found for VNF customization UUID ' + $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`\" />\n","comments":"","x":1593.9643821716309,"y":814.7261123657227,"z":"d84650d6.6853b","wires":[]},{"id":"7c79848.c27b07c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1428.3215827941895,"y":770.0117769241333,"z":"d84650d6.6853b","wires":[["4e267b5c.216c84"]]},{"id":"afabb41.7670148","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1436.8930130004883,"y":814.2974901199341,"z":"d84650d6.6853b","wires":[["5cfb938f.c2a60c"]]},{"id":"4e267b5c.216c84","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODEL table\" />\n","comments":"","x":1593.3215827941895,"y":769.8213710784912,"z":"d84650d6.6853b","wires":[]},{"id":"62a1b7be.065008","type":"comment","name":"check removed with US622450","info":"","comments":"","x":1785.5716171264648,"y":591.00000166893,"z":"d84650d6.6853b","wires":[]},{"id":"f32a4fea.2c96b","type":"call","name":"call self-serve-vnf-changeassign","xml":"<call module='GENERIC-RESOURCE-API' rpc='self-serve-vnf-changeassign' mode='sync' >\n","comments":"","outputs":1,"x":1000.9285583496094,"y":1146.4644346237183,"z":"d84650d6.6853b","wires":[["50726d7e.731414","f9c4545a.90b8d8"]]},{"id":"50726d7e.731414","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1226.6785430908203,"y":1146.7144231796265,"z":"d84650d6.6853b","wires":[["3fccea3e.d01436"]]},{"id":"3fccea3e.d01436","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value=\"`'Encountered error performing changeassign for self-serve resources with error: '+ $error-message`\" />\n","comments":"","x":1386.2499694824219,"y":1146.3573179244995,"z":"d84650d6.6853b","wires":[]},{"id":"670a4655.0f0308","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":261.42858123779297,"y":395.71428537368774,"z":"d84650d6.6853b","wires":[["8d6e003.e53ef","4c011a86.6ca9e4","3ffdfebf.a94f62","848ed288.0a323","721219a1.3f1ec8","fa2765df.fe5b88"]]},{"id":"5e167505.53b26c","type":"comment","name":"self-serve FORKING LOGIC","info":"","comments":"","x":485.7142791748047,"y":499.9999828338623,"z":"d84650d6.6853b","wires":[]},{"id":"f9c4545a.90b8d8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1233.1430358886719,"y":1192.0001401901245,"z":"d84650d6.6853b","wires":[["cb4295a5.f1dcc8"]]},{"id":"cb4295a5.f1dcc8","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1401.7144508361816,"y":1191.5715818405151,"z":"d84650d6.6853b","wires":[]},{"id":"3c3e74.be8df18c","type":"switchNode","name":"switch model-customization-id","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`'>\n","comments":"","outputs":1,"x":1255.5714492797852,"y":722.4643001556396,"z":"d84650d6.6853b","wires":[["53be53bf.12a77c"]]},{"id":"53be53bf.12a77c","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1460.5714492797852,"y":722.464282989502,"z":"d84650d6.6853b","wires":[["d793a0f5.080fa"]]},{"id":"d793a0f5.080fa","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"vf-module-information.onap-model-information.model-customization-uuid is a required input\" />\n","comments":"","x":1612.000015258789,"y":722.4642810821533,"z":"d84650d6.6853b","wires":[]},{"id":"45dc498f.a8c298","type":"comment","name":"model-customization-uuid validation moved from validate-vnf-input DG","info":"","comments":"","x":1389.3214492797852,"y":681.4643135070801,"z":"d84650d6.6853b","wires":[]},{"id":"721219a1.3f1ec8","type":"call","name":"call self-serve-vnf-forking-logic","xml":"<call module='GENERIC-RESOURCE-API' rpc='self-serve-vnf-forking-logic' mode='sync' >\n","comments":"","outputs":1,"x":557.1428489685059,"y":540.0000171661377,"z":"d84650d6.6853b","wires":[[]]},{"id":"fa2765df.fe5b88","type":"switchNode","name":"switch ss.self-serve-flag","xml":"<switch test=\"`$ss.self-serve-flag`\">\n","comments":"","outputs":1,"x":536.9999237060547,"y":598.4286022186279,"z":"d84650d6.6853b","wires":[["e088e76b.3accb8","5f5b2904.9c0c68"]]},{"id":"e088e76b.3accb8","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":763.9999237060547,"y":598.8571872711182,"z":"d84650d6.6853b","wires":[["882bb260.db908"]]},{"id":"5f5b2904.9c0c68","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":768.1427154541016,"y":1146.2859210968018,"z":"d84650d6.6853b","wires":[["f32a4fea.2c96b"]]}]