[
  {
    "id": "688d11a7.db457",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 119.00390625,
    "y": 85.28888085437939,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "e1d5eba9.a13628"
      ]
    ]
  },
  {
    "id": "e1d5eba9.a13628",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 373.50390625,
    "y": 85.28888085437939,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "d4ccfb4f.558f18"
      ]
    ]
  },
  {
    "id": "d4ccfb4f.558f18",
    "type": "method",
    "name": "sdwan-network-topology-operation-create",
    "xml": "<method rpc='sdwan-network-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 372.50390625,
    "y": 185.28888085437939,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "6f5dfed8.385d3"
      ]
    ]
  },
  {
    "id": "6f5dfed8.385d3",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 512.50390625,
    "y": 285.2888808543794,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "122df2f8.6d274d",
        "a575c3fa.61f11",
        "922e69e7.a3d7a8",
        "5d7736de.4069b8",
        "27cb2b03.b23a84",
        "47c22ea2.aab27",
        "8f02d925.52aa28",
        "eec5382a.01c068",
        "6cba311b.177c7",
        "aba522ee.20d06",
        "6bb7e42.0db951c"
      ]
    ]
  },
  {
    "id": "122df2f8.6d274d",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:validate-sdwan-network-input-parameters",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='validate-sdwan-network-input-parameters' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 942.5039176940918,
    "y": 103.06663277698681,
    "z": "60d023c5.cabe1c",
    "wires": [
      []
    ]
  },
  {
    "id": "a575c3fa.61f11",
    "type": "record",
    "name": "record",
    "xml": "<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.FileRecorder\">\n<parameter name=\"file\" value=\"/opt/opendaylight/current/data/log/svclogic.log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"sdwan-network-topology-operation-create\"/>\n<parameter name=\"field3\" value=\"SDWAN-Config\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 736.0595626831055,
    "y": 280.5110926628113,
    "z": "60d023c5.cabe1c",
    "wires": [
      []
    ]
  },
  {
    "id": "922e69e7.a3d7a8",
    "type": "execute",
    "name": "execute generate prop.sdwan.network-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.sdwan.network-id\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 838.5039138793945,
    "y": 147.06663513183594,
    "z": "60d023c5.cabe1c",
    "wires": [
      []
    ]
  },
  {
    "id": "5d7736de.4069b8",
    "type": "switchNode",
    "name": "switch service-data.networks_length",
    "xml": "<switch test='`$service-data.networks.network_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 827.0595626831055,
    "y": 240.51109266281128,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "18f092a5.32926d",
        "30abb8ec.b5d758"
      ]
    ]
  },
  {
    "id": "18f092a5.32926d",
    "type": "other",
    "name": "Null",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 1056.0595626831055,
    "y": 220.51109266281128,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "6b96ad21.6fe954"
      ]
    ]
  },
  {
    "id": "30abb8ec.b5d758",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1056.0595626831055,
    "y": 260.5110926628113,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "9b1eb0f3.03df9"
      ]
    ]
  },
  {
    "id": "6b96ad21.6fe954",
    "type": "set",
    "name": "set nidx",
    "xml": "<set>\n<parameter name='nidx' value='0' />\n",
    "comments": "",
    "x": 1198.5595626831055,
    "y": 220.51109266281128,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "144f1430.6e2a2c",
    "type": "set",
    "name": "set nidx",
    "xml": "<set>\n<parameter name='nidx' value='`$service-data.networks.network_length`' />\n",
    "comments": "",
    "x": 1332.1150817871094,
    "y": 222.06670236587524,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "27cb2b03.b23a84",
    "type": "set",
    "name": "set network in service-data",
    "xml": "<set>\n<parameter name='service-data.networks.network[$nidx].network-id' value='`$prop.sdwan.network-id`' />\n<parameter name='service-data.networks.network[$nidx].network-data.sdnc-request-header.' value='`$network-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.networks.network[$nidx].network-data.request-information.' value='`$network-topology-operation-input.request-information.`' />\n<parameter name='service-data.networks.network[$nidx].network-data.service-information.' value='`$network-topology-operation-input.service-information.`' />\n<parameter name='service-data.networks.network[$nidx].network-data.network-information.' value='`$network-topology-operation-input.network-information.`' />\n<parameter name='service-data.networks.network[$nidx].network-data.network-request-input.' value='`$network-topology-operation-input.network-request-input.`' />\n<parameter name='service-data.networks.network_length' value='`$nidx+1`' />\n\n",
    "comments": "",
    "x": 797.5595626831055,
    "y": 320.5110926628113,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "47c22ea2.aab27",
    "type": "set",
    "name": "set networkId and network-object-path",
    "xml": "<set>\n<parameter name='networkId' value='`$prop.sdwan.network-id`' />\n<parameter name=\"network-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $network-topology-operation-input.service-information.service-instance-id  + '/service-data/networks/network/'  + $prop.sdwan.network-id  + '/network-data/'` \" />",
    "comments": "",
    "x": 833.0595626831055,
    "y": 360.5110926628113,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "8f02d925.52aa28",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 757.7264022827148,
    "y": 530.1778182983398,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "eec5382a.01c068",
    "type": "set",
    "name": "set network-level-oper-status",
    "xml": "<set>\n<parameter name='service-data.networks.network[$nidx].network-data.network-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.networks.network[$nidx].network-data.network-level-oper-status.last-rpc-action' value='`$network-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.networks.network[$nidx].network-data.network-level-oper-status.last-action' value='`$network-topology-operation-input.request-information.request-action`' />",
    "comments": "",
    "x": 804.5595626831055,
    "y": 400.5110926628113,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "97c23cb8.cc8d8",
    "type": "for",
    "name": "for each existing network",
    "xml": "<for index='idx' start='0' end='`$nidx`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1201.5436248779297,
    "y": 365.28884455608204,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "30c4fff.3f577"
      ]
    ]
  },
  {
    "id": "9b1eb0f3.03df9",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1200.4166069030762,
    "y": 260.4476046562195,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "97c23cb8.cc8d8",
        "144f1430.6e2a2c"
      ]
    ]
  },
  {
    "id": "30c4fff.3f577",
    "type": "switchNode",
    "name": "switch networkid found",
    "xml": "<switch test=\"`$service-data.networks.network[$idx].network-id == $network-topology-operation-input.network-information.network-id`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1476.829345703125,
    "y": 364.8603472416289,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "d2ce2b28.5e29e8"
      ]
    ]
  },
  {
    "id": "d2ce2b28.5e29e8",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1377.5595436096191,
    "y": 423.43177840160206,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "f1e681ab.ee1c1"
      ]
    ]
  },
  {
    "id": "5f52499a.1b3a58",
    "type": "comment",
    "name": "make sure this network doesn't exist already",
    "info": "",
    "comments": "",
    "x": 1425.1943550109863,
    "y": 323.5429019634612,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "f1e681ab.ee1c1",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"network-topology-operation-input.network-request-input.network-id already found in service-data\" />\n",
    "comments": "",
    "x": 1525.3096466064453,
    "y": 423.28897047042847,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "3715a6c8.5b9a7a",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1491.961139678955,
    "y": 193.06668996810913,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "e8cbf5d3.3c9d38",
        "54012a96.723714"
      ]
    ]
  },
  {
    "id": "e8cbf5d3.3c9d38",
    "type": "switchNode",
    "name": "switch name",
    "xml": "<switch test=\"`$network-topology-operation-input.network-request-input.network-input-parameters.param[$idx].name == 'name'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1680.1829833984375,
    "y": 175.39999413490295,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "f228e37d.0f2a2"
      ]
    ]
  },
  {
    "id": "f228e37d.0f2a2",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1867.1829833984375,
    "y": 171.39999413490295,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "7c1c28e6.2d07b8"
      ]
    ]
  },
  {
    "id": "7c1c28e6.2d07b8",
    "type": "set",
    "name": "set name",
    "xml": "<set>\n<parameter name='prop.name' value='`$network-topology-operation-input.network-request-input.network-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 2017.1831130981445,
    "y": 170.00000071525574,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "54012a96.723714",
    "type": "switchNode",
    "name": "switch topology",
    "xml": "<switch test=\"`$network-topology-operation-input.network-request-input.network-input-parameters.param[$idx].name == 'topology'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1691.0226440429688,
    "y": 215.39999222755432,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "e98b9c1d.e4ed8"
      ]
    ]
  },
  {
    "id": "e98b9c1d.e4ed8",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1861.0226440429688,
    "y": 211.39999222755432,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "dbc89ad1.a2ed48"
      ]
    ]
  },
  {
    "id": "dbc89ad1.a2ed48",
    "type": "set",
    "name": "set topology",
    "xml": "<set>\n<parameter name='prop.topology' value='`$network-topology-operation-input.network-request-input.network-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 2048.3560848236084,
    "y": 209.8611490726471,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "6cba311b.177c7",
    "type": "for",
    "name": "for loop i - Network input parameters",
    "xml": "<for index=\"idx\" start=\"0\" end=\"`$network-topology-operation-input.network-request-input.network-input-parameters.param_length`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 829.7383041381836,
    "y": 190.8444209098816,
    "z": "60d023c5.cabe1c",
    "wires": [
      [
        "3715a6c8.5b9a7a"
      ]
    ]
  },
  {
    "id": "35a9ce0f.ae54c2",
    "type": "comment",
    "name": "TODO: Recheck AAI schemas",
    "info": "",
    "comments": "",
    "x": 801.0351867675781,
    "y": 49.43131971359253,
    "z": "60d023c5.cabe1c",
    "wires": []
  },
  {
    "id": "aba522ee.20d06",
    "type": "save",
    "name": "save sdwan vpn resource in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='sdwan-vpn' \n      key='sdwan-vpn.id = $prop.sdwan.network-id' >\n<parameter name='id' value='`$prop.sdwan.network-id`' />\n<parameter name='name' value='`$prop.name`' />\n<parameter name='topology' value='`$prop.topology`' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-uuid`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $network-topology-operation-input.service-information.service-instance-id  + '/service-data/networks/network/'  + $prop.sdwan.network-id  + '/network-data/'` \" />",
    "comments": "",
    "outputs": 1,
    "x": 814.0038986206055,
    "y": 440.0039348602295,
    "z": "60d023c5.cabe1c",
    "wires": [
      []
    ]
  },
  {
    "id": "6bb7e42.0db951c",
    "type": "save",
    "name": "save service relationship in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id \n         AND customer.global-customer-id = $service-data.networks.network[$nidx].network-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.networks.network[$nidx].network-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"sdwan-vpn\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/sdwan-vpns/sdwan-vpn/' + $prop.sdwan.network-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"sdwan-vpn.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.sdwan.network-id`\" />",
    "comments": "",
    "outputs": 1,
    "x": 810.00390625,
    "y": 487.00390625,
    "z": "60d023c5.cabe1c",
    "wires": [
      []
    ]
  }
]
