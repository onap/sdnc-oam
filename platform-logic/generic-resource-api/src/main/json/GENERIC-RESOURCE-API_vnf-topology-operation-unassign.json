[{"id":"2fd9471b.69af38","type":"dgstart","name":"DGSTART","outputs":1,"x":158.57142639160156,"y":106.6993715763092,"z":"4c9ab6a.7151748","wires":[["e752038e.d1f5a"]]},{"id":"e752038e.d1f5a","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":272.8571319580078,"y":146.93748307228088,"z":"4c9ab6a.7151748","wires":[["d99c33c9.917fc"]]},{"id":"d99c33c9.917fc","type":"method","name":"method vnf-topology-operation-unassign","xml":"<method rpc='vnf-topology-operation-unassign' mode='sync'>\n","comments":"","outputs":1,"x":255.00005340576172,"y":186.6993715763092,"z":"4c9ab6a.7151748","wires":[["d7bc4779.1eda58"]]},{"id":"6b4e98eb.f45fd8","type":"comment","name":"vnf-topology-operation-unassign","info":"","comments":"","x":552.9162826538086,"y":54.28571534156799,"z":"4c9ab6a.7151748","wires":[]},{"id":"57b1a585.c0996c","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vnf-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":562.0952377319336,"y":285.5565092563629,"z":"4c9ab6a.7151748","wires":[["95806c13.7cfc4","c0203520.38f9e8"]]},{"id":"95806c13.7cfc4","type":"outcome","name":"DeleteVnfInstance","xml":"<outcome value='DeleteVnfInstance'>\n","comments":"","outputs":1,"x":815.8095321655273,"y":262.69939064979553,"z":"4c9ab6a.7151748","wires":[["510e3baf.6c03d4"]]},{"id":"c0203520.38f9e8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":777.809497833252,"y":308.41371846199036,"z":"4c9ab6a.7151748","wires":[["76420941.8dbeb8"]]},{"id":"510e3baf.6c03d4","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1000.6666603088379,"y":262.69942021369934,"z":"4c9ab6a.7151748","wires":[[]]},{"id":"76420941.8dbeb8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'deactivate' then request-action must be 'DeleteVnfInstance'\" />\n","comments":"","x":1017.8095054626465,"y":308.41367650032043,"z":"4c9ab6a.7151748","wires":[]},{"id":"d7bc4779.1eda58","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":236.9047622680664,"y":580.0327055454254,"z":"4c9ab6a.7151748","wires":[["57b1a585.c0996c","ef167729.c653b8","242976d0.d2fb7a","f9db2fc6.f607d","e75b1912.e02048","b229bc58.834c5","5f46dba8.c562c4"]]},{"id":"ef167729.c653b8","type":"switchNode","name":"switch vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":548.5714111328125,"y":355.0327351093292,"z":"4c9ab6a.7151748","wires":[["df45106f.9abac"]]},{"id":"df45106f.9abac","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":735.2380905151367,"y":354.3660328388214,"z":"4c9ab6a.7151748","wires":[["3704f169.a2fc9e"]]},{"id":"3704f169.a2fc9e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs in MD-SAL\" />\n","comments":"","x":916.9047164916992,"y":354.3660328388214,"z":"4c9ab6a.7151748","wires":[]},{"id":"f9db2fc6.f607d","type":"for","name":"for each vnf","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":530.2380905151367,"y":403.36605286598206,"z":"4c9ab6a.7151748","wires":[["29131551.89e82a"]]},{"id":"29131551.89e82a","type":"switchNode","name":"switch this vnf-id == input vnf-id","xml":"<switch test='`$service-data.vnfs.vnf[$idx].vnf-id == $vnf-topology-operation-input.vnf-information.vnf-id`' >\n","comments":"","outputs":1,"x":785.2381782531738,"y":402.0327208042145,"z":"4c9ab6a.7151748","wires":[["797c5e5.ac056a"]]},{"id":"797c5e5.ac056a","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1023.5714645385742,"y":401.0326988697052,"z":"4c9ab6a.7151748","wires":[["68e43d11.eea054"]]},{"id":"68e43d11.eea054","type":"set","name":"set vnf-index","xml":"<set>\n<parameter name='vnf-index' value='`$idx`' />\n","comments":"","x":1191.9046592712402,"y":401.0327208042145,"z":"4c9ab6a.7151748","wires":[]},{"id":"e75b1912.e02048","type":"switchNode","name":"switch vnf-index","xml":"<switch test='`$vnf-index`'>\n","comments":"","outputs":1,"x":541.9047546386719,"y":450.0327227115631,"z":"4c9ab6a.7151748","wires":[["8227e3f6.9aa9a"]]},{"id":"8227e3f6.9aa9a","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":723.5713729858398,"y":449.36605286598206,"z":"4c9ab6a.7151748","wires":[["b4e649ce.eb6988"]]},{"id":"b4e649ce.eb6988","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"'Could not find VNF ' + $vnf-topology-operation-input.vnf-information.vnf-id + ' in MD-SAL'\" />\n","comments":"","x":890.2380599975586,"y":449.03267884254456,"z":"4c9ab6a.7151748","wires":[]},{"id":"aacab2cf.b24bf","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1191.698501586914,"y":1084.5562915802002,"z":"4c9ab6a.7151748","wires":[]},{"id":"8a0320db.451c4","type":"for","name":"for each vnf","xml":"<for index='idx' start='`$vnf-index + 1`' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":1712.1760787963867,"y":830.112060546875,"z":"4c9ab6a.7151748","wires":[["cefd1cf4.4bf99"]]},{"id":"d25cea27.cb6248","type":"comment","name":"Remove VNF from service data","info":"","comments":"","x":1154.334846496582,"y":788.6837129592896,"z":"4c9ab6a.7151748","wires":[]},{"id":"cefd1cf4.4bf99","type":"set","name":"move vnf to remove one","xml":"<set>\n\t<parameter name=\"$tmpidx\" value=\"`$idx - 1`\"/>\n\t<parameter name=\"service-data.vnfs.vnf[$tmpidx].\" value=\"$service-data.vnfs.vnf[$idx].\" />\n\t\n","comments":"","x":1945.7672119140625,"y":829.1360120773315,"z":"4c9ab6a.7151748","wires":[]},{"id":"7a3c4303.9ec5ec","type":"switchNode","name":"switch vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":1198.4339408874512,"y":831.691689491272,"z":"4c9ab6a.7151748","wires":[["9f19ae27.d107e","b366d422.c1b158"]]},{"id":"9f19ae27.d107e","type":"outcome","name":"1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1375.433982849121,"y":792.3582763671875,"z":"4c9ab6a.7151748","wires":[["68a27479.2c17fc"]]},{"id":"68a27479.2c17fc","type":"set","name":"Remove vnfs","xml":"<set>\n\t<parameter name=\"service-data.vnfs.\" value=\"\"/>\n\n","comments":"","x":1539.1004791259766,"y":792.3583755493164,"z":"4c9ab6a.7151748","wires":[]},{"id":"b366d422.c1b158","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1376.9578742980957,"y":872.834415435791,"z":"4c9ab6a.7151748","wires":[["87575c7b.87768"]]},{"id":"fa8677dd.7dc038","type":"set","name":"set new vnf length","xml":"<set>\n\t<parameter name=\"service-data.vnfs.vnf_length\" value=\"`$service-data.vnfs.vnf_length - 1`\"/>\n\n\t\n","comments":"","x":1731.730167388916,"y":920.6916341781616,"z":"4c9ab6a.7151748","wires":[]},{"id":"452d1003.58e5f","type":"set","name":"Remove the last vnf in the list","xml":"<set>\n\t<parameter name=\"service-data.vnfs.vnf[$service-data.vnfs.vnf_length-1].\" value=\"\"/>\n\n","comments":"","x":1767.433822631836,"y":875.8026552200317,"z":"4c9ab6a.7151748","wires":[]},{"id":"87575c7b.87768","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1542.7672157287598,"y":876.3581962585449,"z":"4c9ab6a.7151748","wires":[["8a0320db.451c4","452d1003.58e5f","fa8677dd.7dc038"]]},{"id":"75c7b96f.9b29d8","type":"switchNode","name":"switch current vnf-level-oper-status == Created","xml":"<switch test=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status == 'Created'`\">\n","comments":"","outputs":1,"x":641.2380676269531,"y":495.69939255714417,"z":"4c9ab6a.7151748","wires":[["b51a2a52.cee1c8"]]},{"id":"b51a2a52.cee1c8","type":"outcomeFalse","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":945.90478515625,"y":495.3660318851471,"z":"4c9ab6a.7151748","wires":[["4197f006.511ff"]]},{"id":"4197f006.511ff","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Cannot delete a VNF in a Created state\" />\n","comments":"","x":1104.2380599975586,"y":494.69935631752014,"z":"4c9ab6a.7151748","wires":[]},{"id":"242976d0.d2fb7a","type":"switchNode","name":"switch current vf-module_length","xml":"<switch test=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`\">\n","comments":"","outputs":1,"x":591.5714111328125,"y":581.6993582248688,"z":"4c9ab6a.7151748","wires":[["1d4bad90.637232","d3006cf2.7221a","66c6314f.cac37"]]},{"id":"1d4bad90.637232","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":820.2380523681641,"y":538.3659994602203,"z":"4c9ab6a.7151748","wires":[["9c08ffe4.4e1f6"]]},{"id":"d3006cf2.7221a","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":818.8094635009766,"y":579.7946569919586,"z":"4c9ab6a.7151748","wires":[["9c08ffe4.4e1f6"]]},{"id":"9c08ffe4.4e1f6","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":967.3809776306152,"y":559.7946579456329,"z":"4c9ab6a.7151748","wires":[[]]},{"id":"66c6314f.cac37","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":818.809513092041,"y":621.2232449054718,"z":"4c9ab6a.7151748","wires":[["e0770e38.daef2"]]},{"id":"e0770e38.daef2","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Cannot delete the VNF because there are VFs defined\" />\n","comments":"","x":985.9524078369141,"y":620.7946331501007,"z":"4c9ab6a.7151748","wires":[]},{"id":"ec129d0c.3da5d","type":"call","name":"call GENERIC-RESOURCE-API:naming-policy-generate-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='naming-policy-generate-name' mode='sync' >\n","comments":"","outputs":1,"x":1339.8411331176758,"y":1028.3333406448364,"z":"4c9ab6a.7151748","wires":[[]]},{"id":"945a4b25.df5d68","type":"set","name":"set variables for deleting name","xml":"<set>\n<parameter name='naming-policy-generate-name-input.naming-type' value='VNF' />\n<parameter name='naming-policy-generate-name-input.context-id' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='naming-policy-generate-name-input.action' value='DELETE' />\n","comments":"","x":1241.2697525024414,"y":981.190411567688,"z":"4c9ab6a.7151748","wires":[]},{"id":"8c9c9812.e2add8","type":"comment","name":"check removed with US622450","info":"","comments":"","x":1311.4284362792969,"y":494.28574204444885,"z":"4c9ab6a.7151748","wires":[]},{"id":"fb7893eb.5d51b","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":948.8571472167969,"y":914.2857551574707,"z":"4c9ab6a.7151748","wires":[["7a3c4303.9ec5ec","945a4b25.df5d68","ec129d0c.3da5d","aacab2cf.b24bf"]]},{"id":"b229bc58.834c5","type":"call","name":"call self-serve-vnf-forking-logic","xml":"<call module='GENERIC-RESOURCE-API' rpc='self-serve-vnf-forking-logic' mode='sync' >\n","comments":"","outputs":1,"x":574.4286956787109,"y":724.285665512085,"z":"4c9ab6a.7151748","wires":[[]]},{"id":"5f46dba8.c562c4","type":"switchNode","name":"switch ss.self-serve-flag","xml":"<switch test=\"`$ss.self-serve-flag`\">\n","comments":"","outputs":1,"x":555.7143096923828,"y":914.14284324646,"z":"4c9ab6a.7151748","wires":[["ac0b2fd9.2b5cb","afe49b4f.f40a98"]]},{"id":"ac0b2fd9.2b5cb","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":771.7143096923828,"y":914.5714282989502,"z":"4c9ab6a.7151748","wires":[["fb7893eb.5d51b"]]},{"id":"8488e183.5299c","type":"call","name":"call self-serve-vnf-unassign","xml":"<call module='GENERIC-RESOURCE-API' rpc='self-serve-vnf-unassign' mode='sync' >\n","comments":"","outputs":1,"x":987.4285736083984,"y":1229.9999895095825,"z":"4c9ab6a.7151748","wires":[["94ec55d8.a11158","fac6e4ae.85d5b8"]]},{"id":"94ec55d8.a11158","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1195.1785583496094,"y":1230.2499780654907,"z":"4c9ab6a.7151748","wires":[["f8e2b999.669308"]]},{"id":"f8e2b999.669308","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value=\"`'Encountered error while unassigning self-serve resources with error: '+ $error-message`\" />\n","comments":"","x":1360.749984741211,"y":1229.8928728103638,"z":"4c9ab6a.7151748","wires":[]},{"id":"fac6e4ae.85d5b8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1199.785732269287,"y":1280.8055124282837,"z":"4c9ab6a.7151748","wires":[["941cfed4.1684d"]]},{"id":"941cfed4.1684d","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1368.3571472167969,"y":1280.3769540786743,"z":"4c9ab6a.7151748","wires":[]},{"id":"afe49b4f.f40a98","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":772.9999885559082,"y":1230.4285688400269,"z":"4c9ab6a.7151748","wires":[["8488e183.5299c"]]}]