[{"id":"46d6fdfc.0d3d74","type":"dgstart","name":"DGSTART","outputs":1,"x":142.00390625,"y":70.00390625,"z":"941656e1.8095c8","wires":[["3dff9ac3.bb3cb6"]]},{"id":"3dff9ac3.bb3cb6","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":273.2895965576172,"y":119.24201488494873,"z":"941656e1.8095c8","wires":[["2ef3e2.eacdfc1e"]]},{"id":"2ef3e2.eacdfc1e","type":"method","name":"method sdwan-vnf-topology-operation-wanport-activate","xml":"<method rpc='sdwan-vnf-topology-operation-wanport-activate' mode='sync'>\n","comments":"","outputs":1,"x":276.4325256347656,"y":204.00393867492676,"z":"941656e1.8095c8","wires":[["4424dee4.7277c"]]},{"id":"4424dee4.7277c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":339.67066192626953,"y":809.670895576477,"z":"941656e1.8095c8","wires":[["6e86cc91.e0dec4","5bdbf2ca.b4e3dc","151081d2.0192fe","c29d81d2.26164","a2e7cf45.ff9e2","38e08d51.507ad2","94bebe02.1a335","a5bbfdf4.35473","a43c9c13.d97cd","32a8d1f7.681cde","92918d15.6311e","11b93136.6ca9cf","539afc44.b0e354","141979cd.9670c6","b7e436fa.b674a8","1b1c84a1.cf917b","c375f7fa.294358","811217d2.ba2838","d9fd9ca8.ebcd1","626cbb77.e952f4"]]},{"id":"6e86cc91.e0dec4","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":666.338436126709,"y":1541.3386178016663,"z":"941656e1.8095c8","wires":[]},{"id":"32a8d1f7.681cde","type":"execute","name":"execute RestApiCallNode device port create","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"templateFileName\" value=\"`$prop.restapi.templateDir + '/sdwan-port.json'`\" />\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/controller/campus/v1/sdwan/net/ports'`\" />\n<parameter name=\"restapiUser\" value=\"`$prop.sdncRestApi.thirdpartySdnc.user`\" />\n<parameter name=\"restapiPassword\" value=\"`$prop.sdncRestApi.thirdpartySdnc.password`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"post\"/>\n<parameter name=\"responsePrefix\" value=\"portResp\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.onap.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>\n<parameter name='customHttpHeaders' value=\"`'X-ACCESS-TOKEN=' + $prop.sdncRestApi.token_id`\" />","comments":"","outputs":1,"x":754.3380165100098,"y":804.893404006958,"z":"941656e1.8095c8","wires":[["5cc9a68e.86df28","fed901a6.fef5b"]]},{"id":"5cc9a68e.86df28","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1003.3380756378174,"y":818.8936100006104,"z":"941656e1.8095c8","wires":[["19629438.2f203c"]]},{"id":"fed901a6.fef5b","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1003.3380756378174,"y":780.8934454917908,"z":"941656e1.8095c8","wires":[["b43125d5.1cbe28"]]},{"id":"b43125d5.1cbe28","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error executing Create device port rest api\" />\n","comments":"","x":1147.3384094238281,"y":779.8934450149536,"z":"941656e1.8095c8","wires":[]},{"id":"19629438.2f203c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":1150.3380870819092,"y":819.8934488296509,"z":"941656e1.8095c8","wires":[[]]},{"id":"92918d15.6311e","type":"execute","name":"execute RestApiCallNode get transport network info","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/controller/campus/v1/sdwan/net/network-orchestration-resources'`\" />\n<parameter name=\"restapiUser\" value=\"`$prop.sdncRestApi.thirdpartySdnc.user`\" />\n<parameter name=\"restapiPassword\" value=\"`$prop.sdncRestApi.thirdpartySdnc.password`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"get\"/>\n<parameter name=\"responsePrefix\" value=\"transportNetworksResp\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.onap.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>\n<parameter name='customHttpHeaders' value=\"`'X-ACCESS-TOKEN=' + $prop.sdncRestApi.token_id`\" />","comments":"","outputs":1,"x":777.0043678283691,"y":984.0045094490051,"z":"941656e1.8095c8","wires":[["3327c1fb.4d24fe","c55988fe.a0e798"]]},{"id":"539afc44.b0e354","type":"execute","name":"execute RestApiCallNode wan port create","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"templateFileName\" value=\"`$prop.restapi.templateDir + '/sdwan-wan-port.json'`\" />\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/controller/campus/v1/sdwan/net/transport-network-ports'`\" />\n<parameter name=\"restapiUser\" value=\"`$prop.sdncRestApi.thirdpartySdnc.user`\" />\n<parameter name=\"restapiPassword\" value=\"`$prop.sdncRestApi.thirdpartySdnc.password`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"post\"/>\n<parameter name=\"responsePrefix\" value=\"wanPortResp\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.onap.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>\n<parameter name='customHttpHeaders' value=\"`'X-ACCESS-TOKEN=' + $prop.sdncRestApi.token_id`\" />","comments":"","outputs":1,"x":750.0044593811035,"y":1221.004557609558,"z":"941656e1.8095c8","wires":[["ad0f8d25.41a07","6aa8a6c5.0c81c8"]]},{"id":"5bdbf2ca.b4e3dc","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":736.0248413085938,"y":148.02481842041016,"z":"941656e1.8095c8","wires":[["a576fae9.715c48","c3727d96.694c","c11796b3.901648"]]},{"id":"a576fae9.715c48","type":"other","name":"Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":988.0248756408691,"y":149.02489948272705,"z":"941656e1.8095c8","wires":[["5f0271db.92f1e"]]},{"id":"5f0271db.92f1e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"vnf-topology-operation-input.vnf-request-input.vnf-id not found in service-data\" />\n","comments":"","x":1149.8026237487793,"y":128.91384649276733,"z":"941656e1.8095c8","wires":[]},{"id":"c3727d96.694c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":981.0252838134766,"y":182.02490329742432,"z":"941656e1.8095c8","wires":[["dfdaa60f.2c4798"]]},{"id":"dfdaa60f.2c4798","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1004.2947998046875,"y":280.5794982910156,"z":"941656e1.8095c8","wires":[["29ab81e8.aad05e","1ff5f2ad.bd779d","d40815b2.6f0e48","ae71fbba.546708","cda43949.a48508"]]},{"id":"29ab81e8.aad05e","type":"for","name":"for vidx..service-data.vnfs.vnf_length[]","xml":"<for index='vidx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":1284.3109436035156,"y":174.45346450805664,"z":"941656e1.8095c8","wires":[["27d5ec0c.5024d4"]]},{"id":"1ff5f2ad.bd779d","type":"switchNode","name":"switch tmp.vidx ","xml":"<switch test=\"`$tmp.vidx`\">\n\n","comments":"","outputs":1,"x":1210.612247467041,"y":320.43669986724854,"z":"941656e1.8095c8","wires":[["e7d084a0.2326d8"]]},{"id":"e7d084a0.2326d8","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1358.0408897399902,"y":320.0081100463867,"z":"941656e1.8095c8","wires":[["2ada3281.d776de"]]},{"id":"d3e4c80f.d09fa8","type":"switchNode","name":"switch vnfid found","xml":"<switch test=\"`$service-data.vnfs.vnf[$vidx].vnf-id == $vnf-topology-operation-input.vnf-information.vnf-id`\">\n\n","comments":"","outputs":1,"x":1657.7401733398438,"y":173.70362663269043,"z":"941656e1.8095c8","wires":[["2986fb68.2295a4"]]},{"id":"2ada3281.d776de","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"vnf-topology-operation-input.vnf-request-input.vnf-id not found in service-data\" />\n","comments":"","x":1507.4696159362793,"y":321.15102767944336,"z":"941656e1.8095c8","wires":[]},{"id":"2986fb68.2295a4","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1812.6921653747559,"y":174.59630584716797,"z":"941656e1.8095c8","wires":[["18f7dec7.63c771"]]},{"id":"c972958e.ff1258","type":"set","name":"set tmp.vidx and ctx.vnf-data","xml":"<set>\n<parameter name='tmp.vidx' value='`$vidx`' />\n<parameter name='ctx.vnf-data.' value='`$service-data.vnfs.vnf[$vidx].`' />\n","comments":"","x":2220.224250793457,"y":84.34636402130127,"z":"941656e1.8095c8","wires":[]},{"id":"c11796b3.901648","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":989.9936256408691,"y":112.99358558654785,"z":"941656e1.8095c8","wires":[["5f0271db.92f1e"]]},{"id":"141979cd.9670c6","type":"set","name":"set device PortId to service data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param[$service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length].name' value='devicePortId' />\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param[$service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length].value' value='`$prop.wan.devicePortId`' />\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length' value='`$service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length + 1`' />\n\n\n\n\n","comments":"","x":718.9948272705078,"y":1277.9951152801514,"z":"941656e1.8095c8","wires":[]},{"id":"40c1c1e5.e807e","type":"comment","name":"Get siteId from site resource created for this service","info":"","comments":"","x":761.9938888549805,"y":333.32712268829346,"z":"941656e1.8095c8","wires":[]},{"id":"27d5ec0c.5024d4","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1503.6605758666992,"y":173.99354457855225,"z":"941656e1.8095c8","wires":[["d3e4c80f.d09fa8"]]},{"id":"151081d2.0192fe","type":"set","name":"set vnfId and vnf-object-path","xml":"<set>\n<parameter name='vnfId' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $vnf-topology-operation-input.vnf-information.vnf-id  + '/vnf-data/'` \" />","comments":"","x":699.5501403808594,"y":1420.217029094696,"z":"941656e1.8095c8","wires":[]},{"id":"c29d81d2.26164","type":"set","name":"set vnf-level-oper-status to Active","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-level-oper-status.order-status' value='Active' />\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n","comments":"","x":716.9946022033691,"y":1459.9948649406433,"z":"941656e1.8095c8","wires":[]},{"id":"d9fd9ca8.ebcd1","type":"update","name":"update SDWAN wan port instance configuration in AAI","xml":"<update plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='wan-port-config' \n      key='wan-port-config.wan-port-config-id = $vnf-topology-operation-input.vnf-information.vnf-id' >\n<parameter name=\"wan-port-config-id\" value=\"`$vnf-topology-operation-input.vnf-information.vnf-id`\" />\n<parameter name='operational-status' value='Active' />\n<parameter name='device-port-id' value='`$prop.wan.devicePortId`' />\n<parameter name='wan-port-id' value='`$prop.wan.wanPortId`' />\n<parameter name='model-customization-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n","comments":"","outputs":1,"x":779.657527923584,"y":1499.1423268318176,"z":"941656e1.8095c8","wires":[[]]},{"id":"540113a8.f6e3bc","type":"set","name":"set prop.wan.transportNetworkId","xml":"<set>\n<parameter name='prop.wan.transportNetworkId' value='`$transportNetworksResp.data.transportNetworks[$tidx].id`' />\n","comments":"","x":1531.995449066162,"y":1060.9945812225342,"z":"941656e1.8095c8","wires":[]},{"id":"811217d2.ba2838","type":"for","name":"for loop sidx - Get siteId from servicedata","xml":"<for index=\"sidx\" start=\"0\" end=\"`$ctx.site.vnf-data.vnf-request-input.vnf-input-parameters.param_length`\">\n    \n    \n","comments":"","outputs":1,"x":741.9939117431641,"y":483.9937791824341,"z":"941656e1.8095c8","wires":[["5a526d31.0941f4"]]},{"id":"eb17c95f.c77458","type":"switchNode","name":"switch siteId","xml":"<switch test=\"`$ctx.site.vnf-data.vnf-request-input.vnf-input-parameters.param[$sidx].name == 'siteId'`\">\n","comments":"","outputs":1,"x":1172.994239807129,"y":484.99390983581543,"z":"941656e1.8095c8","wires":[["fec4cb2a.2c7e38"]]},{"id":"fec4cb2a.2c7e38","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1310.9946975708008,"y":482.99389457702637,"z":"941656e1.8095c8","wires":[["b43cbcc4.04945"]]},{"id":"b43cbcc4.04945","type":"set","name":"set prop.wan.siteId","xml":"<set>\n<parameter name='prop.wan.siteId' value='`$ctx.site.vnf-data.vnf-request-input.vnf-input-parameters.param[$sidx].value`' />\n\n\n","comments":"","x":1474.9947319030762,"y":484.59374809265137,"z":"941656e1.8095c8","wires":[]},{"id":"11b93136.6ca9cf","type":"execute","name":"execute split ip and mask","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$prop.wan.ipAddress`'/>\n<parameter name=\"regex\" value=\"/\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"ipandMask\"/>\n","comments":"","outputs":1,"x":700.9942359924316,"y":1129.3275499343872,"z":"941656e1.8095c8","wires":[["8bee1efd.9d6b2","15fadf5a.5c3931"]]},{"id":"15fadf5a.5c3931","type":"failure","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":901.994255065918,"y":1107.3275413513184,"z":"941656e1.8095c8","wires":[["8296d7d6.8486f8"]]},{"id":"8bee1efd.9d6b2","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":901.9942588806152,"y":1148.3275451660156,"z":"941656e1.8095c8","wires":[["202ce5b1.58685a"]]},{"id":"8296d7d6.8486f8","type":"set","name":"set ipAddress prefixLength","xml":"<set>\n<parameter name='prop.wan.ip-address' value='`$ipandMask[0]`' />\n<parameter name='prop.wan.prefixLength' value='`$ipandMask[1]`' />","comments":"","x":1098.9942741394043,"y":1105.3275413513184,"z":"941656e1.8095c8","wires":[]},{"id":"202ce5b1.58685a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value=\"An error occured while splitting sna1_route\" />\n","comments":"","x":1056.9942665100098,"y":1145.3275442123413,"z":"941656e1.8095c8","wires":[]},{"id":"a5bbfdf4.35473","type":"get-resource","name":"get-resource esr-thirdparty-sdnc","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"esr-thirdparty-sdnc\" \n\t\tkey=\"esr-thirdparty-sdnc.thirdparty-sdnc-id = SDWANController AND \n\t\t     depth = '1'\"\n        pfx='tmp.aai.esr-thirdparty-sdnc' local-only='false' >\n\n","comments":"","outputs":1,"x":716.4940795898438,"y":581.9938354492188,"z":"941656e1.8095c8","wires":[["a1fae638.ce0e38","c7e4f763.873648","695a6a89.62d134"]]},{"id":"a1fae638.ce0e38","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":948.4941635131836,"y":545.9938583374023,"z":"941656e1.8095c8","wires":[["43c09877.81b248"]]},{"id":"c7e4f763.873648","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":950.9850463867188,"y":581.5678949356079,"z":"941656e1.8095c8","wires":[["7bb99ede.125ea"]]},{"id":"695a6a89.62d134","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":946.3180541992188,"y":617.9012537002563,"z":"941656e1.8095c8","wires":[["7755af9b.62a34"]]},{"id":"7755af9b.62a34","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unexpected error occurred while querying esr-thirdparty-sdnc from AnAI with thirdparty-sdnc-id = ' + $tmp.thirdparty-sdnc-id`\" />\n\n","comments":"","x":1100.0905456542969,"y":615.3403406143188,"z":"941656e1.8095c8","wires":[]},{"id":"7bb99ede.125ea","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'An error occurred while querying esr-thirdparty-sdnc from AnAI with thirdparty-sdnc-id = ' + $tmp.thirdparty-sdnc-id`\" />\n\n","comments":"","x":1096.5564422607422,"y":579.8535823822021,"z":"941656e1.8095c8","wires":[]},{"id":"43c09877.81b248","type":"set","name":"set controller data","xml":"<set>\n<parameter name='prop.sdncRestApi.thirdpartySdnc.url' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].service-url`\" />\n<parameter name='prop.sdncRestApi.thirdpartySdnc.user' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].user-name`\" />\n<parameter name='prop.sdncRestApi.thirdpartySdnc.password' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].password`\" />\n","comments":"","x":1108.9942741394043,"y":543.9937982559204,"z":"941656e1.8095c8","wires":[]},{"id":"a2e7cf45.ff9e2","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.FileRecorder\">\n<parameter name=\"file\" value=\"/opt/opendaylight/current/data/log/svclogic.log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"sdwan-wanport-vnf-topology-operation-activate\"/>\n<parameter name=\"field3\" value=\"SDWAN-Activate\"/>\n","comments":"","outputs":1,"x":654.0040016174316,"y":204.00393629074097,"z":"941656e1.8095c8","wires":[[]]},{"id":"38e08d51.507ad2","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":690.3061256408691,"y":239.00398015975952,"z":"941656e1.8095c8","wires":[[]]},{"id":"a43c9c13.d97cd","type":"execute","name":"execute RestApiCallNode Get token","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"templateFileName\" value=\"`$prop.restapi.templateDir + '/actokentemplate.json'`\" />\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/controller/v2/tokens'`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"post\"/>\n<parameter name=\"responsePrefix\" value=\"token-result\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.onap.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>","comments":"","outputs":1,"x":731.0042114257812,"y":669.6708374023438,"z":"941656e1.8095c8","wires":[["7b139fe2.0d3ea","5f5e8987.ed1188"]]},{"id":"7b139fe2.0d3ea","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":966.004337310791,"y":655.670825958252,"z":"941656e1.8095c8","wires":[["64afeedb.7ff63"]]},{"id":"64afeedb.7ff63","type":"set","name":"set token-id","xml":"<set>\n<parameter name='prop.sdncRestApi.token_id' value='`$token-result.data.token_id`' />\n","comments":"","x":1108.0043449401855,"y":654.6708269119263,"z":"941656e1.8095c8","wires":[]},{"id":"8c817f35.4dc83","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error executing get token rest api\" />\n","comments":"","x":1114.0043449401855,"y":692.0638151168823,"z":"941656e1.8095c8","wires":[]},{"id":"5f5e8987.ed1188","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":965.254337310791,"y":691.3137331008911,"z":"941656e1.8095c8","wires":[["8c817f35.4dc83"]]},{"id":"550c76f1.771f98","type":"switchNode","name":"switch transportNetworkName same","xml":"<switch test=\"`$transportNetworksResp.data.transportNetworks[$tidx].name == $prop.wan.transportNetworkName`\">\n\n","comments":"","outputs":1,"x":1171.0050621032715,"y":1018.6709794998169,"z":"941656e1.8095c8","wires":[["32465786.9bb1f8"]]},{"id":"32465786.9bb1f8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1384.0045127868652,"y":1018.6708974838257,"z":"941656e1.8095c8","wires":[["540113a8.f6e3bc"]]},{"id":"f0dc5ee5.ceaf8","type":"switchNode","name":"switch ActivateSDWANDeviceInstance","xml":"<switch test=\"`$service-data.vnfs.vnf[$vidx].vnf-data.request-information.request-action == 'ActivateSDWANDeviceInstance'`\">\n    \n    \n\n","comments":"","outputs":1,"x":1598.3375091552734,"y":251.00396347045898,"z":"941656e1.8095c8","wires":[["f3b0bb97.35fe78"]]},{"id":"f3b0bb97.35fe78","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1821.3375186920166,"y":251.00396347045898,"z":"941656e1.8095c8","wires":[["8f1b5c96.10d07"]]},{"id":"9ea18cc5.bcded","type":"set","name":"set tmp.devicevidx","xml":"<set>\n<parameter name='tmp.devicevidx' value='`$vidx`' />\n\n","comments":"","x":2786.3368530273438,"y":682.0039882659912,"z":"941656e1.8095c8","wires":[]},{"id":"cda43949.a48508","type":"switchNode","name":"switch tmp.devicevidx","xml":"<switch test=\"`$tmp.devicevidx`\">\n\n","comments":"","outputs":1,"x":1251.3374366760254,"y":409.0040259361267,"z":"941656e1.8095c8","wires":[["cab806dc.723728"]]},{"id":"cab806dc.723728","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1435.7660026550293,"y":409.57546281814575,"z":"941656e1.8095c8","wires":[["ce137ba4.ab4808"]]},{"id":"ce137ba4.ab4808","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"ActivateSDWANDeviceInstance not found in service-data\" />\n","comments":"","x":1576.1947441101074,"y":409.71834230422974,"z":"941656e1.8095c8","wires":[]},{"id":"273aead0.9eb3a6","type":"comment","name":"Get deviceId from device resource created for this service","info":"","comments":"","x":2235.6707916259766,"y":348.33724212646484,"z":"941656e1.8095c8","wires":[]},{"id":"4e13b56.4d1d64c","type":"for","name":"for loop didx - Get deviceId from servicedata","xml":"<for index=\"didx\" start=\"0\" end=\"`$service-data.vnfs.vnf[$vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length`\">\n    \n    \n","comments":"","outputs":1,"x":2221.671001434326,"y":272.00388622283936,"z":"941656e1.8095c8","wires":[["92766af3.12d248"]]},{"id":"c477fc4d.b0d32","type":"switchNode","name":"switch name (DeviceName)","xml":"<switch test=\"`$service-data.vnfs.vnf[$vidx].vnf-data.vnf-request-input.vnf-input-parameters.param[$didx].name == 'name'`\">\n","comments":"","outputs":1,"x":2239.671600341797,"y":410.0041313171387,"z":"941656e1.8095c8","wires":[["41bc9702.e49d18"]]},{"id":"41bc9702.e49d18","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2441.672092437744,"y":404.0041913986206,"z":"941656e1.8095c8","wires":[["2a414e7.1dfdeb2"]]},{"id":"5a526d31.0941f4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1004.0041046142578,"y":484.67060375213623,"z":"941656e1.8095c8","wires":[["eb17c95f.c77458"]]},{"id":"92766af3.12d248","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2014.003890991211,"y":408.6706323623657,"z":"941656e1.8095c8","wires":[["c477fc4d.b0d32"]]},{"id":"300379eb.34eba6","type":"switchNode","name":"switch deviceId","xml":"<switch test=\"`$service-data.vnfs.vnf[$vidx].vnf-data.vnf-request-input.vnf-input-parameters.param[$deviceidx].name == 'deviceId'`\">\n","comments":"","outputs":1,"x":3085.0050506591797,"y":622.6709289550781,"z":"941656e1.8095c8","wires":[["1e04fb03.c02275"]]},{"id":"1e04fb03.c02275","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3238.0054206848145,"y":623.6710062026978,"z":"941656e1.8095c8","wires":[["febe1667.67dc28"]]},{"id":"febe1667.67dc28","type":"set","name":"set prop.wan.deviceId","xml":"<set>\n<parameter name='prop.wan.deviceId' value='`$service-data.vnfs.vnf[$vidx].vnf-data.vnf-request-input.vnf-input-parameters.param[$deviceidx].value`' />\n","comments":"","x":3407.0060272216797,"y":622.2710409164429,"z":"941656e1.8095c8","wires":[]},{"id":"8f1b5c96.10d07","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1962.6708374023438,"y":273.00398349761963,"z":"941656e1.8095c8","wires":[["4e13b56.4d1d64c"]]},{"id":"2a414e7.1dfdeb2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2260.0051345825195,"y":487.0041608810425,"z":"941656e1.8095c8","wires":[["97c6ed04.8c4b6"]]},{"id":"7cbc77f3.7157c8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2649.0058403015137,"y":490.00428581237793,"z":"941656e1.8095c8","wires":[["fc9feae5.213678"]]},{"id":"18f7dec7.63c771","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1951.3376846313477,"y":175.00393962860107,"z":"941656e1.8095c8","wires":[["c972958e.ff1258","20413b2e.a4e934","d5207b14.483ab8","4003ca14.00a3a4"]]},{"id":"54164621.634478","type":"set","name":"set prop.wan.wanPortId","xml":"<set>\n<parameter name='prop.wan.wanPortId' value='`$wanPortResp.success[0].id`' />\n","comments":"","x":1326.3287029266357,"y":1239.6612844467163,"z":"941656e1.8095c8","wires":[]},{"id":"b7e436fa.b674a8","type":"set","name":"set prop.wan.devicePortId","xml":"<set>\n<parameter name='prop.wan.devicePortId' value='`$portResp.success[0].id`' />\n","comments":"","x":708.9952239990234,"y":866.9945602416992,"z":"941656e1.8095c8","wires":[]},{"id":"147912c.8f205ed","type":"comment","name":"Create port","info":"","comments":"","x":656.0039558410645,"y":771.3374280929565,"z":"941656e1.8095c8","wires":[]},{"id":"f901209e.dc4fb","type":"comment","name":"Get network id","info":"","comments":"","x":707.0040283203125,"y":949.3373865485191,"z":"941656e1.8095c8","wires":[]},{"id":"166789be.de4306","type":"comment","name":"Create wan port","info":"","comments":"","x":674.0041122436523,"y":1082.3375997543335,"z":"941656e1.8095c8","wires":[]},{"id":"6aa8a6c5.0c81c8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":986.0041160583496,"y":1207.0041790008545,"z":"941656e1.8095c8","wires":[["c6f20e4e.e6f5"]]},{"id":"ad0f8d25.41a07","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":990.0040855407715,"y":1241.004285812378,"z":"941656e1.8095c8","wires":[["4d940881.eaca88"]]},{"id":"4d940881.eaca88","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":1134.0041007995605,"y":1240.0041227340698,"z":"941656e1.8095c8","wires":[["54164621.634478"]]},{"id":"93fe9fd5.c023","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error executing Create wan port rest api\" />\n","comments":"","x":1308.004482269287,"y":1206.004210472107,"z":"941656e1.8095c8","wires":[]},{"id":"c55988fe.a0e798","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1083.0039558410645,"y":932.0040845870972,"z":"941656e1.8095c8","wires":[["3bae7b03.73d364"]]},{"id":"3327c1fb.4d24fe","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1083.0039520263672,"y":972.0042495727539,"z":"941656e1.8095c8","wires":[["f0b104fa.c0deb8"]]},{"id":"f0b104fa.c0deb8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":1227.0039672851562,"y":971.0040864944458,"z":"941656e1.8095c8","wires":[[]]},{"id":"3bae7b03.73d364","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error executing Get transport network info rest api\" />\n","comments":"","x":1225.0042877197266,"y":931.0040845870972,"z":"941656e1.8095c8","wires":[]},{"id":"d5207b14.483ab8","type":"call","name":"call sdwan-get-wan-param","xml":"<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-wan-param' mode='sync' >\n","comments":"","outputs":1,"x":2223.670539855957,"y":181.0039825439453,"z":"941656e1.8095c8","wires":[[]]},{"id":"20413b2e.a4e934","type":"set","name":"set vnf-request-input.","xml":"<set>\n<parameter name='vnf-request-input.' value='`$ctx.vnf-data.vnf-data.vnf-request-input.`' />\n\n","comments":"","x":2192.670539855957,"y":131.003999710083,"z":"941656e1.8095c8","wires":[]},{"id":"5b0f6055.7179","type":"comment","name":"This is also required for template parameters update","info":"","comments":"","x":2588.0043029785156,"y":227.00394248962402,"z":"941656e1.8095c8","wires":[]},{"id":"50e23754.b09268","type":"switchNode","name":"switch ActivateSiteInstance","xml":"<switch test=\"`$service-data.vnfs.vnf[$vidx].vnf-data.request-information.request-action == 'ActivateSiteInstance'`\">\n    \n    \n\n","comments":"","outputs":1,"x":1561.0043487548828,"y":216.00395584106445,"z":"941656e1.8095c8","wires":[["97fa566d.a78ef8"]]},{"id":"97fa566d.a78ef8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1757.0045318603516,"y":217.00395584106445,"z":"941656e1.8095c8","wires":[["f588a589.b88298"]]},{"id":"f588a589.b88298","type":"set","name":"set tmp.siteVidx","xml":"<set>\n<parameter name='tmp.siteVidx' value='`$vidx`' />\n<parameter name='ctx.site.' value='`$service-data.vnfs.vnf[$vidx].`' />\n\n","comments":"","x":1943.0038299560547,"y":214.00395965576172,"z":"941656e1.8095c8","wires":[]},{"id":"ae71fbba.546708","type":"switchNode","name":"switch tmp.siteVidx","xml":"<switch test=\"`$tmp.siteVidx`\">\n\n","comments":"","outputs":1,"x":1234.6706581115723,"y":358.00397634506226,"z":"941656e1.8095c8","wires":[["3f02b2e3.e5e5ae"]]},{"id":"3f02b2e3.e5e5ae","type":"outcome","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1409.0993690490723,"y":358.5754280090332,"z":"941656e1.8095c8","wires":[["54b3eb72.36f954"]]},{"id":"54b3eb72.36f954","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"ActivateSiteInstance not found in service-data\" />\n","comments":"","x":1551.5280876159668,"y":357.71829080581665,"z":"941656e1.8095c8","wires":[]},{"id":"97c6ed04.8c4b6","type":"switchNode","name":"switch deviceName match","xml":"<switch test=\"`$prop.wan.deviceName == $service-data.vnfs.vnf[$vidx].vnf-data.vnf-request-input.vnf-input-parameters.param[$didx].value`\">\n\n\n","comments":"","outputs":1,"x":2465.671859741211,"y":488.0042247772217,"z":"941656e1.8095c8","wires":[["7cbc77f3.7157c8"]]},{"id":"fc9feae5.213678","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2548.3377990722656,"y":562.0040683746338,"z":"941656e1.8095c8","wires":[["6c43560b.6674b8","9ea18cc5.bcded"]]},{"id":"6c43560b.6674b8","type":"for","name":"for loop deviceidx - Get deviceId from servicedata","xml":"<for index=\"deviceidx\" start=\"0\" end=\"`$service-data.vnfs.vnf[$vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length`\">\n    \n    \n","comments":"","outputs":1,"x":2828.5349502563477,"y":557.0352573394775,"z":"941656e1.8095c8","wires":[["95b06241.a3403"]]},{"id":"95b06241.a3403","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2905.5356826782227,"y":621.0353565216064,"z":"941656e1.8095c8","wires":[["300379eb.34eba6"]]},{"id":"4003ca14.00a3a4","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.FileRecorder\">\n<parameter name=\"file\" value=\"/opt/opendaylight/current/data/log/svclogic.log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\".....\"/>\n<parameter name=\"field3\" value=\"prop.wan.deviceName\"/>\n<parameter name=\"field4\" value='`$prop.wan.deviceName`'/>\n","comments":"","outputs":1,"x":2151.535285949707,"y":229.0351734161377,"z":"941656e1.8095c8","wires":[[]]},{"id":"d40815b2.6f0e48","type":"for","name":"for vidx..service-data.vnfs.vnf_length[]","xml":"<for index='vidx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":1277.003978729248,"y":252.0039234161377,"z":"941656e1.8095c8","wires":[["f0dc5ee5.ceaf8","50e23754.b09268"]]},{"id":"94bebe02.1a335","type":"set","name":"copy input data to service data","xml":"<set>\n<!--parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-id' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' /-->\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />","comments":"","x":712.0351943969727,"y":1374.5353388786316,"z":"941656e1.8095c8","wires":[]},{"id":"83fdb698.dfc008","type":"comment","name":"TODO: split ip/mask","info":"","comments":"","x":1098.00390625,"y":1067.5078134536743,"z":"941656e1.8095c8","wires":[]},{"id":"538e6756.86b638","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":950.0047798156738,"y":1020.3376731872559,"z":"941656e1.8095c8","wires":[["550c76f1.771f98"]]},{"id":"1b1c84a1.cf917b","type":"for","name":"for loop tidx - Get transportNetwork ID","xml":"<for index=\"tidx\" start=\"0\" end=\"`$transportNetworksResp.data.transportNetworks_length`\">\n    \n    \n","comments":"","outputs":1,"x":734.0043983459473,"y":1019.3374290466309,"z":"941656e1.8095c8","wires":[["538e6756.86b638"]]},{"id":"c375f7fa.294358","type":"set","name":"set wan portId to service data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param[$service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length].name' value='wanPortId' />\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param[$service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length].value' value='`$prop.wan.wanPortId`' />\n<parameter name='service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length' value='`$service-data.vnfs.vnf[$tmp.vidx].vnf-data.vnf-request-input.vnf-input-parameters.param_length + 1`' />\n\n\n\n\n","comments":"","x":713.0039215087891,"y":1324.254180431366,"z":"941656e1.8095c8","wires":[]},{"id":"626cbb77.e952f4","type":"call","name":"call sdwan-get-tenant-auth","xml":"<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-tenant-auth' mode='sync' >\n","comments":"","outputs":1,"x":706.00390625,"y":725.00390625,"z":"941656e1.8095c8","wires":[[]]},{"id":"c6f20e4e.e6f5","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":1130.0079612731934,"y":1205.5078706741333,"z":"941656e1.8095c8","wires":[[]]}]