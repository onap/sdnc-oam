[{"id":"69f402c5.4ffaec","type":"dgstart","name":"DGSTART","outputs":1,"x":158.3333282470703,"y":65,"z":"432e7ac4.a40554","wires":[["e26fa578.48fab8"]]},{"id":"e26fa578.48fab8","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":233.61903381347656,"y":105.23811149597168,"z":"432e7ac4.a40554","wires":[["682aae1.218495"]]},{"id":"682aae1.218495","type":"method","name":"network-topology-operation-deactivate","xml":"<method rpc='network-topology-operation-deactivate' mode='sync'>\n","comments":"","outputs":1,"x":275.011962890625,"y":148.7499942779541,"z":"432e7ac4.a40554","wires":[["5fc5c371.08d5ac"]]},{"id":"5fc5c371.08d5ac","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":274.33335876464844,"y":243.4434814453125,"z":"432e7ac4.a40554","wires":[["c9dbaeef.d2b7f","e37a3f33.284a1","807c556a.69d798","e47607dd.0bd2c8","a435410a.7fa9b","211e0507.82ebaa","aaf73e80.537c","b2d1cdcb.f51cb"]]},{"id":"beafbfc9.85ba1","type":"not-found","name":"not found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":794.3333282470703,"y":239,"z":"432e7ac4.a40554","wires":[["bfb7faa.23a5b08"]]},{"id":"bfb7faa.23a5b08","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name=\"error-code\" value=\"404\" />\n\t<parameter name=\"error-message\" value=\"network-id not found in AAI\" />","comments":"","x":957.5277252197266,"y":239.11122131347656,"z":"432e7ac4.a40554","wires":[]},{"id":"c9dbaeef.d2b7f","type":"get-resource","name":"get AnAI - l3-network by network-id","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"l3-network\" \n\t\tkey=\"l3-network.network-id = $network-topology-operation-input.network-information.network-id\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"aai.l3-network\">\n","comments":"","outputs":1,"x":559.0554351806641,"y":243.48460388183594,"z":"432e7ac4.a40554","wires":[["beafbfc9.85ba1","98643732.417478"]]},{"id":"98643732.417478","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":787.0554351806641,"y":277.48460388183594,"z":"432e7ac4.a40554","wires":[["11e10f89.d2fcc"]]},{"id":"11e10f89.d2fcc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name=\"error-code\" value=\"500\" />\n\t<parameter name=\"error-message\" value=\"'Error retrieving l3-network with network-id=' + $network-topology-operation-input.network-request-information.network-id + 'from AnAI'\" />","comments":"","x":939.1665191650391,"y":277.7068328857422,"z":"432e7ac4.a40554","wires":[]},{"id":"4acd3ea8.47a81","type":"set","name":"set entity-id and plan-name","xml":"<set>\n\t<parameter name=\"eipam-ip-block.entity-id\" value=\"`$aai.l3-network.subnets.subnet[$sidx].subnet-id`\"/>\n\t<parameter name=\"eipam-ip-block.plans[0].plan-name\" value=\"$tmp.eipam-subnet-row.plan-name\"/>\n","comments":"","x":1405.4127349853516,"y":578.0794448852539,"z":"432e7ac4.a40554","wires":[]},{"id":"2d59a7f6.f14488","type":"for","name":"for 0..subnet_length","xml":"<for index='sidx' start='0' end='`$aai.l3-network.subnets.subnet_length`' >\n","comments":"","outputs":1,"x":603.6984405517578,"y":433.2223205566406,"z":"432e7ac4.a40554","wires":[["1d464653.da7e5a"]]},{"id":"1d464653.da7e5a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":809.6984405517578,"y":433.36515045166016,"z":"432e7ac4.a40554","wires":[["7047b8ac.d02de8","fa64d7ef.074b98"]]},{"id":"fa64d7ef.074b98","type":"get-resource","name":"get eipam-ip-subnet by subnet-id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS where entity_id = $aai.l3-network.subnets.subnet[$sidx].subnet-id ; \"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":762.8413238525391,"y":561.2222671508789,"z":"432e7ac4.a40554","wires":[["9e4e6381.a12b5","ea671a42.72df38","12b2b17a.2c624f"]]},{"id":"d52179ea.880588","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNETS failed to find subnet matching aai subnet.\" />\n\t","comments":"","x":1170.984115600586,"y":508.9365312755108,"z":"432e7ac4.a40554","wires":[]},{"id":"9e4e6381.a12b5","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1021.5557098388672,"y":576.936501711607,"z":"432e7ac4.a40554","wires":[["722407af.2ab048"]]},{"id":"ea671a42.72df38","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1021.8459930419922,"y":510.9365312755108,"z":"432e7ac4.a40554","wires":[["d52179ea.880588"]]},{"id":"12b2b17a.2c624f","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":1022.7031021118164,"y":545.2222518920898,"z":"432e7ac4.a40554","wires":[["63b1b75.e304248"]]},{"id":"722407af.2ab048","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1174.2697982788086,"y":578.3651220500469,"z":"432e7ac4.a40554","wires":[["4acd3ea8.47a81"]]},{"id":"63b1b75.e304248","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Subnet not found in EIPAM_IP_SUBNETS - deactivate failed.\" />\n\t","comments":"","x":1171.650650024414,"y":544.5556163787842,"z":"432e7ac4.a40554","wires":[]},{"id":"7047b8ac.d02de8","type":"save","name":"update AnAI - subnet","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"subnet\" \n\t\tkey=\"l3-network.network-id = $aai.l3-network.network-id \n\t\t\tAND subnet.subnet-id = $eipam-ip-block.entity-id\" >\n<parameter name=\"orchestration-status\" value=\"PendingDelete\" />\n\t\t","comments":"","outputs":1,"x":715.9840240478516,"y":616.2380752563477,"z":"432e7ac4.a40554","wires":[["d5cee8ce.8467a8","a456dec9.801d3"]]},{"id":"b752a8a2.9451f8","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Failure updating orchestration-status in AAI for subnet.\" />\n\t","comments":"","x":1175.7301864624023,"y":620.0793077647686,"z":"432e7ac4.a40554","wires":[]},{"id":"d1b0ef11.e7fe1","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1026.3017807006836,"y":688.0792782008648,"z":"432e7ac4.a40554","wires":[["70e3044e.599f2c"]]},{"id":"d5cee8ce.8467a8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1015.1634273529053,"y":626.3650381267071,"z":"432e7ac4.a40554","wires":[["b752a8a2.9451f8"]]},{"id":"a456dec9.801d3","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":1027.4491729736328,"y":656.3650283813477,"z":"432e7ac4.a40554","wires":[["40d65762.2df748"]]},{"id":"70e3044e.599f2c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1179.015869140625,"y":689.5078985393047,"z":"432e7ac4.a40554","wires":[[]]},{"id":"40d65762.2df748","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Failure updating orchestration-status in AAI for subnet.  Subnet not found.\" />\n\t","comments":"","x":1174.7300262451172,"y":652.3650588989258,"z":"432e7ac4.a40554","wires":[]},{"id":"e47607dd.0bd2c8","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":579.1270027160645,"y":1012.3650369644165,"z":"432e7ac4.a40554","wires":[]},{"id":"211e0507.82ebaa","type":"set","name":"set object-path","xml":"<set>\n<parameter name='network-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $network-topology-operation-input.service-information.service-instance-id\n + '/service-data/networks/network/'\n + $networkId\n + '/network-data/network-topology/'` \" />\n \n","comments":"","x":579.1309471130371,"y":932.559079170227,"z":"432e7ac4.a40554","wires":[]},{"id":"e37a3f33.284a1","type":"set","name":"set networkId","xml":"<set>\n<parameter name='networkId' value='`$network-topology-operation-input.network-information.network-id`' />\n","comments":"","x":573.4165802001953,"y":895.416187286377,"z":"432e7ac4.a40554","wires":[]},{"id":"807c556a.69d798","type":"set","name":"set network-level-oper-status","xml":"<set>\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.network-level-oper-status.order-status' value='PendingDelete' />\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.network-level-oper-status.last-rpc-action' value='`$network-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.network-level-oper-status.last-action' value='`$network-topology-operation-input.request-information.request-action`' />\n","comments":"","x":621.4166412353516,"y":971.9875411987305,"z":"432e7ac4.a40554","wires":[]},{"id":"b2d1cdcb.f51cb","type":"set","name":"copy input to service-data","xml":"<set>\n<parameter name='service-data.networks.network[$nidx].network-data.sdnc-request-header.' value='`$network-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.networks.network[$nidx].network-data.request-information.' value='`$network-topology-operation-input.request-information.`' />\n","comments":"","x":614.8451156616211,"y":858.7494688034058,"z":"432e7ac4.a40554","wires":[]},{"id":"a435410a.7fa9b","type":"switchNode","name":"switch $aai.l3-network.subnets.subnet_length","xml":"<switch test='`$aai.l3-network.subnets.subnet_length`'>\n","comments":"","outputs":1,"x":594.3333282470703,"y":339.0000343322754,"z":"432e7ac4.a40554","wires":[["e70ca1dd.ede2d","e9f5fa31.af0bd8"]]},{"id":"e70ca1dd.ede2d","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":890.3333282470703,"y":339.0000343322754,"z":"432e7ac4.a40554","wires":[["fe251278.16a15"]]},{"id":"fe251278.16a15","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"no networks found\" />\n","comments":"","x":1082.1109161376953,"y":338.88901138305664,"z":"432e7ac4.a40554","wires":[]},{"id":"e9f5fa31.af0bd8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":872.3333282470703,"y":373.0000343322754,"z":"432e7ac4.a40554","wires":[["2d59a7f6.f14488"]]},{"id":"aaf73e80.537c","type":"save","name":"update AnAI - network","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"l3-network\" \n\t\tkey=\"l3-network.network-id = $aai.l3-network.network-id\" >\n<parameter name=\"orchestration-status\" value=\"PendingDelete\" />\n\t\t","comments":"","outputs":1,"x":620.3333282470703,"y":770.999870300293,"z":"432e7ac4.a40554","wires":[["3889bc7f.e0c1b4","9f2104a9.50f748"]]},{"id":"538a0124.f3f62","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Failure updating orchestration-status in AAI for l3-network\" />\n\t","comments":"","x":1024.0794982910156,"y":760.8411569595337,"z":"432e7ac4.a40554","wires":[]},{"id":"4e255bd5.3a5b74","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":874.6510925292969,"y":828.8411273956299,"z":"432e7ac4.a40554","wires":[["4ff385ad.29927c"]]},{"id":"3889bc7f.e0c1b4","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":863.5127391815186,"y":767.1268873214722,"z":"432e7ac4.a40554","wires":[["538a0124.f3f62"]]},{"id":"9f2104a9.50f748","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":875.7984848022461,"y":797.1268775761127,"z":"432e7ac4.a40554","wires":[["49adaed9.4e1b1"]]},{"id":"4ff385ad.29927c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1027.3651809692383,"y":830.2697477340698,"z":"432e7ac4.a40554","wires":[[]]},{"id":"49adaed9.4e1b1","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Failure updating orchestration-status in AAI for l3-network.  Network not found.\" />\n\t","comments":"","x":1023.0793380737305,"y":793.1269080936909,"z":"432e7ac4.a40554","wires":[]}]
