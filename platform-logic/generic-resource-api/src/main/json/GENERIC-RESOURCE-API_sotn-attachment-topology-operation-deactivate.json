[
  {
    "id": "b0d71f3f.58b13",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 123,
    "y": 32,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "962f9112.e764e"
      ]
    ]
  },
  {
    "id": "962f9112.e764e",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 304.00000381469727,
    "y": 92.0000171661377,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "87a8de44.934de"
      ]
    ]
  },
  {
    "id": "87a8de44.934de",
    "type": "method",
    "name": "sotn-attachment-topology-operation-deactivate",
    "xml": "<method rpc='sotn-attachment-topology-operation-deactivate' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 292.0001220703125,
    "y": 180,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "b2d80288.ba823"
      ]
    ]
  },
  {
    "id": "b2d80288.ba823",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 308.0001220703125,
    "y": 735.0002446174622,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "6613ec86.694124",
        "f6decbbf.dd5e18",
        "1fbc45c.0ff5aba",
        "bc709271.507d8",
        "1c40b1f3.81976e",
        "4f9b598.14771a8",
        "8522b683.befcf8",
        "62f18656.44cfe8",
        "683cb14.3ce605",
        "c2e56bca.b33d78",
        "802f8ef7.b6731",
        "5c1eba3c.5a3914",
        "d3793c0a.e76dd",
        "a3a48876.1d8a18",
        "7ccf367e.a869f8",
        "2c211a2d.e90676",
        "693977cc.87d158",
        "c0b8662.2083398",
        "fada7ab3.d1d4e8",
        "cfef8c40.7d401"
      ]
    ]
  },
  {
    "id": "6613ec86.694124",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-id,etc",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n\n\n",
    "comments": "",
    "x": 704.9935607910156,
    "y": 133.9934868812561,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "c64c0419.fa25b8",
    "type": "comment",
    "name": "set tmp ar-id to fetch resource from MDSAL",
    "info": "",
    "comments": "",
    "x": 733.9538726806641,
    "y": 98.02528285980225,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "f6decbbf.dd5e18",
    "type": "set",
    "name": "set tmp.ar.self-link",
    "xml": "<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:connection-attachment-allotted-resources/connection-attachment-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/connection-attachment-topology/'` \" />\n\n",
    "comments": "",
    "x": 658.9934997558594,
    "y": 226.99349212646484,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "1c40b1f3.81976e",
    "type": "execute",
    "name": "execute Properties",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n",
    "comments": "",
    "outputs": 1,
    "x": 665.2553901672363,
    "y": 314.6602210998535,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "1fbc45c.0ff5aba",
    "type": "execute",
    "name": "generate allotted-resource tmp.ar-url",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.connection-attachment-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 715.2554931640625,
    "y": 401.66022205352783,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "61a9d102.2b159",
    "type": "comment",
    "name": "GET connection-attachment-allotted-resource from mdsal",
    "info": "",
    "comments": "",
    "x": 758.8084869384766,
    "y": 472.53876876831055,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "e3f68d6f.a262e",
    "type": "comment",
    "name": "Used for setting output to API Handler",
    "info": "",
    "comments": "",
    "x": 712.9935302734375,
    "y": 193.993501663208,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "b492f1ea.34bc2",
    "type": "comment",
    "name": "Obtain different URL, template location etc",
    "info": "For saving resource information to MDSAL & for AAI",
    "comments": "",
    "x": 730.9934959411621,
    "y": 279.8823823928833,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "d53312d8.be37d",
    "type": "comment",
    "name": "Used to Get AR by id to MDSAL, same as self-link",
    "info": "",
    "comments": "",
    "x": 756.9935150146484,
    "y": 366.8823413848877,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "e963cad3.e8d6c8",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1199.6668281555176,
    "y": 520.0000286102295,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "8ab48cf9.6862d"
      ]
    ]
  },
  {
    "id": "8ab48cf9.6862d",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1368.6668319702148,
    "y": 518.4999294281006,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "46b50e5a.245ae"
      ]
    ]
  },
  {
    "id": "46b50e5a.245ae",
    "type": "switchNode",
    "name": "switch cr length",
    "xml": "<switch test='`$mdsal-ar.connection-attachment-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1541.5241012573242,
    "y": 456.11909198760986,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "13dfccaf.a022c3",
        "30d435f0.aca96a"
      ]
    ]
  },
  {
    "id": "13dfccaf.a022c3",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1778.8573455810547,
    "y": 434.1190423965454,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "2fbac1bd.15b6ee"
      ]
    ]
  },
  {
    "id": "2fbac1bd.15b6ee",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic='true'>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1963.3812351226807,
    "y": 431.02387619018555,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "5bdbcf18.37ca8",
        "cbe39501.d4aef8",
        "a9187100.e70c6"
      ]
    ]
  },
  {
    "id": "6cd8cd98.bbac14",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"Error: SOTN resource not found\" />\n    \n",
    "comments": "",
    "x": 1887.5190773010254,
    "y": 556.0661172866821,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "489ff5d2.164b7c",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1191.5186309814453,
    "y": 555.0661134719849,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "6d0a26d5.df63e8"
      ]
    ]
  },
  {
    "id": "6d0a26d5.df63e8",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1371.5185813903809,
    "y": 555.7326641082764,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "6cd8cd98.bbac14"
      ]
    ]
  },
  {
    "id": "30d435f0.aca96a",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1767.1852989196777,
    "y": 471.3994026184082,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "6cd8cd98.bbac14"
      ]
    ]
  },
  {
    "id": "5bdbcf18.37ca8",
    "type": "set",
    "name": "set connection-attachment-ar from get",
    "xml": "<set>\n<parameter name='connection-attachment-ar.' value='$mdsal-ar.connection-attachment-allotted-resource[0].' />\n",
    "comments": "",
    "x": 2209.444793701172,
    "y": 391.0001058578491,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "a9187100.e70c6",
    "type": "set",
    "name": "set oper-status",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$connection-attachment-ar.allotted-resource-status.rpc-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n",
    "comments": "",
    "x": 2142.4447898864746,
    "y": 481.42866039276123,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "cbe39501.d4aef8",
    "type": "switchNode",
    "name": "switch order-status",
    "xml": "<switch test='`$connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2153.444625854492,
    "y": 435.0001096725464,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "1d7c3fd4.3573f",
        "34a89ac4.b608e6"
      ]
    ]
  },
  {
    "id": "1d7c3fd4.3573f",
    "type": "outcome",
    "name": "outcome Active",
    "xml": "<outcome value='Active'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2360.044574737549,
    "y": 425.0001096725464,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "fffa8dec.2b92a"
      ]
    ]
  },
  {
    "id": "34a89ac4.b608e6",
    "type": "outcome",
    "name": "outcome Other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2359.7590942382812,
    "y": 467.4287004470825,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "31994932.765476"
      ]
    ]
  },
  {
    "id": "fffa8dec.2b92a",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 2512.5151290893555,
    "y": 423.3757600784302,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "31994932.765476",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'Existing connection-attachment-allotted-resource with order status of ' + $connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status + '.'`\" />\n",
    "comments": "",
    "x": 2532.6669845581055,
    "y": 464.000111579895,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ade228e6.1238f8",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:sotn-get-saved-ar-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sotn-get-saved-ar-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 920.3031158447266,
    "y": 616.4935908317566,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "4f9b598.14771a8",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 617.3092803955078,
    "y": 617.4999389648438,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "ade228e6.1238f8"
      ]
    ]
  },
  {
    "id": "2ee127b4.83e818",
    "type": "comment",
    "name": "GET parent-service-data from mdsal to check existence of other End point",
    "info": "",
    "comments": "",
    "x": 799.0004425048828,
    "y": 678.5316982269287,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ac0c0701.4d5818",
    "type": "for",
    "name": "for pidx..mdsal-psd.service-data.provided-allotted-resources.provided-allotted-resource[]",
    "xml": "<for index='pidx' start='0' end='`$mdsal-psd.service-data.provided-allotted-resources.provided-allotted-resource_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1689.1849975585938,
    "y": 882.0040826797485,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "6de65a21.ad20a4"
      ]
    ]
  },
  {
    "id": "cf2de8b0.5bcd28",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1095.3269691467285,
    "y": 1014.5755434036255,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "75a0a72c.5c3178"
      ]
    ]
  },
  {
    "id": "2c958bf6.015ea4",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1286.4543704986572,
    "y": 879.7015712037683,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "ac0c0701.4d5818"
      ]
    ]
  },
  {
    "id": "6de65a21.ad20a4",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test=\"`$mdsal-psd.service-data.provided-allotted-resources.provided-allotted-resource[$pidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n",
    "comments": "",
    "outputs": 1,
    "x": 2124.296398162842,
    "y": 882.0039796829224,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "9440a4ce.27b3b8",
        "44e5c372.52cc1c"
      ]
    ]
  },
  {
    "id": "9440a4ce.27b3b8",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2333.106746673584,
    "y": 862.4684362411499,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "ce614dfc.389e4"
      ]
    ]
  },
  {
    "id": "5d89c62c.f1ebc8",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 2481.867500305176,
    "y": 898.3256177902222,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "12052b78.fd51b5"
      ]
    ]
  },
  {
    "id": "12052b78.fd51b5",
    "type": "set",
    "name": "set tmp.pidx and ptx.consumed-ar",
    "xml": "<set>\n<parameter name='tmp.pidx' value='`$pidx`' />\n<parameter name='tmp.provided-ar.' value='`$mdsal-psd.service-data.provided-allotted-resources.provided-allotted-resource[$pidx].`' />\n<parameter name='tmp.found-in-ar' value='true' />\n<parameter name='tmp.ep-available' value='true' />",
    "comments": "",
    "x": 2716.724937438965,
    "y": 896.8971490859985,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "2107b4e5.fcdf0c",
    "type": "comment",
    "name": "Check existence of other AR in parent service data",
    "info": "Check if other allotted resource is available.",
    "comments": "",
    "x": 722.9628448486328,
    "y": 848.8929204940796,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "103b0ff7.ad1fb",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1105.9793167114258,
    "y": 949.677264213562,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "61e7696e.e32818"
      ]
    ]
  },
  {
    "id": "75a0a72c.5c3178",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"Error: SOTN resource not found\" />\n    \n",
    "comments": "",
    "x": 1267.9793128967285,
    "y": 1013.677285194397,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "4057b675.85b588",
    "type": "other",
    "name": "outcome 2",
    "xml": "<outcome value='2'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1111.9793910980225,
    "y": 880.6772715821862,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "2c958bf6.015ea4"
      ]
    ]
  },
  {
    "id": "ce614dfc.389e4",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 2462.090805053711,
    "y": 857.6771764755249,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "44e5c372.52cc1c",
    "type": "outcomeTrue",
    "name": "false",
    "xml": "<outcome value='false'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2333.0907974243164,
    "y": 896.6771802902222,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "5d89c62c.f1ebc8"
      ]
    ]
  },
  {
    "id": "4960bf69.46744",
    "type": "switchNode",
    "name": "switch mdsal-psd.networks_length",
    "xml": "<switch test='`$mdsal-psd.service-data.networks.network_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1518.3129959106445,
    "y": 952.8997611999512,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "21a6ff32.cc535",
        "fd1b6df1.cb9a8"
      ]
    ]
  },
  {
    "id": "fd1b6df1.cb9a8",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1748.3130187988281,
    "y": 928.7885932922363,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "bb9fff84.461e"
      ]
    ]
  },
  {
    "id": "21a6ff32.cc535",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1742.3131408691406,
    "y": 988.7885932922363,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "8d4e5f2f.b2054"
      ]
    ]
  },
  {
    "id": "8d4e5f2f.b2054",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"Error: Incorrect state found more then 1 network\" />\n    \n",
    "comments": "",
    "x": 1914.9655265808105,
    "y": 988.8903999328613,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "e3b0ecf2.4e878",
    "type": "set",
    "name": "set tmp.network.",
    "xml": "<set>\n<parameter name='tmp.network.' value='`$mdsal-psd.service-data.networks.network[0].`' />\n",
    "comments": "",
    "x": 2116.757942199707,
    "y": 918.7887525558472,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "61e7696e.e32818",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1278.423671722412,
    "y": 950.7885122299194,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "4960bf69.46744"
      ]
    ]
  },
  {
    "id": "bb9fff84.461e",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1916.090690612793,
    "y": 947.7884273529053,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "e3b0ecf2.4e878",
        "2162bd86.35e6f2"
      ]
    ]
  },
  {
    "id": "2162bd86.35e6f2",
    "type": "for",
    "name": "for nidx..tmp.network.network-data.network-request-input.network...[]",
    "xml": "<for index='nidx' start='0' end='`$tmp.network.network-data.network-request-input.network-input-parameters.param_length`' >",
    "comments": "",
    "outputs": 1,
    "x": 2292.09130859375,
    "y": 990.7884349822998,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "15f15c9c.6120f3"
      ]
    ]
  },
  {
    "id": "15f15c9c.6120f3",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 2615.6469688415527,
    "y": 991.7885122299194,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "1f8bf049.48a41",
        "24ef27d4.5acd08"
      ]
    ]
  },
  {
    "id": "1f8bf049.48a41",
    "type": "switchNode",
    "name": "switch access-node-id",
    "xml": "<switch test=\"`$tmp.network.network-data.network-request-input.network-input-parameters.param[$nidx].name == 'access-node-id'`\">",
    "comments": "",
    "outputs": 1,
    "x": 2794.1570739746094,
    "y": 975.7989301681519,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "8ecdc6ef.8a8ce8"
      ]
    ]
  },
  {
    "id": "8ecdc6ef.8a8ce8",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2981.1570739746094,
    "y": 976.7989301681519,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "5c66b7eb.d5bf28"
      ]
    ]
  },
  {
    "id": "5c66b7eb.d5bf28",
    "type": "set",
    "name": "set tmp.found-in-network tmp.ep-available",
    "xml": "<set>\n<parameter name='tmp.found-in-network' value='true' />\n<parameter name='tmp.ep-available' value='true' />",
    "comments": "",
    "x": 3232.157081604004,
    "y": 976.3988723754883,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "24ef27d4.5acd08",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 2777.14697265625,
    "y": 1020.7885293960571,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "bc709271.507d8",
    "type": "switchNode",
    "name": "switch tmp.ep-available",
    "xml": "<switch test='`$tmp.ep-available`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 654.3128662109375,
    "y": 1153.2327852249146,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "18bdb942.c7be37",
        "343945c7.6ea6fa"
      ]
    ]
  },
  {
    "id": "343945c7.6ea6fa",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 836.9797019958496,
    "y": 1177.5661935806274,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "eb3e9e9.a810a6"
      ]
    ]
  },
  {
    "id": "18bdb942.c7be37",
    "type": "outcomeTrue",
    "name": "false",
    "xml": "<outcome value='false'>\n",
    "comments": "",
    "outputs": 1,
    "x": 839.8684730529785,
    "y": 1116.566291809082,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "33d109a0.0b3696"
      ]
    ]
  },
  {
    "id": "33d109a0.0b3696",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 976.8685493469238,
    "y": 1115.4551057815552,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "eb3e9e9.a810a6",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1007.0907897949219,
    "y": 1175.5661516189575,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "d5bc9567.22f988"
      ]
    ]
  },
  {
    "id": "eba7f62b.bd7668",
    "type": "comment",
    "name": "GET connection-attachment-ar to store AR data from mdsal",
    "info": "",
    "comments": "",
    "x": 2192.472946166992,
    "y": 355.5039691925049,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "2d6b93ab.08655c",
    "type": "comment",
    "name": "Set source end point",
    "info": "",
    "comments": "",
    "x": 630.9728393554688,
    "y": 585.2540645599365,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "8522b683.befcf8",
    "type": "set",
    "name": "set tmp.ar.parent-service-instance-id",
    "xml": "<set>\n<parameter name='tmp.ar.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n\n",
    "comments": "",
    "x": 683.9689178466797,
    "y": 710.0002088546753,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "773fbfc3.82918",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1061.9689140319824,
    "y": 759.000207901001,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "e1e0569.afbf9a8"
      ]
    ]
  },
  {
    "id": "be2f70a0.4132d",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1053.8207168579102,
    "y": 794.0662927627563,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "82d58d98.da526"
      ]
    ]
  },
  {
    "id": "82d58d98.da526",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"Error: SOTN resource not found\" />\n    \n",
    "comments": "",
    "x": 1228.9694023132324,
    "y": 790.3336429595947,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "e1e0569.afbf9a8",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1212.9689140319824,
    "y": 757.000207901001,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "62f18656.44cfe8",
    "type": "set",
    "name": "set tmp.found-in-ar tmp.found-in-network tmp.ep-available to false",
    "xml": "<set>\n<parameter name='tmp.found-in-ar' value='false' />\n<parameter name='tmp.found-in-network' value='false' />\n<parameter name='tmp.ep-available' value='false' />",
    "comments": "",
    "x": 770.9689102172852,
    "y": 884.0001821517944,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ba6cedb4.1637d",
    "type": "comment",
    "name": "If other EP exists delete from domain controller",
    "info": "",
    "comments": "",
    "x": 704.9688110351562,
    "y": 1077.999997138977,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "84d93cd2.2a2bf",
    "type": "set",
    "name": "set controller data",
    "xml": "<set>\n<parameter name='prop.sdncRestApi.thirdpartySdnc.url' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].service-url`\" />\n<parameter name='prop.sdncRestApi.thirdpartySdnc.user' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].user-name`\" />\n<parameter name='prop.sdncRestApi.thirdpartySdnc.password' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].password`\" />\n",
    "comments": "",
    "x": 2702.969627380371,
    "y": 1368.0005893707275,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "3c2c4321.6e016c",
    "type": "get-resource",
    "name": "get-resource esr-thirdparty-sdnc",
    "xml": "<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"esr-thirdparty-sdnc\" \n\t\tkey=\"esr-thirdparty-sdnc.thirdparty-sdnc-id = $tmp.thirdparty-sdnc-id AND \n\t\t     depth = '1'\"\n        pfx='tmp.aai.esr-thirdparty-sdnc' local-only='false' >\n\n",
    "comments": "",
    "outputs": 1,
    "x": 2266.469566345215,
    "y": 1427.0005893707275,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "b9c78202.065c4",
        "b1e4c467.b20658",
        "7cb01101.04dc1"
      ]
    ]
  },
  {
    "id": "b9c78202.065c4",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2505.469566345215,
    "y": 1380.0005893707275,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "84d93cd2.2a2bf"
      ]
    ]
  },
  {
    "id": "b1e4c467.b20658",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2508.96053314209,
    "y": 1427.5746250152588,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "912e3892.c38738"
      ]
    ]
  },
  {
    "id": "7cb01101.04dc1",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2504.29354095459,
    "y": 1468.90793800354,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "ba048e79.e103b"
      ]
    ]
  },
  {
    "id": "912e3892.c38738",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'An error occurred while querying esr-thirdparty-sdnc from AnAI with thirdparty-sdnc-id = ' + $tmp.thirdparty-sdnc-id`\" />\n\n",
    "comments": "",
    "x": 2685.5319442749023,
    "y": 1415.8603610992432,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ba048e79.e103b",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unexpected error occurred while querying esr-thirdparty-sdnc from AnAI with thirdparty-sdnc-id = ' + $tmp.thirdparty-sdnc-id`\" />\n\n",
    "comments": "",
    "x": 2692.0660972595215,
    "y": 1464.3471307754517,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ac6b10fc.018ca",
    "type": "get-resource",
    "name": "get-resource pnf",
    "xml": "<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"pnf\" \n\t\tkey=\"pnf.pnf-name = $tmp.node-id \n\t\tAND depth = '0'\"\n        pfx='tmp.aai.pnf' local-only='false' >\n\n\n\n",
    "comments": "",
    "outputs": 1,
    "x": 2215.9697341918945,
    "y": 1319.000418663025,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "7d25011f.79dd3",
        "abbaec43.33e1c",
        "9bfad8e.2252b28"
      ]
    ]
  },
  {
    "id": "7d25011f.79dd3",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2403.9697494506836,
    "y": 1265.0004110336304,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "addfa25b.c3718"
      ]
    ]
  },
  {
    "id": "abbaec43.33e1c",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2409.460796356201,
    "y": 1307.5743074417114,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "6b2117db.4230f8"
      ]
    ]
  },
  {
    "id": "9bfad8e.2252b28",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2395.793804168701,
    "y": 1345.9076433181763,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "c5a2b6cb.8de6a8"
      ]
    ]
  },
  {
    "id": "6b2117db.4230f8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'An error occurred while querying pnf from AnAI with pnf-name = ' + $prop.connection-attachement.access-node-id`\" />\n\n",
    "comments": "",
    "x": 2563.032096862793,
    "y": 1297.8601140975952,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "c5a2b6cb.8de6a8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unexpected error occurred while querying pnf from AnAI with pnf-name = ' + $prop.connection-attachement.access-node-id`\" />\n\n",
    "comments": "",
    "x": 2559.566276550293,
    "y": 1337.3469333648682,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "addfa25b.c3718",
    "type": "set",
    "name": "set tmp.thirdparty-sdnc-id",
    "xml": "<set>\n<parameter name='tmp.thirdparty-sdnc-id' value=\"`$tmp.aai.pnf.relationship-list.relationship[0].relationship-data[0].relationship-value`\" />\n",
    "comments": "",
    "x": 2603.9697647094727,
    "y": 1260.0004110336304,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "44ef1c3d.800ab4",
    "type": "comment",
    "name": "get domain controller information",
    "info": "",
    "comments": "",
    "x": 2259.4736404418945,
    "y": 1288.0043859481812,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "7164fdca.4a0d84",
    "type": "execute",
    "name": "execute RestApiCallNode Delete ethernet Service",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/restconf/data/ietf-eth-tran-service:etht-svc/etht-svc-instances=' + $tmp.actual.vpn-name`\" />\n<parameter name=\"restapiUser\" value=\"`$prop.sdncRestApi.thirdpartySdnc.user`\" />\n<parameter name=\"restapiPassword\" value=\"`$prop.sdncRestApi.thirdpartySdnc.password`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"delete\"/>\n<parameter name=\"responsePrefix\" value=\"vpn-result\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.onap.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>\n<parameter name='customHttpHeaders' value=\"`'X-ACCESS-TOKEN=' + $prop.sdncRestApi.token_id`\" />",
    "comments": "",
    "outputs": 1,
    "x": 2308.969596862793,
    "y": 1681.0005912780762,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "2b22380a.f1bc58",
        "2dc816f1.66c67a"
      ]
    ]
  },
  {
    "id": "2b22380a.f1bc58",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2595.9695358276367,
    "y": 1704.0005912780762,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "2a372b2.85f3bd4"
      ]
    ]
  },
  {
    "id": "2a372b2.85f3bd4",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "comments": "",
    "outputs": 1,
    "x": 2765.9694747924805,
    "y": 1707.0005912780762,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "9ab48a6d.252ca8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error executing Create vpn rest api\" />\n",
    "comments": "",
    "x": 2765.969596862793,
    "y": 1663.0005912780762,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "2dc816f1.66c67a",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2598.9694747924805,
    "y": 1663.0005912780762,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "9ab48a6d.252ca8"
      ]
    ]
  },
  {
    "id": "b8fd2a49.d0b368",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 933.7307472229004,
    "y": 1677.9527901411057,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "4d3bfe83.8ac38"
      ]
    ]
  },
  {
    "id": "4d3bfe83.8ac38",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n",
    "comments": "",
    "x": 1100.2546272277832,
    "y": 1689.5718611478806,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "59f13b89.e4e7d4",
    "type": "failure",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 940.8260345458984,
    "y": 1710.7147578001022,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "4d3bfe83.8ac38"
      ]
    ]
  },
  {
    "id": "65a9cdb6.115924",
    "type": "comment",
    "name": "Save Resource to AAI",
    "info": "",
    "comments": "",
    "x": 652.7784614562988,
    "y": 1660.3021783828735,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "a3a48876.1d8a18",
    "type": "set",
    "name": "set output to api handler",
    "xml": "<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='connection-attachment-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $connection-attachment-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n",
    "comments": "",
    "x": 667.5461578369141,
    "y": 1581.8276596069336,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "7ccf367e.a869f8",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 635.9592399597168,
    "y": 1742.4434118270874,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "d3793c0a.e76dd",
    "type": "execute",
    "name": "execute RestApiCallNode - PUT AR by id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.sotn-attachment.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 717.2782592773438,
    "y": 1489.468433380127,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "c94958cd.0f7e08",
        "5e263814.55f358",
        "1ecab8f8.94f047"
      ]
    ]
  },
  {
    "id": "c94958cd.0f7e08",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 985.9196357727051,
    "y": 1540.799845121801,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "916b12ec.48653"
      ]
    ]
  },
  {
    "id": "5e263814.55f358",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 976.9196853637695,
    "y": 1509.2998708710074,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "916b12ec.48653"
      ]
    ]
  },
  {
    "id": "1ecab8f8.94f047",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 980.6697235107422,
    "y": 1479.6569757461548,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "9a61150.9613ce8"
      ]
    ]
  },
  {
    "id": "916b12ec.48653",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1146.6697235107422,
    "y": 1510.0498947128654,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "9a61150.9613ce8",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1122.3256912231445,
    "y": 1475.849144935608,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "683cb14.3ce605",
    "type": "set",
    "name": "set ar-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-status.action' value=\"`$connection-attachment-topology-operation-input.request-information.request-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-name' value=\"connection-attachment-topology-operation\" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-action' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$connection-attachment-topology-operation-input.request-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$connection-attachment-topology-operation-input.service-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.` \" />",
    "comments": "",
    "x": 617.4918785095215,
    "y": 1339.8493564128876,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "802f8ef7.b6731",
    "type": "execute",
    "name": "execute getTime",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 634.7777214050293,
    "y": 1412.4689540863037,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "5c1eba3c.5a3914",
    "type": "set",
    "name": "set allotted-resource-oper-status",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='PendingDelete' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$connection-attachment-topology-operation-input.request-information.request-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n",
    "comments": "",
    "x": 689.764778137207,
    "y": 1450.4200916290283,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "c2e56bca.b33d78",
    "type": "set",
    "name": "set model-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.onap-model-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.` \" />",
    "comments": "",
    "x": 631.3334197998047,
    "y": 1379.024006843567,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ae41f871.b43fa8",
    "type": "comment",
    "name": "Prepare data for allotted-resource addition to MDSAL",
    "info": "This will add to allotted-resource which is present inside service.",
    "comments": "",
    "x": 744.6668815612793,
    "y": 1300.0239589214325,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "e752535c.aeb57",
    "type": "comment",
    "name": "Add to allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 686.2467079162598,
    "y": 1267.4372606277466,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "2c211a2d.e90676",
    "type": "update",
    "name": "update AAI allotted-resource",
    "xml": "<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $connection-attachment-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $connection-attachment-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $connection-attachment-topology-operation-input.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"description\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid`\" />\n\t<parameter name=\"operational-status\" value=\"PendingDelete\" />\n",
    "comments": "",
    "outputs": 1,
    "x": 679.2227401733398,
    "y": 1697.7543210983276,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "b8fd2a49.d0b368",
        "59f13b89.e4e7d4"
      ]
    ]
  },
  {
    "id": "d5bc9567.22f988",
    "type": "get-resource",
    "name": "get-resource connectivity",
    "xml": "<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"connectivity\" \n\t\tkey=\"connectivity.connectivity-id = $mdsal-psd.service-data.networks.network[0].network-id AND \n\t\t     depth = '1'\"\n        pfx='tmp.connectivity' local-only='false' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1213.0005645751953,
    "y": 1175.5044269561768,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "7024d4cd.1a62bc",
        "cf432033.112d9"
      ]
    ]
  },
  {
    "id": "41a48915.ce4758",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1986.1178741455078,
    "y": 1372.3445596694946,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "ae412232.e0411",
        "3c342d96.9776c2",
        "ac6b10fc.018ca",
        "3c2c4321.6e016c",
        "7164fdca.4a0d84",
        "dda1ddc2.84784",
        "f1f4e6ef.143a68"
      ]
    ]
  },
  {
    "id": "d567023b.2d9f",
    "type": "outcome",
    "name": "vpn-binding",
    "xml": "<outcome value='vpn-binding'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1812.286392211914,
    "y": 1374.8260831832886,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "41a48915.ce4758"
      ]
    ]
  },
  {
    "id": "de835816.465b48",
    "type": "for",
    "name": "for each relationship",
    "xml": "<for silentFailure='true' index='vidx' start='0' end='`$tmp.connectivity.relationship-list.relationship_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1434.0003356933594,
    "y": 1373.0043096542358,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "a2ccacd2.b0dbc"
      ]
    ]
  },
  {
    "id": "a2ccacd2.b0dbc",
    "type": "switchNode",
    "name": "switch related-to",
    "xml": "<switch test='`$tmp.connectivity.relationship-list.relationship[$vidx].related-to`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1646.0003471374512,
    "y": 1374.0043096542358,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "d567023b.2d9f"
      ]
    ]
  },
  {
    "id": "3c342d96.9776c2",
    "type": "set",
    "name": "set tmp.vpn-name",
    "xml": "<set>\n<parameter name='tmp.vpn-name' value=\"`$tmp.connectivity.relationship-list.relationship[$vidx].relationship-data[0].relationship-value` \" />\n",
    "comments": "",
    "x": 2219.0005416870117,
    "y": 1086.004626274109,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ae412232.e0411",
    "type": "execute",
    "name": "split vpnName to find nodeId",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$tmp.vpn-name`'/>\n<parameter name=\"regex\" value=\"-\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"route1\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 2255.0004959106445,
    "y": 1187.0039930343628,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "ae670977.becbb8",
        "60767ce2.3ab0a4"
      ]
    ]
  },
  {
    "id": "60767ce2.3ab0a4",
    "type": "failure",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2456.000686645508,
    "y": 1164.0039854049683,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "bf10a60c.fdea98"
      ]
    ]
  },
  {
    "id": "bf10a60c.fdea98",
    "type": "set",
    "name": "set tmp.node-id",
    "xml": "<set>\n<parameter name='tmp.node-id' value='`$route1[0]`' />\n<parameter name='tmp.actual.vpn-name' value='`$route1[1]`' />\n",
    "comments": "",
    "x": 2609.000846862793,
    "y": 1162.0039863586426,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "a5afcc72.d877b",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value=\"An error occured while splitting sna1_route\" />\n",
    "comments": "",
    "x": 2593.001012802124,
    "y": 1211.0039882659912,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ae670977.becbb8",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2453.00066947937,
    "y": 1212.0039901733398,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "a5afcc72.d877b"
      ]
    ]
  },
  {
    "id": "7024d4cd.1a62bc",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1394.0001640319824,
    "y": 1210.0000715255737,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "ea43f44.e748208"
      ]
    ]
  },
  {
    "id": "cf432033.112d9",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1396.851894378662,
    "y": 1137.0663166046143,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "801260ca.47a9"
      ]
    ]
  },
  {
    "id": "801260ca.47a9",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"Error: Connectivity resource not found\" />\n    \n",
    "comments": "",
    "x": 1539.0006637573242,
    "y": 1137.3337268829346,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "ea43f44.e748208",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1396.0001754760742,
    "y": 1288.0002374649048,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "de835816.465b48"
      ]
    ]
  },
  {
    "id": "693977cc.87d158",
    "type": "execute",
    "name": "execute RestApiCallNode - get-resource connection-attachment-allotted-resource",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 832.3339538574219,
    "y": 536.4999494552612,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "e963cad3.e8d6c8",
        "489ff5d2.164b7c"
      ]
    ]
  },
  {
    "id": "c0b8662.2083398",
    "type": "execute",
    "name": "get parent-service-data tmp.ar-url-psd",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"/restconf/config/GENERIC-RESOURCE-API:services/service/{service-instance-id}/service-data\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url-psd\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 686.0001983642578,
    "y": 745.0002107620239,
    "z": "ed10e8c7.d58f28",
    "wires": [
      []
    ]
  },
  {
    "id": "fada7ab3.d1d4e8",
    "type": "execute",
    "name": "execute RestApiCallNode - get-resource parent service data",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url-psd`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-psd\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 753.0001602172852,
    "y": 780.0002946853638,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "773fbfc3.82918",
        "be2f70a0.4132d"
      ]
    ]
  },
  {
    "id": "cfef8c40.7d401",
    "type": "switchNode",
    "name": "switch mdsal-psd.service-data.provided-allotted-resources_length",
    "xml": "<switch test='`$mdsal-psd.service-data.provided-allotted-resources.provided-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 769.1842803955078,
    "y": 954.7181224822998,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "cf2de8b0.5bcd28",
        "103b0ff7.ad1fb",
        "4057b675.85b588"
      ]
    ]
  },
  {
    "id": "dda1ddc2.84784",
    "type": "update",
    "name": "delete AAI vpn-binding",
    "xml": "<delete plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='vpn-binding' \n      key='vpn-binding.vpn-id = $tmp.vpn-name' >",
    "comments": "",
    "outputs": 1,
    "x": 2239.999954223633,
    "y": 1784.0001649856567,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "c726da18.1fa408",
        "b99e2363.4f50b"
      ]
    ]
  },
  {
    "id": "c726da18.1fa408",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2494.5079612731934,
    "y": 1764.1986340284348,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "53701c4b.a688d4"
      ]
    ]
  },
  {
    "id": "b99e2363.4f50b",
    "type": "failure",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2501.6032485961914,
    "y": 1796.9606016874313,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "53701c4b.a688d4"
      ]
    ]
  },
  {
    "id": "53701c4b.a688d4",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n",
    "comments": "",
    "x": 2661.031841278076,
    "y": 1775.8177050352097,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "f1f4e6ef.143a68",
    "type": "execute",
    "name": "execute RestApiCallNode Get token",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"templateFileName\" value=\"`$prop.restapi.templateDir + '/actokentemplate.json'`\" />\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/controller/v2/tokens'`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"post\"/>\n<parameter name=\"responsePrefix\" value=\"token-result\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.onap.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>",
    "comments": "",
    "outputs": 1,
    "x": 2279.7541580200195,
    "y": 1564.254002571106,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "f8436b41.519d68",
        "9d9f79f.4a7c888"
      ]
    ]
  },
  {
    "id": "f8436b41.519d68",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2514.7541580200195,
    "y": 1542.254002571106,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "1076a472.b53e4c"
      ]
    ]
  },
  {
    "id": "9d9f79f.4a7c888",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2507.0041580200195,
    "y": 1595.8968858718872,
    "z": "ed10e8c7.d58f28",
    "wires": [
      [
        "6534e8a7.2122d8"
      ]
    ]
  },
  {
    "id": "6534e8a7.2122d8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error executing get token rest api\" />\n",
    "comments": "",
    "x": 2659.7541580200195,
    "y": 1595.6469469070435,
    "z": "ed10e8c7.d58f28",
    "wires": []
  },
  {
    "id": "1076a472.b53e4c",
    "type": "set",
    "name": "set token-id",
    "xml": "<set>\n<parameter name='prop.sdncRestApi.token_id' value='`$token-result.data.token_id`' />\n",
    "comments": "",
    "x": 2668.7541580200195,
    "y": 1543.254002571106,
    "z": "ed10e8c7.d58f28",
    "wires": []
  }
]
