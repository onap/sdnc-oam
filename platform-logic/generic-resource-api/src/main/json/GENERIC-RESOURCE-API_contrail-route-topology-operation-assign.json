[{"id":"4c9f1270.94615c","type":"dgstart","name":"DGSTART","outputs":1,"x":150,"y":88,"z":"4d1b2427.607d4c","wires":[["9e2ac2f1.e6e2"]]},{"id":"9e2ac2f1.e6e2","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":256.23807525634766,"y":162.95240020751953,"z":"4d1b2427.607d4c","wires":[["3916a67.a589d5a"]]},{"id":"3916a67.a589d5a","type":"method","name":"contrail-route-topology-operation-assign","xml":"<method rpc='contrail-route-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":257.82152557373047,"y":262.1904363632202,"z":"4d1b2427.607d4c","wires":[["9cfe2b9e.d58558"]]},{"id":"9cfe2b9e.d58558","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":284.4761848449707,"y":375.523784160614,"z":"4d1b2427.607d4c","wires":[["779e03bd.004a6c","b7d6a7d6.406e68","fb26a2b7.6969f","142b08a1.6d8de7","87a2a4c4.087d48","f3613a51.1c26f8","625eb8ab.21f038","6c13aed7.4f039","1836ca82.75ebe5","9f72a1ac.015ab","d634d1d1.89bbb","69c9d3c4.e9707c","bec92482.90ee38","bbe3aaad.4a5568","6bcbfec7.4a61d","62c0d784.f7e3d8","b6d077f3.00bc38","892a2973.dace48","ac3303.d63e3d","866ca1ea.ff3bc","ea795139.b531a","6a318934.66ddc8","783e64a0.ae3edc","cd01ba46.1664d8","1420897.e40c477","1fa15432.96f97c","af7a877d.eb2d78","843930fc.abe98","fac7c328.21b71","6959d8ae.04d098","b5119828.1d53c8","e6eeaa3.150a058","8211864b.caed98","571268e5.730638","96b047c4.679ec8","5e25bd11.a21d44","e2e2a185.95801","5790ccca.f5ea54","c643b552.15d5b8","e9e426fe.b64fd8","be0b4c28.f1b79"]]},{"id":"b7d6a7d6.406e68","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":519.0002326965332,"y":3227.2144536972046,"z":"4d1b2427.607d4c","wires":[]},{"id":"779e03bd.004a6c","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='contrail-route-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $contrail-route-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":547.7541580200195,"y":3199.051257133484,"z":"4d1b2427.607d4c","wires":[]},{"id":"b6d077f3.00bc38","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='PendingCreate' />\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$contrail-route-topology-operation-input.request-information.request-action`' />\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$contrail-route-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$contrail-route-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":584.7542457580566,"y":2376.0512704849243,"z":"4d1b2427.607d4c","wires":[]},{"id":"142b08a1.6d8de7","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:contrail-route-allotted-resources/contrail-route-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/contrail-route-topology/'` \" />\n\n","comments":"","x":556.7381706237793,"y":325.33333587646484,"z":"4d1b2427.607d4c","wires":[]},{"id":"fb26a2b7.6969f","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$contrail-route-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$contrail-route-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n<parameter name='tmp.ar.contrail-applied-service-instance-id' value='`$contrail-route-topology-operation-input.contrail-route-request-input.contrail-applied-service-info.service-instance-id`' />\n<parameter name='tmp.ar.allotted-resource-type' value='`$contrail-route-topology-operation-input.allotted-resource-information.allotted-resource-type`' />\n\n","comments":"","x":603.9974327087402,"y":291.59260177612305,"z":"4d1b2427.607d4c","wires":[]},{"id":"87a2a4c4.087d48","type":"execute","name":"execute Properties - pull properties file","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":618.9935836791992,"y":357.2315893173218,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"625eb8ab.21f038","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":619.5189018249512,"y":737.4595794677734,"z":"4d1b2427.607d4c","wires":[["b8ba7075.92c81","408b9489.78624c"]]},{"id":"f3613a51.1c26f8","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.cr-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":591.0649604797363,"y":421.0172395706177,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"b8ba7075.92c81","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":866.8149909973145,"y":732.2673687934875,"z":"4d1b2427.607d4c","wires":[["3a69737a.dd4c0c"]]},{"id":"6bcbfec7.4a61d","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.cr.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":612.958122253418,"y":2994.291175842285,"z":"4d1b2427.607d4c","wires":[["69575477.9eb00c","215247c4.dbf588"]]},{"id":"69575477.9eb00c","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":879.9328575134277,"y":3023.9561338424683,"z":"4d1b2427.607d4c","wires":[["2a4bd3e4.dd179c"]]},{"id":"215247c4.dbf588","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":874.2662467956543,"y":2992.455969810486,"z":"4d1b2427.607d4c","wires":[["2a4bd3e4.dd179c"]]},{"id":"1a4098bb.aead37","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for contrail-route-allotted-resource.  Parent provided resource rolled back\" />\n","comments":"","x":1216.3495788574219,"y":3038.5395822525024,"z":"4d1b2427.607d4c","wires":[]},{"id":"3a69737a.dd4c0c","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1035.8149948120117,"y":730.7672696113586,"z":"4d1b2427.607d4c","wires":[["9399d0e2.ddd51"]]},{"id":"9399d0e2.ddd51","type":"switchNode","name":"switch cr length","xml":"<switch test='`$mdsal-ar.contrail-route-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1246.6722373962402,"y":730.3863987922668,"z":"4d1b2427.607d4c","wires":[["4041d430.f6846c"]]},{"id":"4041d430.f6846c","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1436.005542755127,"y":730.3863568305969,"z":"4d1b2427.607d4c","wires":[["e842b5e7.c19358"]]},{"id":"f17d1c78.92f5f","type":"comment","name":"Save consumed-allotted-resources to mdsal","info":"","comments":"","x":619.2436676025391,"y":2185.3863854408264,"z":"4d1b2427.607d4c","wires":[]},{"id":"efe5ed7c.3b0ae","type":"comment","name":"GET contrail-route-allotted-resource from mdsal","info":"","comments":"","x":638.8148880004883,"y":704.7672181129456,"z":"4d1b2427.607d4c","wires":[]},{"id":"6c13aed7.4f039","type":"set","name":"set ar-identifiers","xml":"<set>\n<parameter name='ar-identifiers.consuming-service-instance-id' value=\"`$contrail-route-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='ar-identifiers.parent-service-instance-id' value=\"`$contrail-route-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='ar-identifiers.allotted-resource-type' value=\"`$contrail-route-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n","comments":"","x":545.0531158447266,"y":846.2912406921387,"z":"4d1b2427.607d4c","wires":[]},{"id":"306f9e61.b62042","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":585.6721267700195,"y":816.6720333099365,"z":"4d1b2427.607d4c","wires":[]},{"id":"892a2973.dace48","type":"set","name":"set identifiers in overal structure","xml":"<set>\n<parameter name='ar.allotted-resource-data.contrail-route-topology.allotted-resource-identifiers.' \nvalue=\"`$ar-identifiers.`\" />\n\n\n","comments":"","x":605.0529861450195,"y":1362.9103206694126,"z":"4d1b2427.607d4c","wires":[]},{"id":"1836ca82.75ebe5","type":"set","name":"set onap model information from input","xml":"<set>\n<parameter name='ar.allotted-resource-data.contrail-route-topology.onap-model-information.' \nvalue=\"`$contrail-route-topology-operation-input.allotted-resource-information.onap-model-information.`\" />\n\n\n","comments":"","x":606.7196884155273,"y":930.2436923980713,"z":"4d1b2427.607d4c","wires":[]},{"id":"9f72a1ac.015ab","type":"switchNode","name":"switch model-invariant-uuid is null","xml":"<switch test='$contrail-route-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid'>\n","comments":"","outputs":1,"x":592.9101486206055,"y":965.9578294754028,"z":"4d1b2427.607d4c","wires":[["a386a341.6a5dc"]]},{"id":"a386a341.6a5dc","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":820.0530281066895,"y":967.3863468170166,"z":"4d1b2427.607d4c","wires":[["f68746c1.bc30f8"]]},{"id":"f68746c1.bc30f8","type":"set","name":"set model-invariant-uuid","xml":"<set>\n<parameter name='ar.allotted-resource-data.contrail-route-topology.onap-model-information.model-invariant-uuid' \nvalue=\"`$ar-model.invariant-uuid`\" />\n\n\n","comments":"","x":1021.4816017150879,"y":966.8148994445801,"z":"4d1b2427.607d4c","wires":[]},{"id":"d634d1d1.89bbb","type":"switchNode","name":"switch model-uuid is null","xml":"<switch test='$contrail-route-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid'>\n","comments":"","outputs":1,"x":564.3387451171875,"y":1000.2435302734375,"z":"4d1b2427.607d4c","wires":[["41ad333e.6ea4ec"]]},{"id":"41ad333e.6ea4ec","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":765.7673110961914,"y":1000.8149518966675,"z":"4d1b2427.607d4c","wires":[["8577b5de.034978"]]},{"id":"8577b5de.034978","type":"set","name":"set model-uuid","xml":"<set>\n<parameter name='sar.allotted-resource-data.contrail-route-topology.onap-model-information.model-uuid' \nvalue=\"`$ar-model.uuid`\" />\n\n\n","comments":"","x":958.6244697570801,"y":1000.8148736953735,"z":"4d1b2427.607d4c","wires":[]},{"id":"69c9d3c4.e9707c","type":"switchNode","name":"switch model-version is null","xml":"<switch test='$contrail-route-topology-operation-input.allotted-resource-information.onap-model-information.model-version'>\n","comments":"","outputs":1,"x":572.9101486206055,"y":1033.1006574630737,"z":"4d1b2427.607d4c","wires":[["a2183382.79fd3"]]},{"id":"a2183382.79fd3","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":822.9101295471191,"y":1033.1006422042847,"z":"4d1b2427.607d4c","wires":[["32b5229d.0cab2e"]]},{"id":"32b5229d.0cab2e","type":"set","name":"set model-version","xml":"<set>\n<parameter name='ar.allotted-resource-data.contrail-route-topology.onap-model-information.model-version' \nvalue=\"`$ar-model.version`\" />\n\n\n","comments":"","x":1015.767276763916,"y":1033.1006317138672,"z":"4d1b2427.607d4c","wires":[]},{"id":"866ca1ea.ff3bc","type":"switchNode","name":"switch ar-model.onap-generated-naming","xml":"<switch test='`$ar-model.onap-generated-naming`'>\n","comments":"","outputs":1,"x":633.7196960449219,"y":1279.7672176361084,"z":"4d1b2427.607d4c","wires":[["3948bc2f.f77b54","e707f9ff.d5a678"]]},{"id":"3948bc2f.f77b54","type":"other","name":"outcome Y","xml":"<outcome value='Y'>\n","comments":"","outputs":1,"x":910.7197341918945,"y":1275.8624358177185,"z":"4d1b2427.607d4c","wires":[["20908a4f.bf6266"]]},{"id":"20908a4f.bf6266","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">\n","atomic":"true","comments":"","outputs":1,"x":1079.4697761535645,"y":1276.3624243736267,"z":"4d1b2427.607d4c","wires":[["7b9d654d.5be03c"]]},{"id":"e707f9ff.d5a678","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":901.942024230957,"y":1308.8624358177185,"z":"4d1b2427.607d4c","wires":[["29eade88.e64712"]]},{"id":"29eade88.e64712","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in allotted-resource-model data.  Ecomp-generated-naming should be true\" />\n\n","comments":"","x":1079.942024230957,"y":1307.8624358177185,"z":"4d1b2427.607d4c","wires":[]},{"id":"7b9d654d.5be03c","type":"switchNode","name":"switch ar-model.onap-generated-naming","xml":"<switch test='`$ar-model.naming-policy`'>\n","comments":"","outputs":1,"x":1380.7196807861328,"y":1276.433897972107,"z":"4d1b2427.607d4c","wires":[["cef027f.91fdfd8","38b91d73.c94a62"]]},{"id":"cef027f.91fdfd8","type":"other","name":"outcome oam_network_policy","xml":"<outcome value='oam_network_policy'>\n","comments":"","outputs":1,"x":1751.5775146484375,"y":1268.0119352340698,"z":"4d1b2427.607d4c","wires":[["8431f8ba.f08668"]]},{"id":"38b91d73.c94a62","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1676.338981628418,"y":1300.529139995575,"z":"4d1b2427.607d4c","wires":[["8431f8ba.f08668"]]},{"id":"9b97c321.adf0f","type":"set","name":"set ar_name","xml":"<set>\n<parameter name='tmp.ar-name' value='$TenantName_$CloudRegionID_$TenantNetworkRole_$LandingNetworkRole_policy_' />\n","comments":"","x":2194.100845336914,"y":1256.1009072959423,"z":"4d1b2427.607d4c","wires":[]},{"id":"b38296e4.3c0ea8","type":"execute","name":"execute SliStringUtils - replace $TenantName","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$TenantName\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.tenant-name`\"/>\n\n","comments":"","outputs":1,"x":2294.244155883789,"y":1294.6247834861279,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"52fb7e92.2cea6","type":"execute","name":"execute SliStringUtils - replace LandingNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$LandingNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.dest-network.network-role`\"/>\n\n","comments":"","outputs":1,"x":2302.577407836914,"y":1398.7676134109497,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"8431f8ba.f08668","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":1981.8626976013184,"y":1302.0053367614746,"z":"4d1b2427.607d4c","wires":[["9b97c321.adf0f","b38296e4.3c0ea8","52fb7e92.2cea6","33d9a65.b86135a","70595e41.23774","d7151a9c.c5a358","b85f95cf.56c518","e6c914ff.bbbeb8","a21ede43.fc3e7"]]},{"id":"33d9a65.b86135a","type":"set","name":"set identifiers.allotted-resource-name","xml":"<set>\n<parameter name='ar-identifiers.allotted-resource-name' value='`$tmp.ar-name`' />\n","comments":"","x":2258.767318725586,"y":1545.3865489661694,"z":"4d1b2427.607d4c","wires":[]},{"id":"ac3303.d63e3d","type":"set","name":"set assignments in overal structure","xml":"<set>\n<parameter name='ar.allotted-resource-data.contrail-route-topology.contrail-route-assignments.' \nvalue=\"`$ar-assignments.`\" />\n\n\n","comments":"","x":593.1960144042969,"y":2152.624861717224,"z":"4d1b2427.607d4c","wires":[]},{"id":"6a318934.66ddc8","type":"set","name":"set ar-assignments","xml":"<set>\n<parameter name='ar-assignments.source-network.' value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.source-network.` \" />\n<parameter name='ar-assignments.dest-network.' value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.dest-network.` \" />\n<parameter name='ar-assignments.contrail-applied-service.' value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.contrail-applied-service-info.` \" />\n\n\n","comments":"","x":564.529167175293,"y":1399.3863624632359,"z":"4d1b2427.607d4c","wires":[]},{"id":"e9829904.2e77e8","type":"for","name":"for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]","xml":"<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n","comments":"","outputs":1,"x":1498.8155517578125,"y":2260.291075229645,"z":"4d1b2427.607d4c","wires":[["76e1246.58bf5dc"]]},{"id":"bec92482.90ee38","type":"switchNode","name":"switch service-data.consumed-allotted-resources_length","xml":"<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n","comments":"","outputs":1,"x":656.8150024414062,"y":2218.0051369667053,"z":"4d1b2427.607d4c","wires":[["4dce9f0e.197ca","75705eae.125bb"]]},{"id":"4dce9f0e.197ca","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":978.9578857421875,"y":2220.8625588417053,"z":"4d1b2427.607d4c","wires":[["f9d4ed78.b618a"]]},{"id":"75705eae.125bb","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":966.9578895568848,"y":2263.862560272217,"z":"4d1b2427.607d4c","wires":[["c55c83ec.31bb6"]]},{"id":"76e1246.58bf5dc","type":"switchNode","name":"switch allotted-resource-id","xml":"<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n","comments":"","outputs":1,"x":1928.9107818603516,"y":2262.3508410453796,"z":"4d1b2427.607d4c","wires":[["d664ab8f.6994a8"]]},{"id":"d664ab8f.6994a8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2133.720748901367,"y":2262.81529378891,"z":"4d1b2427.607d4c","wires":[["67045931.262a78"]]},{"id":"c55c83ec.31bb6","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1127.0849800109863,"y":2261.988536834717,"z":"4d1b2427.607d4c","wires":[["e9829904.2e77e8","1d1bc1f0.a72b7e"]]},{"id":"67045931.262a78","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2305.481700897217,"y":2262.6725223064423,"z":"4d1b2427.607d4c","wires":[["354eaed.bcc7f52","3ad061dc.d44dfe"]]},{"id":"f9d4ed78.b618a","type":"set","name":"set cidx","xml":"<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n","comments":"","x":1137.8148574829102,"y":2220.57662153244,"z":"4d1b2427.607d4c","wires":[]},{"id":"354eaed.bcc7f52","type":"set","name":"set tmp.cidx and ctx.consumed-ar","xml":"<set>\n<parameter name='tmp.cidx' value='`$cidx`' />\n<parameter name='ctx.consumed-ar.' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].`' />\n<parameter name='tmp.found-cidx' value='true' />","comments":"","x":2551.339029312134,"y":2263.2439963817596,"z":"4d1b2427.607d4c","wires":[]},{"id":"bbe3aaad.4a5568","type":"set","name":"set consumed allotted resources","xml":"<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$contrail-route-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n","comments":"","x":580.6723365783691,"y":2308.5766229629517,"z":"4d1b2427.607d4c","wires":[]},{"id":"8d887169.2ecf8","type":"comment","name":"Create urls for restapi","info":"","comments":"","x":561.9577674865723,"y":390.6243667602539,"z":"4d1b2427.607d4c","wires":[]},{"id":"6959d8ae.04d098","type":"set","name":"set ar-assignments","xml":"<set>\n<parameter name='ar-assignments.fq-name' value=\"`$tmp.fq-name` \" />\n\n\n\n","comments":"","x":548.6722793579102,"y":2118.196542739868,"z":"4d1b2427.607d4c","wires":[]},{"id":"8665234a.8510b","type":"comment","name":"Add AR to md-sal","info":"","comments":"","x":534.2437210083008,"y":2965.481409072876,"z":"4d1b2427.607d4c","wires":[]},{"id":"62c0d784.f7e3d8","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":535.2434692382812,"y":2343.4815063476562,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"e842b5e7.c19358","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: Existing contrail route allotted resource\" />\n    \n","comments":"","x":1616.33349609375,"y":728.3334121704102,"z":"4d1b2427.607d4c","wires":[]},{"id":"408b9489.78624c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":858.6667938232422,"y":767.3334536552429,"z":"4d1b2427.607d4c","wires":[["94a2f0be.5376d"]]},{"id":"94a2f0be.5376d","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1038.6667442321777,"y":768.0000042915344,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"ea795139.b531a","type":"set","name":"set ar data","xml":"<set>\n<parameter name='ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='ar.allotted-resource-status.action' value=\"`$contrail-route-topology-operation-input.request-information.request-action` \" />\n<parameter name='ar.allotted-resource-status.rpc-name' value=\"contrail-route-topology-operation\" />\n<parameter name='ar.allotted-resource-status.rpc-action' value=\"`$contrail-route-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$contrail-route-topology-operation-input.request-information.` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$contrail-route-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$contrail-route-topology-operation-input.service-information.` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$contrail-route-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.contrail-route-request-input.' value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.` \" />\n","comments":"","x":530.6667594909668,"y":771.666675567627,"z":"4d1b2427.607d4c","wires":[]},{"id":"70595e41.23774","type":"execute","name":"execute SliStringUtils - replace $CloudRegionID","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$CloudRegionID\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.cloud-region-id`\"/>\n\n","comments":"","outputs":1,"x":2303.333267211914,"y":1328.6671237945557,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"d7151a9c.c5a358","type":"execute","name":"execute SliStringUtils - replace $TenantNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$TenantNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.source-network.network-role`\"/>\n\n","comments":"","outputs":1,"x":2312.6664657592773,"y":1362.6670274734497,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"e6c914ff.bbbeb8","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":2317.3332595825195,"y":1503.333630681038,"z":"4d1b2427.607d4c","wires":[["be6042e3.12db","9ef8ef75.f00ad"]]},{"id":"be6042e3.12db","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2627.047782897949,"y":1506.1907633244991,"z":"4d1b2427.607d4c","wires":[["d59007c0.f67198"]]},{"id":"9ef8ef75.f00ad","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2632.3810272216797,"y":1537.85746383667,"z":"4d1b2427.607d4c","wires":[["b0a81ae7.4dfba8"]]},{"id":"b85f95cf.56c518","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='CONTRAIL_ROUTE_NAME_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='contrail_route_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='CONTRAIL_ROUTE_INSTANCE' />\n<parameter name='generate-unique-name-input.prefix' value=\"`$tmp.ar-name`\" />\n<parameter name='generate-unique-name-input.index-length' value='2' />\n","comments":"","x":2279.000259399414,"y":1433.0003308951855,"z":"4d1b2427.607d4c","wires":[]},{"id":"b0a81ae7.4dfba8","type":"set","name":"set tmp.ar-name to generated name","xml":"<set>\n<parameter name='tmp.ar-name' value='`$generate-unique-name-output.generated-name`' />\n","comments":"","x":2879.571189880371,"y":1538.3335467875004,"z":"4d1b2427.607d4c","wires":[]},{"id":"d59007c0.f67198","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":2800.9047050476074,"y":1505.6192770004272,"z":"4d1b2427.607d4c","wires":[]},{"id":"783e64a0.ae3edc","type":"set","name":"set fq_name","xml":"<set>\n<parameter name='tmp.fq-name' value='$defaultDomain.$defaultProject.$sdncNetworkPolicy' />\n","comments":"","x":548.3332748413086,"y":1478.6666288375854,"z":"4d1b2427.607d4c","wires":[]},{"id":"cd01ba46.1664d8","type":"execute","name":"execute SliStringUtils - replace $defaultDomain","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.fq-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.fq-name\"/>\n    <parameter name=\"target\" value=\"$defaultDomain\"/>\n    <parameter name=\"replacement\" value=\"default-domain\"/>\n\n","comments":"","outputs":1,"x":655.6666259765625,"y":1508.6666717529297,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"1420897.e40c477","type":"execute","name":"execute SliStringUtils - replace $defaultProject","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.fq-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.fq-name\"/>\n    <parameter name=\"target\" value=\"$defaultProject\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.tenant-name`\"/>\n\n","comments":"","outputs":1,"x":655.6666564941406,"y":1542.0001125335693,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"467969e2.ea3918","type":"comment","name":"generate fqname","info":"","comments":"","x":557.3333206176758,"y":1451.9999351501465,"z":"4d1b2427.607d4c","wires":[]},{"id":"1fa15432.96f97c","type":"execute","name":"execute SliStringUtils - replace $sdncNetworkPolicy","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.fq-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.fq-name\"/>\n    <parameter name=\"target\" value=\"$sdncNetworkPolicy\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar-name`\"/>\n\n","comments":"","outputs":1,"x":668.9999618530273,"y":1575.333267211914,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"bb5388b.9a34478","type":"comment","name":"Set onap-model-info","info":"","comments":"","x":554.1429672241211,"y":896.5714740753174,"z":"4d1b2427.607d4c","wires":[]},{"id":"af7a877d.eb2d78","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $service-data.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $service-data.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $service-data.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"description\" value=\"`$contrail-route-topology-operation-input.allotted-resource-information.allotted-resource-type`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$ar-model.invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$ar-model.uuid`\" />\n\t<parameter name=\"operational-status\" value=\"null\" />\n","comments":"","outputs":1,"x":568.8571891784668,"y":2474.5715532302856,"z":"4d1b2427.607d4c","wires":[["f49edd24.7f19d","22aa6a43.558c86"]]},{"id":"f49edd24.7f19d","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":824.6191215515137,"y":2451.809727668762,"z":"4d1b2427.607d4c","wires":[["a2554f1f.b50de"]]},{"id":"22aa6a43.558c86","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":829.9285507202148,"y":2487.381145477295,"z":"4d1b2427.607d4c","wires":[["a2554f1f.b50de"]]},{"id":"a2554f1f.b50de","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":1039.7143363952637,"y":2453.4287719726562,"z":"4d1b2427.607d4c","wires":[]},{"id":"a21ede43.fc3e7","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"tmp.ar-name=\"/>\n<parameter name=\"field3\" value=\"`$tmp.ar-name`\"/>\n<parameter name=\"field4\" value=\"generate-unique-name-input.prefix\" />\n<parameter name=\"field5\" value=\"`$generate-unique-name-input.prefix`\" />","comments":"","outputs":1,"x":2170.2000579833984,"y":1468.0004276931286,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"843930fc.abe98","type":"switchNode","name":"switch source-network.network-id","xml":"<switch test='`$contrail-route-topology-operation-input.contrail-route-request-input.source-network.network-id`'>\n\n","comments":"","outputs":1,"x":601.5997695922852,"y":1155.3336191177368,"z":"4d1b2427.607d4c","wires":[["f66777d8.98ad18","6a87e5bf.61d96c"]]},{"id":"f66777d8.98ad18","type":"other","name":"Other","xml":"<outcome value='Other'>","comments":"","outputs":1,"x":952.6000289916992,"y":1153.0001316070557,"z":"4d1b2427.607d4c","wires":[["cde00633.b18cb8"]]},{"id":"6a87e5bf.61d96c","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":945.2668228149414,"y":1114.9999265670776,"z":"4d1b2427.607d4c","wires":[["44011184.bdb35"]]},{"id":"b7184182.4959f","type":"for","name":"for nidx..service-data.networks.network[]","xml":"<for index='nidx' start='0' end='`$service-data.networks.network_length`' >\n","comments":"","outputs":1,"x":2105.7113876342773,"y":1151.444565474987,"z":"4d1b2427.607d4c","wires":[["1c4a61f3.c2849e"]]},{"id":"fbab815c.672c4","type":"switchNode","name":"switch service-data.networks.network_length","xml":"<switch test='`$service-data.networks.network_length`'>\n","comments":"","outputs":1,"x":1341.425392150879,"y":1152.0159158706665,"z":"4d1b2427.607d4c","wires":[["140ca41e.1dac4c","97892501.9ff8f8"]]},{"id":"140ca41e.1dac4c","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1630.425392150879,"y":1154.0159769058228,"z":"4d1b2427.607d4c","wires":[["662569df.4978f8"]]},{"id":"97892501.9ff8f8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1610.425392150879,"y":1189.0159769058228,"z":"4d1b2427.607d4c","wires":[["c55a8bab.54c1e8"]]},{"id":"cb1b209a.0c898","type":"switchNode","name":"switch networkid found","xml":"<switch test=\"`$service-data.networks.network[$nidx].network-id == $contrail-route-topology-operation-input.contrail-route-request-input.source-network.network-id`\">\n\n","comments":"","outputs":1,"x":2550.1400508880615,"y":1113.6947317123413,"z":"4d1b2427.607d4c","wires":[["6f669f36.77ecf"]]},{"id":"c55a8bab.54c1e8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1811.695411682129,"y":1190.5705423355103,"z":"4d1b2427.607d4c","wires":[["b7184182.4959f","74060662.5164e8","4f6aa7ae.9611b8"]]},{"id":"cde00633.b18cb8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1083.7112121582031,"y":1152.4444932937622,"z":"4d1b2427.607d4c","wires":[["fbab815c.672c4"]]},{"id":"44011184.bdb35","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error assigning contrail route.  Source network not found\" />\n","comments":"","x":1099.4002304077148,"y":1114.000121831894,"z":"4d1b2427.607d4c","wires":[]},{"id":"662569df.4978f8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error assigning contrail route.  Source network not found\" />\n","comments":"","x":1820.2001876831055,"y":1152.0001287460327,"z":"4d1b2427.607d4c","wires":[]},{"id":"74a5cd24.86b7f4","type":"set","name":"set tmp vals","xml":"<set>\n<parameter name='tmp.ar.tenant-id' value='`$service-data.networks.network[$nidx].network-data.network-topology.tenant`' />\n<parameter name='tmp.ar.cloud-region-id' value='`$service-data.networks.network[$nidx].network-data.network-topology.aic-cloud-region`' />\n<parameter name='source-network-found' value='true' />\n\n","comments":"","x":3059.2002391815186,"y":1093.0001211166382,"z":"4d1b2427.607d4c","wires":[]},{"id":"7a4f9f18.b1ca8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2869.2666816711426,"y":1106.00013256073,"z":"4d1b2427.607d4c","wires":[["74a5cd24.86b7f4","d9c31b5a.6a4cd8"]]},{"id":"6f669f36.77ecf","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2719.8002071380615,"y":1112.0000047683716,"z":"4d1b2427.607d4c","wires":[["7a4f9f18.b1ca8"]]},{"id":"465f3356.89525c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error assigning contrail route.  Source network not found\" />\n","comments":"","x":2434.5999183654785,"y":1186.0001649856567,"z":"4d1b2427.607d4c","wires":[]},{"id":"23fb5fa1.57992","type":"execute","name":"execute RestApiCallNode - Get Parent service network","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-parentnetwork-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"parent-net\" />\n\n","comments":"","outputs":1,"x":1549.0000228881836,"y":1704.000186920166,"z":"4d1b2427.607d4c","wires":[["a3fb960c.d85758","fc9d9601.9e18b8"]]},{"id":"a3fb960c.d85758","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1858.2960777282715,"y":1704.8080496788025,"z":"4d1b2427.607d4c","wires":[["ac20b661.d93d88"]]},{"id":"ac20b661.d93d88","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":2027.2960815429688,"y":1703.3079504966736,"z":"4d1b2427.607d4c","wires":[["55142221.a74b4c"]]},{"id":"55142221.a74b4c","type":"switchNode","name":"switch network length","xml":"<switch test='`$parent-net.networks.network_length`'>\n","comments":"","outputs":1,"x":2238.1533241271973,"y":1702.9270796775818,"z":"4d1b2427.607d4c","wires":[["66c12173.13d7","d9862bb8.9cb708"]]},{"id":"66c12173.13d7","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":2447.4865951538086,"y":1702.9269948005676,"z":"4d1b2427.607d4c","wires":[["a8318bf.731e378"]]},{"id":"68b4c2ed.00f22c","type":"comment","name":"GET dest network from mdsal","info":"","comments":"","x":1494.295997619629,"y":1645.3078532218933,"z":"4d1b2427.607d4c","wires":[]},{"id":"fc9d9601.9e18b8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1850.1478805541992,"y":1739.8741345405579,"z":"4d1b2427.607d4c","wires":[["8ccfa208.0193"]]},{"id":"8ccfa208.0193","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":2030.1478309631348,"y":1740.5406851768494,"z":"4d1b2427.607d4c","wires":[["fa75851f.39e8f8"]]},{"id":"fac7c328.21b71","type":"execute","name":"generate parent-network url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.network`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-parentnetwork-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n","comments":"","outputs":1,"x":585.0001220703125,"y":450.0000238418579,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"fa75851f.39e8f8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: No existing parent netorks\" />\n    \n","comments":"","x":2214.999954223633,"y":1742.0001639127731,"z":"4d1b2427.607d4c","wires":[]},{"id":"d9862bb8.9cb708","type":"other","name":"Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2448.999828338623,"y":1738.0000948905945,"z":"4d1b2427.607d4c","wires":[["462e905c.7055"]]},{"id":"462e905c.7055","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: Network id not found.  Parent Service should only have one network\" />\n    \n","comments":"","x":2615.3278045654297,"y":1737.9472098350525,"z":"4d1b2427.607d4c","wires":[]},{"id":"a8318bf.731e378","type":"set","name":"set dest network id","xml":"<set>\n<parameter name='ar-assignments.dest-network.network-id' value=\"`$parent-net.networks.network[0].network-id` \" />\n\n\n\n","comments":"","x":2626.5996856689453,"y":1704.000138759613,"z":"4d1b2427.607d4c","wires":[]},{"id":"d30b861c.434bf8","type":"comment","name":"Find tenant/cloud region from source network","info":"","comments":"","x":631.0000610351562,"y":1120.0000252723694,"z":"4d1b2427.607d4c","wires":[]},{"id":"b5119828.1d53c8","type":"execute","name":"generate contrail-applied-service url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.vnf`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-contrailappliedsvc-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.contrail-applied-service-instance-id`\"/>\n","comments":"","outputs":1,"x":612.200122833252,"y":480.00002574920654,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"e6eeaa3.150a058","type":"execute","name":"execute RestApiCallNode - Get vnf","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-contrailappliedsvc-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"vnf\" />\n\n","comments":"","outputs":1,"x":598.2000503540039,"y":1835.6668615341187,"z":"4d1b2427.607d4c","wires":[["1fcbedaf.3a00e2","f42d5962.ac9958"]]},{"id":"1fcbedaf.3a00e2","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":977.4961700439453,"y":1828.8080359697342,"z":"4d1b2427.607d4c","wires":[["81eaf91d.91f988"]]},{"id":"81eaf91d.91f988","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1146.4961738586426,"y":1827.3079367876053,"z":"4d1b2427.607d4c","wires":[["2ab7fe69.be87a2"]]},{"id":"2ab7fe69.be87a2","type":"switchNode","name":"switch vnf length","xml":"<switch test='`$vnf.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":1357.353416442871,"y":1826.9270659685135,"z":"4d1b2427.607d4c","wires":[["6ae0da83.aaa4f4","f324301e.0d32b"]]},{"id":"6ae0da83.aaa4f4","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1548.6869087219238,"y":1820.9270491600037,"z":"4d1b2427.607d4c","wires":[["b98f6f34.959f"]]},{"id":"be2cb9a.2505e48","type":"comment","name":"GET contrail vnf for contrail applied service  from mdsal","info":"","comments":"","x":660.8294906616211,"y":1797.6413383483887,"z":"4d1b2427.607d4c","wires":[]},{"id":"f42d5962.ac9958","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":969.347972869873,"y":1863.8741208314896,"z":"4d1b2427.607d4c","wires":[["e17a2bcb.e52fb8"]]},{"id":"e17a2bcb.e52fb8","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1149.3479232788086,"y":1864.540671467781,"z":"4d1b2427.607d4c","wires":[["a25cc221.aaa89"]]},{"id":"a25cc221.aaa89","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: No existing contrail applied service vnfs\" />\n    \n","comments":"","x":1334.2000465393066,"y":1866.0001502037048,"z":"4d1b2427.607d4c","wires":[]},{"id":"f324301e.0d32b","type":"other","name":"Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1550.2001419067383,"y":1856.0001492500305,"z":"4d1b2427.607d4c","wires":[["55da27e9.1a2d18"]]},{"id":"55da27e9.1a2d18","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: vnf id not found.  Contrail applied service should only have one vnf\" />\n    \n","comments":"","x":1714.5280456542969,"y":1855.9473118782043,"z":"4d1b2427.607d4c","wires":[]},{"id":"b98f6f34.959f","type":"set","name":"set applied service vnf id","xml":"<set>\n<parameter name='ar-assignments.contrail-applied-service.vnf-id' value=\"`$vnf.vnfs.vnf[0].vnf-id` \" />\n\n\n\n","comments":"","x":1759.8001136779785,"y":1820.0002398490906,"z":"4d1b2427.607d4c","wires":[]},{"id":"c6c2334d.98278","type":"comment","name":"Generate contrail route name","info":"","comments":"","x":583.0000457763672,"y":1244.0000286102295,"z":"4d1b2427.607d4c","wires":[]},{"id":"6add4fcf.7d2a3","type":"comment","name":"GET contrail fqdn from vnf/vf-module","info":"","comments":"","x":613.3333969116211,"y":1938.6669101715088,"z":"4d1b2427.607d4c","wires":[]},{"id":"8211864b.caed98","type":"switchNode","name":"switch contrail-route-request-input.constrail-applied-service-info.contrail-fqdn","xml":"<switch test='`$contrail-route-topology-operation-input.contrail-route-request-input.contrail-applied-service-info.contrail-fqdn`'>\n","comments":"","outputs":1,"x":719.0000991821289,"y":1980.0002436637878,"z":"4d1b2427.607d4c","wires":[["4525a9a8.0b4468","841c4f89.afe5f"]]},{"id":"4525a9a8.0b4468","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1111.0000648498535,"y":1970.0000656843185,"z":"4d1b2427.607d4c","wires":[["68cb2b70.90a404"]]},{"id":"841c4f89.afe5f","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1093.9999923706055,"y":2007.0000529289246,"z":"4d1b2427.607d4c","wires":[["36215833.3a7f48"]]},{"id":"36215833.3a7f48","type":"set","name":"set applied service fqdn","xml":"<set>\n<parameter name='ar-assignments.contrail-applied-service.contrail-fqdn' value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.contrail-applied-service-info.contrail-fqdn` \" />\n\n\n\n","comments":"","x":1285.0000076293945,"y":2007.000086903572,"z":"4d1b2427.607d4c","wires":[]},{"id":"68cb2b70.90a404","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1297.0000686645508,"y":1970.0000647306442,"z":"4d1b2427.607d4c","wires":[["bf2bb366.b639d","c7b161a8.2d59d"]]},{"id":"54037341.49dacc","type":"comment","name":"GET dest network from parent service","info":"","comments":"","x":603.666618347168,"y":1676.000069618225,"z":"4d1b2427.607d4c","wires":[]},{"id":"571268e5.730638","type":"switchNode","name":"switch contrail-route-topology-operation-input.contrail-route-request-input.dest-network.network-id","xml":"<switch test='`$contrail-route-topology-operation-input.contrail-route-request-input.dest-network.network-id`'>\n","comments":"","outputs":1,"x":795.0000686645508,"y":1704.0000405311584,"z":"4d1b2427.607d4c","wires":[["8bb9d911.861198","a62ad6dd.907908"]]},{"id":"8bb9d911.861198","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1236.9999771118164,"y":1704.0000402927399,"z":"4d1b2427.607d4c","wires":[["23fb5fa1.57992"]]},{"id":"a62ad6dd.907908","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1218.9999809265137,"y":1737.0000410079956,"z":"4d1b2427.607d4c","wires":[["cddb9071.a0335"]]},{"id":"cddb9071.a0335","type":"set","name":"set dest network id","xml":"<set>\n<parameter name='ar-assignments.dest-network.network-id' value=\"`$contrail-route-request-input.dest-network.network-id` \" />\n\n\n\n","comments":"","x":1410.999942779541,"y":1739.9999961853027,"z":"4d1b2427.607d4c","wires":[]},{"id":"bfe89f13.37b26","type":"comment","name":"GET contrail fqdn via AAI","info":"","comments":"","x":1550.2000579833984,"y":1933.9999685287476,"z":"4d1b2427.607d4c","wires":[]},{"id":"bf2bb366.b639d","type":"get-resource","name":"get-resource generic-vnf","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"generic-vnf\" \n\t\tkey=\"generic-vnf.vnf-id = $ar-assignments.contrail-applied-service.vnf-id\"\n        pfx='aai.vnf' local-only='false' >\n        \n\n\n","comments":"","outputs":1,"x":1560.2000579833984,"y":1969.9999694824219,"z":"4d1b2427.607d4c","wires":[["358e578d.2fd368","1096a3e1.ecde4c"]]},{"id":"1096a3e1.ecde4c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1762.8396644592285,"y":1998.805338382721,"z":"4d1b2427.607d4c","wires":[["1005d67c.37828a"]]},{"id":"1005d67c.37828a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving vnf from AAI\" />\n","comments":"","x":1938.7918891906738,"y":2002.1386723518372,"z":"4d1b2427.607d4c","wires":[]},{"id":"358e578d.2fd368","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1765.3394889831543,"y":1968.8054161071777,"z":"4d1b2427.607d4c","wires":[["e73bb580.fac7b8"]]},{"id":"e73bb580.fac7b8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Vnf not found in AAI\" />\n","comments":"","x":1933.117374420166,"y":1968.110846042633,"z":"4d1b2427.607d4c","wires":[]},{"id":"6ad7fa83.050644","type":"comment","name":"Loop through vf modeuls looking for contrail fqdn","info":"","comments":"","x":1633.8667068481445,"y":2038.333501815796,"z":"4d1b2427.607d4c","wires":[]},{"id":"57a1c09e.69c79","type":"comment","name":"Update AAI AR","info":"","comments":"","x":532.2000465393066,"y":2437.999997138977,"z":"4d1b2427.607d4c","wires":[]},{"id":"96b047c4.679ec8","type":"execute","name":"execute RestApiCallNode - Update parent provided service AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n","comments":"","outputs":1,"x":674.2001609802246,"y":2570.0002641677856,"z":"4d1b2427.607d4c","wires":[["c1fb6c5e.e721a","e74826b3.4d8b38","d137df8f.0037a"]]},{"id":"c1fb6c5e.e721a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":996.5081787109375,"y":2614.9984817504883,"z":"4d1b2427.607d4c","wires":[["dd5d09e6.0f8e48"]]},{"id":"e74826b3.4d8b38","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":987.508228302002,"y":2583.498507499695,"z":"4d1b2427.607d4c","wires":[["dd5d09e6.0f8e48"]]},{"id":"d137df8f.0037a","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":991.2582664489746,"y":2553.855612374842,"z":"4d1b2427.607d4c","wires":[["a297dd7b.aa05c"]]},{"id":"dd5d09e6.0f8e48","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for contrail-route-allotted-resource\" />\n","comments":"","x":1157.2582664489746,"y":2584.2485313415527,"z":"4d1b2427.607d4c","wires":[]},{"id":"a297dd7b.aa05c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1132.914234161377,"y":2550.0477815642953,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"c332fe05.c3ade","type":"comment","name":"Put the parent allotted resource in mdsal","info":"","comments":"","x":601.2001266479492,"y":2538.0000896453857,"z":"4d1b2427.607d4c","wires":[]},{"id":"1d1bc1f0.a72b7e","type":"switchNode","name":"switch tmp.found-cidx","xml":"<switch test='`$tmp.found-cidx`'>\n","comments":"","outputs":1,"x":1316.2000274658203,"y":2294.000059604645,"z":"4d1b2427.607d4c","wires":[["65d66863.2a8258"]]},{"id":"65d66863.2a8258","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1506.1999816894531,"y":2293.99999666214,"z":"4d1b2427.607d4c","wires":[["762eafdc.0bdf2"]]},{"id":"762eafdc.0bdf2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1672.1999816894531,"y":2293.99999666214,"z":"4d1b2427.607d4c","wires":[["63da8f53.b089c"]]},{"id":"63da8f53.b089c","type":"set","name":"set tmp.cidx ","xml":"<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n","comments":"","x":1918.0573101043701,"y":2294.5714707374573,"z":"4d1b2427.607d4c","wires":[]},{"id":"3ad061dc.d44dfe","type":"break","name":"break","xml":"<break>\n","comments":"","x":2468.199981689453,"y":2291.99999666214,"z":"4d1b2427.607d4c","wires":[]},{"id":"5e25bd11.a21d44","type":"execute","name":"generate parent-ar url - replace service-instance-id","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.parent-provided-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n","comments":"","outputs":1,"x":656.2001876831055,"y":512.0000591278076,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"e2e2a185.95801","type":"execute","name":"generate parent-ar url - replace allotted-resource-id","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.parent-ar-url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":661.2000579833984,"y":547.0000600814819,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"3111d761.5e06d8","type":"execute","name":"execute RestApiCallNode - Update parent provided service AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='DELETE' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n","comments":"","outputs":1,"x":1373.333595275879,"y":3004.3333768844604,"z":"4d1b2427.607d4c","wires":[["7e416b6f.40fa64","cdcc7917.56abb8","8bd6f68b.5ef6b8"]]},{"id":"521d8bd0.fa7014","type":"comment","name":"Rollback parent","info":"","comments":"","x":1217.3335227966309,"y":2974.000007390976,"z":"4d1b2427.607d4c","wires":[]},{"id":"2a4bd3e4.dd179c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1026.0001258850098,"y":3003.6666803359985,"z":"4d1b2427.607d4c","wires":[["3111d761.5e06d8","1a4098bb.aead37"]]},{"id":"7e416b6f.40fa64","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1744.64164352417,"y":3064.998343229294,"z":"4d1b2427.607d4c","wires":[["3c400d0a.33bc62"]]},{"id":"cdcc7917.56abb8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1735.6416931152344,"y":3033.4983689785004,"z":"4d1b2427.607d4c","wires":[["3c400d0a.33bc62"]]},{"id":"8bd6f68b.5ef6b8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1739.391731262207,"y":3003.8554738536477,"z":"4d1b2427.607d4c","wires":[["3c400d0a.33bc62"]]},{"id":"3c400d0a.33bc62","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1881.0476989746094,"y":3000.047643043101,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"5790ccca.f5ea54","type":"execute","name":"generate network-ar url - replace service-instance-id","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.network-provided-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.network-ar-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n","comments":"","outputs":1,"x":663.0000228881836,"y":581.9999942779541,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"c643b552.15d5b8","type":"execute","name":"generate network-ar url - replace network-id","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.network-ar-url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.network-ar-url\"/>\n    <parameter name=\"target\" value=\"{network-id}\"/>\n    <parameter name=\"replacement\" value=\"`$ar-assignments.dest-network.network-id`\"/>\n","comments":"","outputs":1,"x":608.3334274291992,"y":2757.333106994629,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"e9e426fe.b64fd8","type":"execute","name":"execute RestApiCallNode - Update parent network provided AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.network-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"net-ar\" />\n\n","comments":"","outputs":1,"x":669.0000686645508,"y":2789.332983970642,"z":"4d1b2427.607d4c","wires":[["5fedcca8.21af14","b88ee5a.8fd2218","945ef6e1.dc3458"]]},{"id":"b88ee5a.8fd2218","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1076.3081321716309,"y":2790.9985933303833,"z":"4d1b2427.607d4c","wires":[["758f2d97.6a46a4"]]},{"id":"945ef6e1.dc3458","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1068.9748420715332,"y":2826.165051460266,"z":"4d1b2427.607d4c","wires":[["758f2d97.6a46a4"]]},{"id":"5fedcca8.21af14","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1071.0581665039062,"y":2756.5221377387643,"z":"4d1b2427.607d4c","wires":[["758f2d97.6a46a4"]]},{"id":"758f2d97.6a46a4","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1242.7140617370605,"y":2761.047921180725,"z":"4d1b2427.607d4c","wires":[["47bc6f66.279f","aed7c269.f7e95"]]},{"id":"5b0d4b89.fa37f4","type":"comment","name":"Add AR to  parent network allotted resource from mdsal","info":"","comments":"","x":636.9999618530273,"y":2717.6666049957275,"z":"4d1b2427.607d4c","wires":[]},{"id":"aed7c269.f7e95","type":"switchNode","name":"switch net-ar_length","xml":"<switch test='`$net-ar.network-provided-allotted-resources.network-provided-ar-id_length`'>\n","comments":"","outputs":1,"x":1469.3332176208496,"y":2800.3330936431885,"z":"4d1b2427.607d4c","wires":[["28ec3cfa.5c9964","d62a83f8.5e709"]]},{"id":"561e5c25.cb8074","type":"for","name":"for nidx..net-ar[]","xml":"<for index='nidx' start='0' end='`$net-ar.network-provided-allotted-resources.network-provided-ar-id_length`' >\n","comments":"","outputs":1,"x":2187.6666717529297,"y":2821.3331003189087,"z":"4d1b2427.607d4c","wires":[["a35b9203.161d8"]]},{"id":"28ec3cfa.5c9964","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1752.1422843933105,"y":2755.9044466018677,"z":"4d1b2427.607d4c","wires":[["e0cae091.f6ab5"]]},{"id":"d62a83f8.5e709","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1733.8089332580566,"y":2829.571165084839,"z":"4d1b2427.607d4c","wires":[["8d766915.255368"]]},{"id":"a35b9203.161d8","type":"switchNode","name":"switch allotted-resource-id","xml":"<switch test=\"`$net-ar.network-provided-allotted-resources.network-provided-ar-id[$nidx] == $tmp.ar.allotted-resource-id`\">\n\n","comments":"","outputs":1,"x":2412.761730194092,"y":2828.3930258750916,"z":"4d1b2427.607d4c","wires":[["bc858023.6898d"]]},{"id":"bc858023.6898d","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2595.905242919922,"y":2823.857072353363,"z":"4d1b2427.607d4c","wires":[["f4a2c79.aa6a338"]]},{"id":"8d766915.255368","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1936.2693977355957,"y":2832.36363363266,"z":"4d1b2427.607d4c","wires":[["561e5c25.cb8074","3cebc33.7bab73c"]]},{"id":"f4a2c79.aa6a338","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2762.6662063598633,"y":2825.3809678554535,"z":"4d1b2427.607d4c","wires":[["e9b23d6.001eac","c26f5049.d1dee"]]},{"id":"a0f4304a.2addd","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2366.7178077697754,"y":2865.041989326477,"z":"4d1b2427.607d4c","wires":[["907c3bfc.fa31a8"]]},{"id":"907c3bfc.fa31a8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2536.0509071350098,"y":2863.3752422332764,"z":"4d1b2427.607d4c","wires":[["f4d721f4.46f46","fe096059.4ee75","3c945468.bd2a2c"]]},{"id":"f4d721f4.46f46","type":"set","name":"set tmp.nidx ","xml":"<set>\n<parameter name='tmp.nidx' value='`$net-ar.network-provided-allotted-resources.network-provided-ar-id_length`' />\n","comments":"","x":2741.9081535339355,"y":2868.946853160858,"z":"4d1b2427.607d4c","wires":[]},{"id":"6922d49.4d4892c","type":"comment","name":"allotted resource already exists- no op","info":"","comments":"","x":2457.999900817871,"y":2679.333148956299,"z":"4d1b2427.607d4c","wires":[]},{"id":"3cebc33.7bab73c","type":"switchNode","name":"switch tmp.found-nidx","xml":"<switch test='`$tmp.found-nidx`'>\n","comments":"","outputs":1,"x":2196.717716217041,"y":2863.375160217285,"z":"4d1b2427.607d4c","wires":[["a0f4304a.2addd"]]},{"id":"e9b23d6.001eac","type":"set","name":"set tmp.nidx ","xml":"<set>\n<parameter name='tmp.found-nidx' value='true' />","comments":"","x":2974.6665992736816,"y":2816.6662435531616,"z":"4d1b2427.607d4c","wires":[]},{"id":"c26f5049.d1dee","type":"break","name":"break","xml":"<break>\n","comments":"","x":2961.860704421997,"y":2850.0894327163696,"z":"4d1b2427.607d4c","wires":[]},{"id":"fe096059.4ee75","type":"execute","name":"execute RestApiCallNode - Update parent network provided AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.network-ar.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.network-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"p-network-ar\" />\n\n","comments":"","outputs":1,"x":2909.0000190734863,"y":2934.6661834716797,"z":"4d1b2427.607d4c","wires":[["409657f3.cf5e98","c70db172.aebc4","8859496f.d9d998"]]},{"id":"8859496f.d9d998","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":3251.9999656677246,"y":2980.999610900879,"z":"4d1b2427.607d4c","wires":[["34c49998.798456"]]},{"id":"c70db172.aebc4","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3243.000015258789,"y":2949.4996366500854,"z":"4d1b2427.607d4c","wires":[["34c49998.798456"]]},{"id":"409657f3.cf5e98","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":3246.7500534057617,"y":2919.856741525233,"z":"4d1b2427.607d4c","wires":[["34c49998.798456"]]},{"id":"34c49998.798456","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":3431.739345550537,"y":2916.0488624572754,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"47bc6f66.279f","type":"set","name":"set tmp.found-nidx = false","xml":"<set>\n<parameter name='tmp.found-nidx' value='false' />","comments":"","x":1485.9999809265137,"y":2730.6669635772705,"z":"4d1b2427.607d4c","wires":[]},{"id":"3c945468.bd2a2c","type":"set","name":"set length","xml":"<set>\n<parameter name='net-ar.network-provided-allotted-resources.network-provided-ar-id_length' value='`$net-ar.network-provided-allotted-resources.network-provided-ar-id_length + 1`' />\n<parameter name='net-ar.network-provided-allotted-resources.network-provided-ar-id[$tmp.nidx]' value=\"`$tmp.ar.allotted-resource-id`\" />\n","comments":"","x":2736.666305541992,"y":2903.000112056732,"z":"4d1b2427.607d4c","wires":[]},{"id":"e917600f.4f7d7","type":"set","name":"set new network-provided-ar","xml":"<set>\n<parameter name='net-ar.network-provided-allotted-resources.network-provided-ar-id_length' value=\"1\" />\n<parameter name='net-ar.network-provided-allotted-resources.network-provided-ar-id[0]' value=\"`$tmp.ar.allotted-resource-id`\" />\n\n\n\n\n","comments":"","x":2252.999351501465,"y":2759.285076737404,"z":"4d1b2427.607d4c","wires":[]},{"id":"e0cae091.f6ab5","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1949.6670188903809,"y":2755.9993057250977,"z":"4d1b2427.607d4c","wires":[["e917600f.4f7d7","fe096059.4ee75"]]},{"id":"ed6517f4.b8f3b8","type":"comment","name":"Other Rollbacks? ","info":"","comments":"","x":1222.999870300293,"y":3065.9997520446777,"z":"4d1b2427.607d4c","wires":[]},{"id":"5b89889f.eedaf8","type":"for","name":"for each vf-module","xml":"<for index='idx' start='0' end='`$aai.vnf.vf-modules.vf-module_length`' >\n","comments":"","outputs":1,"x":1975.1585693359375,"y":2104.26904296875,"z":"4d1b2427.607d4c","wires":[["c9284eeb.d1eb5"]]},{"id":"471bc9f6.bff138","type":"break","name":"break","xml":"<break>\n","comments":"","x":2854.730155944824,"y":2168.507378578186,"z":"4d1b2427.607d4c","wires":[]},{"id":"c9284eeb.d1eb5","type":"switchNode","name":"switch contrail-service-instance-fqdn","xml":"<switch test='`$aai-vf-module.contrail-service-instance-fqdn`'>\n","comments":"","outputs":1,"x":2258.66650390625,"y":2104.999755859375,"z":"4d1b2427.607d4c","wires":[["b136ca44.5724a8","ed24b238.48ffb"]]},{"id":"eedd883d.4f3368","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"VF Module not found in AAI\" />\n","comments":"","x":1956.61083984375,"y":2071.97216796875,"z":"4d1b2427.607d4c","wires":[]},{"id":"b136ca44.5724a8","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2538.66650390625,"y":2106.3330078125,"z":"4d1b2427.607d4c","wires":[["b5e70f0a.b42d"]]},{"id":"ed24b238.48ffb","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2520.6665077209473,"y":2139.3330085277557,"z":"4d1b2427.607d4c","wires":[["322afc54.4f0194"]]},{"id":"b5e70f0a.b42d","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2695.3334197998047,"y":2104.666417121887,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"322afc54.4f0194","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2701.9997482299805,"y":2136.333013534546,"z":"4d1b2427.607d4c","wires":[["471bc9f6.bff138","caad7e17.7d471"]]},{"id":"caad7e17.7d471","type":"set","name":"set applied service fqdn","xml":"<set>\n<parameter name='ar-assignments.contrail-applied-service.contrail-fqdn' value=\"`$aai-vf-module.contrail-service-instance-fqdn` \" />\n\n\n\n","comments":"","x":2913.3330078125,"y":2135.6666259765625,"z":"4d1b2427.607d4c","wires":[]},{"id":"be0b4c28.f1b79","type":"switchNode","name":"switch ar-assignments.contrail-applied-service.contrail-fqdn","xml":"<switch test='`$ar-assignments.contrail-applied-service.contrail-fqdn`'>\n","comments":"","outputs":1,"x":672.0000610351562,"y":2053.6666259765625,"z":"4d1b2427.607d4c","wires":[["214426a4.7d2d2a"]]},{"id":"214426a4.7d2d2a","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1000.6667442321777,"y":2054.333152294159,"z":"4d1b2427.607d4c","wires":[["9fbe5884.aaa628"]]},{"id":"9fbe5884.aaa628","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: No vf-module with contrail-service-instance-fqdn found in AAI\" />\n    \n","comments":"","x":1176.6666259765625,"y":2052.66650390625,"z":"4d1b2427.607d4c","wires":[]},{"id":"68ea4ba9.f086b4","type":"comment","name":"MDSal adaptor only saves consuming service so parent service and AR are done by Rest api calls","info":"","comments":"","x":650.666618347168,"y":90.99999618530273,"z":"4d1b2427.607d4c","wires":[]},{"id":"d9c31b5a.6a4cd8","type":"get-resource","name":"get-resource tenant","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"tenant\" \n\t\tkey=\"cloud-region.cloud-owner = 'Rackspace' AND \n\t\t     cloud-region.cloud-region-id = $tmp.ar.cloud-region-id AND\n\t\t     tenant.tenant-id = $tmp.ar.tenant-id\"\n        pfx='aai.tenant' local-only='false' >\n\n","comments":"","outputs":1,"x":3081.666784286499,"y":1128.9998168945312,"z":"4d1b2427.607d4c","wires":[["a1818b66.74b108","7a2bb1ac.b1704","d7af6553.4f9528"]]},{"id":"a1818b66.74b108","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":3302.5281734466553,"y":1121.6109313964844,"z":"4d1b2427.607d4c","wires":[["e5f97be8.5172e8"]]},{"id":"7a2bb1ac.b1704","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":3297.8612003326416,"y":1154.94424533844,"z":"4d1b2427.607d4c","wires":[["e5f97be8.5172e8"]]},{"id":"e5f97be8.5172e8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Tenant not found in AAI\" />\n\n","comments":"","x":3472.0371227264404,"y":1142.9998044967651,"z":"4d1b2427.607d4c","wires":[]},{"id":"d7af6553.4f9528","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":3298.0372066497803,"y":1090.0368957519531,"z":"4d1b2427.607d4c","wires":[["d4ad82c0.f23a2"]]},{"id":"d4ad82c0.f23a2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3478.0372066497803,"y":1088.0368957519531,"z":"4d1b2427.607d4c","wires":[["e5841bea.414a18"]]},{"id":"e5841bea.414a18","type":"set","name":"set tenant name","xml":"<set>\n<parameter name='tmp.ar.tenant-name' value='`$aai.tenant.tenant-name`' />\n\n\n","comments":"","x":3665.000310897827,"y":1085.6666374206543,"z":"4d1b2427.607d4c","wires":[]},{"id":"1c4a61f3.c2849e","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2344.39990234375,"y":1116,"z":"4d1b2427.607d4c","wires":[["cb1b209a.0c898","3cf67218.fc2b9e"]]},{"id":"3cf67218.fc2b9e","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"tmp.ar-name=\"/>\n<parameter name=\"field3\" value=\"`$tmp.ar-name`\"/>\n<parameter name=\"field4\" value=\"service-data-network-id\" />\n<parameter name=\"field5\" value=\"`$service-data.networks.network[$nidx].network-id`\" />\n<parameter name=\"field6\" value=\"contrail-route-input-network-id\" />\n<parameter name=\"field7\" value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.source-network.network-id`\" />\n<parameter name=\"field8\" value=\"`$nidx`\" />","comments":"","outputs":1,"x":2509.0000762939453,"y":1079.0001277923584,"z":"4d1b2427.607d4c","wires":[[]]},{"id":"74060662.5164e8","type":"set","name":"set source-network-found","xml":"<set>\n<parameter name='source-network-found' value='false' />\n\n","comments":"","x":2067.000198364258,"y":1120.0000407099724,"z":"4d1b2427.607d4c","wires":[]},{"id":"4f6aa7ae.9611b8","type":"switchNode","name":"switch source-network-found","xml":"<switch test=\"`$source-network-found`\">\n\n","comments":"","outputs":1,"x":2071.000072479248,"y":1186.000033378601,"z":"4d1b2427.607d4c","wires":[["ef194605.ce8898"]]},{"id":"ef194605.ce8898","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2283.000030517578,"y":1186.0000343322754,"z":"4d1b2427.607d4c","wires":[["465f3356.89525c"]]},{"id":"c7b161a8.2d59d","type":"switchNode","name":"switch vf-module_length","xml":"<switch test='`$aai.vnf.vf-modules.vf-module_length`'>\n","comments":"","outputs":1,"x":1558,"y":2071,"z":"4d1b2427.607d4c","wires":[["883be9e.f5d5a18","130ed066.b1002"]]},{"id":"883be9e.f5d5a18","type":"other","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1763,"y":2072,"z":"4d1b2427.607d4c","wires":[["eedd883d.4f3368"]]},{"id":"130ed066.b1002","type":"other","name":"outcome other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1763,"y":2103,"z":"4d1b2427.607d4c","wires":[["5b89889f.eedaf8"]]}]
