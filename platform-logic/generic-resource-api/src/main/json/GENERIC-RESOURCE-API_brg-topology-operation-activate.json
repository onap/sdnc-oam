[{"id":"365c93f8.67b65c","type":"dgstart","name":"DGSTART","outputs":1,"x":137,"y":110,"z":"18a62ac6.9713a5","wires":[["169d7df0.93c452"]]},{"id":"169d7df0.93c452","type":"service-logic","name":"GENERIC-RESOURCE-API 1.2.0-SNAPSHOT-111602b4-M","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":233.23807907104492,"y":170.95239067077637,"z":"18a62ac6.9713a5","wires":[["37783da7.81e2d2"]]},{"id":"37783da7.81e2d2","type":"method","name":"brg-topology-operation-activate","xml":"<method rpc='brg-topology-operation-activate' mode='sync'>\n","comments":"","outputs":1,"x":279.15485763549805,"y":206.19044589996338,"z":"18a62ac6.9713a5","wires":[["ec733994.d86e28"]]},{"id":"ec733994.d86e28","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":146.9761962890625,"y":2113.02392578125,"z":"18a62ac6.9713a5","wires":[["76888a74.ab17f4","1f22feac.f3b4c1","2fb29eef.4d6022","42d16f76.97199","338a947c.fbfb4c","95ce73fc.e2da1","c12a838c.45d44","52d9aec6.4c672","3d09c51e.7756ea","a2cfcba2.8fa4e8","104fcdf2.664762","56ef84b.a41387c","7d5c50e5.f78f5","1b700479.28334c","bc0b2cc1.a132a","8f3f21c6.12337","2d189fc6.3f48b","c4a8c4dc.ecee78","f658867d.2c6f38","c96c9fc4.ca9e","fc4cba6e.c5fde8","3f657cde.b4a5c4","40795c0d.d10224","197fef59.d47721","aa1291ea.d5213","1a0eab31.418c85","33f5a5f1.69bb3a","3aa67c55.65a524","d1f5d2dc.8c8b6","d19c10c6.e1717","f6439501.9c66a8","52c535ca.3b7a7c","9aa4c9fa.958f98","a0c021e1.707d58","f30cbbcf.ee6ed8","4b54eeb9.9b9a28","d4c6d967.74fbd"]]},{"id":"1f22feac.f3b4c1","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":451.5002098083496,"y":2666.381863594055,"z":"18a62ac6.9713a5","wires":[]},{"id":"76888a74.ab17f4","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='brg-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $tmp.service-data.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n <!--\nbrg-topology-operation-input.allotted-resource-information.parent-service-instance-id\n \n brg-topology-operation-input.service-information.service-instance-id\n -->\n","comments":"","x":477.2541198730469,"y":2623.504550933838,"z":"18a62ac6.9713a5","wires":[]},{"id":"a2cfcba2.8fa4e8","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Active' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$brg-topology-operation-input.request-information.request-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$brg-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$brg-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":493.7542190551758,"y":730.0514001846313,"z":"18a62ac6.9713a5","wires":[]},{"id":"42d16f76.97199","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:brg-allotted-resources/brg-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/brg-topology/'` \" />\n\n","comments":"","x":447.738037109375,"y":342.33331298828125,"z":"18a62ac6.9713a5","wires":[]},{"id":"2fb29eef.4d6022","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$brg-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$brg-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n<!--\n<parameter name='tmp.ar.brg-vnf-id' value='`$brg-topology-operation-input.allotted-resource-data.brg-topology.brg-assignments.brg-vnf-id`' />\n-->\n\n","comments":"","x":487.997314453125,"y":257.59259033203125,"z":"18a62ac6.9713a5","wires":[]},{"id":"338a947c.fbfb4c","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":453.9934196472168,"y":380.23152446746826,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"c12a838c.45d44","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":518.5187530517578,"y":520.4594917297363,"z":"18a62ac6.9713a5","wires":[["c6a75b8.41f8ca8","84cd8969.410b78"]]},{"id":"95ce73fc.e2da1","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.brg-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":482.0648536682129,"y":440.0172290802002,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"c6a75b8.41f8ca8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":775.8148918151855,"y":519.2672522068024,"z":"18a62ac6.9713a5","wires":[["b7ef52bd.d3fa6"]]},{"id":"52d9aec6.4c672","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.brg.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":526.5293121337891,"y":873.4341316223145,"z":"18a62ac6.9713a5","wires":[["45b09dfd.cbfde4","57dd2e4f.a6dec","c52bd776.1a5058"]]},{"id":"45b09dfd.cbfde4","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1050.8373832702637,"y":898.4324235916138,"z":"18a62ac6.9713a5","wires":[["20c4b5a1.de818a"]]},{"id":"57dd2e4f.a6dec","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1041.8374328613281,"y":866.9324493408203,"z":"18a62ac6.9713a5","wires":[["20c4b5a1.de818a"]]},{"id":"c52bd776.1a5058","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1045.5874710083008,"y":837.2895542159677,"z":"18a62ac6.9713a5","wires":[["60273514.ef34ec"]]},{"id":"20c4b5a1.de818a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for brg-allotted-resource\" />\n","comments":"","x":1211.5874710083008,"y":867.6824731826782,"z":"18a62ac6.9713a5","wires":[]},{"id":"b7ef52bd.d3fa6","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":956.8148460388184,"y":519.7672016620636,"z":"18a62ac6.9713a5","wires":[["284a87e4.4278d8","dc25137f.905be"]]},{"id":"284a87e4.4278d8","type":"switchNode","name":"switch brg length","xml":"<switch test='`$mdsal-ar.brg-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1202.6720924377441,"y":554.052964925766,"z":"18a62ac6.9713a5","wires":[["324a8d88.db8242"]]},{"id":"324a8d88.db8242","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1393.6720962524414,"y":554.0529625415802,"z":"18a62ac6.9713a5","wires":[["641f1fa5.a47fe"]]},{"id":"ce809b2c.dfd4d8","type":"set","name":"set brg-ar from get","xml":"<set>\n<parameter name='brg-ar.' value='$mdsal-ar.brg-allotted-resource[0].' />\n","comments":"","x":1793.5292320251465,"y":554.6243867874146,"z":"18a62ac6.9713a5","wires":[]},{"id":"641f1fa5.a47fe","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":1564.5290794372559,"y":554.6244316101074,"z":"18a62ac6.9713a5","wires":[["ce809b2c.dfd4d8","8e46a7f2.0c6588","3aefc57c.315b5a"]]},{"id":"8e46a7f2.0c6588","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$brg-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$brg-ar.allotted-resource-status.rpc-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$brg-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1791.5294761657715,"y":622.0529508590698,"z":"18a62ac6.9713a5","wires":[]},{"id":"ed7dff8.e3acc","type":"comment","name":"GET brg-allotted-resource from mdsal","info":"","comments":"","x":543.8148155212402,"y":483.7671926021576,"z":"18a62ac6.9713a5","wires":[]},{"id":"3aefc57c.315b5a","type":"switchNode","name":"switch order-status","xml":"<switch test='`$brg-ar.allotted-resource-data.allotted-resource-oper-status.order-status`'>\n","comments":"","outputs":1,"x":1801.52925491333,"y":587.6243848800659,"z":"18a62ac6.9713a5","wires":[["abdb04fd.2cc288","62315be8.564254"]]},{"id":"abdb04fd.2cc288","type":"outcome","name":"outcome Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":2013.1292114257812,"y":548.6243848800659,"z":"18a62ac6.9713a5","wires":[["f727ed41.8760a"]]},{"id":"62315be8.564254","type":"outcome","name":"outcome Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2038.8435859680176,"y":584.052975654602,"z":"18a62ac6.9713a5","wires":[["f727ed41.8760a"]]},{"id":"fc060079.fdec8","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":499.33863830566406,"y":574.3386459350586,"z":"18a62ac6.9713a5","wires":[]},{"id":"dc25137f.905be","type":"set","name":"save backup copy of mdsal-ar for rollback","xml":"<set>\n<parameter name='bk-brg-ar' value='$mdsal-ar.' />\n","comments":"","x":1282.3864250183105,"y":519.7672936916351,"z":"18a62ac6.9713a5","wires":[]},{"id":"c56cf0bd.1e9dc","type":"comment","name":"Create urls for restapi","info":"","comments":"","x":452.9576606750488,"y":409.6243562698364,"z":"18a62ac6.9713a5","wires":[]},{"id":"60273514.ef34ec","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1187.2434387207031,"y":833.4817234054208,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"e7d7a66b.fa9838","type":"comment","name":"TO DO: vnf/put parent","info":"","comments":"","x":457.2433776855469,"y":762.1481952667236,"z":"18a62ac6.9713a5","wires":[]},{"id":"3d09c51e.7756ea","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":441.24338150024414,"y":691.4815549850464,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"84cd8969.410b78","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":775.5766868591309,"y":555.4814250469208,"z":"18a62ac6.9713a5","wires":[["7991d5a8.19d38c"]]},{"id":"7991d5a8.19d38c","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":955.5766372680664,"y":556.1479756832123,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"104fcdf2.664762","type":"set","name":"set id","xml":"<set>\n<parameter name='brg-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='brg-ar.allotted-resource-status.action' value=\"`$brg-topology-operation-input.request-information.request-action` \" />\n<parameter name='brg-ar.allotted-resource-status.rpc-name' value=\"brg-topology-operation\" />\n<parameter name='brg-ar.allotted-resource-status.rpc-action' value=\"`$brg-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$brg-topology-operation-input.request-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$brg-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$brg-topology-operation-input.service-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$brg-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.' value=\"`$brg-topology-operation-input.brg-request-input.` \" />","comments":"","x":424.24342346191406,"y":611.1481666564941,"z":"18a62ac6.9713a5","wires":[]},{"id":"f727ed41.8760a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2227.5997276306152,"y":550.0000190734863,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"56ef84b.a41387c","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $brg-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $brg-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $brg-topology-operation-input.allotted-resource-information.parent-service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"operational-status\" value=\"in-service-path\" />\n","comments":"","outputs":1,"x":484.85716247558594,"y":795.2380628585815,"z":"18a62ac6.9713a5","wires":[["f4a20a5a.4d8c98","1cbfe5b1.92129a"]]},{"id":"f4a20a5a.4d8c98","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":740.6190567016602,"y":778.1905598640442,"z":"18a62ac6.9713a5","wires":[["ef10ebfc.9e5c08"]]},{"id":"ef10ebfc.9e5c08","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":907.142936706543,"y":789.8096308708191,"z":"18a62ac6.9713a5","wires":[]},{"id":"1cbfe5b1.92129a","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":747.7143440246582,"y":810.9525275230408,"z":"18a62ac6.9713a5","wires":[["ef10ebfc.9e5c08"]]},{"id":"7d5c50e5.f78f5","type":"execute","name":"execute RestApiCallNode - setup BRG to vgMux vxlan tunnel port","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.vpp.vxlan-tunnel.templatefile`\" />\n    <parameter name='restapiUrl' value='`$tmp.honeycomb.url + $tmp.vpp-honeycomb-url`' />\n    <parameter name='restapiUser' value='`$prop.honeycomb.user`' />\n    <parameter name='restapiPassword' value='`$prop.honeycomb.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"honeycomb-vnf\" />\n\n","comments":"","outputs":1,"x":597.0000610351562,"y":1364.6668300628662,"z":"18a62ac6.9713a5","wires":[["2ca4c669.5c49fa","e2daafee.ef521","4eb7df5c.3fef3"]]},{"id":"2ca4c669.5c49fa","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":930.9748497009277,"y":1423.9984420761466,"z":"18a62ac6.9713a5","wires":[["7f5791ac.67684"]]},{"id":"e2daafee.ef521","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":921.9748992919922,"y":1392.4984678253531,"z":"18a62ac6.9713a5","wires":[["7f5791ac.67684"]]},{"id":"4eb7df5c.3fef3","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":925.7249374389648,"y":1362.8555727005005,"z":"18a62ac6.9713a5","wires":[["b21cdd09.f6c39"]]},{"id":"7f5791ac.67684","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error setting up vxlan tunnel\" />\n","comments":"","x":1091.7249374389648,"y":1393.248491667211,"z":"18a62ac6.9713a5","wires":[]},{"id":"b21cdd09.f6c39","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1067.3809051513672,"y":1359.0477418899536,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"1b700479.28334c","type":"execute","name":"execute RestApiCallNode - setup BRG vxlan bridge domain","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.vpp.bridge-domain.templatefile`\" />\n    <parameter name='restapiUrl' value=\"`$tmp.honeycomb.url + $tmp.vpp-honeycomb-url + '/v3po:l2' `\" />\n    <parameter name='restapiUser' value='`$prop.honeycomb.user`' />\n    <parameter name='restapiPassword' value='`$prop.honeycomb.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"honeycomb-vnf\" />\n\n","comments":"","outputs":1,"x":578.6668243408203,"y":1511.3336246013641,"z":"18a62ac6.9713a5","wires":[["7284360c.605168","8ddf7786.265978","f7e8ea47.905e38"]]},{"id":"7284360c.605168","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":999.9747314453125,"y":1566.9985536560416,"z":"18a62ac6.9713a5","wires":[["4fdc6451.028a2c"]]},{"id":"8ddf7786.265978","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":990.974781036377,"y":1535.4985794052482,"z":"18a62ac6.9713a5","wires":[["4fdc6451.028a2c"]]},{"id":"f7e8ea47.905e38","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":994.7248191833496,"y":1505.8556842803955,"z":"18a62ac6.9713a5","wires":[["91d81f82.509b9"]]},{"id":"4fdc6451.028a2c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error setting up bridge domain\" />\n","comments":"","x":1160.7248191833496,"y":1536.248603247106,"z":"18a62ac6.9713a5","wires":[]},{"id":"91d81f82.509b9","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1136.380786895752,"y":1502.0478534698486,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"2d189fc6.3f48b","type":"set","name":"set BRG to vgMUX VXLAN Tunnel Port Props","xml":"<set>\n<parameter name='tmp.tunnel-name' value=\"`'vxlanTun' + $brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-lan-ip` \" />\n<parameter name='tmp.tunnel-dest-ip' value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-lan-ip` \" />\n<parameter name='tmp.tunnel-src-ip' value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vbrg-wan-ip` \" />\n<parameter name='tmp.tunnel-vni' value=\"`$brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.vni` \" />","comments":"","x":533.1112060546875,"y":1229.6670894622803,"z":"18a62ac6.9713a5","wires":[]},{"id":"8f3f21c6.12337","type":"execute","name":"generate full brg-vpp-honeycomb url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.vpp-honeycomb`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vpp-honeycomb-url\"/>\n    <parameter name=\"target\" value=\"{tunnel-name}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.tunnel-name`\"/>\n","comments":"","outputs":1,"x":504.77784729003906,"y":1284.6668682098389,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"bc0b2cc1.a132a","type":"execute","name":"generate honeycomb-url to vBRG","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.honeycomb.url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.honeycomb.url\"/>\n    <parameter name=\"target\" value=\"{honeycomb-instance-ip}\"/>\n    <parameter name=\"replacement\" value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vbrg-wan-ip`\"/>\n","comments":"","outputs":1,"x":495.7778778076172,"y":1173.3333940505981,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"c4a8c4dc.ecee78","type":"set","name":"set BRG Bridge Domain Props","xml":"<set>\n<parameter name='tmp.bridge-domain' value=\"bridge-domain-10\" />\n<parameter name='tmp.split-horizon-group' value=\"2\" />","comments":"","x":488.1111602783203,"y":1436.3334999084473,"z":"18a62ac6.9713a5","wires":[]},{"id":"a6a8b2c1.8f856","type":"comment","name":"save service data for BRG to md-sal for SO to do GET ","info":"http://c1.vm1.sdnc.simpledemo.openecomp.org:8282/restconf/config/GENERIC-RESOURCE-API:services/service/e565bb6b-de14-4a5c-a992-65a681771a7a/service-data/service-topology/\n\n\nservice-instance-id is of the vBRG (in VNF-API data)","comments":"","x":230.79503631591797,"y":2214.7715578079224,"z":"18a62ac6.9713a5","wires":[]},{"id":"c96c9fc4.ca9e","type":"execute","name":"execute RestApiCallNode - Get service-data by vnf-id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.vnf-api-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"service-data\" />\n\n","comments":"","outputs":1,"x":563.0015068054199,"y":2341.8350467681885,"z":"18a62ac6.9713a5","wires":[["f822a588.1a5c98","d95df392.1987d"]]},{"id":"f822a588.1a5c98","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":851.8214263916016,"y":2339.2143902778625,"z":"18a62ac6.9713a5","wires":[["473d24ff.a9b42c"]]},{"id":"473d24ff.a9b42c","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1032.8213806152344,"y":2339.714339733124,"z":"18a62ac6.9713a5","wires":[["a5e620b6.49938","3fd59db1.35aa72"]]},{"id":"a5e620b6.49938","type":"switchNode","name":"switch brg length","xml":"<switch test='`$service-data.service-data_length`'>\n","comments":"","outputs":1,"x":1278.6786270141602,"y":2374.000102996826,"z":"18a62ac6.9713a5","wires":[["fb4aa2aa.355d5"]]},{"id":"fb4aa2aa.355d5","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1469.6786308288574,"y":2374.0001006126404,"z":"18a62ac6.9713a5","wires":[["29a2aafd.0e61f6"]]},{"id":"a35ce553.1561d8","type":"set","name":"set service-data from get","xml":"<set>\n<parameter name='tmp.service-data.' value='$service-data.service-data[0].' />\n","comments":"","x":1869.5357666015625,"y":2374.5715248584747,"z":"18a62ac6.9713a5","wires":[]},{"id":"29a2aafd.0e61f6","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":1640.5356140136719,"y":2374.5715696811676,"z":"18a62ac6.9713a5","wires":[["a35ce553.1561d8","9129f6ff.19a068"]]},{"id":"37dc6d21.e214a2","type":"comment","name":"GET vnf-api service info","info":"","comments":"","x":468.39276123046875,"y":2305.1427431106567,"z":"18a62ac6.9713a5","wires":[]},{"id":"9129f6ff.19a068","type":"switchNode","name":"switch order-status","xml":"<switch test='`$tmp.service-data.order-status`'>\n","comments":"","outputs":1,"x":1853.249984741211,"y":2426.1429500579834,"z":"18a62ac6.9713a5","wires":[["6564b5f7.1e716c","4e3f2f90.50e22"]]},{"id":"6564b5f7.1e716c","type":"outcome","name":"outcome Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":2093.1355476379395,"y":2390.5714988708496,"z":"18a62ac6.9713a5","wires":[["27659936.9b16a6"]]},{"id":"4e3f2f90.50e22","type":"outcome","name":"outcome Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2118.849922180176,"y":2426.0000896453857,"z":"18a62ac6.9713a5","wires":[["27659936.9b16a6"]]},{"id":"a417ed65.697e3","type":"comment","name":"Set service-data","info":"","comments":"","x":444.4880065917969,"y":2440.0004692077637,"z":"18a62ac6.9713a5","wires":[]},{"id":"3fd59db1.35aa72","type":"set","name":"save backup copy of mdsal-ar for rollback","xml":"<set>\n<parameter name='bk-service-data' value='$service-data.' />\n","comments":"","x":1358.3929595947266,"y":2339.7144317626953,"z":"18a62ac6.9713a5","wires":[]},{"id":"d95df392.1987d","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":851.5832214355469,"y":2375.428563117981,"z":"18a62ac6.9713a5","wires":[["893155db.6b0fe8"]]},{"id":"893155db.6b0fe8","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1031.5831718444824,"y":2376.0951137542725,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"27659936.9b16a6","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2307.6060638427734,"y":2391.94713306427,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"f658867d.2c6f38","type":"execute","name":"generate vnf service-info url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.vnf-api.service-information`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vnf-api-url\"/>\n    <parameter name=\"target\" value=\"{vnf-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.brg-vnf-id`\"/>\n\n   <!-- \n   <parameter name=\"replacement\" value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.brg-vnf-id`\"/>\n -->\n    <!--\n    <parameter name=\"replacement\" value=\"`$brg-topology-operation-input.allotted-resource-data.brg-topology.brg-assignments.brg-vnf-id`\"/>\n-->\n<!--\nbrg-ar.allotted-resource-data.brg-topology.brg-assignments\n-->","comments":"","outputs":1,"x":484.8109130859375,"y":2260.263671875,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"3f657cde.b4a5c4","type":"execute","name":"execute RestApiCallNode - PUT service into service","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.services.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.services-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":563.0966911315918,"y":2518.502098083496,"z":"18a62ac6.9713a5","wires":[["158b7553.e6c0ab","23fdc360.f5c5ec","b2329d47.fddb5"]]},{"id":"158b7553.e6c0ab","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1069.3095474243164,"y":2513.0241107940674,"z":"18a62ac6.9713a5","wires":[["9901f01.23a2d1"]]},{"id":"23fdc360.f5c5ec","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1060.3095970153809,"y":2481.524136543274,"z":"18a62ac6.9713a5","wires":[["9901f01.23a2d1"]]},{"id":"b2329d47.fddb5","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1064.0596351623535,"y":2451.8812414184213,"z":"18a62ac6.9713a5","wires":[["beabb707.b031c8"]]},{"id":"9901f01.23a2d1","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for brg-allotted-resource\" />\n","comments":"","x":1230.0596351623535,"y":2482.274160385132,"z":"18a62ac6.9713a5","wires":[]},{"id":"beabb707.b031c8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1205.7156028747559,"y":2448.0734106078744,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"fc4cba6e.c5fde8","type":"execute","name":"generate services url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.services`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.services-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.service-data.service-information.service-instance-id`\"/>\n<!--  tmp.service-data.service-information.service-instance-id\nbrg-topology-operation-input.allotted-resource-information.parent-service-instance-id\nbrg-topology-operation-input.service-information.service-instance-id\n\n-->","comments":"","outputs":1,"x":462.4300231933594,"y":2470.02618598938,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"40795c0d.d10224","type":"get-resource","name":"get-resource IPADDR from dmaap DHCP_MAP ","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='IPADDR' key=\"SELECT min(ip_addr) ip from DHCP_MAP where mac_addr = $brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.brg-wan-mac-address\" pfx=\"tmp.brg-wan-ip\" >\n","comments":"","outputs":1,"x":541.8571624755859,"y":921.7501087188721,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"197fef59.d47721","type":"set","name":"set brg-ar.allotted-resource-data.brg-topology.brg-assignments.vbrg-wan-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vbrg-wan-ip' value='`$tmp.brg-wan-ip.ip`' />\n","comments":"","x":628.0000305175781,"y":971.0000267028809,"z":"18a62ac6.9713a5","wires":[]},{"id":"aa1291ea.d5213","type":"set","name":"set tmp.ar.consuming-service-instance-id to find vgmux-lan-ip","xml":"<set>\n<parameter name='tmp.ar.consuming-service-instance-id' value='`$brg-ar.allotted-resource-data.brg-topology.allotted-resource-identifiers.consuming-service-instance-id`' />\n","comments":"","x":588.9999694824219,"y":1018.9998550415039,"z":"18a62ac6.9713a5","wires":[]},{"id":"1a0eab31.418c85","type":"call","name":"call GENERIC-RESOURCE-API:get-tunnelxconn-ar","xml":"<call module='GENERIC-RESOURCE-API' rpc='get-tunnelxconn-ar' mode='sync' >\n","comments":"","outputs":1,"x":549.0000152587891,"y":1067.333191871643,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"33f5a5f1.69bb3a","type":"set","name":"set brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-lan-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-lan-ip' value='`$tmp.tunnelxconn-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.vgmux-lan-ip`' />\n","comments":"","x":627.3332672119141,"y":1120.6665697097778,"z":"18a62ac6.9713a5","wires":[]},{"id":"6155dc8a.47b934","type":"comment","name":"Change to POST and just update service?","info":"","comments":"","x":742.357177734375,"y":2545.9287109375,"z":"18a62ac6.9713a5","wires":[]},{"id":"4671c454.83b62c","type":"execute","name":"execute RestApiCallNode - setup vG to vgMux vxlan tunnel port","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.vpp.vxlan-tunnel.templatefile`\" />\n    <parameter name='restapiUrl' value='`$tmp.honeycomb.url + $tmp.vpp-honeycomb-url`' />\n    <parameter name='restapiUser' value='`$prop.honeycomb.user`' />\n    <parameter name='restapiPassword' value='`$prop.honeycomb.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"honeycomb-vnf\" />\n\n","comments":"","outputs":1,"x":743.166748046875,"y":2036.166748046875,"z":"18a62ac6.9713a5","wires":[["c3e30f3c.69b62","aacf95a1.7f29b8","973c7491.1e4558"]]},{"id":"c3e30f3c.69b62","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1082.141513824463,"y":2075.49837436527,"z":"18a62ac6.9713a5","wires":[["6db5d0f7.79722"]]},{"id":"aacf95a1.7f29b8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1073.1415634155273,"y":2043.9984001144767,"z":"18a62ac6.9713a5","wires":[["6db5d0f7.79722"]]},{"id":"973c7491.1e4558","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1076.8916015625,"y":2014.355504989624,"z":"18a62ac6.9713a5","wires":[["cad549e0.47c898"]]},{"id":"6db5d0f7.79722","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error setting up vxlan tunnel\" />\n","comments":"","x":1242.8916015625,"y":2044.7484239563346,"z":"18a62ac6.9713a5","wires":[]},{"id":"cad549e0.47c898","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1218.5475692749023,"y":2010.5476741790771,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"962bcf79.cf631","type":"execute","name":"execute RestApiCallNode - setup BRG vxlan bridge domain","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.vpp.bridge-domain.templatefile`\" />\n    <parameter name='restapiUrl' value=\"`$tmp.honeycomb.url + $tmp.vpp-honeycomb-url + '/v3po:l2' `\" />\n    <parameter name='restapiUser' value='`$prop.honeycomb.user`' />\n    <parameter name='restapiPassword' value='`$prop.honeycomb.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"honeycomb-vnf\" />\n\n","comments":"","outputs":1,"x":728.1668548583984,"y":2122.8336877822876,"z":"18a62ac6.9713a5","wires":[["f4596489.8437f8","6b5435d6.b9011c","390b5095.8468b"]]},{"id":"f4596489.8437f8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1072.808193206787,"y":2203.4984325394034,"z":"18a62ac6.9713a5","wires":[["156eac4b.350654"]]},{"id":"6b5435d6.b9011c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1063.8082427978516,"y":2171.99845828861,"z":"18a62ac6.9713a5","wires":[["156eac4b.350654"]]},{"id":"390b5095.8468b","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1067.5582809448242,"y":2142.3555631637573,"z":"18a62ac6.9713a5","wires":[["8c514a9b.da33e8"]]},{"id":"156eac4b.350654","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error setting up bridge domain\" />\n","comments":"","x":1233.5582809448242,"y":2172.748482130468,"z":"18a62ac6.9713a5","wires":[]},{"id":"8c514a9b.da33e8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1209.2142486572266,"y":2138.5477323532104,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"f6439501.9c66a8","type":"set","name":"set vG to vgMUX VXLAN Tunnel Port Props","xml":"<set>\n<parameter name='tmp.tunnel-name' value=\"`'vxlanTun' + $brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-bearer-ip` \" />\n<parameter name='tmp.tunnel-dest-ip' value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-bearer-ip` \" />\n<parameter name='tmp.tunnel-src-ip' value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-ip` \" />\n<parameter name='tmp.tunnel-vni' value=\"`$brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.vni` \" />","comments":"","x":532.9445724487305,"y":1918.1669521331787,"z":"18a62ac6.9713a5","wires":[]},{"id":"52c535ca.3b7a7c","type":"execute","name":"generate full vg-vpp-honeycomb url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.vpp-honeycomb`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vpp-honeycomb-url\"/>\n    <parameter name=\"target\" value=\"{tunnel-name}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.tunnel-name`\"/>\n","comments":"","outputs":1,"x":512.611213684082,"y":1973.1667308807373,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"d19c10c6.e1717","type":"execute","name":"generate honeycomb-url to vG","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.honeycomb.url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.honeycomb.url\"/>\n    <parameter name=\"target\" value=\"{honeycomb-instance-ip}\"/>\n    <parameter name=\"replacement\" value=\"`$brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-mgmt-ip`\"/>\n","comments":"","outputs":1,"x":491.9446029663086,"y":1858.4999265670776,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"3aa67c55.65a524","type":"set","name":"set brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-ip' value='`$tmp.tunnelxconn-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.vg-ip`' />\n","comments":"","x":604.0000457763672,"y":1570.666633605957,"z":"18a62ac6.9713a5","wires":[]},{"id":"d1f5d2dc.8c8b6","type":"set","name":"set brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-bearer-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vgmux-bearer-ip' value='`$tmp.tunnelxconn-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.vgmux-bearer-ip`' />\n","comments":"","x":642.3333435058594,"y":1620.6665630340576,"z":"18a62ac6.9713a5","wires":[]},{"id":"c542adc.b942a5","type":"comment","name":"Setup VXLAN Tunnel - vG to vgMUX","info":"","comments":"","x":189,"y":1573.999852180481,"z":"18a62ac6.9713a5","wires":[]},{"id":"6f57d567.30fbfc","type":"comment","name":"Setup VXLAN Tunnel - vBRG to vgMUX","info":"","comments":"","x":191.1666717529297,"y":924.0001373291016,"z":"18a62ac6.9713a5","wires":[]},{"id":"b4aea72.b49c158","type":"comment","name":"Get vg-mgmt-ip","info":"brg tunnelxconnn consuming-service-instance-id\nfound in services as service-instance-id","comments":"","x":187.00001525878906,"y":1768.333607673645,"z":"18a62ac6.9713a5","wires":[]},{"id":"9aa4c9fa.958f98","type":"set","name":"set tmp.search.consuming-service-instance-id to find vg-mgmt-ip","xml":"<set>\n<parameter name='tmp.search.consuming-service-instance-id' value='`$brg-ar.allotted-resource-data.brg-topology.allotted-resource-identifiers.consuming-service-instance-id`' />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","comments":"","x":590.1666030883789,"y":1692.3329668045044,"z":"18a62ac6.9713a5","wires":[]},{"id":"123998f5.c51be7","type":"for","name":"for tmp.preloadvnfdata","xml":"<for index='vnfidx' start='0' end='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list_length`' >\n                               \n\n\n","comments":"","outputs":1,"x":1449.333251953125,"y":1686.9998779296875,"z":"18a62ac6.9713a5","wires":[["8715f7ad.f83878"]]},{"id":"33d4cc93.eac684","type":"get-resource","name":"get-resource generic-resource-api:services ","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='GENERIC-RESOURCE-API' key='services' pfx='tmp.servicedata' >\n","comments":"","outputs":1,"x":526.6667175292969,"y":1754.6663818359375,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"4cf7f570.7cc58c","type":"switchNode","name":"switch parent-service-instance-id matches","xml":"<switch test='`$tmp.preloadvnfdata.vnfs.vnf[$vnfidx].service-instance-id == $tmp.search.consuming-service-instance-id`'>\n\n\n","comments":"","outputs":1,"x":1678,"y":2034.6666259765625,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"fc727137.9eaa","type":"success","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1904.9999923706055,"y":1745.3332052230835,"z":"18a62ac6.9713a5","wires":[["8a518589.666998"]]},{"id":"9deb72d.caf209","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1124.3332977294922,"y":1671.6664695739746,"z":"18a62ac6.9713a5","wires":[["e273cfe4.5b48e8"]]},{"id":"ba3b2049.c4386","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1102.6666564941406,"y":1738.3331623077393,"z":"18a62ac6.9713a5","wires":[["c97e5262.51d26"]]},{"id":"385890ca.3fc72","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1093.666706085205,"y":1706.8331880569458,"z":"18a62ac6.9713a5","wires":[["c97e5262.51d26"]]},{"id":"c97e5262.51d26","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error getting GENERIC-RESOURCE-API:services\" />\n","comments":"","x":1263.4167442321777,"y":1707.5832118988037,"z":"18a62ac6.9713a5","wires":[]},{"id":"5218fc4a.0b9fe4","type":"switchNode","name":"switch vnf-parameter-name matches vgw_private_ip","xml":"<switch test=\"`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters[$paramidx].vnf-parameter-name == 'vgw_private_ip_1'`\" >\n\n\n","comments":"","outputs":1,"x":2393.3331451416016,"y":1638.3332786560059,"z":"18a62ac6.9713a5","wires":[["5266f859.ebeaf8"]]},{"id":"5266f859.ebeaf8","type":"success","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2672.333251953125,"y":1650,"z":"18a62ac6.9713a5","wires":[["538ce914.9ab908"]]},{"id":"8a518589.666998","type":"for","name":"for service vnfs vf-modules parameters","xml":"<for index='paramidx' start='0' end='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters_length`' >\n\n\n","comments":"","outputs":1,"x":2169.333251953125,"y":1728.66650390625,"z":"18a62ac6.9713a5","wires":[["5218fc4a.0b9fe4"]]},{"id":"538ce914.9ab908","type":"set","name":"set vg-mgmt-ip","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.vg-mgmt-ip'\n value=\"`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters[$paramidx].vnf-parameter-value`\" />\n\n","comments":"","x":2821.999755859375,"y":1688.6666259765625,"z":"18a62ac6.9713a5","wires":[]},{"id":"f30cbbcf.ee6ed8","type":"execute","name":"execute print context","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/brg-topo-op-activate.log' />\n","comments":"","outputs":1,"x":469,"y":2577,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"8715f7ad.f83878","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1462,"y":1800,"z":"18a62ac6.9713a5","wires":[["7a100e73.8d8e8"]]},{"id":"2006cbdb.ce9484","type":"set","name":"set debug","xml":"<set>\n<parameter name='tmp.debug.service-instance-id' value='`$tmp.servicedata.services.service[$serviceidx].service-instance-id`' />\n<parameter name='tmp.debug.consuming-service-instance-id' value='`$tmp.search.consuming-service-instance-id`' />\n\n\n\n","comments":"","x":1613,"y":1875,"z":"18a62ac6.9713a5","wires":[]},{"id":"1f725a28.ed9056","type":"execute","name":"execute print context","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/brg-topo-op-activate.log' />\n","comments":"","outputs":1,"x":1442,"y":1619,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"49c119e6.4c4ad8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":1445,"y":1512,"z":"18a62ac6.9713a5","wires":[]},{"id":"e273cfe4.5b48e8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1240,"y":1624,"z":"18a62ac6.9713a5","wires":[["123998f5.c51be7","1f725a28.ed9056","bde6b16b.6406"]]},{"id":"a0c021e1.707d58","type":"get-resource","name":"get-resource vnf-api:vnfs","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='VNF-API' key='preload-vnfs' pfx='tmp.preloadvnfdata' >\n<!--\ntmp.preloadvnfdata.preload-vnfs.vnf-preload-list[1].preload-data[0].vnf-topology-information.vnf-parameters[16].vnf-parameter-value = 10.0.101.30\n-->","comments":"","outputs":1,"x":562,"y":1802,"z":"18a62ac6.9713a5","wires":[["ba3b2049.c4386","385890ca.3fc72","9deb72d.caf209"]]},{"id":"19ca5c15.87361c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":300,"y":1803,"z":"18a62ac6.9713a5","wires":[]},{"id":"7a100e73.8d8e8","type":"switchNode","name":"switch parent-service-instance-id matches","xml":"<switch test='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].vnf-name == $tmp.brg-match-vnf-name`'>\n\n\n","comments":"","outputs":1,"x":1677,"y":1950,"z":"18a62ac6.9713a5","wires":[["fc727137.9eaa"]]},{"id":"bde6b16b.6406","type":"set","name":"set tmp.brgmatch-vnf-name","xml":"<set>\n<parameter name='tmp.brg-match-vnf-name' value=\"`'VGW2BRG-'+ $brg-ar.allotted-resource-data.allotted-resource-operation-information.brg-request-input.brg-wan-mac-address`\" />\n\n","comments":"","x":1463,"y":1575,"z":"18a62ac6.9713a5","wires":[]},{"id":"8c51381a.12e268","type":"comment","name":"Disable updates to vGW becuase of race condition","info":"vGW has to reboot to apply its config and sdnc tries to connect soon. \nBeijing will have the sleep utilities to handle this. Use heat.env parameters with vni to resolve","comments":"","x":727,"y":2077,"z":"18a62ac6.9713a5","wires":[]},{"id":"a6a20093.23fd2","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":427,"y":2044,"z":"18a62ac6.9713a5","wires":[]},{"id":"2bd2dbb4.5800fc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":421,"y":2126,"z":"18a62ac6.9713a5","wires":[]},{"id":"73a37392.67696c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":647,"y":2247,"z":"18a62ac6.9713a5","wires":[]},{"id":"4e875cc.4e618a4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":241,"y":313,"z":"18a62ac6.9713a5","wires":[]},{"id":"9aab8f92.6499e8","type":"for","name":"for tmp.vnfs","xml":"<for index='vnfidx' start='0' end='`$tmp.vnfdata.vnfs.vnf-list_length`' >\n\n\n","comments":"","outputs":1,"x":784,"y":340,"z":"18a62ac6.9713a5","wires":[["1035cc67.32f044"]]},{"id":"4b54eeb9.9b9a28","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":431.1429443359375,"y":300.1904296875,"z":"18a62ac6.9713a5","wires":[["3cf47355.04e39c","9aab8f92.6499e8"]]},{"id":"3cf47355.04e39c","type":"get-resource","name":"get-resource vnf-api vnfs","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='VNF-API' key='vnfs' pfx='tmp.vnfdata' >\n","comments":"","outputs":1,"x":863,"y":282.6666259765625,"z":"18a62ac6.9713a5","wires":[[]]},{"id":"1035cc67.32f044","type":"switchNode","name":"switch parent-service-instance-id matches","xml":"<switch test='`$tmp.vnfdata.vnfs.vnf-list[$vnfidx].service-data.service-information.service-instance-id == $tmp.ar.parent-service-instance-id`'>\n\n\n","comments":"","outputs":1,"x":1052,"y":363.33331298828125,"z":"18a62ac6.9713a5","wires":[["6541c2a7.51e764"]]},{"id":"6541c2a7.51e764","type":"success","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1350.0001220703125,"y":373.33331298828125,"z":"18a62ac6.9713a5","wires":[["380ce5f.0bb281a"]]},{"id":"380ce5f.0bb281a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1565.0001220703125,"y":383.3333435058594,"z":"18a62ac6.9713a5","wires":[["ef941af1.3f0ab8"]]},{"id":"ef941af1.3f0ab8","type":"set","name":"set  tmp.ar.brg-vnf-id","xml":"<set>\n<parameter name='tmp.ar.brg-vnf-id' \n   value='`$tmp.vnfdata.vnfs.vnf-list[$vnfidx].vnf-id`' />\n\n\n\n","comments":"","x":1793,"y":400,"z":"18a62ac6.9713a5","wires":[]},{"id":"680c1f95.266288","type":"comment","name":"Need to use parent service instance id","info":"service-instance id : {\n  \"service-status\": {\n    \"rpc-action\": \"activate\",\n    \"response-code\": \"200\",\n    \"action\": \"CreateVfModuleInstance\",\n    \"request-status\": \"synccomplete\",\n    \"rpc-name\": \"vf-module-topology-operation\",\n    \"response-timestamp\": \"2017-11-16T21:31:31.697Z\",\n    \"final-indicator\": \"Y\",\n    \"response-message\": \"\"\n  }\n}","comments":"","x":191,"y":2607,"z":"18a62ac6.9713a5","wires":[]},{"id":"d4c6d967.74fbd","type":"set","name":"set  service-instance-id ","xml":"<set>\n<parameter name='tmp.service-data.service-information.service-instance-id' value='`$brg-topology-operation-input.service-information.service-instance-id`' />\n","comments":"","x":469.5,"y":2392,"z":"18a62ac6.9713a5","wires":[]}]
