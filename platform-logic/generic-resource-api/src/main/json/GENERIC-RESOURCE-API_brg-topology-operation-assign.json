[{"id":"1a9e9fdb.f14c98","type":"dgstart","name":"DGSTART","outputs":1,"x":142,"y":73,"z":"c29cef13.e3d5d8","wires":[["1feecfbb.b6bd08"]]},{"id":"1feecfbb.b6bd08","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":238.23807907104492,"y":133.95239067077637,"z":"c29cef13.e3d5d8","wires":[["7d03abf3.8482a4"]]},{"id":"7d03abf3.8482a4","type":"method","name":"brg-topology-operation-assign","xml":"<method rpc='brg-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":284.15485763549805,"y":169.19044589996338,"z":"c29cef13.e3d5d8","wires":[["d5a51879.bee068"]]},{"id":"d5a51879.bee068","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":192.47619247436523,"y":312.5237879753113,"z":"c29cef13.e3d5d8","wires":[["7efbee27.8c249","635c64fe.15e31c","4eefe296.7bebbc","2e8ac5c1.b9bbfa","4684c0aa.3dde3"]]},{"id":"53291df6.9ddfb4","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1035.6666564941406,"y":2239.5477046966553,"z":"c29cef13.e3d5d8","wires":[]},{"id":"39990b91.9af8dc","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='tunnelxconn-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $brg-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":1072.7540550231934,"y":2118.432439804077,"z":"c29cef13.e3d5d8","wires":[]},{"id":"f567c426.8d891","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='PendingCreate' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$brg-topology-operation-input.request-information.request-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$brg-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$brg-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":1144.468376159668,"y":1535.6228160858154,"z":"c29cef13.e3d5d8","wires":[]},{"id":"635c64fe.15e31c","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:tunnelxconn-allotted-resources/tunnelxconn-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/tunnelxconn-topology/'` \" />\n\n","comments":"","x":622.7380676269531,"y":204.33331298828125,"z":"c29cef13.e3d5d8","wires":[]},{"id":"7efbee27.8c249","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$brg-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$brg-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n\n\n","comments":"","x":675.997314453125,"y":166.59259033203125,"z":"c29cef13.e3d5d8","wires":[]},{"id":"9a0daa46.107f","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":825.8148803710938,"y":352.26727294921875,"z":"c29cef13.e3d5d8","wires":[["ff1ebed0.644eb"]]},{"id":"e6d60f2.c65a0f","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.brg.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":1165.8626251220703,"y":1760.1008231639862,"z":"c29cef13.e3d5d8","wires":[["4ec8b7a6.16c2d","e4cab2c4.276ff8","a753b6df.52a578"]]},{"id":"4ec8b7a6.16c2d","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1434.5040016174316,"y":1811.4322349056602,"z":"c29cef13.e3d5d8","wires":[["25fc91ec.35c546"]]},{"id":"e4cab2c4.276ff8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1425.504051208496,"y":1779.9322606548667,"z":"c29cef13.e3d5d8","wires":[["25fc91ec.35c546"]]},{"id":"a753b6df.52a578","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1429.2540893554688,"y":1750.289365530014,"z":"c29cef13.e3d5d8","wires":[["bfac6da0.ad031"]]},{"id":"25fc91ec.35c546","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for tunnelxconn-allotted-resource\" />\n","comments":"","x":1595.2540893554688,"y":1780.6822844967246,"z":"c29cef13.e3d5d8","wires":[]},{"id":"37b45496.104104","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$brg-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$brg-ar.allotted-resource-status.rpc-action`' />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$brg-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1175.5294189453125,"y":453.05291748046875,"z":"c29cef13.e3d5d8","wires":[]},{"id":"5cd97725.c0723","type":"comment","name":"Save consumed-allotted-resources to mdsal","info":"","comments":"","x":1243.2434692382812,"y":1134.7196044921875,"z":"c29cef13.e3d5d8","wires":[]},{"id":"b12e4e28.0a5df8","type":"comment","name":"GET tunnelxconn-allotted-resource from mdsal","info":"","comments":"","x":548.8148193359375,"y":322.7672119140625,"z":"c29cef13.e3d5d8","wires":[]},{"id":"ff1ebed0.644eb","type":"returnFailure","name":"return failure - tunnelxconn already exists","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'Existing brg-allotted-resource with order status of ' + $mdsal-ar.allotted-resource-data.allotted-resource-oper-status.order-status + '.'`\" />\n","comments":"","x":1135.129150390625,"y":348.6243896484375,"z":"c29cef13.e3d5d8","wires":[]},{"id":"8c2d795e.9f5a88","type":"set","name":"set brg-ar-identifiers","xml":"<set>\n<parameter name='brg-ar-identifiers.consuming-service-instance-id' value=\"`$brg-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='brg-ar-identifiers.parent-service-instance-id' value=\"`$brg-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='brg-ar-identifiers.allotted-resource-type' value=\"`$brg-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='brg-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n","comments":"","x":1185.38623046875,"y":546.6243896484375,"z":"c29cef13.e3d5d8","wires":[]},{"id":"f6bafeac.462b98","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":1212.338623046875,"y":505.338623046875,"z":"c29cef13.e3d5d8","wires":[]},{"id":"1a0f3a2c.0a3de6","type":"set","name":"set identifiers in overall structure","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.allotted-resource-identifiers.' \nvalue=\"`$brg-ar-identifiers.`\" />\n\n\n","comments":"","x":1202.38623046875,"y":854.910400390625,"z":"c29cef13.e3d5d8","wires":[]},{"id":"3d181765.fbccf","type":"set","name":"set onap model information from input","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.brg-topology.onap-model-information.' \nvalue=\"`$brg-topology-operation-input.allotted-resource-information.onap-model-information.`\" />\n\n\n","comments":"","x":1230.957763671875,"y":589.9100952148438,"z":"c29cef13.e3d5d8","wires":[]},{"id":"d2df734a.c38c08","type":"switchNode","name":"switch model-invariant-uuid is null","xml":"<switch test='$brg-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid'>\n","comments":"","outputs":1,"x":1210.8148193359375,"y":629.19580078125,"z":"c29cef13.e3d5d8","wires":[["da6db434.ac4448"]]},{"id":"da6db434.ac4448","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1438.9576988220215,"y":630.6243271827698,"z":"c29cef13.e3d5d8","wires":[["eb8c65a7.0d7d38"]]},{"id":"eb8c65a7.0d7d38","type":"set","name":"set model-invariant-uuid","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.onap-model-information.model-invariant-uuid' \nvalue=\"`$ar-model.invariant-uuid`\" />\n\n\n","comments":"","x":1640.38627243042,"y":630.0528798103333,"z":"c29cef13.e3d5d8","wires":[]},{"id":"bff5d451.212c3","type":"switchNode","name":"switch model-uuid is null","xml":"<switch test='$brg-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid'>\n","comments":"","outputs":1,"x":1183.2434158325195,"y":663.4815106391907,"z":"c29cef13.e3d5d8","wires":[["3c5106bf.1bfc5a"]]},{"id":"3c5106bf.1bfc5a","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1384.6719818115234,"y":664.0529322624207,"z":"c29cef13.e3d5d8","wires":[["25cec0f1.eb3838"]]},{"id":"25cec0f1.eb3838","type":"set","name":"set model-uuid","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.onap-model-information.model-uuid' \nvalue=\"`$ar-model.uuid`\" />\n\n\n","comments":"","x":1577.529140472412,"y":664.0528540611267,"z":"c29cef13.e3d5d8","wires":[]},{"id":"a9cd943.ce163e8","type":"switchNode","name":"switch model-version is null","xml":"<switch test='$brg-topology-operation-input.allotted-resource-information.onap-model-information.model-version'>\n","comments":"","outputs":1,"x":1191.8148193359375,"y":696.3386378288269,"z":"c29cef13.e3d5d8","wires":[["1543121f.333836"]]},{"id":"1543121f.333836","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1441.8148002624512,"y":696.3386225700378,"z":"c29cef13.e3d5d8","wires":[["3d10d727.63e288"]]},{"id":"3d10d727.63e288","type":"set","name":"set model-version","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-version' \nvalue=\"`$ar-model.version`\" />\n\n\n","comments":"","x":1634.6719589233398,"y":696.3385443687439,"z":"c29cef13.e3d5d8","wires":[]},{"id":"bb4550d6.319aa8","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.ecomp-generated-naming`'>\n","comments":"","outputs":1,"x":1255.38623046875,"y":798.7672729492188,"z":"c29cef13.e3d5d8","wires":[["cade400.4162ac","545a814a.c84b6"]]},{"id":"cade400.4162ac","type":"other","name":"outcome Y","xml":"<outcome value='Y'>\n","comments":"","outputs":1,"x":1541.3862915039062,"y":798.1958618164062,"z":"c29cef13.e3d5d8","wires":[["bb122ced.1a0cd"]]},{"id":"bb122ced.1a0cd","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">\n","atomic":"true","comments":"","outputs":1,"x":1695.1363525390625,"y":800.69580078125,"z":"c29cef13.e3d5d8","wires":[["d8196485.7c217"]]},{"id":"545a814a.c84b6","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1560.608642578125,"y":887.1958618164062,"z":"c29cef13.e3d5d8","wires":[["46c2ee0d.c84ff8"]]},{"id":"46c2ee0d.c84ff8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in allotted-resource-model data.  Ecomp-generated-naming should be true\" />\n\n","comments":"","x":1743.608642578125,"y":892.1958618164062,"z":"c29cef13.e3d5d8","wires":[]},{"id":"d8196485.7c217","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.naming-policy`'>\n","comments":"","outputs":1,"x":1831.38623046875,"y":849.767333984375,"z":"c29cef13.e3d5d8","wires":[["bb4e2b9c.4086d8","2356c985.0b0286"]]},{"id":"bb4e2b9c.4086d8","type":"other","name":"outcome oam_network_policy","xml":"<outcome value='oam_network_policy'>\n","comments":"","outputs":1,"x":2206.244140625,"y":853.3453369140625,"z":"c29cef13.e3d5d8","wires":[["3046bafa.3c2d3e"]]},{"id":"2356c985.0b0286","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2120.671875,"y":930.1958618164062,"z":"c29cef13.e3d5d8","wires":[["3046bafa.3c2d3e"]]},{"id":"22c35190.15250e","type":"set","name":"set ar_name","xml":"<set>\n<parameter name='tmp.ar-name' value='$TenantOAMNetworkRole_$LandingNetworkRole_SZ' />\n","comments":"","x":2512.100830078125,"y":888.7672729492188,"z":"c29cef13.e3d5d8","wires":[]},{"id":"c47ddc23.426f8","type":"execute","name":"execute SliStringUtils - replace TenantOAMNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$TenantOAMNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.untrusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2656.2437858581543,"y":932.6244196891785,"z":"c29cef13.e3d5d8","wires":[[]]},{"id":"5a14842f.e92664","type":"execute","name":"execute SliStringUtils - replace LandingNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$LandingNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.trusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2643.243896484375,"y":972.7672729492188,"z":"c29cef13.e3d5d8","wires":[[]]},{"id":"3046bafa.3c2d3e","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":2320.5292015075684,"y":928.3387522697449,"z":"c29cef13.e3d5d8","wires":[["22c35190.15250e","c47ddc23.426f8","5a14842f.e92664","cd147cf7.76b88"]]},{"id":"cd147cf7.76b88","type":"set","name":"set identifiers.allotted-resource-name","xml":"<set>\n<parameter name='brg-ar-identifiers.allotted-resource-name' value='`$tmp.ar-name`' />\n","comments":"","x":2601.1005859375,"y":1023.052978515625,"z":"c29cef13.e3d5d8","wires":[]},{"id":"1fcaf821.382a2","type":"set","name":"set assignments in overall structure","xml":"<set>\n<parameter name='brg-ar.allotted-resource-data.brg-topology.brg-assignments.' \nvalue=\"`$brg-ar-assignments.`\" />\n\n\n","comments":"","x":1210.8624572753906,"y":1059.6246919631958,"z":"c29cef13.e3d5d8","wires":[]},{"id":"60d9bd3e.6cd364","type":"set","name":"Handle brg-ar-assignments","xml":"<set>\n<parameter name='brg-ar-assignments.vbrg-wan-ip' value='`$brg-topology-operation-input.brg-request-input.brg-wan-ip-address`'/>\n","comments":"","x":1190.529052734375,"y":956.0530395507812,"z":"c29cef13.e3d5d8","wires":[]},{"id":"30d3c1ee.7fc976","type":"for","name":"for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]","xml":"<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n","comments":"","outputs":1,"x":2228.8155822753906,"y":1333.0411586761475,"z":"c29cef13.e3d5d8","wires":[["f53d6c15.b050f"]]},{"id":"2f884a7a.6e8196","type":"switchNode","name":"switch service-data.consumed-allotted-resources_length","xml":"<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1259.8148193359375,"y":1220.505126953125,"z":"c29cef13.e3d5d8","wires":[["89048b56.100478","1b67b275.9169de"]]},{"id":"89048b56.100478","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1635.2077865600586,"y":1225.1124458312988,"z":"c29cef13.e3d5d8","wires":[["a53bed24.5d56e"]]},{"id":"1b67b275.9169de","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1633.9577865600586,"y":1315.1124477386475,"z":"c29cef13.e3d5d8","wires":[["56be06c6.c6dfa"]]},{"id":"f53d6c15.b050f","type":"switchNode","name":"switch allotted-resource-id","xml":"<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n","comments":"","outputs":1,"x":2663.4106826782227,"y":1334.85085105896,"z":"c29cef13.e3d5d8","wires":[["a09d88e1.dd4188"]]},{"id":"a09d88e1.dd4188","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2870.220375061035,"y":1338.064962387085,"z":"c29cef13.e3d5d8","wires":[["5b40e24d.eda55c"]]},{"id":"56be06c6.c6dfa","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1791.834976196289,"y":1321.4885501861572,"z":"c29cef13.e3d5d8","wires":[["30d3c1ee.7fc976","115a39a6.10a9ae"]]},{"id":"5b40e24d.eda55c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3038.4817276000977,"y":1342.9222631454468,"z":"c29cef13.e3d5d8","wires":[["a500a6c4.dec128","cc977440.a0001"]]},{"id":"a53bed24.5d56e","type":"set","name":"set cidx","xml":"<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n","comments":"","x":1814.0647735595703,"y":1227.3266830444336,"z":"c29cef13.e3d5d8","wires":[]},{"id":"a500a6c4.dec128","type":"set","name":"set tmp.cidx and ctx.consumed-ar","xml":"<set>\n<parameter name='tmp.cidx' value='`$cidx`' />\n<parameter name='ctx.consumed-ar.' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].`' />\n<parameter name='tmp.found-cidx' value='true' />","comments":"","x":3284.3391876220703,"y":1337.4937419891357,"z":"c29cef13.e3d5d8","wires":[]},{"id":"4d4fdc3f.aa162c","type":"set","name":"set consumed allotted resources","xml":"<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$brg-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n","comments":"","x":1170.6720123291016,"y":1385.826681137085,"z":"c29cef13.e3d5d8","wires":[]},{"id":"bfac6da0.ad031","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1570.910057067871,"y":1746.4815347194672,"z":"c29cef13.e3d5d8","wires":[["c4384e16.f7f12"]]},{"id":"a6c52c98.1144c","type":"comment","name":"Add BRG AR to mdsal","info":"","comments":"","x":1095.148208618164,"y":1721.1957080364227,"z":"c29cef13.e3d5d8","wires":[]},{"id":"db326488.0fad18","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":1111.4814224243164,"y":1459.671986579895,"z":"c29cef13.e3d5d8","wires":[[]]},{"id":"b09b29f3.055d78","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":831.57666015625,"y":403.4814453125,"z":"c29cef13.e3d5d8","wires":[["6e964e83.04343"]]},{"id":"6e964e83.04343","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":779.57666015625,"y":899.2908325195312,"z":"c29cef13.e3d5d8","wires":[["e4f03c25.262bc8","8c2d795e.9f5a88","3d181765.fbccf","d2df734a.c38c08","bff5d451.212c3","a9cd943.ce163e8","37b45496.104104","bb4550d6.319aa8","1a0f3a2c.0a3de6","60d9bd3e.6cd364","1fcaf821.382a2","2f884a7a.6e8196","4d4fdc3f.aa162c","db326488.0fad18","f567c426.8d891","3991bc2a.dbb1ac","e6d60f2.c65a0f","39990b91.9af8dc","53291df6.9ddfb4"]]},{"id":"e4f03c25.262bc8","type":"set","name":"set id","xml":"<set>\n<parameter name='brg-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='brg-ar.allotted-resource-status.action' value=\"`$brg-topology-operation-input.request-information.request-action` \" />\n<parameter name='brg-ar.allotted-resource-status.rpc-name' value=\"brg-topology-operation\" />\n<parameter name='brg-ar.allotted-resource-status.rpc-action' value=\"`$brg-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$brg-topology-operation-input.request-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$brg-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$brg-topology-operation-input.service-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$brg-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='brg-ar.allotted-resource-data.allotted-resource-operation-information.tunnelxconn-request-input.' value=\"`$brg-topology-operation-input.brg-request-input.` \" />","comments":"","x":1150.2434387207031,"y":409.433837890625,"z":"c29cef13.e3d5d8","wires":[]},{"id":"3991bc2a.dbb1ac","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $service-data.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $service-data.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $service-data.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"description\" value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$ar-model.invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$ar-model.uuid`\" />\n\t<parameter name=\"operational-status\" value=\"null\" />\n","comments":"","outputs":1,"x":1132.0529327392578,"y":1627.5767517089844,"z":"c29cef13.e3d5d8","wires":[["1f98a234.aa314e","69037bb6.41c44c"]]},{"id":"1f98a234.aa314e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1387.814842224121,"y":1610.5292553901672,"z":"c29cef13.e3d5d8","wires":[["aa261c9b.918ae8"]]},{"id":"aa261c9b.918ae8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":1554.338722229004,"y":1622.1483263969421,"z":"c29cef13.e3d5d8","wires":[]},{"id":"69037bb6.41c44c","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1394.9101295471191,"y":1643.2912230491638,"z":"c29cef13.e3d5d8","wires":[["aa261c9b.918ae8"]]},{"id":"115a39a6.10a9ae","type":"switchNode","name":"switch tmp.found-cidx","xml":"<switch test='`$tmp.found-cidx`'>\n","comments":"","outputs":1,"x":2043.743423461914,"y":1579.2315921783447,"z":"c29cef13.e3d5d8","wires":[["6457c8b0.7c96f8"]]},{"id":"6457c8b0.7c96f8","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2233.743377685547,"y":1579.2315292358398,"z":"c29cef13.e3d5d8","wires":[["a4cf2172.8fb0a8"]]},{"id":"a4cf2172.8fb0a8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2399.743377685547,"y":1579.2315292358398,"z":"c29cef13.e3d5d8","wires":[["deb41530.608d4"]]},{"id":"deb41530.608d4","type":"set","name":"set tmp.cidx ","xml":"<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n","comments":"","x":2645.600706100464,"y":1579.8030033111572,"z":"c29cef13.e3d5d8","wires":[]},{"id":"cc977440.a0001","type":"break","name":"break","xml":"<break>\n","comments":"","x":3203.243408203125,"y":1382.731689453125,"z":"c29cef13.e3d5d8","wires":[]},{"id":"c4384e16.f7f12","type":"execute","name":"execute RestApiCallNode - Update parent provided service AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='DELETE' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n","comments":"","outputs":1,"x":1921.9521980285645,"y":1746.1904199123383,"z":"c29cef13.e3d5d8","wires":[["50cfb05d.e0eac","9f2cf4be.9ad798","4e3a88c6.282ed"]]},{"id":"182bfccb.4d5023","type":"comment","name":"Rollback parent","info":"","comments":"","x":1765.9521255493164,"y":1715.8570504188538,"z":"c29cef13.e3d5d8","wires":[]},{"id":"50cfb05d.e0eac","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2293.2602462768555,"y":1806.8553862571716,"z":"c29cef13.e3d5d8","wires":[["a36dd9.bb2b1228"]]},{"id":"9f2cf4be.9ad798","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2284.26029586792,"y":1775.3554120063782,"z":"c29cef13.e3d5d8","wires":[["a36dd9.bb2b1228"]]},{"id":"4e3a88c6.282ed","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2288.0103340148926,"y":1745.7125168815255,"z":"c29cef13.e3d5d8","wires":[["a36dd9.bb2b1228"]]},{"id":"a36dd9.bb2b1228","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2429.666301727295,"y":1741.9046860709786,"z":"c29cef13.e3d5d8","wires":[[]]},{"id":"14caf14a.dde917","type":"comment","name":"Generate naming","info":"","comments":"","x":1186.3862762451172,"y":756.7672252655029,"z":"c29cef13.e3d5d8","wires":[]},{"id":"4eefe296.7bebbc","type":"get-resource","name":"get-resource tunnelxconn-allotted-resource","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='GENERIC-RESOURCE-API' key='brg-allotted-resources/brg-allotted-resource/$brg-topology-operation-input.alloted-resource-information.allotted-resource-id' pfx='mdsal-ar' >\n","comments":"","outputs":1,"x":531,"y":357,"z":"c29cef13.e3d5d8","wires":[["9a0daa46.107f","b09b29f3.055d78"]]},{"id":"2e8ac5c1.b9bbfa","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":607,"y":246,"z":"c29cef13.e3d5d8","wires":[[]]},{"id":"4684c0aa.3dde3","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.brg-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":614,"y":286,"z":"c29cef13.e3d5d8","wires":[[]]}]