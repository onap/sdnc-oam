[{"id":"ff331a1b.1c488","type":"dgstart","name":"DGSTART","outputs":1,"x":171,"y":61,"z":"a2d41f5.f696b6","wires":[["b1e4068e.a8248"]]},{"id":"b1e4068e.a8248","type":"service-logic","name":"GENERIC-RESOURCE-API 1.2.0-SNAPSHOT-INT110901","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='1.2.0-SNAPSHOT-INT110901'>","outputs":1,"x":267.2380790710449,"y":121.95239067077637,"z":"a2d41f5.f696b6","wires":[["446ed2d0.62eac4"]]},{"id":"446ed2d0.62eac4","type":"method","name":"gw-vfmodule","xml":"<method rpc='gw-vfmodule-update' mode='sync'>\n","comments":"","outputs":1,"x":151.15488815307617,"y":215.19043064117432,"z":"a2d41f5.f696b6","wires":[["472b6b38.991c9c"]]},{"id":"472b6b38.991c9c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":267.9999809265137,"y":315.0000009536743,"z":"a2d41f5.f696b6","wires":[["37136d7b.9d869a","ef5050d6.256b6","eb0397a.74a27e8","d4b6b0db.1e149"]]},{"id":"8b408e80.6fa7a8","type":"execute","name":"generate vnf service-info url - vnf-d","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.vnf-api-url1`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vnf-api-url2\"/>\n    <parameter name=\"target\" value=\"{vnf-id}\"/>\n    <parameter name=\"replacement\" value=\"`$brg-topology-operation-input.allotted-resource-data.brg-topology.brg-assignments.gw-vnf-id`\"/>\n\n","comments":"","outputs":1,"x":1614.7499389648438,"y":1510.0000762939453,"z":"a2d41f5.f696b6","wires":[[]]},{"id":"af678515.3b6dc8","type":"execute","name":"execute RestApiCallNode - PUT service into service","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.services.vnf.vfmodule.templatefile`\" />\n   <!--\n   <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.vnf-api-url3`' />\n   -->\n   <parameter name='restapiUrl' value='`$tmp.vf-module-object-path`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-vfmodule-vgw\" />\n\n","comments":"","outputs":1,"x":1662.75,"y":1786.0001831054688,"z":"a2d41f5.f696b6","wires":[["91040b39.f22c2"]]},{"id":"61bfb216.427e1c","type":"execute","name":"generate vnf service-info url - service-instance-id","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.service.vnf.vfmodule-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vnf-api-url1\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.service-data.service-information.service-instance-id`\"/>\n","comments":"","outputs":1,"x":1660.2499389648438,"y":1467.2500762939453,"z":"a2d41f5.f696b6","wires":[[]]},{"id":"e0830250.c2c27","type":"execute","name":"generate vnf service-info url - vf-module-id","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.vnf-api-url2`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.vnf-api-url3\"/>\n    <parameter name=\"target\" value=\"{vf-module-id}\"/>\n    <parameter name=\"replacement\" value=\"`$brg-topology-operation-input.allotted-resource-data.brg-topology.brg-assignments.gw-vfmodule-id`\"/>\n\n","comments":"","outputs":1,"x":1638.9999389648438,"y":1551.0000762939453,"z":"a2d41f5.f696b6","wires":[[]]},{"id":"30dc1fcc.9a851","type":"set","name":"set tmp.vgw.vg_mux_tunnel.vni","xml":"<set>\n<!--\n<parameter name='tmp.service.vnf.vf-module.vg-mux-tunnel-vni' value='`$input.vni`' />\n-->\n<parameter name='tmp.service.vnf.vf-module.vg-mux-tunnel-vni' value='`$tmp.txconns.tunnelxconn-allotted-resources.tunnelxconn-allotted-resource[0].allotted-resource-data[0].tunnelxconn-topology[0].tunnelxconn-assignments[0].vni`' />\n\n\n\n","comments":"","x":1602.7499389648438,"y":1602.2500762939453,"z":"a2d41f5.f696b6","wires":[]},{"id":"669eab32.da6dc4","type":"set","name":"set tmp.service.vnf.vf-module-id","xml":"<set>\n<parameter name='tmp.service.vnf.vf-module.vf-module-id' value='9aa4ede4-c639-48c4-9386-74c9ff87f8e3' />\n<parameter name='brg-topology-operation-input.allotted-resource-data.brg-topology.brg-assignments.gw-vfmodule-id' value='9aa4ede4-c639-48c4-9386-74c9ff87f8e3' />","comments":"","x":1591.5,"y":1281.8333435058594,"z":"a2d41f5.f696b6","wires":[]},{"id":"13501960.e241ff","type":"set","name":"set tmp.service-data.vnf-information.vnf-id","xml":"<set>\n<parameter name='tmp.service-data.vnf-information.vnf-id' value='3a3332d1-12ad-4709-ac81-ba32b304a462' />\n<parameter name='brg-topology-operation-input.allotted-resource-data.brg-topology.brg-assignments.gw-vnf-id' value='3a3332d1-12ad-4709-ac81-ba32b304a462' />\n","comments":"","x":1622.75,"y":1235.5834045410156,"z":"a2d41f5.f696b6","wires":[]},{"id":"447eb1b6.b6fa5","type":"set","name":"set tmp.service-data.service-information.service-instance-id","xml":"<set>\n<parameter name='tmp.service-data.service-information.service-instance-id' value='6e34b9fb-9ec1-4c95-9e12-0326c434c623' />\n","comments":"","x":1657.7499084472656,"y":1183.0833129882812,"z":"a2d41f5.f696b6","wires":[]},{"id":"5f6db3a1.3f84a4","type":"set","name":"set tmp.service.vnf.vf-module-id","xml":"<set>\n<parameter name='tmp.restapi.service.vnf.vfmodule-resource' value='`$prop.restapi.service.vnf.vfmodule-resource`' />\n","comments":"","x":1587.75,"y":1321.8333435058594,"z":"a2d41f5.f696b6","wires":[]},{"id":"3f9b4d45.aeea12","type":"execute","name":"execute Propertis gen-res-api-dg","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":1583.9999084472656,"y":1103.0833282470703,"z":"a2d41f5.f696b6","wires":[[]]},{"id":"91040b39.f22c2","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1944,"y":1837.2501831054688,"z":"a2d41f5.f696b6","wires":[["72a0c285.aded84"]]},{"id":"72a0c285.aded84","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='Failed on PUT vf-module parameters to MD0SAL' />\n","comments":"","x":2134,"y":1846.0001831054688,"z":"a2d41f5.f696b6","wires":[]},{"id":"37136d7b.9d869a","type":"set","name":"set VGW2BRG-fa:16:3e:8f:ea:68 & consuming service-instance","xml":"<set>\n<parameter name='tmp.brg-macaddress' value='fa:16:3e:8f:ea:68' />\n<parameter name='tmp.brg-mac-address-match' value='VGW2BRG-fa:16:3e:8f:ea:68'/>\n<!--\n<parameter name='tmp.consuming-service-instance-id' value='b3cb7040-f7a5-4beb-ad2f-2a893b7d374b' />\nservice-data.service-topology.service-topology-identifier.service-instance-id\n\n-->\n<parameter name='tmp.consuming-service-instance-id' value='`$service-data.service-topology.service-topology-identifier.service-instance-id`' />\n","comments":"","x":640.0000610351562,"y":312.08343505859375,"z":"a2d41f5.f696b6","wires":[]},{"id":"a257a1ad.5c67c8","type":"get-resource","name":"get-resource vnfs","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='VNF-API' key='preload-vnfs' pfx='tmp.preloadvnfdata' >\n","comments":"","outputs":1,"x":804.3055419921875,"y":658.7499694824219,"z":"a2d41f5.f696b6","wires":[[]]},{"id":"2d739416.c7e85c","type":"for","name":"for tmp.vnfs","xml":"<for index='vnfidx' start='0' end='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list_length`' >\n\n\n","comments":"","outputs":1,"x":798.1944580078125,"y":760.9723510742188,"z":"a2d41f5.f696b6","wires":[["1a3e1a43.0a466e"]]},{"id":"612e9f6e.18b6e","type":"switchNode","name":"switch parameter name","xml":"<switch test='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].vnf-name == $tmp.brg-mac-address-match`'>\n\n\n","comments":"","outputs":1,"x":1086.1942749023438,"y":776.361083984375,"z":"a2d41f5.f696b6","wires":[["e671abf7.bf0aa8"]]},{"id":"e671abf7.bf0aa8","type":"success","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1244.91650390625,"y":922.5,"z":"a2d41f5.f696b6","wires":[["fd3690b6.c3232"]]},{"id":"fd3690b6.c3232","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1160,"y":1382.5,"z":"a2d41f5.f696b6","wires":[["5d3d78fd.9d7e18","3f9b4d45.aeea12","5f6db3a1.3f84a4","30dc1fcc.9a851","44a79ac4.bca8c4","86b5a8ca.a751d8","20051d0c.51867a","bd8cc978.6b6dc8","be425f83.ac7d28"]]},{"id":"4803c2a3.bb47e4","type":"comment","name":"vnfidx ","info":"","comments":"","x":1406.2499389648438,"y":796.2500305175781,"z":"a2d41f5.f696b6","wires":[]},{"id":"5d3d78fd.9d7e18","type":"for","name":"for each vnf parameter copy to vf_module_parameter","xml":"<for index='preloadIdx' start='0' end='`$tmp.endLoop1`'>\n<!--\n\n     \"preload-data\": {\n          \"vnf-topology-information\": {\n            \"vnf-parameters\": [\n            \n            -->\n","comments":"","outputs":1,"x":1662.4999389648438,"y":991.25,"z":"a2d41f5.f696b6","wires":[["d1e7f1cd.6532f8"]]},{"id":"16294d67.941e83","type":"set","name":"set name/values","xml":"<set>\n<parameter name='tmp.vfmodule.param[$preloadIdx].name'  value='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters[$preloadIdx].vnf-parameter-name`' />\n<parameter name='tmp.vfmodule.param[$preloadIdx].value' value='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters[$preloadIdx].vnf-parameter-value`' />","comments":"","x":2125.1389770507812,"y":1093.4722595214844,"z":"a2d41f5.f696b6","wires":[]},{"id":"ef5050d6.256b6","type":"get-resource","name":"get-resource tunnelxcon-allotted-resources","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='GENERIC-RESOURCE-API'    \n         key='tunnelxconn-allotted-resources/' pfx='tmp.txconns' >\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t","comments":"","outputs":1,"x":581.3635559082031,"y":411.8182067871094,"z":"a2d41f5.f696b6","wires":[["12d5ec8f.a479d3"]]},{"id":"1178542e.cb8f2c","type":"for","name":"for tmp.xconns.tunnelxconn-allotted-resoruces.tunnelxonn-alloted-resource[]","xml":"<for index='txidx' start='0' end='`$tmp.txconns.tunnelxconn-allotted-resources.tunnelxconn-allotted-resource_length`' >\n\n\n","comments":"","outputs":1,"x":1055.4544982910156,"y":450.9090576171875,"z":"a2d41f5.f696b6","wires":[["cd424057.0ab1f"]]},{"id":"fc7b6817.1b14e8","type":"switchNode","name":"switch parameter name","xml":"<switch test='`$tmp.test1 == $tmp.consuming-service-instance-id`'>","comments":"","outputs":1,"x":1441,"y":582.7423706054688,"z":"a2d41f5.f696b6","wires":[["2cedbe9.a6657c2"]]},{"id":"2cedbe9.a6657c2","type":"success","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1609.5,"y":653.060546875,"z":"a2d41f5.f696b6","wires":[["58ede03d.79aa"]]},{"id":"58ede03d.79aa","type":"set","name":"set thisIsVGW","xml":"<set>\n<parameter name='tmp.thisIsVGW' value='true' />\n","comments":"","x":1773.8182373046875,"y":701.5454711914062,"z":"a2d41f5.f696b6","wires":[]},{"id":"eb0397a.74a27e8","type":"set","name":"set thisIsVGW false","xml":"<set>\n<parameter name='tmp.thisIsVGW' value='false' />\n","comments":"","x":501.81817626953125,"y":361.81817626953125,"z":"a2d41f5.f696b6","wires":[]},{"id":"d4b6b0db.1e149","type":"switchNode","name":"switch thsIsVGW","xml":"<switch test='`$tmp.thisIsVGW`'>\n","comments":"","outputs":1,"x":316.3636474609375,"y":486.36370849609375,"z":"a2d41f5.f696b6","wires":[["7aacca5d.2f0d54"]]},{"id":"7aacca5d.2f0d54","type":"other","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":339.09090909090907,"y":568.1818181818181,"z":"a2d41f5.f696b6","wires":[["40d2bdfb.c44124"]]},{"id":"40d2bdfb.c44124","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":520.6747436523438,"y":756.293701171875,"z":"a2d41f5.f696b6","wires":[["a257a1ad.5c67c8","2d739416.c7e85c"]]},{"id":"1a3e1a43.0a466e","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":876.666748046875,"y":811.1112060546875,"z":"a2d41f5.f696b6","wires":[["612e9f6e.18b6e","670614ea.aa072c"]]},{"id":"cd424057.0ab1f","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1210,"y":514.4444580078125,"z":"a2d41f5.f696b6","wires":[["fc7b6817.1b14e8","14eaeaa.5e2e915"]]},{"id":"d1e7f1cd.6532f8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1922.9166259765625,"y":1055.6944885253906,"z":"a2d41f5.f696b6","wires":[["16294d67.941e83"]]},{"id":"12d5ec8f.a479d3","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":666.6666666666666,"y":462.22222222222223,"z":"a2d41f5.f696b6","wires":[["1178542e.cb8f2c"]]},{"id":"14eaeaa.5e2e915","type":"set","name":"set txconns.tunnelxconn-allotted-resources.tunnelxconn-alloted-resource[$txidx].allotted-resource-data.tunnelxconn-topology.allotted-resource-identifiers.consuming-service-instance-id","xml":"<set>\n<parameter name='tmp.test1' value='`$tmp.txconns.tunnelxconn-allotted-resources.tunnelxconn-allotted-resource[$txidx].allotted-resource-data.tunnelxconn-topology.allotted-resource-identifiers.consuming-service-instance-id`' />\n<parameter name='tmp.test2' value='`$tmp.txconns.tunnelxconn-allotted-resources.tunnelxconn-allotted-resource-data[$txidx].tunnelxconn-topology[0].allotted-resource-identifiers[0].consuming-service-instance-id`' />","comments":"","x":1312,"y":153,"z":"a2d41f5.f696b6","wires":[]},{"id":"670614ea.aa072c","type":"set","name":"set test3","xml":"<set>\n<parameter name='tmp.test3' value='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].vnf-name`' />\n<parameter name='tmp.test4' value='`$tmp.brg-mac-address-match`'/>\n\n\n","comments":"","x":1038,"y":702,"z":"a2d41f5.f696b6","wires":[]},{"id":"44a79ac4.bca8c4","type":"set","name":"set length of for  endLoop1","xml":"<set>\n<parameter name='tmp.endLoop1' value='`$tmp.preloadvnfdata.preload-vnfs.vnf-preload-list[$vnfidx].preload-data.vnf-topology-information.vnf-parameters_length`' />","comments":"","x":1505,"y":910,"z":"a2d41f5.f696b6","wires":[]},{"id":"86b5a8ca.a751d8","type":"set","name":"set vf-module-object-path","xml":"<set>\n<parameter name='tmp.vf-module-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $service-data.service-topology.service-topology-identifier.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id \n + '/'`\"/>\n","comments":"","x":1512.5,"y":1382.5,"z":"a2d41f5.f696b6","wires":[]},{"id":"20051d0c.51867a","type":"set","name":"copy  vf-module-parameters","xml":"<set>\n<!--\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-parameters.param.'\n\n                 service-data.vnfs.vnf\\[0\\].       vnf-data.vf-modules.vf-module\\[0\\]             .vf-module-data.vf-module-topology.vf-module-parameters.param.\n   value='$tmp.vfmodule.' />\n-->\n<parameter name='service-data.vnfs.vnf[0].vnf-data.vf-modules.vf-module[0].vf-module-data.vf-module-topology.vf-module-parameters.'\n   value='$tmp.vfmodule.' />","comments":"","x":1548.75,"y":1684.5,"z":"a2d41f5.f696b6","wires":[]},{"id":"bd8cc978.6b6dc8","type":"execute","name":"execute print context","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bdf-gw-vfmodule.log' />\n","comments":"","outputs":1,"x":1485,"y":1740,"z":"a2d41f5.f696b6","wires":[[]]},{"id":"be425f83.ac7d28","type":"set","name":"set _length","xml":"<set>\n<parameter name='tmp.vfmodule.param_length' value='`$tmp.endLoop1`' />\n","comments":"","x":1528.7501220703125,"y":1046.25,"z":"a2d41f5.f696b6","wires":[]}]
