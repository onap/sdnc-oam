[
  {
    "id": "d0010b4e.1448a8",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 135.00390625,
    "y": 59.999999046325684,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "7fc8b438.987c3c"
      ]
    ]
  },
  {
    "id": "7fc8b438.987c3c",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 234.28960418701172,
    "y": 134.23810693901032,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "18f3c53b.5e40fb"
      ]
    ]
  },
  {
    "id": "18f3c53b.5e40fb",
    "type": "method",
    "name": "method site-vnf-topology-operation-create",
    "xml": "<method rpc='site-vnf-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 255.4325180053711,
    "y": 223.99999544303864,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "286c6526.b613ca"
      ]
    ]
  },
  {
    "id": "286c6526.b613ca",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 235.67056274414062,
    "y": 395.66666719596833,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "2a8f2c14.d43db4",
        "5fbde6da.2bd958",
        "6d87bfd7.c22d1",
        "cc1a93a5.7ab76",
        "18b24e84.30ff61",
        "a5742836.13c218",
        "671e4dac.744e44",
        "2dfa8b04.f64514",
        "c4eecb83.953aa8",
        "ee03e646.5fd808",
        "d81ebfe3.370b",
        "d3dc22e.6b5c4e",
        "4ed7986f.14fb68"
      ]
    ]
  },
  {
    "id": "5fbde6da.2bd958",
    "type": "set",
    "name": "set vnf-level-oper-status to Created",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
    "comments": "",
    "x": 663.8173141479492,
    "y": 814.6705651283264,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "2a8f2c14.d43db4",
    "type": "set",
    "name": "copy input data to service data",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
    "comments": "",
    "x": 650.6704635620117,
    "y": 712.6667809486389,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "a5742836.13c218",
    "type": "execute",
    "name": "execute generate-vnf-index",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-index\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 635.0039978027344,
    "y": 639.3334522247314,
    "z": "32a9459d.29ba0a",
    "wires": [
      []
    ]
  },
  {
    "id": "6d87bfd7.c22d1",
    "type": "set",
    "name": "set vnf-index to service data",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.vnf-id' value='`$prop.vnf-index`' />\n",
    "comments": "",
    "x": 641.0039596557617,
    "y": 768.3334069252014,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "cc1a93a5.7ab76",
    "type": "switchNode",
    "name": "switch service-data.vnfs.vnf_length",
    "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 665.0038833618164,
    "y": 274.33335876464844,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "6a52e61c.b473b8",
        "ceafd752.94f398"
      ]
    ]
  },
  {
    "id": "6a52e61c.b473b8",
    "type": "other",
    "name": "NULL",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 899.7182693481445,
    "y": 269.4761791229248,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "98d935d6.adba58"
      ]
    ]
  },
  {
    "id": "98d935d6.adba58",
    "type": "set",
    "name": "set vnf-index=0",
    "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
    "comments": "",
    "x": 1060.0039749145508,
    "y": 269.4762706756592,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "ceafd752.94f398",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 896.1468086242676,
    "y": 302.7620105743408,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "2edf4169.726dbe"
      ]
    ]
  },
  {
    "id": "f2ec0c7c.259ee",
    "type": "set",
    "name": "set vnf-index = vnf_length",
    "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
    "comments": "",
    "x": 1289.004051208496,
    "y": 281.0477361679077,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "728dfb90.8e3944",
    "type": "for",
    "name": "for each existing VNF",
    "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1277.4326705932617,
    "y": 316.0477080345154,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "f1186372.a0982"
      ]
    ]
  },
  {
    "id": "2edf4169.726dbe",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1030.8610916137695,
    "y": 304.7619800567627,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "f2ec0c7c.259ee",
        "728dfb90.8e3944"
      ]
    ]
  },
  {
    "id": "f1186372.a0982",
    "type": "switchNode",
    "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
    "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1670.718406677246,
    "y": 316.6191921234131,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "32b0d35f.e4b42c"
      ]
    ]
  },
  {
    "id": "32b0d35f.e4b42c",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1952.004108428955,
    "y": 315.1905975341797,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "c7f17107.aecae"
      ]
    ]
  },
  {
    "id": "8ccad497.cccb38",
    "type": "comment",
    "name": "make sure this vnf-id doesn't exist already",
    "info": "",
    "comments": "",
    "x": 1639.8610229492188,
    "y": 280.19058418273926,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "18b24e84.30ff61",
    "type": "set",
    "name": "set new vnf_length",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
    "comments": "",
    "x": 617.0039596557617,
    "y": 606.3334069252014,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "c4eecb83.953aa8",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 619.0039863586426,
    "y": 1037.5970339775085,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "671e4dac.744e44",
    "type": "save",
    "name": "save siteInstance configuration in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource' \n      key='site-resource.id = $prop.vnf-index' >\n<parameter name='id' value='`$prop.vnf-index`' />      \n<parameter name='name' value='`$prop.site.name`' />\n<parameter name='description' value='`$prop.site.description`' />\n<parameter name='type' value='prop.site.type' />\n<parameter name='role' value='prop.site.role' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />\n",
    "comments": "",
    "outputs": 1,
    "x": 667.6707305908203,
    "y": 909.8190650939941,
    "z": "32a9459d.29ba0a",
    "wires": [
      []
    ]
  },
  {
    "id": "2dfa8b04.f64514",
    "type": "save",
    "name": "save service relationship in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id \n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"site-resource\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/site-resources/site-resource/' + $prop.vnf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"site-resource.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-index`\" />",
    "comments": "",
    "outputs": 1,
    "x": 656.6707344055176,
    "y": 972.5969476699829,
    "z": "32a9459d.29ba0a",
    "wires": [
      []
    ]
  },
  {
    "id": "ee03e646.5fd808",
    "type": "set",
    "name": "set vnf-index and vnf-object-path",
    "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-index`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />",
    "comments": "",
    "x": 658.0039825439453,
    "y": 858.5968360900879,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "d81ebfe3.370b",
    "type": "for",
    "name": "for loop idx - VNF input parameters",
    "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 651.0039978027344,
    "y": 413.00006198883057,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "610b8a5.566b074"
      ]
    ]
  },
  {
    "id": "610b8a5.566b074",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 865.782341003418,
    "y": 410.555645942688,
    "z": "32a9459d.29ba0a",
    "wires": [
      [
        "544f33c4.6ec91c",
        "77273637.aeb898"
      ]
    ]
  },
  {
    "id": "544f33c4.6ec91c",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1062.0385437011719,
    "y": 388.30378437042236,
    "z": "32a9459d.29ba0a",
    "wires": [
      []
    ]
  },
  {
    "id": "77273637.aeb898",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1031.4829711914062,
    "y": 425.30390071868896,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "d3dc22e.6b5c4e",
    "type": "set",
    "name": "set vnf-request-input.",
    "xml": "<set>\n<parameter name='vnf-request-input.' value='`$vnf-topology-operation-input.vnf-request-input.`' />\n",
    "comments": "",
    "x": 613.0036163330078,
    "y": 487.3247766494751,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "4ed7986f.14fb68",
    "type": "call",
    "name": "call sdwan-get-site-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-site-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 629.0039825439453,
    "y": 519.3249807357788,
    "z": "32a9459d.29ba0a",
    "wires": [
      []
    ]
  },
  {
    "id": "c7f17107.aecae",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
    "comments": "",
    "x": 2080.5754776000977,
    "y": 366.19061183929443,
    "z": "32a9459d.29ba0a",
    "wires": []
  },
  {
    "id": "9be618c6.476348",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 1374.0040893554688,
    "y": 369.6666784286499,
    "z": "32a9459d.29ba0a",
    "wires": []
  }
]
