[
  {
    "id": "b9ac105c.8ec8f",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 97.01041412353516,
    "y": 47.41365957260132,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "cdfd9c31.ba898"
      ]
    ]
  },
  {
    "id": "cdfd9c31.ba898",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API 1.2.1-SNAPSHOT",
    "module": "GENERIC-RESOURCE-API",
    "version": "1.2.1-SNAPSHOT",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='1.2.1-SNAPSHOT'>",
    "outputs": 1,
    "x": 196.29611206054688,
    "y": 121.65176746528596,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "8cec72fa.c96d5"
      ]
    ]
  },
  {
    "id": "8cec72fa.c96d5",
    "type": "method",
    "name": "method site-vnf-topology-operation-create",
    "xml": "<method rpc='site-vnf-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 217.43902587890625,
    "y": 211.41365596931428,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "c88bbc51.c05a"
      ]
    ]
  },
  {
    "id": "c88bbc51.c05a",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 197.67707061767578,
    "y": 383.08032772224396,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "6bf31f55.e7d98",
        "c99fe643.20ccd8",
        "34e47add.75c586",
        "fe017e7c.6df8",
        "bb192e9e.a5c6c",
        "10180061.fe9e8",
        "bc730e3d.2a3f4",
        "fd6d952f.2ce658",
        "bb650f09.4befc",
        "c7f37fdc.75322",
        "8a7774f7.eba7c8"
      ]
    ]
  },
  {
    "id": "34e47add.75c586",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 520.3436431884766,
    "y": 741.7469849586487,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "c99fe643.20ccd8",
    "type": "set",
    "name": "set vnf-level-oper-status to Created",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
    "comments": "",
    "x": 579.8237457275391,
    "y": 568.0841431617737,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "6bf31f55.e7d98",
    "type": "set",
    "name": "copy input data to service data",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
    "comments": "",
    "x": 566.6768951416016,
    "y": 466.0803589820862,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "fe017e7c.6df8",
    "type": "execute",
    "name": "execute generate-vnf-index",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-index\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 559.0103912353516,
    "y": 404.7469849586487,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "bb192e9e.a5c6c",
    "type": "set",
    "name": "set vnf-index to service data",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.vnf-id' value='`$prop.vnf-index`' />\n",
    "comments": "",
    "x": 557.0103912353516,
    "y": 521.7469849586487,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "10180061.fe9e8",
    "type": "switchNode",
    "name": "switch service-data.vnfs.vnf_length",
    "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 581.0103912353516,
    "y": 284.7469849586487,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "da5d62eb.78235",
        "6a8033d.3310ccc"
      ]
    ]
  },
  {
    "id": "da5d62eb.78235",
    "type": "other",
    "name": "NULL",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 836.7247467041016,
    "y": 274.8898072242737,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "aa63df44.dc701"
      ]
    ]
  },
  {
    "id": "aa63df44.dc701",
    "type": "set",
    "name": "set vnf-index=0",
    "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
    "comments": "",
    "x": 1001.0104675292969,
    "y": 273.8898854255676,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "6a8033d.3310ccc",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 838.1533088684082,
    "y": 339.17562532424927,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "62e804c3.fcb0ec"
      ]
    ]
  },
  {
    "id": "fde7e6bf.6c5328",
    "type": "set",
    "name": "set vnf-index = vnf_length",
    "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
    "comments": "",
    "x": 1177.0104637145996,
    "y": 317.4613137245178,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "59c71e1.00ba4e",
    "type": "for",
    "name": "for each existing VNF",
    "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1162.4389762878418,
    "y": 363.4612526893616,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "17e77a68.a0edf6"
      ]
    ]
  },
  {
    "id": "62e804c3.fcb0ec",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 973.8675689697266,
    "y": 339.1755909919739,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "fde7e6bf.6c5328",
        "59c71e1.00ba4e"
      ]
    ]
  },
  {
    "id": "17e77a68.a0edf6",
    "type": "switchNode",
    "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
    "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1538.7247467041016,
    "y": 351.0327515602112,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "5bee4b88.02f404"
      ]
    ]
  },
  {
    "id": "5bee4b88.02f404",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1639.0103912353516,
    "y": 420.6041626930237,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "45cdc14c.e4a58"
      ]
    ]
  },
  {
    "id": "45cdc14c.e4a58",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
    "comments": "",
    "x": 1664.581802368164,
    "y": 480.6041626930237,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "22974b6a.26eb04",
    "type": "comment",
    "name": "make sure this VNF doesn't exist already",
    "info": "",
    "comments": "",
    "x": 1503.867473602295,
    "y": 320.6041626930237,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "bc730e3d.2a3f4",
    "type": "set",
    "name": "set new vnf_length",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
    "comments": "",
    "x": 533.0103912353516,
    "y": 359.7469849586487,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "fd6d952f.2ce658",
    "type": "save",
    "name": "save siteInstance configuration in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='generic-vnf' \n      key='generic-vnf.vnf-id = $prop.vnf-index' >\n<parameter name='vnf-id' value='`$prop.vnf-index`' />\n<parameter name='vnf-name' value='`$prop.site.name`' />\n<parameter name='vnf-name2' value='`$prop.site.description`' />\n<parameter name='regional-resource-zone' value='`$prop.site.location`' />\n<parameter name='vnf-type' value='prop.site.type' />\n<parameter name='in-maint' value='true' />\n<parameter name='is-closed-loop-disabled' value='false' />\n<parameter name='orchestration-status' value='Created' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />\n",
    "comments": "",
    "outputs": 1,
    "x": 588.0103797912598,
    "y": 654.9692330360413,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "bb650f09.4befc",
    "type": "save",
    "name": "save service relationship in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id \n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"generic-vnf\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/generic-vnfs/generic-vnf/' + $prop.vnf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"generic-vnf.vnf-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-index`\" />",
    "comments": "",
    "outputs": 1,
    "x": 568.0103912353516,
    "y": 692.7469849586487,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "c7f37fdc.75322",
    "type": "set",
    "name": "set vnf-index and vnf-object-path",
    "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-index`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />",
    "comments": "",
    "x": 573.5103912353516,
    "y": 609.7469849586487,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "8a7774f7.eba7c8",
    "type": "for",
    "name": "for loop i - VNF input parameters",
    "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 586.1151275634766,
    "y": 141.48147916793823,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "359fa75f.492d58"
      ]
    ]
  },
  {
    "id": "359fa75f.492d58",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 973.8933715820312,
    "y": 142.03711557388306,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "f0758e90.0e45c",
        "2de72527.9a032a",
        "378d80e2.17f6",
        "7702e686.8af7a8",
        "75b119e9.762ed8",
        "1c70f9bf.47a396"
      ]
    ]
  },
  {
    "id": "f0758e90.0e45c",
    "type": "switchNode",
    "name": "switch name",
    "xml": "<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name == 'name'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1177.1152682304382,
    "y": 88.03709030151367,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "665f8a5d.1e1384"
      ]
    ]
  },
  {
    "id": "665f8a5d.1e1384",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1364.1152682304382,
    "y": 84.03709030151367,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "303b324.5f06cce"
      ]
    ]
  },
  {
    "id": "303b324.5f06cce",
    "type": "set",
    "name": "set name",
    "xml": "<set>\n<parameter name='prop.site.name' value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1532.1152682304382,
    "y": 84.6370964050293,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "2de72527.9a032a",
    "type": "switchNode",
    "name": "switch description",
    "xml": "<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name == 'description'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1194.9549860954285,
    "y": 131.0370855331421,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "ea9a727f.74db9"
      ]
    ]
  },
  {
    "id": "ea9a727f.74db9",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1381.9549860954285,
    "y": 127.03708553314209,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "965ea5a4.e205c8"
      ]
    ]
  },
  {
    "id": "965ea5a4.e205c8",
    "type": "set",
    "name": "set description",
    "xml": "<set>\n<parameter name='prop.site.description' value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1543.2884669303894,
    "y": 126.49824523925781,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "378d80e2.17f6",
    "type": "switchNode",
    "name": "switch location",
    "xml": "<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name == 'location'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1185.0410990715027,
    "y": 173.44442749023438,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "aa90cf46.db3a1"
      ]
    ]
  },
  {
    "id": "aa90cf46.db3a1",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1372.0410990715027,
    "y": 169.44442749023438,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "77618d13.d7cf34"
      ]
    ]
  },
  {
    "id": "77618d13.d7cf34",
    "type": "set",
    "name": "set location",
    "xml": "<set>\n<parameter name='prop.site.location' value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1540.0410990715027,
    "y": 170.04443359375,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "7702e686.8af7a8",
    "type": "switchNode",
    "name": "switch id",
    "xml": "<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name == 'id'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1175.0104174613953,
    "y": 42.010414123535156,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "ed13080f.421188"
      ]
    ]
  },
  {
    "id": "ed13080f.421188",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1362.0104174613953,
    "y": 38.010414123535156,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "23e732a.cf615ce"
      ]
    ]
  },
  {
    "id": "23e732a.cf615ce",
    "type": "set",
    "name": "set id",
    "xml": "<set>\n<parameter name='prop.site.id' value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1530.0104174613953,
    "y": 38.61042022705078,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "75b119e9.762ed8",
    "type": "switchNode",
    "name": "switch type",
    "xml": "<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name == 'type'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1184.0104174613953,
    "y": 217.01040649414062,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "2190e18f.1b285e"
      ]
    ]
  },
  {
    "id": "2190e18f.1b285e",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1371.0104174613953,
    "y": 213.01040649414062,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "195e7aa3.f12db5"
      ]
    ]
  },
  {
    "id": "195e7aa3.f12db5",
    "type": "set",
    "name": "set type",
    "xml": "<set>\n<parameter name='prop.site.type' value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1539.0104174613953,
    "y": 213.61041259765625,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "1c70f9bf.47a396",
    "type": "switchNode",
    "name": "switch role",
    "xml": "<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name == 'role'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1187.0104174613953,
    "y": 260.0104064941406,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "6e1ae54c.95dc4c"
      ]
    ]
  },
  {
    "id": "6e1ae54c.95dc4c",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1374.0104174613953,
    "y": 256.0104064941406,
    "z": "c9244d8c.dbc33",
    "wires": [
      [
        "338b1db2.4b0a32"
      ]
    ]
  },
  {
    "id": "338b1db2.4b0a32",
    "type": "set",
    "name": "set role",
    "xml": "<set>\n<parameter name='prop.site.role' value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1542.0104174613953,
    "y": 256.61041259765625,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  },
  {
    "id": "63e9e578.e6c03c",
    "type": "comment",
    "name": "TODO: AAI",
    "info": "",
    "comments": "",
    "x": 813,
    "y": 651,
    "z": "c9244d8c.dbc33",
    "wires": [
      
    ]
  }
]
