[
  {
    "id": "1fe30678.9b6c5a",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 122.03125,
    "y": 82.03125,
    "z": "c632d855.425948",
    "wires": [
      [
        "6f581451.d6d46c"
      ]
    ]
  },
  {
    "id": "6f581451.d6d46c",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 221.31694793701172,
    "y": 156.26935789268464,
    "z": "c632d855.425948",
    "wires": [
      [
        "ffdaf6e4.8fe2a8"
      ]
    ]
  },
  {
    "id": "ffdaf6e4.8fe2a8",
    "type": "method",
    "name": "method site-vnf-topology-operation-create",
    "xml": "<method rpc='site-vnf-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 242.4598617553711,
    "y": 246.03124639671296,
    "z": "c632d855.425948",
    "wires": [
      [
        "4928aa8e.b25464"
      ]
    ]
  },
  {
    "id": "4928aa8e.b25464",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 222.69790649414062,
    "y": 417.69791814964265,
    "z": "c632d855.425948",
    "wires": [
      [
        "290eb35e.b9e26c",
        "2113cd25.2b0aa2",
        "1e868a78.080646",
        "63b1d38d.89ffcc",
        "c8bfa3ce.63b66",
        "81b868ec.b075e8",
        "8129d44e.2d4828",
        "66b4b0a.218e25",
        "f33cfcda.f0c5d",
        "87aab9f9.450f38",
        "c3c6696a.6ae368",
        "b6127d24.eca33",
        "82b5aeb7.909dc"
      ]
    ]
  },
  {
    "id": "2113cd25.2b0aa2",
    "type": "set",
    "name": "set vnf-level-oper-status to Created",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
    "comments": "",
    "x": 650.8446578979492,
    "y": 836.7018160820007,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "290eb35e.b9e26c",
    "type": "set",
    "name": "copy input data to service data",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
    "comments": "",
    "x": 637.6978073120117,
    "y": 734.6980319023132,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "81b868ec.b075e8",
    "type": "execute",
    "name": "execute generate-vnf-index",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-index\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 622.0313415527344,
    "y": 661.3647031784058,
    "z": "c632d855.425948",
    "wires": [
      []
    ]
  },
  {
    "id": "1e868a78.080646",
    "type": "set",
    "name": "set vnf-index to service data",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.vnf-id' value='`$prop.vnf-index`' />\n",
    "comments": "",
    "x": 628.0313034057617,
    "y": 790.3646578788757,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "63b1d38d.89ffcc",
    "type": "switchNode",
    "name": "switch service-data.vnfs.vnf_length",
    "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 652.0312271118164,
    "y": 296.36460971832275,
    "z": "c632d855.425948",
    "wires": [
      [
        "65a65f43.d7119",
        "e1777473.61ad38"
      ]
    ]
  },
  {
    "id": "65a65f43.d7119",
    "type": "other",
    "name": "NULL",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 886.7456130981445,
    "y": 291.5074300765991,
    "z": "c632d855.425948",
    "wires": [
      [
        "1145bf21.5d5e11"
      ]
    ]
  },
  {
    "id": "1145bf21.5d5e11",
    "type": "set",
    "name": "set vnf-index=0",
    "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
    "comments": "",
    "x": 1047.0313186645508,
    "y": 291.5075216293335,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "e1777473.61ad38",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 883.1741523742676,
    "y": 324.79326152801514,
    "z": "c632d855.425948",
    "wires": [
      [
        "43f60e81.7293"
      ]
    ]
  },
  {
    "id": "3c64116d.221f3e",
    "type": "set",
    "name": "set vnf-index = vnf_length",
    "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
    "comments": "",
    "x": 1276.031394958496,
    "y": 303.07898712158203,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "2bf3f4e0.d3268c",
    "type": "for",
    "name": "for each existing VNF",
    "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1264.4600143432617,
    "y": 338.0789589881897,
    "z": "c632d855.425948",
    "wires": [
      [
        "8fa582ed.781d1"
      ]
    ]
  },
  {
    "id": "43f60e81.7293",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1017.8884353637695,
    "y": 326.793231010437,
    "z": "c632d855.425948",
    "wires": [
      [
        "3c64116d.221f3e",
        "2bf3f4e0.d3268c"
      ]
    ]
  },
  {
    "id": "8fa582ed.781d1",
    "type": "switchNode",
    "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
    "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1657.745750427246,
    "y": 338.6504430770874,
    "z": "c632d855.425948",
    "wires": [
      [
        "d1ebb0ef.628be"
      ]
    ]
  },
  {
    "id": "d1ebb0ef.628be",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1939.031452178955,
    "y": 337.221848487854,
    "z": "c632d855.425948",
    "wires": [
      [
        "43f17df2.e71f94"
      ]
    ]
  },
  {
    "id": "25d81b97.ed5734",
    "type": "comment",
    "name": "make sure this vnf-id doesn't exist already",
    "info": "",
    "comments": "",
    "x": 1626.8883666992188,
    "y": 302.2218351364136,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "c8bfa3ce.63b66",
    "type": "set",
    "name": "set new vnf_length",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
    "comments": "",
    "x": 604.0313034057617,
    "y": 628.3646578788757,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "f33cfcda.f0c5d",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 606.0313301086426,
    "y": 1059.6282849311829,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "8129d44e.2d4828",
    "type": "save",
    "name": "save siteInstance configuration in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource' \n      key='site-resource.id = $prop.vnf-index' >\n<parameter name='id' value='`$prop.vnf-index`' />      \n<parameter name='name' value='`$prop.site.name`' />\n<parameter name='description' value='`$prop.site.description`' />\n<parameter name='type' value='prop.site.type' />\n<parameter name='role' value='prop.site.role' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />\n",
    "comments": "",
    "outputs": 1,
    "x": 654.6980743408203,
    "y": 931.8503160476685,
    "z": "c632d855.425948",
    "wires": [
      []
    ]
  },
  {
    "id": "66b4b0a.218e25",
    "type": "save",
    "name": "save service relationship in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id \n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"site-resource\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/site-resources/site-resource/' + $prop.vnf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"site-resource.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-index`\" />",
    "comments": "",
    "outputs": 1,
    "x": 643.6980781555176,
    "y": 994.6281986236572,
    "z": "c632d855.425948",
    "wires": [
      []
    ]
  },
  {
    "id": "87aab9f9.450f38",
    "type": "set",
    "name": "set vnf-index and vnf-object-path",
    "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-index`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />",
    "comments": "",
    "x": 645.0313262939453,
    "y": 880.6280870437622,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "c3c6696a.6ae368",
    "type": "for",
    "name": "for loop idx - VNF input parameters",
    "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 638.0313415527344,
    "y": 435.0313129425049,
    "z": "c632d855.425948",
    "wires": [
      [
        "8cb85abf.a9b198"
      ]
    ]
  },
  {
    "id": "8cb85abf.a9b198",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 852.809684753418,
    "y": 432.5868968963623,
    "z": "c632d855.425948",
    "wires": [
      [
        "e6a0ec42.6ba",
        "cdd1aefb.fa2f8"
      ]
    ]
  },
  {
    "id": "e6a0ec42.6ba",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1049.0658874511719,
    "y": 410.3350353240967,
    "z": "c632d855.425948",
    "wires": [
      []
    ]
  },
  {
    "id": "cdd1aefb.fa2f8",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1018.5103149414062,
    "y": 447.3351516723633,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "b6127d24.eca33",
    "type": "set",
    "name": "set vnf-request-input.",
    "xml": "<set>\n<parameter name='vnf-request-input.' value='`$vnf-topology-operation-input.vnf-request-input.`' />\n",
    "comments": "",
    "x": 600.0309600830078,
    "y": 509.3560276031494,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "82b5aeb7.909dc",
    "type": "call",
    "name": "call sdwan-get-site-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-site-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 616.0313262939453,
    "y": 541.3562316894531,
    "z": "c632d855.425948",
    "wires": [
      []
    ]
  },
  {
    "id": "43f17df2.e71f94",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
    "comments": "",
    "x": 2067.6028213500977,
    "y": 388.22186279296875,
    "z": "c632d855.425948",
    "wires": []
  },
  {
    "id": "ee62377b.687508",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 1361.0314331054688,
    "y": 391.6979293823242,
    "z": "c632d855.425948",
    "wires": []
  }
]
