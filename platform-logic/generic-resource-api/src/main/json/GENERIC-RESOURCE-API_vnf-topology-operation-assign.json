[{"id":"ed675d7d.ace6e","type":"dgstart","name":"DGSTART","outputs":1,"x":142,"y":87,"z":"bddd9a6f.337e6","wires":[["f794159d.0d7d78"]]},{"id":"f794159d.0d7d78","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":255.61902618408203,"y":127.23811340332031,"z":"bddd9a6f.337e6","wires":[["c84d8eee.f1ae98"]]},{"id":"c84d8eee.f1ae98","type":"method","name":"method vnf-topology-operation-assign","xml":"<method rpc='vnf-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":233.42862701416016,"y":167,"z":"bddd9a6f.337e6","wires":[["c8854c95.fd5d38"]]},{"id":"82dd08cf.3cd538","type":"comment","name":"vnf-topology-operation-assign","info":"","comments":"","x":536.344856262207,"y":34.58634376525879,"z":"bddd9a6f.337e6","wires":[]},{"id":"c41ad6d1.efc148","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vnf-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":543.8571395874023,"y":364.19043922424316,"z":"bddd9a6f.337e6","wires":[["dacb2cef.914238","b3a11928.c1fa08"]]},{"id":"dacb2cef.914238","type":"outcome","name":"CreateVnfInstance","xml":"<outcome value='CreateVnfInstance'>\n","comments":"","outputs":1,"x":797.5714340209961,"y":341.3333206176758,"z":"bddd9a6f.337e6","wires":[["e8d30ae3.61ceb"]]},{"id":"b3a11928.c1fa08","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":759.5713996887207,"y":387.0476484298706,"z":"bddd9a6f.337e6","wires":[["2a07291.574a0d6"]]},{"id":"e8d30ae3.61ceb","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":982.4285621643066,"y":341.3333501815796,"z":"bddd9a6f.337e6","wires":[[]]},{"id":"2a07291.574a0d6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'assign' then request-action must be 'CreateVnfInstance'\" />\n","comments":"","x":999.5714073181152,"y":387.0476064682007,"z":"bddd9a6f.337e6","wires":[]},{"id":"c8854c95.fd5d38","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":172.11905670166016,"y":1698.7857055664062,"z":"bddd9a6f.337e6","wires":[["c41ad6d1.efc148","ab22586b.1af468","faa7a92c.48066","9d0e736e.cc1668","207ee148.fc777e","63cfe327.355cf4","5281280a.9dc9a","1d2cbc77.5e5ca4","77f8a2db.9c448c","739375da.25855c","cf6fd24a.08dd9","b673146c.65e6b","ce1e73a5.9738d","3768664b.92e13a","2c9c1d4b.d179d2","85f383e7.d1f218","17624bbf.b0bddc","ff8e6bc6.9dded","241bf6d5.4e1e22","3bedba52.17895e","1f02a684.292909","6557b560.6e69a4","ce7a195a.8cbea","9f01dbdc.6a2aa","25a5b081.5b45f","9e65c027.44ee98","3a0a0662.a0965a","a5e3b389.180a58","85e9a83.dd89d58","63a54164.66f868","a56a9b32.b2955"]]},{"id":"ab22586b.1af468","type":"get-resource","name":"get-resource VF_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODEL WHERE customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-model'>\n\n","comments":"","outputs":1,"x":556.1904449462891,"y":455.333309173584,"z":"bddd9a6f.337e6","wires":[["b91565b7.cb491","9b71463c.52ff28"]]},{"id":"27ff7eba.78185a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No model found for VNF customization UUID ' + $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`\" />\n","comments":"","x":997.6189231872559,"y":478.7617950439453,"z":"bddd9a6f.337e6","wires":[]},{"id":"b91565b7.cb491","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":756.9761428833008,"y":435.7141466140747,"z":"bddd9a6f.337e6","wires":[["698bcc73.6b3cbc"]]},{"id":"9b71463c.52ff28","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":765.5475730895996,"y":479.9998598098755,"z":"bddd9a6f.337e6","wires":[["27ff7eba.78185a"]]},{"id":"698bcc73.6b3cbc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODEL table\" />\n","comments":"","x":996.9761238098145,"y":433.85705375671387,"z":"bddd9a6f.337e6","wires":[]},{"id":"faa7a92c.48066","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":586.2857131958008,"y":645.5714282989502,"z":"bddd9a6f.337e6","wires":[["4f942e07.8ce308","9ea8692f.1e45f"]]},{"id":"4f942e07.8ce308","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":812.0000419616699,"y":612.7142162322998,"z":"bddd9a6f.337e6","wires":[["e04e1714.d2815"]]},{"id":"e04e1714.d2815","type":"set","name":"set vnf-index=0","xml":"<set>\n<parameter name='vnf-index' value='0' />\n","comments":"","x":976.2857627868652,"y":611.7142944335938,"z":"bddd9a6f.337e6","wires":[]},{"id":"9ea8692f.1e45f","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":813.4286041259766,"y":677.0000343322754,"z":"bddd9a6f.337e6","wires":[["76f85ae1.e31714"]]},{"id":"cf88f86.a482088","type":"set","name":"set vnf-index = vnf_length","xml":"<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n","comments":"","x":1152.285758972168,"y":655.285722732544,"z":"bddd9a6f.337e6","wires":[]},{"id":"c77b9541.93f3d8","type":"for","name":"for each existing VNF","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":1137.7142715454102,"y":701.2856616973877,"z":"bddd9a6f.337e6","wires":[["4de48921.839148"]]},{"id":"76f85ae1.e31714","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":949.1428642272949,"y":677,"z":"bddd9a6f.337e6","wires":[["cf88f86.a482088","c77b9541.93f3d8"]]},{"id":"4de48921.839148","type":"switchNode","name":"switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n","comments":"","outputs":1,"x":1492.0000381469727,"y":700.857141494751,"z":"bddd9a6f.337e6","wires":[["25496de9.3a62b2"]]},{"id":"25496de9.3a62b2","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1786.2857475280762,"y":700.4286136627197,"z":"bddd9a6f.337e6","wires":[["ae112884.d5476"]]},{"id":"ae112884.d5476","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n","comments":"","x":1934.8571548461914,"y":700.4285736083984,"z":"bddd9a6f.337e6","wires":[]},{"id":"8c52b465.472978","type":"comment","name":"make sure this VNF doesn't exist already","info":"","comments":"","x":1479.1427688598633,"y":658.4285717010498,"z":"bddd9a6f.337e6","wires":[]},{"id":"9d0e736e.cc1668","type":"set","name":"set vnf-topology data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-id'\n value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-type'\n value='`$vnf-topology-operation-input.vnf-information.vnf-type`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-type'\n value='`$db.vf-model.nf-type`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-role'\n value='`$db.vf-model.nf-role`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-function'\n value='`$db.vf-model.nf-function`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-code'\n value='`$db.vf-model.nf-code`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.tenant'\n value='`$vnf-topology-operation-input.vnf-request-input.tenant`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-cloud-region'\n value='`$vnf-topology-operation-input.vnf-request-input.aic-cloud-region`' />\n \n","comments":"","x":541.9999694824219,"y":807.238115310669,"z":"bddd9a6f.337e6","wires":[]},{"id":"207ee148.fc777e","type":"switchNode","name":"switch input vnf-name","xml":"<switch test='`$vnf-topology-operation-input.vnf-request-input.vnf-name`'>\n","comments":"","outputs":1,"x":548.4285507202148,"y":1049.8571615219116,"z":"bddd9a6f.337e6","wires":[["dbb8606.485d82","2ea9add9.2c72c2"]]},{"id":"dbb8606.485d82","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":816.6427726745605,"y":972.8333864212036,"z":"bddd9a6f.337e6","wires":[["3ca24359.bef8f4"]]},{"id":"732a6ddd.c2e644","type":"switchNode","name":"switch ecomp-generated-naming","xml":"<switch test='`$db.vf-model.ecomp-generated-naming`'>\n","comments":"","outputs":1,"x":1233.071662902832,"y":879.5002059936523,"z":"bddd9a6f.337e6","wires":[["e787aef9.0cd478","1d35a9ef.5d23ee","be700d9b.b44c08"]]},{"id":"3ca24359.bef8f4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":962.3572692871094,"y":972.833498954773,"z":"bddd9a6f.337e6","wires":[["a9780469.c668c","678d2aa7.28fe04","732a6ddd.c2e644"]]},{"id":"1d35a9ef.5d23ee","type":"outcome","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":1482.357322692871,"y":881.404914855957,"z":"bddd9a6f.337e6","wires":[["3661192f.98b9de"]]},{"id":"3661192f.98b9de","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"No vnf-name was received but ecomp-generated-naming is not Y\" />\n","comments":"","x":1636.64310836792,"y":899.9763593673706,"z":"bddd9a6f.337e6","wires":[]},{"id":"e787aef9.0cd478","type":"outcome","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1482.3572883605957,"y":837.1192359924316,"z":"bddd9a6f.337e6","wires":[["5988fdb5.7e49bc"]]},{"id":"be700d9b.b44c08","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1482.357250213623,"y":927.119234085083,"z":"bddd9a6f.337e6","wires":[["3661192f.98b9de"]]},{"id":"5988fdb5.7e49bc","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1619.5002326965332,"y":837.1192359924316,"z":"bddd9a6f.337e6","wires":[[]]},{"id":"2ea9add9.2c72c2","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":819.2144546508789,"y":1119.119125366211,"z":"bddd9a6f.337e6","wires":[["5962ed67.221854"]]},{"id":"bbd7dd1d.18139","type":"set","name":"set tmp.vnf-name","xml":"<set>\n<parameter name='tmp.vnf-name' value=\"`$vnf-topology-operation-input.vnf-request-input.vnf-name`\" />\n","comments":"","x":1778.0715306599936,"y":1186.5476417541504,"z":"bddd9a6f.337e6","wires":[]},{"id":"a9780469.c668c","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":1301.4763259887695,"y":1045.8333959579468,"z":"bddd9a6f.337e6","wires":[["9cdadb69.ea7d","adc43185.56d19"]]},{"id":"9cdadb69.ea7d","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1597.1906140645347,"y":1018.6906585693359,"z":"bddd9a6f.337e6","wires":[["4114114c.1198d"]]},{"id":"adc43185.56d19","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1600.5239639282227,"y":1070.3573017120361,"z":"bddd9a6f.337e6","wires":[["ec0ba008.80def8"]]},{"id":"678d2aa7.28fe04","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='VNF_NAME_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vnf_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='VNF_INSTANCE' />\n<parameter name='generate-unique-name-input.prefix' value=\"`'z' + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region + $db.vf-model.nf-code`\" />\n<parameter name='generate-unique-name-input.index-length' value='2' />\n","comments":"","x":1258.1430130004883,"y":994.1668043136597,"z":"bddd9a6f.337e6","wires":[]},{"id":"ec0ba008.80def8","type":"set","name":"set tmp.vnf-name to generated name","xml":"<set>\n<parameter name='tmp.vnf-name' value='`$generate-unique-name-output.generated-name`' />\n","comments":"","x":1841.7143491109214,"y":1070.8333930969238,"z":"bddd9a6f.337e6","wires":[]},{"id":"4114114c.1198d","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":1765.0477269490561,"y":1018.1191701889038,"z":"bddd9a6f.337e6","wires":[]},{"id":"5962ed67.221854","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":967.1429824829102,"y":1117.7858123779297,"z":"bddd9a6f.337e6","wires":[["93b63ea3.232198","a94f82ec.8b4f7"]]},{"id":"a94f82ec.8b4f7","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":1297.1429824829102,"y":1165.7858123779297,"z":"bddd9a6f.337e6","wires":[["cf3e6374.7377a8","619c56dc.128418"]]},{"id":"cf3e6374.7377a8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1595.7143987019858,"y":1135.785837173462,"z":"bddd9a6f.337e6","wires":[["6632d087.4bc468"]]},{"id":"619c56dc.128418","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1599.0477485656738,"y":1187.452480316162,"z":"bddd9a6f.337e6","wires":[["bbd7dd1d.18139"]]},{"id":"93b63ea3.232198","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.name-table-type' value='VNF_INSTANCE' />\n<parameter name='generate-unique-name-input.supplied-name' value='`$vnf-topology-operation-input.vnf-request-input.vnf-name`' />\n","comments":"","x":1253.8096542358398,"y":1114.1191844940186,"z":"bddd9a6f.337e6","wires":[]},{"id":"6632d087.4bc468","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":1763.5715115865073,"y":1135.2143487930298,"z":"bddd9a6f.337e6","wires":[]},{"id":"63cfe327.355cf4","type":"get-resource","name":"get-resource cloud region","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"cloud-region\" \n\t\tkey=\"cloud-region.cloud-owner = 'CloudOwner' AND \n\t\t     cloud-region.cloud-region-id = $vnf-topology-operation-input.vnf-request-input.aic-cloud-region AND\n\t\t     depth='0'\"\n        pfx='aai.cloud-region' local-only='false' >\n\n","comments":"","outputs":1,"x":570.5714492797852,"y":1727.8569984436035,"z":"bddd9a6f.337e6","wires":[["d99c6dd7.6b2a2","c039b6e9.6f408"]]},{"id":"c039b6e9.6f408","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":795.8176422119141,"y":1746.00785446167,"z":"bddd9a6f.337e6","wires":[["ce7041d9.2f8398"]]},{"id":"ce7041d9.2f8398","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving cloud region from AAI\" />\n","comments":"","x":970.8176155090332,"y":1746.007890701294,"z":"bddd9a6f.337e6","wires":[]},{"id":"d99c6dd7.6b2a2","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":804.7462387084961,"y":1704.2935876846313,"z":"bddd9a6f.337e6","wires":[["37bacf14.e6491"]]},{"id":"37bacf14.e6491","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Cloud region not found in AAI\" />\n","comments":"","x":971.095516204834,"y":1703.5991649627686,"z":"bddd9a6f.337e6","wires":[]},{"id":"5281280a.9dc9a","type":"get-resource","name":"get-resource VF_TO_NETWORK_ROLE_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_TO_NETWORK_ROLE_MAPPING WHERE vf_customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-network-role-mapping[]'>\n\n","comments":"","outputs":1,"x":635.8095321655273,"y":2038.9045181274414,"z":"bddd9a6f.337e6","wires":[["7af63da2.c6a66c","5ebbea50.6d2c64"]]},{"id":"b504d54f.24e1b","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in VF_TO_NETWORK_ROLE_MAPPING for VNF customization UUID ' + $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`\" />\n","comments":"","x":1371.5237121582031,"y":2056.618698120117,"z":"bddd9a6f.337e6","wires":[]},{"id":"7af63da2.c6a66c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":931.5952033996582,"y":2017.6186828613281,"z":"bddd9a6f.337e6","wires":[["f3da033c.a777d"]]},{"id":"5ebbea50.6d2c64","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":940.166633605957,"y":2061.904396057129,"z":"bddd9a6f.337e6","wires":[["424ff6e7.447f38"]]},{"id":"f3da033c.a777d","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_TO_NETWORK_ROLE_MAPPING table\" />\n","comments":"","x":1106.5951843261719,"y":2017.4283332824707,"z":"bddd9a6f.337e6","wires":[]},{"id":"cdee5167.028838","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":736.5715866088867,"y":2487.71391582489,"z":"bddd9a6f.337e6","wires":[["6b46f1c5.2af3c","120b4cf.d380333","3a20f7c8.4b9948","e93186fa.4cc36","589655ec.744604","25449779.0edec8","4953ffcc.d2d09","73cdb214.fd8154"]]},{"id":"3a20f7c8.4b9948","type":"get-resource","name":"get-resource l3-network","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"l3-networks\" \n\t\tkey=\"l3-network.network-role = $db.vf-network-role-mapping[$role-index].network-role\"\n        pfx='aai.l3-network' local-only='false'\n>\n","comments":"","outputs":1,"x":969.4286041259766,"y":2166.999779701233,"z":"bddd9a6f.337e6","wires":[["e723937e.6f5778","213a35dd.62965a"]]},{"id":"213a35dd.62965a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1173.476318359375,"y":2189.1426191329956,"z":"bddd9a6f.337e6","wires":[["5e97c627.91f488"]]},{"id":"5e97c627.91f488","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving l3-network from AAI\" />\n","comments":"","x":1348.4762916564941,"y":2189.1426553726196,"z":"bddd9a6f.337e6","wires":[]},{"id":"e723937e.6f5778","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1182.404914855957,"y":2147.428352355957,"z":"bddd9a6f.337e6","wires":[["96cdb581.d26ff8"]]},{"id":"96cdb581.d26ff8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No active l3-network found in AAI with cloud_region_id '\n          + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region + ' and network_role '\n          + $db.vf-network-role-mapping[$network-index].network-role`\" />\n","comments":"","x":1348.754192352295,"y":2146.7339296340942,"z":"bddd9a6f.337e6","wires":[]},{"id":"6b46f1c5.2af3c","type":"set","name":"set vnf-network data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-role'\n    value='`$db.vf-network-role-mapping[$role-index].network-role`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-name'\n    value='`$aai.l3-network.l3-network[$db-network-index].network-name`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].neutron-id'\n    value='`$aai.l3-network.l3-network[$db-network-index].neutron-network-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-id'\n    value='`$aai.l3-network.l3-network[$db-network-index].network-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].contrail-network-fqdn'\n    value='`$aai.l3-network.l3-network[$db-network-index].contrail-network-fqdn`' />\n","comments":"","x":958.6191940307617,"y":2654.0000228881836,"z":"bddd9a6f.337e6","wires":[]},{"id":"cf6fd24a.08dd9","type":"for","name":"for each cloud-region availability zone","xml":"<for index='idx' start='0' end='`$aai.az.availability-zone_length`' >\n","comments":"","outputs":1,"x":570.3335571289062,"y":3068.618803024292,"z":"bddd9a6f.337e6","wires":[["17f34860.26dd28"]]},{"id":"7e453d1b.116fbc","type":"set","name":"set availability-zone","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.availability-zone[$idx]'\n  value='`$aai.az.availability-zone[$idx].availability-zone-name`' />\n","comments":"","x":1032.0002403259277,"y":3037.952217102051,"z":"bddd9a6f.337e6","wires":[]},{"id":"b673146c.65e6b","type":"set","name":"set vnf-parameters-data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-parameters-data.'\n  value='vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.' />\n","comments":"","x":529.9524841308594,"y":2918.5711631774902,"z":"bddd9a6f.337e6","wires":[]},{"id":"5765b2b2.3e4194","type":"save","name":"save generic-vnf l3-network relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf:relationship-list\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$vnf-nw-index].network-id`\" />\n","comments":"","outputs":1,"x":996.5240173339844,"y":3212.381015777588,"z":"bddd9a6f.337e6","wires":[["db875f44.a9e568","de1a21e7.7779d8"]]},{"id":"2c9c1d4b.d179d2","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":493.0953674316406,"y":3599.1901140213013,"z":"bddd9a6f.337e6","wires":[]},{"id":"3768664b.92e13a","type":"set","name":"set vnf-level-oper-status to PendingCreate","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='PendingCreate' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n","comments":"","x":582.9088134765625,"y":3501.527594566345,"z":"bddd9a6f.337e6","wires":[]},{"id":"77f8a2db.9c448c","type":"for","name":"for each network-role","xml":"<for index='role-index' start='0' end='`$db.vf-network-role-mapping_length`'>","comments":"","outputs":1,"x":519.9048919677734,"y":2487.7141189575195,"z":"bddd9a6f.337e6","wires":[["cdee5167.028838"]]},{"id":"1d2cbc77.5e5ca4","type":"set","name":"set network-index = 0","xml":"<set>\n<parameter name='network-index' value='0' />\n","comments":"","x":538.2380676269531,"y":2105.8094577789307,"z":"bddd9a6f.337e6","wires":[]},{"id":"120b4cf.d380333","type":"set","name":"increment network-index","xml":"<set>\n<parameter name='network-index' value='`$network-index + 1`' />\n","comments":"","x":968.9525146484375,"y":2791.6189250946045,"z":"bddd9a6f.337e6","wires":[]},{"id":"739375da.25855c","type":"set","name":"set vnf-network_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network_length'\n  value='`$network-index`' />\n","comments":"","x":528.8095703125,"y":2868.571207046509,"z":"bddd9a6f.337e6","wires":[]},{"id":"ce1e73a5.9738d","type":"set","name":"copy input data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n<parameter name=\"service-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'+$vnf-topology-operation-input.service-information.service-instance-id+'/service-data/service-topology/'`\" />\n\n","comments":"","x":498.4286422729492,"y":3449.1904258728027,"z":"bddd9a6f.337e6","wires":[]},{"id":"85f383e7.d1f218","type":"for","name":"for each vnf-network","xml":"<for index='vnf-nw-index' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network_length`' >\n","comments":"","outputs":1,"x":519.52392578125,"y":3211.380931854248,"z":"bddd9a6f.337e6","wires":[["b2f3e0eb.51871"]]},{"id":"b2f3e0eb.51871","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":723.1905670166016,"y":3211.380892753601,"z":"bddd9a6f.337e6","wires":[["5765b2b2.3e4194"]]},{"id":"17624bbf.b0bddc","type":"set","name":"set new vnf_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n","comments":"","x":534.0952491760254,"y":761.7619781494141,"z":"bddd9a6f.337e6","wires":[]},{"id":"ff8e6bc6.9dded","type":"for","name":"for each cloud-region relationship","xml":"<for index='idx' start='0' end='`$aai.cloud-region.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":583.4285736083984,"y":1815.0951700210571,"z":"bddd9a6f.337e6","wires":[["a8614d0.450ddb"]]},{"id":"a8614d0.450ddb","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship[$idx].related-to`'>\n","comments":"","outputs":1,"x":831.1071166992188,"y":1814.8450994491577,"z":"bddd9a6f.337e6","wires":[["f1dde95f.85ac7"]]},{"id":"f1dde95f.85ac7","type":"outcome","name":"complex","xml":"<outcome value='complex'>\n","comments":"","outputs":1,"x":1000.5714378356934,"y":1814.2379217147827,"z":"bddd9a6f.337e6","wires":[["e4107e03.5dfa"]]},{"id":"4f8598ab.f9ffd","type":"set","name":"set aic-clli","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-clli'\n  value='`$aai-uid-split[$aai-uid-split_length - 1]`' />\n","comments":"","x":1321.2857360839844,"y":1813.9045791625977,"z":"bddd9a6f.337e6","wires":[]},{"id":"241bf6d5.4e1e22","type":"switchNode","name":"switch aic-clli","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-clli`'>\n","comments":"","outputs":1,"x":519.3333511352539,"y":1971.0474872589111,"z":"bddd9a6f.337e6","wires":[["c8c50b1f.04bb3"]]},{"id":"c8c50b1f.04bb3","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":667.4761848449707,"y":1971.0474700927734,"z":"bddd9a6f.337e6","wires":[["fd7a237.10133e"]]},{"id":"fd7a237.10133e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find aic-clli in AAI for aic-cloud-region ' + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n","comments":"","x":814.6190452575684,"y":1970.6189041137695,"z":"bddd9a6f.337e6","wires":[]},{"id":"b722795f.a9e078","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid'\n  value='`$db.vf-model.invariant-uuid`' />\n","comments":"","x":942.9287452697754,"y":1287.0475587844849,"z":"bddd9a6f.337e6","wires":[]},{"id":"5298edb0.64002c","type":"for","name":"for each l3-network","xml":"<for index='db-network-index' start='0' end='`$aai.l3-network.l3-network_length`' >\n","comments":"","outputs":1,"x":1076.8811492919922,"y":2410.571388244629,"z":"bddd9a6f.337e6","wires":[["8e8a2f55.dddb5"]]},{"id":"8e8a2f55.dddb5","type":"switchNode","name":"switch orchestration-status","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].orchestration-status`'>\n","comments":"","outputs":1,"x":1305.452350616455,"y":2409.142815589905,"z":"bddd9a6f.337e6","wires":[["814b5140.7fded","5d445690.1da32","b50a1866.36fbd8","cd22a787.eb644","451488d0.84e8b8"]]},{"id":"814b5140.7fded","type":"outcome","name":"Pending Delete","xml":"<outcome value='Pending Delete'>\n","comments":"","outputs":1,"x":1542.1192626953125,"y":2454.8095235824585,"z":"bddd9a6f.337e6","wires":[["1cd33321.db0f4d"]]},{"id":"5d445690.1da32","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1514.9764022827148,"y":2505.809504508972,"z":"bddd9a6f.337e6","wires":[["7867f780.cba5c"]]},{"id":"7be8d11a.3c685","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].related-to`'>\n","comments":"","outputs":1,"x":1880.6907539367676,"y":2504.3808450698853,"z":"bddd9a6f.337e6","wires":[["6b08a7e3.5775c8"]]},{"id":"7867f780.cba5c","type":"for","name":"for each relationship","xml":"<for silentFailure='true' index='db-rel-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":1684.9763145446777,"y":2505.3808813095093,"z":"bddd9a6f.337e6","wires":[["7be8d11a.3c685"]]},{"id":"6b08a7e3.5775c8","type":"outcome","name":"cloud-region","xml":"<outcome value='cloud-region'>\n","comments":"","outputs":1,"x":2054.9763946533203,"y":2503.9522914886475,"z":"bddd9a6f.337e6","wires":[["b238ffa6.fabd4"]]},{"id":"b238ffa6.fabd4","type":"for","name":"for each relationship data","xml":"<for silentFailure='true' index='db-data-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data_length`' >\n","comments":"","outputs":1,"x":2252.119094848633,"y":2504.380759239197,"z":"bddd9a6f.337e6","wires":[["37697e64.349baa"]]},{"id":"37697e64.349baa","type":"switchNode","name":"switch relationship-key","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-key`'>\n","comments":"","outputs":1,"x":2483.547695159912,"y":2503.9521341323853,"z":"bddd9a6f.337e6","wires":[["c6e1f4cf.6124c"]]},{"id":"c6e1f4cf.6124c","type":"outcome","name":"cloud-region.cloud-region-id","xml":"<outcome value='cloud-region.cloud-region-id'>\n","comments":"","outputs":1,"x":2724.9762268066406,"y":2503.95223903656,"z":"bddd9a6f.337e6","wires":[["5ebe148f.d83a24"]]},{"id":"5ebe148f.d83a24","type":"switchNode","name":"switch relationship-value == cloud-region-id","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-value == $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`'>\n","comments":"","outputs":1,"x":3029.2621459960938,"y":2503.8092947006226,"z":"bddd9a6f.337e6","wires":[["4046e770.1f41f8"]]},{"id":"4046e770.1f41f8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3269.262176513672,"y":2503.9522399902344,"z":"bddd9a6f.337e6","wires":[["ad372b52.fd9498"]]},{"id":"e93186fa.4cc36","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":915.0953330993652,"y":2478.4284858703613,"z":"bddd9a6f.337e6","wires":[["5298edb0.64002c","7f77673e.102018"]]},{"id":"7f77673e.102018","type":"returnSuccess","name":"CATCH BREAK","xml":"<return status='success'>\n\n","comments":"","x":1066.4287414550781,"y":2551.7617197036743,"z":"bddd9a6f.337e6","wires":[]},{"id":"34bdf9b6.ca8766","type":"returnFailure","name":"BREAK","xml":"<return status='failure'>\n","comments":"","x":3570.095157623291,"y":2521.761643409729,"z":"bddd9a6f.337e6","wires":[]},{"id":"589655ec.744604","type":"set","name":"set l3-network-id = -1","xml":"<set>\n<parameter name='l3-network-id' value='-1' />\n","comments":"","x":959.4287033081055,"y":2281.7616996765137,"z":"bddd9a6f.337e6","wires":[]},{"id":"ad372b52.fd9498","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3415.0951538085938,"y":2503.4283485412598,"z":"bddd9a6f.337e6","wires":[["6b4c615d.b4afd8","34bdf9b6.ca8766"]]},{"id":"6b4c615d.b4afd8","type":"set","name":"set l3-network-id = this l3-network","xml":"<set>\n<parameter name='l3-network-id' value='`$aai.l3-network.l3-network[$db-network-index].network-id`' />\n","comments":"","x":3651.7618255615234,"y":2478.4283475875854,"z":"bddd9a6f.337e6","wires":[]},{"id":"25449779.0edec8","type":"switchNode","name":"switch l3-network-id","xml":"<switch test='`$l3-network-id`'>\n","comments":"","outputs":1,"x":956.4286270141602,"y":2605.428741455078,"z":"bddd9a6f.337e6","wires":[["aec8f346.b51a18"]]},{"id":"aec8f346.b51a18","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":1126.4285774230957,"y":2605.428497314453,"z":"bddd9a6f.337e6","wires":[["47305c77.c27a7c"]]},{"id":"47305c77.c27a7c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find l3-network in AAI for network role ' + $db.vf-network-role-mapping[$role-index].network-role`\" />\n","comments":"","x":1274.7619400024414,"y":2605.4286346435547,"z":"bddd9a6f.337e6","wires":[]},{"id":"3bedba52.17895e","type":"switchNode","name":"switch input model-invariant-uuid","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`'>\n","comments":"","outputs":1,"x":586.7858200073242,"y":1309.8720026016235,"z":"bddd9a6f.337e6","wires":[["bf83dfb1.1d53","632b6168.07ab5"]]},{"id":"bf83dfb1.1d53","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":792.4524917602539,"y":1287.0149660110474,"z":"bddd9a6f.337e6","wires":[["b722795f.a9e078"]]},{"id":"632b6168.07ab5","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":793.8810882568359,"y":1331.3005571365356,"z":"bddd9a6f.337e6","wires":[["2bbee3a1.4659ac"]]},{"id":"2bbee3a1.4659ac","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n","comments":"","x":948.1668243408203,"y":1330.7291293144226,"z":"bddd9a6f.337e6","wires":[]},{"id":"4ec3fae.6a66304","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid'\n  value='`$db.vf-model.uuid`' />\n","comments":"","x":943.8810157775879,"y":1375.5862350463867,"z":"bddd9a6f.337e6","wires":[]},{"id":"1f02a684.292909","type":"switchNode","name":"switch input model-uuid","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`'>\n","comments":"","outputs":1,"x":559.4048385620117,"y":1398.4107398986816,"z":"bddd9a6f.337e6","wires":[["51f7f061.160788","f0995399.7d69f8"]]},{"id":"51f7f061.160788","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":793.4048118591309,"y":1375.553671836853,"z":"bddd9a6f.337e6","wires":[["4ec3fae.6a66304"]]},{"id":"f0995399.7d69f8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":794.8334083557129,"y":1419.8392629623413,"z":"bddd9a6f.337e6","wires":[["af65602f.81011"]]},{"id":"af65602f.81011","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n","comments":"","x":949.1191444396973,"y":1419.2678351402283,"z":"bddd9a6f.337e6","wires":[]},{"id":"ed614573.653388","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-version'\n  value='`$db.vf-model.version`' />\n","comments":"","x":941.0239486694336,"y":1464.4434423446655,"z":"bddd9a6f.337e6","wires":[]},{"id":"6557b560.6e69a4","type":"switchNode","name":"switch input model-version","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-version`'>\n","comments":"","outputs":1,"x":567.5477104187012,"y":1487.2678871154785,"z":"bddd9a6f.337e6","wires":[["7f04ad30.29a2dc","69e41d03.a3554c"]]},{"id":"7f04ad30.29a2dc","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":790.5476951599121,"y":1464.410849571228,"z":"bddd9a6f.337e6","wires":[["ed614573.653388"]]},{"id":"69e41d03.a3554c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":791.9762916564941,"y":1508.6964406967163,"z":"bddd9a6f.337e6","wires":[["520ed43a.540e54"]]},{"id":"520ed43a.540e54","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-version'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-version`' />\n","comments":"","x":946.2620277404785,"y":1508.1250128746033,"z":"bddd9a6f.337e6","wires":[]},{"id":"6a40c8d4.315858","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-name'\n  value='`$db.vf-model.name`' />\n","comments":"","x":941.0239486694336,"y":1551.5862646102905,"z":"bddd9a6f.337e6","wires":[]},{"id":"ce7a195a.8cbea","type":"switchNode","name":"switch input model-name","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-name`'>\n","comments":"","outputs":1,"x":562.5477104187012,"y":1574.4107093811035,"z":"bddd9a6f.337e6","wires":[["cdf1f9c4.de595","2d8c6f74.648b3"]]},{"id":"cdf1f9c4.de595","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":790.5476951599121,"y":1551.553671836853,"z":"bddd9a6f.337e6","wires":[["6a40c8d4.315858"]]},{"id":"2d8c6f74.648b3","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":791.9762916564941,"y":1595.8392629623413,"z":"bddd9a6f.337e6","wires":[["bdf246a6.cec818"]]},{"id":"bdf246a6.cec818","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-name'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-name`' />\n","comments":"","x":946.2620277404785,"y":1595.2678351402283,"z":"bddd9a6f.337e6","wires":[]},{"id":"1cd33321.db0f4d","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1695.3333549499512,"y":2455.586400985718,"z":"bddd9a6f.337e6","wires":[[]]},{"id":"451488d0.84e8b8","type":"outcome","name":"PendingDelete","xml":"<outcome value='PendingDelete'>\n","comments":"","outputs":1,"x":1539.9999961853027,"y":2410.5863151550293,"z":"bddd9a6f.337e6","wires":[["7b85520e.9d8644"]]},{"id":"7b85520e.9d8644","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1695.2140884399414,"y":2411.3631925582886,"z":"bddd9a6f.337e6","wires":[[]]},{"id":"cd22a787.eb644","type":"outcome","name":"Pending Create","xml":"<outcome value='Pending Create'>\n","comments":"","outputs":1,"x":1541.9999961853027,"y":2367.2528190612793,"z":"bddd9a6f.337e6","wires":[["643b5441.1e9774"]]},{"id":"643b5441.1e9774","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1695.2140884399414,"y":2368.0296964645386,"z":"bddd9a6f.337e6","wires":[[]]},{"id":"b50a1866.36fbd8","type":"outcome","name":"PendingCreate","xml":"<outcome value='PendingCreate'>\n","comments":"","outputs":1,"x":1541.9999961853027,"y":2323.9195671081543,"z":"bddd9a6f.337e6","wires":[["b14b6544.b7065"]]},{"id":"b14b6544.b7065","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1695.2140884399414,"y":2324.6964445114136,"z":"bddd9a6f.337e6","wires":[[]]},{"id":"4953ffcc.d2d09","type":"for","name":"for each A&AI subnet","xml":"<for index='subnet-index' start='0' end='`$aai.l3-network.l3-network[0].subnets.subnet_length`' >\n","comments":"","outputs":1,"x":958.6667633056641,"y":2698.919626235962,"z":"bddd9a6f.337e6","wires":[["347eb95e.71451e"]]},{"id":"347eb95e.71451e","type":"set","name":"set subnet data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].ip-version'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].ip-version`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].subnet-id'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-id`' />\n","comments":"","x":1156.9999389648438,"y":2697.2532052993774,"z":"bddd9a6f.337e6","wires":[]},{"id":"73cdb214.fd8154","type":"set","name":"set subnet_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data_length'\n   value='`$aai.l3-network.l3-network[0].subnets.subnet_length`' />\n","comments":"","x":947.3333282470703,"y":2743.919708251953,"z":"bddd9a6f.337e6","wires":[]},{"id":"9f01dbdc.6a2aa","type":"set","name":"set availability-zones.max-count and length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.max-count'\n   value='`$db.vf-model.avail-zone-max-count`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.availability-zone_length'\n   value='`$aai.az.availability-zone_length`' />\n","comments":"","x":590.0000610351562,"y":3156.6342582702637,"z":"bddd9a6f.337e6","wires":[]},{"id":"25a5b081.5b45f","type":"set","name":"set vnf-name","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name'\n   value='`$tmp.vnf-name`' />\n","comments":"","x":523.666633605957,"y":1243.9197664260864,"z":"bddd9a6f.337e6","wires":[]},{"id":"9e65c027.44ee98","type":"save","name":"update generic-vnf","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"vnf-name\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name`\" />\n<parameter name=\"prov-status\" value=\"PREPROV\" />\n<parameter name=\"operational-status\" value=\"out-of-service-path\" />\n<parameter name=\"equipment-role\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-role`\" />\n<parameter name=\"model-invariant-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid`\" />\n<parameter name=\"model-version-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid`\" />\n<parameter name=\"model-customization-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-customization-uuid`\" />\n<parameter name=\"selflink\" value=\"`$vnf-object-path`\" />\n","comments":"","outputs":1,"x":510.3333282470703,"y":3366.300033569336,"z":"bddd9a6f.337e6","wires":[["3f1eaaf4.a88ef6","c0acf086.0388c"]]},{"id":"3a0a0662.a0965a","type":"set","name":"set vnf-object-path","xml":"<set>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vnf-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology'`\"/>\n\n","comments":"","x":510.33336639404297,"y":3296.30051612854,"z":"bddd9a6f.337e6","wires":[]},{"id":"a5e3b389.180a58","type":"set","name":"set vnf-id","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id'\n   value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n","comments":"","x":511.9999771118164,"y":1195.5863094329834,"z":"bddd9a6f.337e6","wires":[]},{"id":"38b60eff.ce6272","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bgb-viprend.log' />\n","comments":"","outputs":1,"x":488.00009536743164,"y":3547.967363357544,"z":"bddd9a6f.337e6","wires":[[]]},{"id":"b15af478.de8cd","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":1433.666805267334,"y":3232.9671211242676,"z":"bddd9a6f.337e6","wires":[]},{"id":"db875f44.a9e568","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1246.3573722839355,"y":3189.919590950012,"z":"bddd9a6f.337e6","wires":[["605e6c2a.f50c34"]]},{"id":"de1a21e7.7779d8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1254.9288024902344,"y":3234.205304145813,"z":"bddd9a6f.337e6","wires":[["b15af478.de8cd"]]},{"id":"605e6c2a.f50c34","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating generic-vnf in AAI\" />\n","comments":"","x":1436.3573989868164,"y":3189.729326248169,"z":"bddd9a6f.337e6","wires":[]},{"id":"756184e9.f9e6ac","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":913.6667442321777,"y":3387.967043876648,"z":"bddd9a6f.337e6","wires":[]},{"id":"3f1eaaf4.a88ef6","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":726.3573112487793,"y":3344.9195137023926,"z":"bddd9a6f.337e6","wires":[["7ddf4740.e5a35"]]},{"id":"c0acf086.0388c","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":734.9287414550781,"y":3389.2052268981934,"z":"bddd9a6f.337e6","wires":[["756184e9.f9e6ac"]]},{"id":"7ddf4740.e5a35","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating selflink in generic-vnf in AAI\" />\n","comments":"","x":916.3573379516602,"y":3344.7292490005493,"z":"bddd9a6f.337e6","wires":[]},{"id":"85e9a83.dd89d58","type":"set","name":"set model-customization-uuid","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-customization-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n","comments":"","x":575.3332977294922,"y":1647.2529134750366,"z":"bddd9a6f.337e6","wires":[]},{"id":"2be4ba9c.c02146","type":"execute","name":"split related-link","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split'>\n   <parameter name='ctx_memory_result_key' value='aai-uid-split' />\n   <parameter name='original_string' value='`$aai.cloud-region.relationship-list.relationship[$idx].related-link`' />\n   <parameter name='regex' value='/' />\n","comments":"","outputs":1,"x":1340.6665954589844,"y":1768.6664972305298,"z":"bddd9a6f.337e6","wires":[[]]},{"id":"e4107e03.5dfa","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1160.3332977294922,"y":1815.333285331726,"z":"bddd9a6f.337e6","wires":[["2be4ba9c.c02146","4f8598ab.f9ffd","c405572b.f9bb3"]]},{"id":"c405572b.f9bb3","type":"break","name":"break","xml":"<break>\n","comments":"","x":1310.3332595825195,"y":1858.666582107544,"z":"bddd9a6f.337e6","wires":[]},{"id":"17f34860.26dd28","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":822,"y":3067.7143869400024,"z":"bddd9a6f.337e6","wires":[["7e453d1b.116fbc","ba597b5f.d72168"]]},{"id":"ba597b5f.d72168","type":"save","name":"save generic-vnf availability-zone relationship","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf:relationship-list\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"availability-zone\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"cloud-region.cloud-owner\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"CloudOwner\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-key\" value=\"cloud-region.cloud-region-id\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-value\" value=\"`$vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-key\" value=\"availability-zone.availability-zone-name\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-value\" value=\"`$aai.az.availability-zone[$idx].availability-zone-name`\" />\n","comments":"","outputs":1,"x":1113.9048156738281,"y":3091.0478343963623,"z":"bddd9a6f.337e6","wires":[["da229e14.cd6ac","a1d97ec8.e6b0a"]]},{"id":"d362c531.8d4fa","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":1567.47607421875,"y":3114.9671936035156,"z":"bddd9a6f.337e6","wires":[]},{"id":"da229e14.cd6ac","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1380.1666412353516,"y":3071.9196634292603,"z":"bddd9a6f.337e6","wires":[["f48e5eb5.1a44c"]]},{"id":"a1d97ec8.e6b0a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1388.7380714416504,"y":3116.205376625061,"z":"bddd9a6f.337e6","wires":[["d362c531.8d4fa"]]},{"id":"f48e5eb5.1a44c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating generic-vnf in AAI\" />\n","comments":"","x":1570.1666679382324,"y":3071.729398727417,"z":"bddd9a6f.337e6","wires":[]},{"id":"424ff6e7.447f38","type":"set","name":"set mapping rows to 0","xml":"<set>\n<parameter name='db.vf-network-role-mapping_length' value='0' />\n","comments":"","x":1134.1427688598633,"y":2061.52388381958,"z":"bddd9a6f.337e6","wires":[]},{"id":"63a54164.66f868","type":"switchNode","name":"switch AAI availability-zone_length","xml":"<switch test='`$aai.az.availability-zone_length`'>\n","comments":"","outputs":1,"x":562.7142868041992,"y":2971.523973464966,"z":"bddd9a6f.337e6","wires":[["9424bf87.6be6f8"]]},{"id":"9424bf87.6be6f8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":781.2857055664062,"y":2971.0953826904297,"z":"bddd9a6f.337e6","wires":[["723df01e.6c44e"]]},{"id":"c1bab72c.315e3","type":"set","name":"set availability-zone_length to 0","xml":"<set>\n<parameter name='aai.az.availability-zone_length' value='0' />\n","comments":"","x":1382.7143478393555,"y":2989.6666202545166,"z":"bddd9a6f.337e6","wires":[]},{"id":"723df01e.6c44e","type":"switchNode","name":"switch AZ max count > 0","xml":"<switch test='`$db.vf-model.avail-zone-max-count &gt; 0`'>\n","comments":"","outputs":1,"x":969.857177734375,"y":2971.5236945152283,"z":"bddd9a6f.337e6","wires":[["5453ed6.037eb94","35d0ba7f.16dcde"]]},{"id":"5453ed6.037eb94","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1172.7142848968506,"y":2945.8094444274902,"z":"bddd9a6f.337e6","wires":[["e0f0183f.4a7aa"]]},{"id":"35d0ba7f.16dcde","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1174.1429061889648,"y":2990.0951919555664,"z":"bddd9a6f.337e6","wires":[["c1bab72c.315e3"]]},{"id":"e0f0183f.4a7aa","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No availability zones found in AAI for cloud region '\n       + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n","comments":"","x":1324.142822265625,"y":2945.5238494873047,"z":"bddd9a6f.337e6","wires":[]},{"id":"a56a9b32.b2955","type":"get-resource","name":"get-resource availability zones","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"availability-zones\" \n\t\tkey=\"cloud-region.cloud-owner = 'CloudOwner' AND \n\t\t     cloud-region.cloud-region-id = $vnf-topology-operation-input.vnf-request-input.aic-cloud-region AND\n\t\t     depth='0'\"\n        pfx='aai.az' local-only='false' >\n\n","comments":"","outputs":1,"x":572.7143096923828,"y":1898.4286441802979,"z":"bddd9a6f.337e6","wires":[["95743078.3aaac"]]},{"id":"95743078.3aaac","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":797.9605255126953,"y":1897.829496383667,"z":"bddd9a6f.337e6","wires":[["47f06ce2.dcce6c"]]},{"id":"47f06ce2.dcce6c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving availability zones from AAI\" />\n","comments":"","x":971.7104644775391,"y":1896.5796184539795,"z":"bddd9a6f.337e6","wires":[]}]