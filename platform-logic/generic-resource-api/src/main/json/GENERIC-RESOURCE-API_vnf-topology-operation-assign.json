[{"id":"fc72a566.b030f8","type":"dgstart","name":"DGSTART","outputs":1,"x":114.28571319580078,"y":82.17556571960449,"z":"be5d0074.91504","wires":[["d7ff7ece.9b8e2"]]},{"id":"d7ff7ece.9b8e2","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":229.57141876220703,"y":124.0803451538086,"z":"be5d0074.91504","wires":[["86d59967.1a7618"]]},{"id":"86d59967.1a7618","type":"method","name":"method vnf-topology-operation-assign","xml":"<method rpc='vnf-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":202.38101959228516,"y":166.84222888946533,"z":"be5d0074.91504","wires":[["f09bed97.7d31e"]]},{"id":"f954a196.dc25a","type":"comment","name":"vnf-topology-operation-assign","info":"","comments":"","x":490.2972412109375,"y":31.428569793701172,"z":"be5d0074.91504","wires":[]},{"id":"e5ad0d66.70637","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vnf-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":500.66666412353516,"y":315.31839752197266,"z":"be5d0074.91504","wires":[["5916492b.857218","c1cdea93.bfa138"]]},{"id":"5916492b.857218","type":"outcome","name":"CreateVnfInstance","xml":"<outcome value='CreateVnfInstance'>\n","comments":"","outputs":1,"x":754.3809585571289,"y":292.4612789154053,"z":"be5d0074.91504","wires":[["391acb58.1c59b4"]]},{"id":"c1cdea93.bfa138","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":716.3809242248535,"y":338.1756067276001,"z":"be5d0074.91504","wires":[["f4427afa.1c8c48"]]},{"id":"391acb58.1c59b4","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":939.2380867004395,"y":292.4613084793091,"z":"be5d0074.91504","wires":[[]]},{"id":"f4427afa.1c8c48","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'assign' then request-action must be 'CreateVnfInstance'\" />\n","comments":"","x":956.380931854248,"y":338.1755647659302,"z":"be5d0074.91504","wires":[]},{"id":"7362746e.83534c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":172.02385711669922,"y":3364.199432373047,"z":"be5d0074.91504","wires":[["320c139b.584b8c","bf64681.3327098","3decabb0.b19304","dfde25aa.22eb48","b3fdadba.ac878","9295f3a8.889f","6652c3ec.51eebc","8297bb69.b2a948","e85c7ed0.15ed6","986025fa.476b28","adadb322.2ebc2","4a499d99.17dc24","f6338637.0f4ab8","4abfb941.f3ffe8","c49cd790.366c28","af081865.1577e8","5b608bb1.3093a4","b8bea347.ec5d","e79aac59.803e","a7739265.64c59","352a2229.74292e","74128bae.fef6c4","a5a33888.67fae8","9393d0c7.d77e9","e6df8bdc.9062b8","9dcdbace.684eb8","fc6ad87e.cad2c8","bd2ebb93.969ad8","9523ee9.421ab1","59afdec8.0d6fc","2c4a61bc.2ff89e","58eda9a2.3858f8","e984610a.8e6fd","7a50c9f.bf28538"]]},{"id":"95e7dc2c.60081","type":"get-resource","name":"get-resource VF_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODEL WHERE customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-model'>\n\n","comments":"","outputs":1,"x":512.9999694824219,"y":406.4612674713135,"z":"be5d0074.91504","wires":[["84af2cd0.e814a","c4d8b439.0a4f08"]]},{"id":"b7c7ad28.59134","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No model found for VNF customization UUID ' + $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`\" />\n","comments":"","x":954.4284477233887,"y":429.8897533416748,"z":"be5d0074.91504","wires":[]},{"id":"84af2cd0.e814a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":713.7856674194336,"y":386.8421049118042,"z":"be5d0074.91504","wires":[["47443e13.3d07b"]]},{"id":"c4d8b439.0a4f08","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":722.3570976257324,"y":431.127818107605,"z":"be5d0074.91504","wires":[["b7c7ad28.59134"]]},{"id":"47443e13.3d07b","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODEL table\" />\n","comments":"","x":953.7856483459473,"y":384.98501205444336,"z":"be5d0074.91504","wires":[]},{"id":"320c139b.584b8c","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":546.666633605957,"y":1157.4137020111084,"z":"be5d0074.91504","wires":[["10c4a3ac.27e12c","7ee20af4.b60b24"]]},{"id":"10c4a3ac.27e12c","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":772.3809623718262,"y":1124.556489944458,"z":"be5d0074.91504","wires":[["15231b53.df2ce5"]]},{"id":"15231b53.df2ce5","type":"set","name":"set vnf-index=0","xml":"<set>\n<parameter name='vnf-index' value='0' />\n","comments":"","x":936.6666831970215,"y":1123.556568145752,"z":"be5d0074.91504","wires":[]},{"id":"7ee20af4.b60b24","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":773.8095245361328,"y":1188.8423080444336,"z":"be5d0074.91504","wires":[["ce5c34bd.216b68"]]},{"id":"4125e058.075d9","type":"set","name":"set vnf-index = vnf_length","xml":"<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n","comments":"","x":1112.6666793823242,"y":1167.1279964447021,"z":"be5d0074.91504","wires":[]},{"id":"75e24b9d.3e0b14","type":"for","name":"for each existing VNF","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":1098.0951919555664,"y":1213.127935409546,"z":"be5d0074.91504","wires":[["1888808a.4f9fff"]]},{"id":"ce5c34bd.216b68","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":909.5237846374512,"y":1188.8422737121582,"z":"be5d0074.91504","wires":[["4125e058.075d9","75e24b9d.3e0b14"]]},{"id":"1888808a.4f9fff","type":"switchNode","name":"switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n","comments":"","outputs":1,"x":1452.380958557129,"y":1212.6994152069092,"z":"be5d0074.91504","wires":[["f2252759.7fe8e8"]]},{"id":"f2252759.7fe8e8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1746.6667137145996,"y":1212.270899772644,"z":"be5d0074.91504","wires":[["e8e7a328.f78eb"]]},{"id":"e8e7a328.f78eb","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists'`\" />\n","comments":"","x":1895.2380752563477,"y":1212.2708473205566,"z":"be5d0074.91504","wires":[]},{"id":"b5747a8b.62e2a8","type":"comment","name":"make sure this VNF doesn't exist already","info":"","comments":"","x":1439.5236892700195,"y":1170.270845413208,"z":"be5d0074.91504","wires":[]},{"id":"bf64681.3327098","type":"set","name":"set vnf-topology data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-id'\n value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-type'\n value='`$vnf-topology-operation-input.vnf-information.vnf-type`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-type'\n value='`$db.vf-model.nf-type`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-role'\n value='`$db.vf-model.nf-role`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-function'\n value='`$db.vf-model.nf-function`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-code'\n value='`$db.vf-model.nf-code`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.tenant'\n value='`$vnf-topology-operation-input.vnf-request-input.tenant`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-cloud-region'\n value='`$vnf-topology-operation-input.vnf-request-input.aic-cloud-region`' />\n \n","comments":"","x":512.380916595459,"y":1689.0804691314697,"z":"be5d0074.91504","wires":[]},{"id":"3decabb0.b19304","type":"switchNode","name":"switch input vnf-name","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.vnf-name`'>\n","comments":"","outputs":1,"x":524.8809356689453,"y":2051.199526786804,"z":"be5d0074.91504","wires":[["5709eb79.187104","cfdd3602.799058"]]},{"id":"dfde25aa.22eb48","type":"get-resource","name":"get-resource cloud region","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"cloud-region\" \n\t\tkey=\"cloud-region.cloud-owner = $prop.cloud-region.cloud-owner AND \n\t\t     cloud-region.cloud-region-id = $vnf-topology-operation-input.vnf-request-input.aic-cloud-region AND\n\t\t     depth='all'\"\n        pfx='aai.cloud-region' local-only='false' >\n\n","comments":"","outputs":1,"x":557.0238800048828,"y":2947.1992626190186,"z":"be5d0074.91504","wires":[["c639d1a9.1cea1","5e574489.17530c"]]},{"id":"5e574489.17530c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":782.2700729370117,"y":2965.350118637085,"z":"be5d0074.91504","wires":[["76478117.63a79"]]},{"id":"fd97eb04.7d1378","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving cloud region from AAI\" />\n","comments":"","x":1083.9367446899414,"y":2965.3501358032227,"z":"be5d0074.91504","wires":[]},{"id":"c639d1a9.1cea1","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":791.1986694335938,"y":2923.6358518600464,"z":"be5d0074.91504","wires":[["8730c02a.4d9e7"]]},{"id":"7181fd4f.3b9314","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Cloud region not found in AAI\" />\n","comments":"","x":1084.2146453857422,"y":2922.9414100646973,"z":"be5d0074.91504","wires":[]},{"id":"b3fdadba.ac878","type":"get-resource","name":"get-resource VF_TO_NETWORK_ROLE_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_TO_NETWORK_ROLE_MAPPING WHERE vf_customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-network-role-mapping[]'>\n\n","comments":"","outputs":1,"x":622.261962890625,"y":3258.2467823028564,"z":"be5d0074.91504","wires":[["e55086cc.fe7c38","bada4af8.48ee18"]]},{"id":"e55086cc.fe7c38","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":918.0476341247559,"y":3236.960947036743,"z":"be5d0074.91504","wires":[["6e98f691.cd8c98"]]},{"id":"bada4af8.48ee18","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":926.6190643310547,"y":3281.246660232544,"z":"be5d0074.91504","wires":[["31b1e600.94057a"]]},{"id":"7d5b4659.62fc88","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_TO_NETWORK_ROLE_MAPPING table\" />\n","comments":"","x":1234.7142581939697,"y":3236.770679473877,"z":"be5d0074.91504","wires":[]},{"id":"7eca1a93.00ad54","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1029.8573684692383,"y":4001.555992126465,"z":"be5d0074.91504","wires":[["aa84ca7f.755948","44cbbbb1.3a7de4","78423903.e2ed08","acfaeeda.3fa36","9940e480.cc5ae8","7c99cdf1.d6d3e4","faee63b4.f8527","6a145c65.18a254","dece7ac8.98c8e8"]]},{"id":"78423903.e2ed08","type":"get-resource","name":"get-resource l3-network","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"l3-networks\" \n\t\tkey=\"l3-network.network-role = $db.vf-network-role-mapping[$role-index].network-role\"\n        pfx='aai.l3-network' local-only='false'\n>\n","comments":"","outputs":1,"x":1286.714443206787,"y":3410.508596420288,"z":"be5d0074.91504","wires":[["d521574d.066048","bddb9f8e.bb902"]]},{"id":"bddb9f8e.bb902","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1490.7621574401855,"y":3432.651435852051,"z":"be5d0074.91504","wires":[["fac96d9.7296c9"]]},{"id":"bf85b613.22da88","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving l3-network from AAI\" />\n","comments":"","x":1805.7621879577637,"y":3432.98477935791,"z":"be5d0074.91504","wires":[]},{"id":"d521574d.066048","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1499.6907539367676,"y":3390.937169075012,"z":"be5d0074.91504","wires":[["15b5633e.00b0bd"]]},{"id":"24c9dca7.afc914","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No active l3-network found in AAI with cloud_region_id '\n          + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region + ' and network_role '\n          + $db.vf-network-role-mapping[$network-index].network-role`\" />\n","comments":"","x":1804.3733835220337,"y":3391.9093055725098,"z":"be5d0074.91504","wires":[]},{"id":"aa84ca7f.755948","type":"set","name":"set vnf-network data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-role'\n    value='`$db.vf-network-role-mapping[$role-index].network-role`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-name'\n    value='`$aai.l3-network.l3-network[$db-network-index].network-name`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].neutron-id'\n    value='`$aai.l3-network.l3-network[$db-network-index].neutron-network-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-id'\n    value='`$aai.l3-network.l3-network[$db-network-index].network-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].contrail-network-fqdn'\n    value='`$aai.l3-network.l3-network[$db-network-index].contrail-network-fqdn`' />\n","comments":"","x":1275.9050331115723,"y":3897.5088396072388,"z":"be5d0074.91504","wires":[]},{"id":"e85c7ed0.15ed6","type":"for","name":"for each cloud-region availability zone","xml":"<for index='idx' start='0' end='`$aai.cloud-region.availability-zones.availability-zone_length`' >\n","comments":"","outputs":1,"x":496.28607177734375,"y":5144.627817153931,"z":"be5d0074.91504","wires":[["55cdaf47.06229"]]},{"id":"61de414e.afb53","type":"set","name":"set availability-zone","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.availability-zone[$idx]'\n  value='`$aai.cloud-region.availability-zones.availability-zone[$idx].availability-zone-name`' />\n","comments":"","x":957.9527549743652,"y":5113.961231231689,"z":"be5d0074.91504","wires":[]},{"id":"986025fa.476b28","type":"set","name":"set vnf-parameters-data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-parameters-data.'\n  value='vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.' />\n","comments":"","x":455.9049987792969,"y":4994.580177307129,"z":"be5d0074.91504","wires":[]},{"id":"788d0393.74592c","type":"save","name":"save generic-vnf l3-network relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf:relationship-list\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$vnf-nw-index].network-id`\" />\n","comments":"","outputs":1,"x":922.4765319824219,"y":5288.390029907227,"z":"be5d0074.91504","wires":[["bf1f1d79.7018b","1454f72a.725d29"]]},{"id":"f6338637.0f4ab8","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":415.7145462036133,"y":5754.00841999054,"z":"be5d0074.91504","wires":[]},{"id":"4a499d99.17dc24","type":"set","name":"set vnf-level-oper-status to PendingCreate","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='PendingCreate' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n","comments":"","x":505.52799224853516,"y":5656.3459005355835,"z":"be5d0074.91504","wires":[]},{"id":"6652c3ec.51eebc","type":"for","name":"for each network-role","xml":"<for silentFailure='true' index='role-index' start='0' end='`$db.vf-network-role-mapping_length`'>","comments":"","outputs":1,"x":489.85730361938477,"y":3974.889660835266,"z":"be5d0074.91504","wires":[["80cab39e.772be"]]},{"id":"9295f3a8.889f","type":"set","name":"set network-index = 0","xml":"<set>\n<parameter name='network-index' value='0' />\n","comments":"","x":524.6904602050781,"y":3312.2945766448975,"z":"be5d0074.91504","wires":[]},{"id":"44cbbbb1.3a7de4","type":"set","name":"increment network-index","xml":"<set>\n<parameter name='network-index' value='`$network-index + 1`' />\n","comments":"","x":1257.9050216674805,"y":4945.2707805633545,"z":"be5d0074.91504","wires":[]},{"id":"8297bb69.b2a948","type":"set","name":"set vnf-network_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network_length'\n  value='`$network-index`' />\n","comments":"","x":454.7620849609375,"y":4944.5802211761475,"z":"be5d0074.91504","wires":[]},{"id":"adadb322.2ebc2","type":"set","name":"copy input data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n","comments":"","x":421.0478210449219,"y":5604.008731842041,"z":"be5d0074.91504","wires":[]},{"id":"4abfb941.f3ffe8","type":"for","name":"for each vnf-network","xml":"<for index='vnf-nw-index' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network_length`' >\n","comments":"","outputs":1,"x":445.4764404296875,"y":5287.389945983887,"z":"be5d0074.91504","wires":[["46f396dd.851888"]]},{"id":"46f396dd.851888","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":649.1430816650391,"y":5287.38990688324,"z":"be5d0074.91504","wires":[["788d0393.74592c"]]},{"id":"c49cd790.366c28","type":"set","name":"set new vnf_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n","comments":"","x":495.30955505371094,"y":1209.4375925064087,"z":"be5d0074.91504","wires":[]},{"id":"af081865.1577e8","type":"for","name":"for each cloud-region relationship","xml":"<for index='idx' start='0' end='`$aai.cloud-region.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":569.8810043334961,"y":3034.437434196472,"z":"be5d0074.91504","wires":[["11d114a7.11d1db"]]},{"id":"11d114a7.11d1db","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship[$idx].related-to`'>\n","comments":"","outputs":1,"x":817.5595474243164,"y":3034.1873636245728,"z":"be5d0074.91504","wires":[["91385fad.fb26d"]]},{"id":"91385fad.fb26d","type":"outcome","name":"complex","xml":"<outcome value='complex'>\n","comments":"","outputs":1,"x":987.023868560791,"y":3033.5801858901978,"z":"be5d0074.91504","wires":[["8ea9283d.520568"]]},{"id":"58064897.8348d8","type":"set","name":"set aic-clli","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-clli'\n  value='`$aai-uid-split[$aai-uid-split_length - 1]`' />\n","comments":"","x":1307.738166809082,"y":3033.2468433380127,"z":"be5d0074.91504","wires":[]},{"id":"5b608bb1.3093a4","type":"switchNode","name":"switch aic-clli","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-clli`'>\n","comments":"","outputs":1,"x":502.9286308288574,"y":3147.5325660705566,"z":"be5d0074.91504","wires":[["666489c1.6451d8"]]},{"id":"666489c1.6451d8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":651.0714645385742,"y":3147.532548904419,"z":"be5d0074.91504","wires":[["b5eeb045.601e6"]]},{"id":"c1a2c00.3db054","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find aic-clli in AAI for aic-cloud-region ' + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n","comments":"","x":941.5476570129395,"y":3148.770594596863,"z":"be5d0074.91504","wires":[]},{"id":"5f373e69.1c378","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid'\n  value='`$db.vf-model.invariant-uuid`' />\n","comments":"","x":929.381175994873,"y":2506.3898229599,"z":"be5d0074.91504","wires":[]},{"id":"f92de18c.da037","type":"for","name":"for each l3-network","xml":"<for index='db-network-index' start='0' end='`$aai.l3-network.l3-network_length`' >\n","comments":"","outputs":1,"x":1396.1670112609863,"y":3722.0802183151245,"z":"be5d0074.91504","wires":[["ad1cc61a.69a3c8"]]},{"id":"88980c13.6b138","type":"switchNode","name":"switch orchestration-status","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].orchestration-status`'>\n","comments":"","outputs":1,"x":1814.738182067871,"y":3656.6516828536987,"z":"be5d0074.91504","wires":[["8046ef6.5d6361","2b1aef5d.2b5eb","7307dfa0.46d7a","b7e26b2.86dc498","ef62ae9c.ffcbb"]]},{"id":"8046ef6.5d6361","type":"outcome","name":"Pending Delete","xml":"<outcome value='Pending Delete'>\n","comments":"","outputs":1,"x":2055.4050521850586,"y":3698.3181867599487,"z":"be5d0074.91504","wires":[["4f9a1482.90979c"]]},{"id":"2b1aef5d.2b5eb","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2028.262191772461,"y":3749.3181676864624,"z":"be5d0074.91504","wires":[["a0a467e4.42d7e8"]]},{"id":"427d1cc0.bee434","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].related-to`'>\n","comments":"","outputs":1,"x":2563.976493835449,"y":3694.5560846328735,"z":"be5d0074.91504","wires":[["1cb8d77e.84dfa9","6a38ac3.c275454"]]},{"id":"a0a467e4.42d7e8","type":"for","name":"for each relationship","xml":"<for silentFailure='true' index='db-rel-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":2198.262104034424,"y":3748.8895444869995,"z":"be5d0074.91504","wires":[["a31baa94.b136c8"]]},{"id":"1cb8d77e.84dfa9","type":"outcome","name":"cloud-region","xml":"<outcome value='cloud-region'>\n","comments":"","outputs":1,"x":2738.262279510498,"y":3717.4609088897705,"z":"be5d0074.91504","wires":[["3bc3eb78.45d084"]]},{"id":"3bc3eb78.45d084","type":"for","name":"for each relationship data","xml":"<for silentFailure='true' index='db-data-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data_length`' >\n","comments":"","outputs":1,"x":2935.4049797058105,"y":3717.88937664032,"z":"be5d0074.91504","wires":[["504faaa9.14ab54"]]},{"id":"504faaa9.14ab54","type":"switchNode","name":"switch relationship-key","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-key`'>\n","comments":"","outputs":1,"x":3166.83358001709,"y":3717.4607515335083,"z":"be5d0074.91504","wires":[["5f887ea8.86a72"]]},{"id":"5f887ea8.86a72","type":"outcome","name":"cloud-region.cloud-region-id","xml":"<outcome value='cloud-region.cloud-region-id'>\n","comments":"","outputs":1,"x":3408.2621459960938,"y":3717.4608478546143,"z":"be5d0074.91504","wires":[["d414e376.8b4e6"]]},{"id":"d414e376.8b4e6","type":"switchNode","name":"switch relationship-value == cloud-region-id","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-value == $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`'>\n","comments":"","outputs":1,"x":3712.548065185547,"y":3717.3179035186768,"z":"be5d0074.91504","wires":[["d7a36632.ac12f8"]]},{"id":"d7a36632.ac12f8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3417.5482025146484,"y":3834.9608573913574,"z":"be5d0074.91504","wires":[["a291152a.934e78"]]},{"id":"acfaeeda.3fa36","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1232.3811836242676,"y":3653.3658628463745,"z":"be5d0074.91504","wires":[["f92de18c.da037","3d04abe8.1b48a4"]]},{"id":"9940e480.cc5ae8","type":"set","name":"set l3-network-id = -1","xml":"<set>\n<parameter name='l3-network-id' value='-1' />\n","comments":"","x":1276.714542388916,"y":3525.270516395569,"z":"be5d0074.91504","wires":[]},{"id":"a291152a.934e78","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3563.3811798095703,"y":3834.436965942383,"z":"be5d0074.91504","wires":[["324a1628.f30e8a","dfefb0c6.308d5","e7b2f268.9efeb"]]},{"id":"324a1628.f30e8a","type":"set","name":"set l3-network-id = this l3-network","xml":"<set>\n<parameter name='l3-network-id' value='`$aai.l3-network.l3-network[$db-network-index].network-id`' />\n","comments":"","x":3798.61918258667,"y":3796.5799350738525,"z":"be5d0074.91504","wires":[]},{"id":"7c99cdf1.d6d3e4","type":"switchNode","name":"switch l3-network-id","xml":"<switch test='`$l3-network-id`'>\n","comments":"","outputs":1,"x":1273.7144660949707,"y":3848.9375581741333,"z":"be5d0074.91504","wires":[["60ad7ff9.df75f"]]},{"id":"60ad7ff9.df75f","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":1443.7144165039062,"y":3848.9373140335083,"z":"be5d0074.91504","wires":[["f42827cf.7bebd8"]]},{"id":"bd21a4ce.761328","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find l3-network in AAI for network role ' + $db.vf-network-role-mapping[$role-index].network-role`\" />\n","comments":"","x":1727.047779083252,"y":3848.937562942505,"z":"be5d0074.91504","wires":[]},{"id":"b8bea347.ec5d","type":"switchNode","name":"switch input model-invariant-uuid","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`'>\n","comments":"","outputs":1,"x":573.2382507324219,"y":2529.2142667770386,"z":"be5d0074.91504","wires":[["cb62cb5c.4fa7c8","883fb8ea.0c5668"]]},{"id":"cb62cb5c.4fa7c8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":778.9049224853516,"y":2506.3572301864624,"z":"be5d0074.91504","wires":[["5f373e69.1c378"]]},{"id":"883fb8ea.0c5668","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":780.3335189819336,"y":2550.6428213119507,"z":"be5d0074.91504","wires":[["974e102f.cb3d3"]]},{"id":"974e102f.cb3d3","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n","comments":"","x":934.619255065918,"y":2550.0713934898376,"z":"be5d0074.91504","wires":[]},{"id":"3c543c1a.6113b4","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid'\n  value='`$db.vf-model.uuid`' />\n","comments":"","x":930.3334465026855,"y":2594.9284992218018,"z":"be5d0074.91504","wires":[]},{"id":"e79aac59.803e","type":"switchNode","name":"switch input model-uuid","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`'>\n","comments":"","outputs":1,"x":545.8572692871094,"y":2617.7530040740967,"z":"be5d0074.91504","wires":[["58af875e.965798","3c85d965.5cbc86"]]},{"id":"58af875e.965798","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":779.8572425842285,"y":2594.895936012268,"z":"be5d0074.91504","wires":[["3c543c1a.6113b4"]]},{"id":"3c85d965.5cbc86","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":781.2858390808105,"y":2639.1815271377563,"z":"be5d0074.91504","wires":[["19910291.706c9d"]]},{"id":"19910291.706c9d","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n","comments":"","x":935.5715751647949,"y":2638.6100993156433,"z":"be5d0074.91504","wires":[]},{"id":"93a12bb2.72bdf8","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-version'\n  value='`$db.vf-model.version`' />\n","comments":"","x":927.4763793945312,"y":2683.7857065200806,"z":"be5d0074.91504","wires":[]},{"id":"a7739265.64c59","type":"switchNode","name":"switch input model-version","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-version`'>\n","comments":"","outputs":1,"x":554.0001411437988,"y":2706.6101512908936,"z":"be5d0074.91504","wires":[["e067afd9.9bc37","29999425.8a840c"]]},{"id":"e067afd9.9bc37","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":777.0001258850098,"y":2683.753113746643,"z":"be5d0074.91504","wires":[["93a12bb2.72bdf8"]]},{"id":"29999425.8a840c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":778.4287223815918,"y":2728.0387048721313,"z":"be5d0074.91504","wires":[["80a13eef.bb832"]]},{"id":"80a13eef.bb832","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-version'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-version`' />\n","comments":"","x":932.7144584655762,"y":2727.4672770500183,"z":"be5d0074.91504","wires":[]},{"id":"c45acb30.4dc358","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-name'\n  value='`$db.vf-model.name`' />\n","comments":"","x":927.4763793945312,"y":2770.9285287857056,"z":"be5d0074.91504","wires":[]},{"id":"352a2229.74292e","type":"switchNode","name":"switch input model-name","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-name`'>\n","comments":"","outputs":1,"x":549.0001411437988,"y":2793.7529735565186,"z":"be5d0074.91504","wires":[["851d518.15311b","26141566.38776a"]]},{"id":"851d518.15311b","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":777.0001258850098,"y":2770.895936012268,"z":"be5d0074.91504","wires":[["c45acb30.4dc358"]]},{"id":"26141566.38776a","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":778.4287223815918,"y":2815.1815271377563,"z":"be5d0074.91504","wires":[["3a99b56f.3b843a"]]},{"id":"3a99b56f.3b843a","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-name'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-name`' />\n","comments":"","x":932.7144584655762,"y":2814.6100993156433,"z":"be5d0074.91504","wires":[]},{"id":"4f9a1482.90979c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2208.6191444396973,"y":3699.095064163208,"z":"be5d0074.91504","wires":[[]]},{"id":"ef62ae9c.ffcbb","type":"outcome","name":"PendingDelete","xml":"<outcome value='PendingDelete'>\n","comments":"","outputs":1,"x":2053.285785675049,"y":3654.0949783325195,"z":"be5d0074.91504","wires":[["a847b1f1.05529"]]},{"id":"a847b1f1.05529","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2208.4998779296875,"y":3654.871855735779,"z":"be5d0074.91504","wires":[[]]},{"id":"b7e26b2.86dc498","type":"outcome","name":"Pending Create","xml":"<outcome value='Pending Create'>\n","comments":"","outputs":1,"x":2055.285785675049,"y":3610.7614822387695,"z":"be5d0074.91504","wires":[["911dd764.0af6d8"]]},{"id":"911dd764.0af6d8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2208.4998779296875,"y":3611.538359642029,"z":"be5d0074.91504","wires":[[]]},{"id":"7307dfa0.46d7a","type":"outcome","name":"PendingCreate","xml":"<outcome value='PendingCreate'>\n","comments":"","outputs":1,"x":2055.285785675049,"y":3567.4282302856445,"z":"be5d0074.91504","wires":[["b2b7ea62.09e978"]]},{"id":"b2b7ea62.09e978","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2208.4998779296875,"y":3568.205107688904,"z":"be5d0074.91504","wires":[[]]},{"id":"705a058a.b98a8c","type":"for","name":"for each A&AI subnet","xml":"<for index='subnet-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet_length`' >\n","comments":"","outputs":1,"x":1741.6668128967285,"y":3988.1423993110657,"z":"be5d0074.91504","wires":[["26bcf61d.39ed8a"]]},{"id":"84cd03b2.470d3","type":"set","name":"set subnet_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data_length'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet_length`' />\n","comments":"","x":1730.3333778381348,"y":4033.142481327057,"z":"be5d0074.91504","wires":[]},{"id":"74128bae.fef6c4","type":"set","name":"set availability-zones.max-count and length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.max-count'\n   value='`$db.vf-model.avail-zone-max-count`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.availability-zone_length'\n   value='`$aai.cloud-region.availability-zones.availability-zone_length`' />\n","comments":"","x":515.9525756835938,"y":5232.6432847976685,"z":"be5d0074.91504","wires":[]},{"id":"a5a33888.67fae8","type":"set","name":"set vnf-name","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name'\n   value='`$tmp.vnf-name`' />\n","comments":"","x":510.1190643310547,"y":2463.2620306015015,"z":"be5d0074.91504","wires":[]},{"id":"9393d0c7.d77e9","type":"save","name":"update generic-vnf","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"vnf-name\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name`\" />\n<parameter name=\"prov-status\" value=\"PREPROV\" />\n<!-- <parameter name=\"operational-status\" value=\"out-of-service-path\" /> -->\n<parameter name=\"equipment-role\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-role`\" />\n<parameter name=\"model-invariant-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid`\" />\n<parameter name=\"model-version-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid`\" />\n<parameter name=\"model-customization-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-customization-uuid`\" />\n<parameter name=\"in-maint\" value=\"true\" />\n<parameter name=\"selflink\" value=\"`$vnf-object-path`\" />\n","comments":"","outputs":1,"x":436.2858428955078,"y":5442.309047698975,"z":"be5d0074.91504","wires":[["d9c5980e.eb83a8","480590e1.d0ad9"]]},{"id":"e6df8bdc.9062b8","type":"set","name":"set vnf-object-path","xml":"<set>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vnf-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology/'`\"/>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vnf-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n","comments":"","x":436.28588104248047,"y":5372.309530258179,"z":"be5d0074.91504","wires":[]},{"id":"9dcdbace.684eb8","type":"set","name":"set vnf-id","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id'\n   value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n","comments":"","x":498.45240783691406,"y":2414.9285736083984,"z":"be5d0074.91504","wires":[]},{"id":"fc6ad87e.cad2c8","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bgb-vnf.log' />\n","comments":"","outputs":1,"x":410.6192741394043,"y":5702.785669326782,"z":"be5d0074.91504","wires":[[]]},{"id":"ec08bcec.3b30e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":1472.9526863098145,"y":5308.975944519043,"z":"be5d0074.91504","wires":[]},{"id":"bf1f1d79.7018b","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1172.309886932373,"y":5265.928605079651,"z":"be5d0074.91504","wires":[["27d38884.173358"]]},{"id":"1454f72a.725d29","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1180.8813171386719,"y":5310.214318275452,"z":"be5d0074.91504","wires":[["4c454b39.b3b144"]]},{"id":"3e53f9d4.705fb6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating generic-vnf in AAI\" />\n","comments":"","x":1475.6432800292969,"y":5265.738149642944,"z":"be5d0074.91504","wires":[]},{"id":"22f19811.37d758","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":907.9526214599609,"y":5462.309480667114,"z":"be5d0074.91504","wires":[]},{"id":"d9c5980e.eb83a8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":610.6431732177734,"y":5420.9286432266235,"z":"be5d0074.91504","wires":[["ee34f26f.d315d"]]},{"id":"480590e1.d0ad9","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":619.2146034240723,"y":5465.214356422424,"z":"be5d0074.91504","wires":[["8ef6f5ea.1df328"]]},{"id":"4db84c3d.411824","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating selflink in generic-vnf in AAI\" />\n","comments":"","x":910.6432151794434,"y":5419.071685791016,"z":"be5d0074.91504","wires":[]},{"id":"bd2ebb93.969ad8","type":"set","name":"set model-customization-uuid","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-customization-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n","comments":"","x":561.7857284545898,"y":2866.5951776504517,"z":"be5d0074.91504","wires":[]},{"id":"6f35740b.7867bc","type":"execute","name":"split related-link","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split'>\n   <parameter name='ctx_memory_result_key' value='aai-uid-split' />\n   <parameter name='original_string' value='`$aai.cloud-region.relationship-list.relationship[$idx].related-link`' />\n   <parameter name='regex' value='/' />\n","comments":"","outputs":1,"x":1327.119026184082,"y":2988.008761405945,"z":"be5d0074.91504","wires":[[]]},{"id":"8ea9283d.520568","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1146.7857284545898,"y":3034.675549507141,"z":"be5d0074.91504","wires":[["6f35740b.7867bc","58064897.8348d8","7b986ac4.ee9cc4"]]},{"id":"7b986ac4.ee9cc4","type":"break","name":"break","xml":"<break>\n","comments":"","x":1296.7856903076172,"y":3078.008846282959,"z":"be5d0074.91504","wires":[]},{"id":"55cdaf47.06229","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":747.9525146484375,"y":5143.723401069641,"z":"be5d0074.91504","wires":[["61de414e.afb53","51a8f712.305ee8"]]},{"id":"51a8f712.305ee8","type":"save","name":"save generic-vnf availability-zone relationship","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf:relationship-list\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"availability-zone\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"cloud-region.cloud-owner\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.cloud-region.cloud-owner`\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-key\" value=\"cloud-region.cloud-region-id\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-value\" value=\"`$vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-key\" value=\"availability-zone.availability-zone-name\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-value\" value=\"`$aai.cloud-region.availability-zones.availability-zone[$idx].availability-zone-name`\" />\n","comments":"","outputs":1,"x":1041.285903930664,"y":5167.056855201721,"z":"be5d0074.91504","wires":[["711bb404.976d3c","66bf2c91.3ad974"]]},{"id":"c18c0d8e.e9c0f","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":1598.428565979004,"y":5190.976183891296,"z":"be5d0074.91504","wires":[]},{"id":"711bb404.976d3c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1306.119155883789,"y":5147.928677558899,"z":"be5d0074.91504","wires":[["eb26162.58114e8"]]},{"id":"66bf2c91.3ad974","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1314.690586090088,"y":5192.2143907547,"z":"be5d0074.91504","wires":[["7ab0197d.e139d8"]]},{"id":"978ac8bf.3e8f28","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating generic-vnf in AAI\" />\n","comments":"","x":1601.1191596984863,"y":5147.738389015198,"z":"be5d0074.91504","wires":[]},{"id":"31b1e600.94057a","type":"set","name":"set mapping rows to 0","xml":"<set>\n<parameter name='db.vf-network-role-mapping_length' value='0' />\n","comments":"","x":1120.595199584961,"y":3280.866147994995,"z":"be5d0074.91504","wires":[]},{"id":"9523ee9.421ab1","type":"switchNode","name":"switch AAI availability-zone_length","xml":"<switch test='`$aai.cloud-region.availability-zones.availability-zone_length`'>\n","comments":"","outputs":1,"x":488.6668014526367,"y":5047.5329875946045,"z":"be5d0074.91504","wires":[["4ac5d11f.7a4fa"]]},{"id":"4ac5d11f.7a4fa","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":707.2382202148438,"y":5047.104396820068,"z":"be5d0074.91504","wires":[["f3cad836.ee2ae8"]]},{"id":"d6a1b0e1.9042e","type":"set","name":"set availability-zone_length to 0","xml":"<set>\n<parameter name='aai.cloud-region.availability-zones.availability-zone_length' value='0' />\n","comments":"","x":1308.666862487793,"y":5065.675634384155,"z":"be5d0074.91504","wires":[]},{"id":"f3cad836.ee2ae8","type":"switchNode","name":"switch AZ max count > 0","xml":"<switch test='`$db.vf-model.avail-zone-max-count &gt; 0`'>\n","comments":"","outputs":1,"x":895.8096923828125,"y":5047.532708644867,"z":"be5d0074.91504","wires":[["fb65358a.19e9b8","d1646588.cb4098"]]},{"id":"fb65358a.19e9b8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1098.666799545288,"y":5021.818458557129,"z":"be5d0074.91504","wires":[["d5bf8b09.cbb7e8"]]},{"id":"d1646588.cb4098","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1100.0954208374023,"y":5066.104206085205,"z":"be5d0074.91504","wires":[["d6a1b0e1.9042e"]]},{"id":"d7cc47f9.e02768","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No availability zones found in AAI for cloud region '\n       + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n","comments":"","x":1390.0953063964844,"y":5019.866150856018,"z":"be5d0074.91504","wires":[]},{"id":"f2cc54c5.7493c8","type":"execute","name":"execute PropertiesNode","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":508.57144927978516,"y":188.60415267944336,"z":"be5d0074.91504","wires":[[]]},{"id":"5709eb79.187104","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":726.9047546386719,"y":1864.6755771636963,"z":"be5d0074.91504","wires":[["d20f8c4c.aaaef"]]},{"id":"6bde2612.3dd418","type":"switchNode","name":"switch ecomp-naming","xml":"<switch test='`$db.vf-model.ecomp-generated-naming`'>\n","comments":"","outputs":1,"x":1104.5241432189941,"y":1765.3900136947632,"z":"be5d0074.91504","wires":[["8d3476a9.1746b8","4f89d2ab.d33efc","e9979aef.402b38"]]},{"id":"d20f8c4c.aaaef","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":872.619255065918,"y":1864.6756944656372,"z":"be5d0074.91504","wires":[["6bde2612.3dd418","fc9752c8.f26a8"]]},{"id":"4f89d2ab.d33efc","type":"outcome","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":1290.9525299072266,"y":1765.8661403656006,"z":"be5d0074.91504","wires":[["2d0f9daa.bc4892"]]},{"id":"2d0f9daa.bc4892","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"No vnf-name was received but ecomp-generated-naming is not Y\" />\n","comments":"","x":1445.2383155822754,"y":1784.4375848770142,"z":"be5d0074.91504","wires":[]},{"id":"8d3476a9.1746b8","type":"outcome","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1290.952522277832,"y":1724.4375944137573,"z":"be5d0074.91504","wires":[["bdd18d45.8079f"]]},{"id":"e9979aef.402b38","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1290.9524688720703,"y":1808.7232723236084,"z":"be5d0074.91504","wires":[["2d0f9daa.bc4892"]]},{"id":"bdd18d45.8079f","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1428.0954399108887,"y":1724.5804615020752,"z":"be5d0074.91504","wires":[[]]},{"id":"cfdd3602.799058","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":712.0954818725586,"y":2219.294753074646,"z":"be5d0074.91504","wires":[["7f164ae2.280aa4"]]},{"id":"7f164ae2.280aa4","type":"set","name":"set tmp.vnf-name","xml":"<set>\n<parameter name='tmp.vnf-name' value=\"`$vnf-topology-operation-input.vnf-information.vnf-name`\" />\n","comments":"","x":877.8574447631836,"y":2218.1520233154297,"z":"be5d0074.91504","wires":[]},{"id":"ccce63ca.12c4d","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":1762.9287223815918,"y":1914.4375138282776,"z":"be5d0074.91504","wires":[["572f952.2f8446c","b26bb6ea.82f758"]]},{"id":"572f952.2f8446c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2040.0715255737305,"y":1888.0090470314026,"z":"be5d0074.91504","wires":[["aefe1dbf.ad7fc"]]},{"id":"b26bb6ea.82f758","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2044.8332710266113,"y":1933.3899579048157,"z":"be5d0074.91504","wires":[["4e0d04fb.4ffd4c"]]},{"id":"809d618b.3699e","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.action' value='ASSIGN' />\n<parameter name='generate-unique-name-input.context-id' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='generate-unique-name-input.index-table-name' value='VNF_NAME_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vnf_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='VNF_INSTANCE' />\n<parameter name='generate-unique-name-input.prefix' value=\"`'z' + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region + $db.vf-model.nf-code`\" />\n","comments":"","x":1717.9289741516113,"y":1865.5328335762024,"z":"be5d0074.91504","wires":[]},{"id":"4e0d04fb.4ffd4c","type":"set","name":"set tmp.vnf-name to generated name","xml":"<set>\n<parameter name='tmp.vnf-name' value='`$generate-unique-name-output.generated-name`' />\n","comments":"","x":2267.7376670837402,"y":1932.86603307724,"z":"be5d0074.91504","wires":[]},{"id":"aefe1dbf.ad7fc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":2193.6429862976074,"y":1887.4375567436218,"z":"be5d0074.91504","wires":[]},{"id":"fc9752c8.f26a8","type":"switchNode","name":"switch naming-policy","xml":"<switch test='`$db.vf-model.naming-policy`'>\n","comments":"","outputs":1,"x":1102.309726715088,"y":1973.675630569458,"z":"be5d0074.91504","wires":[["e81046cf.e30718","c33ad7a8.9551f8"]]},{"id":"e81046cf.e30718","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1292.309658050537,"y":1895.1041851043701,"z":"be5d0074.91504","wires":[["e908e3dd.17c76"]]},{"id":"c33ad7a8.9551f8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1292.5478973388672,"y":2022.4851293563843,"z":"be5d0074.91504","wires":[["17eeb246.7b4dee"]]},{"id":"e908e3dd.17c76","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1445.1669273376465,"y":1893.675651550293,"z":"be5d0074.91504","wires":[["809d618b.3699e","ccce63ca.12c4d"]]},{"id":"5f34736e.da87ac","type":"call","name":"call GENERIC-RESOURCE-API:naming-policy-generate-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='naming-policy-generate-name' mode='sync' >\n","comments":"","outputs":1,"x":1784.2148513793945,"y":2038.199511051178,"z":"be5d0074.91504","wires":[["d4615f91.93833","aa0d10c0.0ed26"]]},{"id":"17eeb246.7b4dee","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1447.0717468261719,"y":2022.4851293563843,"z":"be5d0074.91504","wires":[["2b7b29b.07127d6","5f34736e.da87ac"]]},{"id":"2b7b29b.07127d6","type":"set","name":"set variables for generating name","xml":"<set>\n<parameter name='naming-policy-generate-name-input.policy-instance-name' value='`$db.vf-model.naming-policy`' />\n<parameter name='naming-policy-generate-name-input.naming-type' value='VNF' />\n<parameter name='naming-policy-generate-name-input.context-id' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='naming-policy-generate-name-input.action' value='ASSIGN' />\n<parameter name='naming-policy-generate-name-input.query-parameter' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />","comments":"","x":1694.2147674560547,"y":1992.4851651191711,"z":"be5d0074.91504","wires":[]},{"id":"4a5f4740.237338","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Unable to generate VNF name\" />\n","comments":"","x":2227.0718002319336,"y":2012.0564489364624,"z":"be5d0074.91504","wires":[]},{"id":"26710442.f40cdc","type":"set","name":"set tmp.vnf-name to generated name","xml":"<set>\n<parameter name='tmp.vnf-name' value='`$naming-policy-generate-name-output.vnf-name`' />\n","comments":"","x":2305.5003700256348,"y":2056.7707509994507,"z":"be5d0074.91504","wires":[]},{"id":"eb91c268.10c28","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1988.571159362793,"y":2838.841775894165,"z":"be5d0074.91504","wires":[["ff28928b.062b3","a2fb2a44.e25608"]]},{"id":"a2fb2a44.e25608","type":"call","name":"call GENERIC-RESOURCE-API:naming-policy-generate-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='naming-policy-generate-name' mode='sync' >\n","comments":"","outputs":1,"x":2312.856864929199,"y":2865.4133071899414,"z":"be5d0074.91504","wires":[[]]},{"id":"ff28928b.062b3","type":"set","name":"set variables for deleting name","xml":"<set>\n<parameter name='naming-policy-generate-name-input.naming-type' value='VNF' />\n<parameter name='naming-policy-generate-name-input.context-id' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='naming-policy-generate-name-input.action' value='DELETE' />\n","comments":"","x":2214.285484313965,"y":2818.270378112793,"z":"be5d0074.91504","wires":[]},{"id":"a10bd767.ea4798","type":"comment","name":"Unassign the VNF name","info":"","comments":"","x":2080.237808227539,"y":2758.841877937317,"z":"be5d0074.91504","wires":[]},{"id":"8730c02a.4d9e7","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":928.5714950561523,"y":2923.8420758247375,"z":"be5d0074.91504","wires":[["7181fd4f.3b9314","eb91c268.10c28"]]},{"id":"76478117.63a79","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":926.9047775268555,"y":2965.508828163147,"z":"be5d0074.91504","wires":[["fd97eb04.7d1378","eb91c268.10c28"]]},{"id":"b5eeb045.601e6","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":783.5714492797852,"y":3147.1754579544067,"z":"be5d0074.91504","wires":[["c1a2c00.3db054","eb91c268.10c28"]]},{"id":"6e98f691.cd8c98","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1075.238136291504,"y":3237.1754579544067,"z":"be5d0074.91504","wires":[["7d5b4659.62fc88","eb91c268.10c28"]]},{"id":"15b5633e.00b0bd","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1635.2381553649902,"y":3391.1753253936768,"z":"be5d0074.91504","wires":[["24c9dca7.afc914","eb91c268.10c28"]]},{"id":"fac96d9.7296c9","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1633.5714378356934,"y":3432.842077732086,"z":"be5d0074.91504","wires":[["bf85b613.22da88","eb91c268.10c28"]]},{"id":"f42827cf.7bebd8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1576.9047813415527,"y":3848.8420734405518,"z":"be5d0074.91504","wires":[["bd21a4ce.761328","eb91c268.10c28"]]},{"id":"d5bf8b09.cbb7e8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1233.9048233032227,"y":5020.508767127991,"z":"be5d0074.91504","wires":[["d7cc47f9.e02768","eb91c268.10c28"]]},{"id":"eb26162.58114e8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1453.9048233032227,"y":5148.508767127991,"z":"be5d0074.91504","wires":[["978ac8bf.3e8f28","eb91c268.10c28"]]},{"id":"7ab0197d.e139d8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1452.2381057739258,"y":5192.1755194664,"z":"be5d0074.91504","wires":[["c18c0d8e.e9c0f","eb91c268.10c28"]]},{"id":"27d38884.173358","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1317.2381973266602,"y":5265.508767127991,"z":"be5d0074.91504","wires":[["3e53f9d4.705fb6","eb91c268.10c28"]]},{"id":"4c454b39.b3b144","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1315.5714797973633,"y":5309.1755194664,"z":"be5d0074.91504","wires":[["ec08bcec.3b30e","eb91c268.10c28"]]},{"id":"ee34f26f.d315d","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":763.904857635498,"y":5420.508882522583,"z":"be5d0074.91504","wires":[["4db84c3d.411824","eb91c268.10c28"]]},{"id":"8ef6f5ea.1df328","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":762.2381401062012,"y":5464.175634860992,"z":"be5d0074.91504","wires":[["22f19811.37d758","eb91c268.10c28"]]},{"id":"d4615f91.93833","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2082.3808975219727,"y":2013.1280183792114,"z":"be5d0074.91504","wires":[["4a5f4740.237338"]]},{"id":"aa0d10c0.0ed26","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2087.1426429748535,"y":2058.5089292526245,"z":"be5d0074.91504","wires":[["26710442.f40cdc"]]},{"id":"7b71c44b.6d928c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":737.6189956665039,"y":1368.0952367782593,"z":"be5d0074.91504","wires":[["692dc4cc.06594c","ad3abca7.574a4"]]},{"id":"59afdec8.0d6fc","type":"for","name":"for each instance group id","xml":"<for silentFailure='true' index='inst-group-index' start='0' end='`$vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids_length`' >\n","comments":"","outputs":1,"x":520.9523429870605,"y":1368.761881828308,"z":"be5d0074.91504","wires":[["7b71c44b.6d928c"]]},{"id":"692dc4cc.06594c","type":"get-resource","name":"get-resource instance-group","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"instance-group\" \n\t\tkey=\"instance-group.id = $vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id\"\n        pfx='aai.instance-group' local-only='false' >\n\n","comments":"","outputs":1,"x":968.9523544311523,"y":1291.4286184310913,"z":"be5d0074.91504","wires":[["44a92d04.daaea4","2937e52b.43293a"]]},{"id":"2937e52b.43293a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1183.1985626220703,"y":1309.5794668197632,"z":"be5d0074.91504","wires":[["8fda8fc0.0688e"]]},{"id":"44a92d04.daaea4","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1192.1271591186523,"y":1267.8652000427246,"z":"be5d0074.91504","wires":[["35f13cd1.8e7824"]]},{"id":"35f13cd1.8e7824","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Cannot find instance group id ' +\n      $vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id\n      + ' in AAI'`\" />\n","comments":"","x":1364.9523696899414,"y":1265.4286108016968,"z":"be5d0074.91504","wires":[]},{"id":"8fda8fc0.0688e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving instance-group from AAI\" />\n","comments":"","x":1364.9523696899414,"y":1309.4286108016968,"z":"be5d0074.91504","wires":[]},{"id":"ad3abca7.574a4","type":"for","name":"for each relationship","xml":"<for index='rel-index' start='0' end='`$aai.instance-group.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":942.619010925293,"y":1439.7619342803955,"z":"be5d0074.91504","wires":[["12d4f1e6.ff3a3e"]]},{"id":"12d4f1e6.ff3a3e","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.instance-group.relationship-list.relationship[$rel-index].related-to`'>\n","comments":"","outputs":1,"x":1155.9524536132812,"y":1439.7618732452393,"z":"be5d0074.91504","wires":[["71a5792c.8ec168"]]},{"id":"71a5792c.8ec168","type":"outcome","name":"collection","xml":"<outcome value='collection'>\n","comments":"","outputs":1,"x":1327.6190910339355,"y":1439.7619552612305,"z":"be5d0074.91504","wires":[["e8dfecae.87983"]]},{"id":"e8dfecae.87983","type":"get-resource","name":"get-resource collection","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"collection\" \n\t\tkey=\"collection.collection-id = $aai.instance-group.relationship-list.relationship[$rel-index].relationship-data[0].relationship-value\"\n        pfx='aai.collection' local-only='false' >\n\n","comments":"","outputs":1,"x":1547.618995666504,"y":1438.0952167510986,"z":"be5d0074.91504","wires":[["7605232d.b437ec","c8628f19.c65e4","e8719477.a58328"]]},{"id":"c8628f19.c65e4","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1761.8651885986328,"y":1389.579405784607,"z":"be5d0074.91504","wires":[["9f1118db.4a84c8"]]},{"id":"7605232d.b437ec","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1770.7937850952148,"y":1347.8651390075684,"z":"be5d0074.91504","wires":[["7bca285f.557c98"]]},{"id":"7bca285f.557c98","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Cannot find collection ' +\n      $aai.instance-group.relationship-list.relationship[$rel-index].relationship-data[0].relationship-value\n      + ' in AAI'`\" />\n","comments":"","x":1927.618995666504,"y":1346.4286108016968,"z":"be5d0074.91504","wires":[]},{"id":"9f1118db.4a84c8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"System error retrieving collection from AAI\" />\n","comments":"","x":1927.618995666504,"y":1390.4286108016968,"z":"be5d0074.91504","wires":[]},{"id":"e8719477.a58328","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1760.9523963928223,"y":1526.4285821914673,"z":"be5d0074.91504","wires":[["6f40d450.f9ee5c"]]},{"id":"6f40d450.f9ee5c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1914.2855377197266,"y":1525.7618780136108,"z":"be5d0074.91504","wires":[["edf05ef0.1dd5e","b0242e5b.93cc7","87b9eedb.3dc8d","42a9ebf.50fbd14","8b30506e.9482a"]]},{"id":"edf05ef0.1dd5e","type":"for","name":"for each network-instance-group","xml":"<for silentFailure='true' index='nig-index' start='0' end='`$service-data.network-instance-groups.network-instance-group_length`' >\n","comments":"","outputs":1,"x":2152.618881225586,"y":1476.4286260604858,"z":"be5d0074.91504","wires":[["9e5b6c89.d1809"]]},{"id":"b0242e5b.93cc7","type":"set","name":"set found-network-instance-group to false","xml":"<set>\n<parameter name='found-network-instance-group' value='false' />\n","comments":"","x":2182.6188430786133,"y":1429.7619981765747,"z":"be5d0074.91504","wires":[]},{"id":"9e5b6c89.d1809","type":"switchNode","name":"network-instance-group-id matches?","xml":"<switch test='`$vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id\n  == $service-data.network-instance-groups.network-instance-group[$nig-index].network-instance-group-id`'>\n","comments":"","outputs":1,"x":2469.2853927612305,"y":1476.4286251068115,"z":"be5d0074.91504","wires":[["abc51c7b.c7ef5"]]},{"id":"abc51c7b.c7ef5","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2690.9521713256836,"y":1476.4285898208618,"z":"be5d0074.91504","wires":[["1dbe3fe2.e99a9"]]},{"id":"1dbe3fe2.e99a9","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2820.9522018432617,"y":1476.4286661148071,"z":"be5d0074.91504","wires":[["3e368576.b8d45a","5c2a9090.033f1"]]},{"id":"3e368576.b8d45a","type":"set","name":"set found-network-instance-group to true","xml":"<set>\n<parameter name='found-network-instance-group' value='true' />\n","comments":"","x":3054.2853775024414,"y":1448.0952911376953,"z":"be5d0074.91504","wires":[]},{"id":"5c2a9090.033f1","type":"break","name":"break","xml":"<break>\n","comments":"","x":2947.6189918518066,"y":1496.4286613464355,"z":"be5d0074.91504","wires":[]},{"id":"87b9eedb.3dc8d","type":"switchNode","name":"switch found-network-instance-group","xml":"<switch test='`$found-network-instance-group`'>\n","comments":"","outputs":1,"x":2164.285499572754,"y":1526.4286069869995,"z":"be5d0074.91504","wires":[["aafceefd.beca3"]]},{"id":"aafceefd.beca3","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2385.952346801758,"y":1526.428629398346,"z":"be5d0074.91504","wires":[["84852ec8.853e3"]]},{"id":"84852ec8.853e3","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Could not find network instance group ' +\n      $vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id\n      + ' in MD-SAL'`\" />\n","comments":"","x":2532.6189193725586,"y":1524.7619638442993,"z":"be5d0074.91504","wires":[]},{"id":"2c4a61bc.2ff89e","type":"set","name":"set tmp.vnf-network-collection_length to 0","xml":"<set>\n<parameter name='tmp.vnf-network-collection_length' value='0' />\n","comments":"","x":569.2856826782227,"y":1319.7620134353638,"z":"be5d0074.91504","wires":[]},{"id":"42a9ebf.50fbd14","type":"set","name":"set vnf-network-collection data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection[$tmp.vnf-network-collection_length].network-instance-group-function'\n  value='`$aai.instance-group.instance-group-function`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection[$tmp.vnf-network-collection_length].network-instance-group-id'\n  value='`$aai.instance-group.id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection[$tmp.vnf-network-collection_length].network-collection-service-instance-id'\n  value='`$service-data.network-instance-groups.network-instance-group[$nig-index].service-instance-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection[$tmp.vnf-network-collection_length].network-collection-customization-uuid'\n  value='`$aai.collection.collection-customization-id`' />\n","comments":"","x":2144.2858238220215,"y":1574.7619428634644,"z":"be5d0074.91504","wires":[]},{"id":"8b30506e.9482a","type":"set","name":"increment tmp.vnf-network-collection_length","xml":"<set>\n<parameter name='tmp.vnf-network-collection_length' value='`$tmp.vnf-network-collection_length + 1`' />\n","comments":"","x":2185.9525299072266,"y":1621.4286108016968,"z":"be5d0074.91504","wires":[]},{"id":"58eda9a2.3858f8","type":"set","name":"set vnf-network-collection_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection_length'\n  value='`$tmp.vnf-network-collection_length`' />\n","comments":"","x":548.4523773193359,"y":1577.261962890625,"z":"be5d0074.91504","wires":[]},{"id":"c7bb3006.7fea2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":672.952465057373,"y":5536.904908180237,"z":"be5d0074.91504","wires":[["88fe44bc.b20cb8"]]},{"id":"e984610a.8e6fd","type":"for","name":"for each instance group id","xml":"<for silentFailure='true' index='inst-group-index' start='0' end='`$vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids_length`' >\n","comments":"","outputs":1,"x":456.2858123779297,"y":5537.571553230286,"z":"be5d0074.91504","wires":[["c7bb3006.7fea2"]]},{"id":"88fe44bc.b20cb8","type":"save","name":"save generic-vnf relationship to instance-group","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf:relationship-list\"\n   key=\"generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-information.vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"instance-group\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/network/instance-groups/instance-group/'\n        + $vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id`\" />\n","comments":"","outputs":1,"x":956.2857933044434,"y":5536.4285888671875,"z":"be5d0074.91504","wires":[["b08af364.cb3cc","c5b433d3.c28c9"]]},{"id":"e848e15d.68a83","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":1512.952465057373,"y":5554.761841773987,"z":"be5d0074.91504","wires":[]},{"id":"b08af364.cb3cc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1215.6430168151855,"y":5513.381004333496,"z":"be5d0074.91504","wires":[["1e05cc88.527fb3"]]},{"id":"c5b433d3.c28c9","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1224.2144470214844,"y":5557.666717529297,"z":"be5d0074.91504","wires":[["af381b33.81f6e8"]]},{"id":"1830abef.3e2ad4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating relationship in generic-vnf in AAI\" />\n","comments":"","x":1515.64306640625,"y":5511.5241050720215,"z":"be5d0074.91504","wires":[]},{"id":"1e05cc88.527fb3","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1368.9047012329102,"y":5512.961243629456,"z":"be5d0074.91504","wires":[["1830abef.3e2ad4","eb91c268.10c28"]]},{"id":"af381b33.81f6e8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1367.2379837036133,"y":5556.627995967865,"z":"be5d0074.91504","wires":[["e848e15d.68a83","eb91c268.10c28"]]},{"id":"faee63b4.f8527","type":"switchNode","name":"switch subnet_length","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet_length`'>\n","comments":"","outputs":1,"x":1277.8572120666504,"y":3969.523956298828,"z":"be5d0074.91504","wires":[["c04597b.b1aa868","58e8fb8e.ae1534","12f9127e.1a58ce"]]},{"id":"c04597b.b1aa868","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1450.7143745422363,"y":3932.381015777588,"z":"be5d0074.91504","wires":[["4b6d60ec.1203c"]]},{"id":"58e8fb8e.ae1534","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":1452.1429443359375,"y":3970.952178955078,"z":"be5d0074.91504","wires":[["4b6d60ec.1203c"]]},{"id":"12f9127e.1a58ce","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1450.7144088745117,"y":4009.5235710144043,"z":"be5d0074.91504","wires":[["e69e985e.2e9298"]]},{"id":"e69e985e.2e9298","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1572.1429634094238,"y":4009.523838043213,"z":"be5d0074.91504","wires":[["705a058a.b98a8c","84cd03b2.470d3"]]},{"id":"4b6d60ec.1203c","type":"set","name":"set subnet_length to 0","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data_length'\n   value='0' />\n","comments":"","x":1643.5715675354004,"y":3940.952178955078,"z":"be5d0074.91504","wires":[]},{"id":"c662231.39140e","type":"call","name":"call self-serve-vnf-assign","xml":"<call module='GENERIC-RESOURCE-API' rpc='self-serve-vnf-assign' mode='sync' >\n","comments":"","outputs":1,"x":1138.2576904296875,"y":567.7025542259216,"z":"be5d0074.91504","wires":[["97aac06d.eeb83"]]},{"id":"e2e6067.ebb3cf8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Failed to create self-serve assignment for vnf with vnf-id=' + $vnf-topology-operation-input.vnf-information.vnf-id + ' with error: ' + $error-message`\" />\n","comments":"","x":1522.3290672302246,"y":567.7025046348572,"z":"be5d0074.91504","wires":[]},{"id":"eff2987e.a77eb8","type":"comment","name":"SELF-SERVE FORK","info":"","comments":"","x":869.1270141601562,"y":590.1548004150391,"z":"be5d0074.91504","wires":[]},{"id":"97aac06d.eeb83","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1343.5552711486816,"y":567.1905856132507,"z":"be5d0074.91504","wires":[["e2e6067.ebb3cf8"]]},{"id":"f09bed97.7d31e","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":254.36508178710938,"y":407.04765033721924,"z":"be5d0074.91504","wires":[["f2cc54c5.7493c8","e5ad0d66.70637","95e7dc2c.60081","b07f3957.23cee8","575233c8.305a6c","e450a9d4.f6b6a8"]]},{"id":"26bcf61d.39ed8a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1913.3334197998047,"y":3988.1280336380005,"z":"be5d0074.91504","wires":[["60076dea.ddca64","95a8bc37.de49c","23fb5171.228f8e","b90fa041.aaba2"]]},{"id":"6a145c65.18a254","type":"set","name":"clear aai.l3-network","xml":"<set>\n<parameter name='aai.l3-network.' value='' />\n","comments":"","x":1271.9048652648926,"y":3360.985152244568,"z":"be5d0074.91504","wires":[]},{"id":"dfefb0c6.308d5","type":"break","name":"break","xml":"<break>\n","comments":"","x":3713.6188011169434,"y":3888.127716064453,"z":"be5d0074.91504","wires":[]},{"id":"3d04abe8.1b48a4","type":"set","name":"set found-network to false","xml":"<set>\n<parameter name='found-network' value='false' />\n","comments":"","x":1413.3333930969238,"y":3593.8421201705933,"z":"be5d0074.91504","wires":[]},{"id":"a31baa94.b136c8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2385.0476989746094,"y":3748.1279163360596,"z":"be5d0074.91504","wires":[["427d1cc0.bee434","5549edaf.7acea4"]]},{"id":"5549edaf.7acea4","type":"switchNode","name":"switch found-network","xml":"<switch test='`$found-network`'>\n","comments":"","outputs":1,"x":2576.476245880127,"y":3778.1279706954956,"z":"be5d0074.91504","wires":[["36f14756.ae8f48"]]},{"id":"e7b2f268.9efeb","type":"set","name":"set found-network to true","xml":"<set>\n<parameter name='found-network' value='true' />\n","comments":"","x":3769.3336791992188,"y":3842.413396835327,"z":"be5d0074.91504","wires":[]},{"id":"36f14756.ae8f48","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2745.047737121582,"y":3778.127900123596,"z":"be5d0074.91504","wires":[["d5854119.b6b79"]]},{"id":"d5854119.b6b79","type":"break","name":"break","xml":"<break>\n","comments":"","x":2875.047805786133,"y":3776.699294090271,"z":"be5d0074.91504","wires":[]},{"id":"ad1cc61a.69a3c8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1585.3334159851074,"y":3721.84219455719,"z":"be5d0074.91504","wires":[["88980c13.6b138","9afc419a.5b34a"]]},{"id":"9afc419a.5b34a","type":"switchNode","name":"switch found-network","xml":"<switch test='`$found-network`'>\n","comments":"","outputs":1,"x":1795.3333702087402,"y":3793.8420782089233,"z":"be5d0074.91504","wires":[["f66a4612.6df9f8"]]},{"id":"f66a4612.6df9f8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1963.9048614501953,"y":3793.842007637024,"z":"be5d0074.91504","wires":[["a1bada83.a833c8"]]},{"id":"a1bada83.a833c8","type":"break","name":"break","xml":"<break>\n","comments":"","x":2093.904930114746,"y":3792.4134016036987,"z":"be5d0074.91504","wires":[]},{"id":"f70af5d8.815968","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1110.6666259765625,"y":721.8571219444275,"z":"be5d0074.91504","wires":[]},{"id":"cddbc37f.04216","type":"set","name":"set vnf-level-oper-status to PendingCreate","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='PendingCreate' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n","comments":"","x":1192.4800720214844,"y":619.1946024894714,"z":"be5d0074.91504","wires":[]},{"id":"304e9350.13a68c","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/ss-vnfend.log' />\n","comments":"","outputs":1,"x":1100.5713539123535,"y":669.6343712806702,"z":"be5d0074.91504","wires":[[]]},{"id":"d789f59.74b7f08","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":889.2378845214844,"y":639.1428298950195,"z":"be5d0074.91504","wires":[["c662231.39140e","cddbc37f.04216","304e9350.13a68c","f70af5d8.815968"]]},{"id":"23fb5171.228f8e","type":"set","name":"set subnet data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].ip-version'\n   value='`$tmp.ip-version`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].subnet-id'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].neutron-subnet-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].sdnc-subnet-id'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].subnet-role'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-role`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].subnet-name'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-name`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].network-start-address'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].network-start-address`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].gateway-address'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].gateway-address`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].cidr-mask'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].cidr-mask`' />\n","comments":"","x":2067.619186401367,"y":4018.8097801208496,"z":"be5d0074.91504","wires":[]},{"id":"b90fa041.aaba2","type":"switchNode","name":"switch dhcp-enabled","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].dhcp-enabled`'>\n","comments":"","outputs":1,"x":2082.142967224121,"y":4071.6527338027954,"z":"be5d0074.91504","wires":[["49a34eea.6330e","b5daf2d.33bd71"]]},{"id":"49a34eea.6330e","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2245.000131879534,"y":4050.224091529846,"z":"be5d0074.91504","wires":[["8fc71690.7962d8"]]},{"id":"b5daf2d.33bd71","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2243.571464538574,"y":4095.9385175704956,"z":"be5d0074.91504","wires":[["e2f9a136.49111"]]},{"id":"8fc71690.7962d8","type":"set","name":"set dhcp-enabled to Y","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].dhcp-enabled'\n   value='Y' />\n","comments":"","x":2417.8573303222656,"y":4048.7954874038696,"z":"be5d0074.91504","wires":[]},{"id":"e2f9a136.49111","type":"set","name":"set dhcp-enabled to N","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].dhcp-enabled'\n   value='N' />\n","comments":"","x":2415.000099182129,"y":4095.9385175704956,"z":"be5d0074.91504","wires":[]},{"id":"60076dea.ddca64","type":"switchNode","name":"switch subnet-role","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-role`'>\n","comments":"","outputs":1,"x":2082.6191368103027,"y":3900.700406074524,"z":"be5d0074.91504","wires":[["ed1cfe9d.edd28"]]},{"id":"ed1cfe9d.edd28","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2249.2857398986816,"y":3900.7000579833984,"z":"be5d0074.91504","wires":[["61b607ca.bee948"]]},{"id":"61b607ca.bee948","type":"set","name":"set subnet-role to NONE","xml":"<set>\n<parameter name='aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-role' value='NONE' />\n","comments":"","x":2430.9525260925293,"y":3900.0337104797363,"z":"be5d0074.91504","wires":[]},{"id":"95a8bc37.de49c","type":"switchNode","name":"switch ip-version","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].ip-version`'>\n","comments":"","outputs":1,"x":2077.8574714660645,"y":3965.191512107849,"z":"be5d0074.91504","wires":[["cba78d28.62af2","57793043.471d2"]]},{"id":"cba78d28.62af2","type":"outcome","name":"4","xml":"<outcome value='4'>\n","comments":"","outputs":1,"x":2243.5716133117676,"y":3946.619909286499,"z":"be5d0074.91504","wires":[["dff11ccf.bb16a"]]},{"id":"57793043.471d2","type":"outcome","name":"6","xml":"<outcome value='6'>\n","comments":"","outputs":1,"x":2243.571575164795,"y":3988.048652648926,"z":"be5d0074.91504","wires":[["cc470d.526ff8f"]]},{"id":"dff11ccf.bb16a","type":"set","name":"set tmp.ip-version to ipv4","xml":"<set>\n<parameter name='tmp.ip-version' value='ipv4' />\n","comments":"","x":2430.7143783569336,"y":3945.762836456299,"z":"be5d0074.91504","wires":[]},{"id":"cc470d.526ff8f","type":"set","name":"set tmp.ip-version to ipv6","xml":"<set>\n<parameter name='tmp.ip-version' value='ipv6' />\n","comments":"","x":2429.285930633545,"y":3988.0486545562744,"z":"be5d0074.91504","wires":[]},{"id":"80cab39e.772be","type":"switchNode","name":"switch network-role","xml":"<switch test='`$db.vf-network-role-mapping[$role-index].network-role`'>\n","comments":"","outputs":1,"x":710.2856636047363,"y":3973.428563117981,"z":"be5d0074.91504","wires":[["4a80611b.96ec4","62ed6f4a.81897","5ab52110.3fbcd","b4fbca0e.70bc98"]]},{"id":"4a80611b.96ec4","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":878.3809280395508,"y":3871.761974334717,"z":"be5d0074.91504","wires":[["2b279fb6.0c5b6"]]},{"id":"62ed6f4a.81897","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":876.9523048400879,"y":4000.0951623916626,"z":"be5d0074.91504","wires":[["7eca1a93.00ad54"]]},{"id":"2b279fb6.0c5b6","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1015.7619361877441,"y":3911.5235538482666,"z":"be5d0074.91504","wires":[[]]},{"id":"dece7ac8.98c8e8","type":"get-resource","name":"get-resource VNF_RELATED_NETWORK_ROLE","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VNF_RELATED_NETWORK_ROLE where vnf_customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid\n    and network_role = $db.vf-network-role-mapping[$role-index].network-role'\n  pfx='db.vnf-related-network-role[]'>\n\n","comments":"","outputs":1,"x":1372.285758972168,"y":4303.1750774383545,"z":"be5d0074.91504","wires":[["3ab71df.b211ce2","32829263.ca5a0e"]]},{"id":"3ab71df.b211ce2","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1640.9524230957031,"y":4133.8419189453125,"z":"be5d0074.91504","wires":[["e67a9905.733058"]]},{"id":"711da561.57e78c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VNF_RELATED_NETWORK_ROLE table\" />\n","comments":"","x":1950.9523963928223,"y":4133.6514892578125,"z":"be5d0074.91504","wires":[]},{"id":"e67a9905.733058","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1788.1429405212402,"y":4132.389933586121,"z":"be5d0074.91504","wires":[["711da561.57e78c","eb91c268.10c28"]]},{"id":"32829263.ca5a0e","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1643.9524536132812,"y":4496.508430480957,"z":"be5d0074.91504","wires":[["54f934a8.1407ec"]]},{"id":"54f934a8.1407ec","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1810.285758972168,"y":4494.5080852508545,"z":"be5d0074.91504","wires":[["9905f433.bc4c58","b447de2b.f180d","e0e1bfb9.d3392","8e303b97.191248","9bcef03.5e4921","683fecd1.72d594","2a35f71d.88e7e8","70b3b7bf.4dfb18","e3caf961.b0c638"]]},{"id":"6a38ac3.c275454","type":"outcome","name":"service-instance","xml":"<outcome value='service-instance'>\n","comments":"","outputs":1,"x":2748.5712280273438,"y":3666.74675655365,"z":"be5d0074.91504","wires":[["11fe3f3e.4ee511"]]},{"id":"11fe3f3e.4ee511","type":"for","name":"for each relationship data","xml":"<for silentFailure='true' index='db-data-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data_length`' >\n","comments":"","outputs":1,"x":2974.0470657348633,"y":3667.175386428833,"z":"be5d0074.91504","wires":[["19207da5.d08342"]]},{"id":"19207da5.d08342","type":"switchNode","name":"switch relationship-key","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-key`'>\n","comments":"","outputs":1,"x":3209.2856369018555,"y":3665.5088176727295,"z":"be5d0074.91504","wires":[["941b5311.4c406"]]},{"id":"941b5311.4c406","type":"outcome","name":"service-instance.service-instance-id","xml":"<outcome value='service-instance.service-instance-id'>\n","comments":"","outputs":1,"x":3475.713996887207,"y":3665.5088815689087,"z":"be5d0074.91504","wires":[["4202ddb6.ac36f4"]]},{"id":"4202ddb6.ac36f4","type":"set","name":"set network-service-instance-id","xml":"<set>\n<parameter name='network-service-instance-id'\n  value='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-value`' />\n","comments":"","x":3769.2857818603516,"y":3663.842296600342,"z":"be5d0074.91504","wires":[]},{"id":"9905f433.bc4c58","type":"execute","name":"generate network-topology-identifier-structure url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.network-topology-identifier-structure`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.part\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$network-service-instance-id`\"/>\n","comments":"","outputs":1,"x":2129.618927001953,"y":4190.175718307495,"z":"be5d0074.91504","wires":[[]]},{"id":"e0e1bfb9.d3392","type":"execute","name":"execute RestApiCallNode - get network-topology-identifier-structure","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ntis-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ntis\" />\n\n","comments":"","outputs":1,"x":2186.618721008301,"y":4293.604458808899,"z":"be5d0074.91504","wires":[["e4a73926.d67098"]]},{"id":"b447de2b.f180d","type":"execute","name":"generate network-topology-identifier-structure url (part 2)","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.part`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ntis-url\"/>\n    <parameter name=\"target\" value=\"{network-id}\"/>\n    <parameter name=\"replacement\" value=\"`$l3-network-id`\"/>\n","comments":"","outputs":1,"x":2151.285514831543,"y":4233.5090618133545,"z":"be5d0074.91504","wires":[[]]},{"id":"7a50c9f.bf28538","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bgb-vnfa.log' />\n","comments":"","outputs":1,"x":456.61913299560547,"y":4140.1750774383545,"z":"be5d0074.91504","wires":[[]]},{"id":"e4a73926.d67098","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2515.7279090881348,"y":4293.354936599731,"z":"be5d0074.91504","wires":[["82516186.8c563"]]},{"id":"2728e692.39911a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`\n    'Error retrieving network-topology-identifier-structure for service instance '\n    + $network-service-instance-id\n    + ' and network-id '\n    + $l3-network-id`\" />\n","comments":"","x":2820.9522857666016,"y":4303.841425895691,"z":"be5d0074.91504","wires":[]},{"id":"82516186.8c563","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2653.1427993774414,"y":4292.580025672913,"z":"be5d0074.91504","wires":[["2728e692.39911a","eb91c268.10c28"]]},{"id":"8e303b97.191248","type":"set","name":"set is-trunked and segmentation-id in vnf-network","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].is-trunked'\n    value='`$mdsal-ntis.network-topology-identifier-structure.is-trunked`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].segmentation-id'\n    value='`$mdsal-ntis.network-topology-identifier-structure.segmentation-id`' />\n    ","comments":"","x":2129.285743713379,"y":4353.842082977295,"z":"be5d0074.91504","wires":[]},{"id":"683fecd1.72d594","type":"save","name":"custom query: get owning entity","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.oe\">\n<parameter name=\"start[0]\" value=\"`'nodes/service-instances/service-instance?service-instance-id=' + $network-service-instance-id `\" />\n<parameter name=\"start_length\" value=\"1\" />\n<parameter name=\"query\" value=\"/query/owning-entity-fromService-instance\" /> \n","comments":"","outputs":1,"x":2070.2856369018555,"y":4429.1755657196045,"z":"be5d0074.91504","wires":[["a590bc88.67cc3","f93d7275.280a5"]]},{"id":"a590bc88.67cc3","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2280.5236854553223,"y":4407.841919898987,"z":"be5d0074.91504","wires":[["2c629f1.121d76"]]},{"id":"f93d7275.280a5","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2287.6665802001953,"y":4453.5561447143555,"z":"be5d0074.91504","wires":[["94b1d4ef.94ad08"]]},{"id":"f1c34530.cdc708","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error getting owning entity from service instance\" />\n","comments":"","x":2585.2856369018555,"y":4405.8420696258545,"z":"be5d0074.91504","wires":[]},{"id":"2c629f1.121d76","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2422.4761810302734,"y":4404.580513954163,"z":"be5d0074.91504","wires":[["f1c34530.cdc708","eb91c268.10c28"]]},{"id":"34fee23.74b641e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Unable to find owning entity from service instance\" />\n","comments":"","x":2583.6191329956055,"y":4455.8420696258545,"z":"be5d0074.91504","wires":[]},{"id":"94b1d4ef.94ad08","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2420.8096771240234,"y":4454.580513954163,"z":"be5d0074.91504","wires":[["34fee23.74b641e","eb91c268.10c28"]]},{"id":"d9bc3d6f.ee479","type":"save","name":"custom query: get tenant network","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.get-networks\">\n<parameter name=\"start[0]\" value=\"`'/business/owning-entities/owning-entity/' + $tmp.AnAI-data.oe.results[0].owning-entity.owning-entity-id `\" />\n<parameter name=\"start_length\" value=\"1\" />\n<parameter name=\"query\" value=\"`'/query/getNetworks?networkRole=' + $db.vnf-related-network-role[$rel-network-role-index].related-network-role\n  + '&amp;cloudRegionId=' + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" /> \n","comments":"","outputs":1,"x":2519.9524536132812,"y":4602.175703048706,"z":"be5d0074.91504","wires":[["8560d674.04df58","387d8908.bfa816"]]},{"id":"8560d674.04df58","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2733.190502166748,"y":4580.8422021865845,"z":"be5d0074.91504","wires":[["2edb259f.d6427a"]]},{"id":"387d8908.bfa816","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2740.333396911621,"y":4626.556427001953,"z":"be5d0074.91504","wires":[["83120bbc.de2f08"]]},{"id":"9b719b4e.2bbdf8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error calling getNetworks custom query in AAI\" />\n","comments":"","x":3037.9524536132812,"y":4578.842351913452,"z":"be5d0074.91504","wires":[]},{"id":"2edb259f.d6427a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2875.142997741699,"y":4577.58079624176,"z":"be5d0074.91504","wires":[["9b719b4e.2bbdf8","eb91c268.10c28"]]},{"id":"4dfbb550.f5a8cc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No l3-network returned from getNetworks custom query for related network role '\n      + $db.vnf-related-network-role[0].related-network-role`\" />\n","comments":"","x":3036.2859497070312,"y":4628.842351913452,"z":"be5d0074.91504","wires":[]},{"id":"83120bbc.de2f08","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2873.476493835449,"y":4627.58079624176,"z":"be5d0074.91504","wires":[["4dfbb550.f5a8cc","eb91c268.10c28"]]},{"id":"154d643c.80192c","type":"for","name":"for each relationship","xml":"<for index='rel-index' start='0' end='`$tmp.AnAI-data.get-networks.results[0].l3-network.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":2486.9524536132812,"y":4728.175848007202,"z":"be5d0074.91504","wires":[["2356569c.ffc24a"]]},{"id":"2356569c.ffc24a","type":"switchNode","name":"switch related-to","xml":"<switch test='`$tmp.AnAI-data.get-networks.results[0].l3-network.relationship-list.relationship[$rel-index].related-to`'>\n","comments":"","outputs":1,"x":2684.9524536132812,"y":4728.175848007202,"z":"be5d0074.91504","wires":[["8795e09.89be62"]]},{"id":"8795e09.89be62","type":"outcome","name":"vlan-tag","xml":"<outcome value='vlan-tag'>\n","comments":"","outputs":1,"x":2854.9524536132812,"y":4728.175848007202,"z":"be5d0074.91504","wires":[["346048a1.d0b2d8"]]},{"id":"346048a1.d0b2d8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3022.9524536132812,"y":4726.175848007202,"z":"be5d0074.91504","wires":[["17f6fc0d.8dad74","355b66df.e2b0aa","cc38a6f6.b25fe8"]]},{"id":"17f6fc0d.8dad74","type":"set","name":"set vlan-tag-id","xml":"<set>\n<parameter name='vlan-tag-id' value='`$tmp.AnAI-data.get-networks.results[0].l3-network.relationship-list.relationship[$rel-index].relationship-data[0].relationship-value`' />\n","comments":"","x":3198.9524536132812,"y":4686.175848007202,"z":"be5d0074.91504","wires":[]},{"id":"355b66df.e2b0aa","type":"get-resource","name":"get-resource vlan-tag","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"vlan-tag\" \n\t\tkey=\"vlan-tag.vlan-tag-id = $vlan-tag-id\"\n        pfx='aai.vlan-tag' local-only='false'\n>\n","comments":"","outputs":1,"x":3220.9524536132812,"y":4744.175848007202,"z":"be5d0074.91504","wires":[["403307f7.b64c78","e1666ba5.a09638"]]},{"id":"403307f7.b64c78","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3401.0000610351562,"y":4726.318914413452,"z":"be5d0074.91504","wires":[["6ebd4443.1e2c3c"]]},{"id":"6ebd4443.1e2c3c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":3543.809341430664,"y":4726.509556293488,"z":"be5d0074.91504","wires":[["f840cf70.62acd","eb91c268.10c28"]]},{"id":"f840cf70.62acd","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error getting vlan-tag object from AAI\" />\n","comments":"","x":3704.952346801758,"y":4722.176074981689,"z":"be5d0074.91504","wires":[]},{"id":"9bcef03.5e4921","type":"for","name":"for each related network role","xml":"<for index='rel-network-role-index' start='0' end='`$db.vnf-related-network-role_length`' >\n","comments":"","outputs":1,"x":2057.9523849487305,"y":4658.509412765503,"z":"be5d0074.91504","wires":[["9b20a919.5c92d8"]]},{"id":"9b20a919.5c92d8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2262.9523849487305,"y":4659.8425579071045,"z":"be5d0074.91504","wires":[["d9bc3d6f.ee479","154d643c.80192c","11b17797.ac7498"]]},{"id":"70b3b7bf.4dfb18","type":"switchNode","name":"switch rn-index","xml":"<switch test='`$rn-index`'>\n","comments":"","outputs":1,"x":2018.9523849487305,"y":4548.1755657196045,"z":"be5d0074.91504","wires":[["91b5c234.d549b"]]},{"id":"2a35f71d.88e7e8","type":"set","name":"set rn-index to related network length","xml":"<set>\n<parameter name='rn-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network_length`' />\n","comments":"","x":2087.6189727783203,"y":4499.17541885376,"z":"be5d0074.91504","wires":[]},{"id":"91b5c234.d549b","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2182.9523849487305,"y":4548.1755657196045,"z":"be5d0074.91504","wires":[["d9d5dae4.bd92c8"]]},{"id":"d9d5dae4.bd92c8","type":"set","name":"set rn-index to 0","xml":"<set>\n<parameter name='rn-index' value='0' />\n","comments":"","x":2342.9523849487305,"y":4548.1755657196045,"z":"be5d0074.91504","wires":[]},{"id":"11b17797.ac7498","type":"set","name":"set related-network data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].network-id'\n  value='`$tmp.AnAI-data.get-networks.results[0].l3-network.network-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].network-role'\n  value='`$tmp.AnAI-data.get-networks.results[0].l3-network.network-role`' />\n","comments":"","x":2490.619041442871,"y":4658.842390060425,"z":"be5d0074.91504","wires":[]},{"id":"e3caf961.b0c638","type":"set","name":"set new related network length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network_length'\n  value='`$rn-index + 1`' />\n","comments":"","x":2052.9524536132812,"y":4802.175703048706,"z":"be5d0074.91504","wires":[]},{"id":"e1666ba5.a09638","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":3402.9524536132812,"y":4774.175703048706,"z":"be5d0074.91504","wires":[["31d77170.263a3e"]]},{"id":"31d77170.263a3e","type":"set","name":"set related-network data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].vlan-tags.vlan-interface'\n  value='`$aai.vlan-tag.vlan-tag-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].vlan-tags.upper-tag-id'\n  value='`$aai.vlan-tag.vlan-id-outer`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].vlan-tags.lower-tag-id'\n  value='`$aai.vlan-tag.vlan-id-inner`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].vlan-tags.is-private'\n  value='`$aai.vlan-tag.is-private`' />\n","comments":"","x":3594.9524536132812,"y":4774.175703048706,"z":"be5d0074.91504","wires":[]},{"id":"cc38a6f6.b25fe8","type":"break","name":"break","xml":"<break>\n","comments":"","x":3172.9524536132812,"y":4812.175703048706,"z":"be5d0074.91504","wires":[]},{"id":"aec7ccd0.894f5","type":"comment","name":"temporary data issue: also ignore string \"null\" and \"NULL\"","info":"","comments":"","x":849.2857666015625,"y":3831.937686920166,"z":"be5d0074.91504","wires":[]},{"id":"5ab52110.3fbcd","type":"outcome","name":"null","xml":"<outcome value='null'>\n","comments":"","outputs":1,"x":876.4285888671875,"y":3914.794828414917,"z":"be5d0074.91504","wires":[["2b279fb6.0c5b6"]]},{"id":"b4fbca0e.70bc98","type":"outcome","name":"NULL","xml":"<outcome value='NULL'>","comments":"","outputs":1,"x":876.4285984039307,"y":3957.651900291443,"z":"be5d0074.91504","wires":[["2b279fb6.0c5b6"]]},{"id":"b07f3957.23cee8","type":"switchNode","name":"switch input cloud-owner","xml":"<switch test='`$vnf-topology-operation-input.vnf-request-input.cloud-owner`'>\n","comments":"","outputs":1,"x":509.28570556640625,"y":243.84222221374512,"z":"be5d0074.91504","wires":[["d3fc9056.4916f","57a81799.8acba8"]]},{"id":"d3fc9056.4916f","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":692.6190795898438,"y":213.84221076965332,"z":"be5d0074.91504","wires":[["9917844.58b4178"]]},{"id":"57a81799.8acba8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":692.3809852600098,"y":254.79470443725586,"z":"be5d0074.91504","wires":[["efdbfc78.53fd6"]]},{"id":"9917844.58b4178","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":827.6190338134766,"y":212.17555046081543,"z":"be5d0074.91504","wires":[[]]},{"id":"efdbfc78.53fd6","type":"set","name":"set prop.cloud-region.cloud-owner","xml":"<set>\n<parameter name='prop.cloud-region.cloud-owner' value='`$vnf-topology-operation-input.vnf-request-input.cloud-owner`' />\n","comments":"","x":909.2856903076172,"y":253.84223175048828,"z":"be5d0074.91504","wires":[]},{"id":"575233c8.305a6c","type":"call","name":"call self-serve-vnf-forking-logic","xml":"<call module='GENERIC-RESOURCE-API' rpc='self-serve-vnf-forking-logic' mode='sync' >\n","comments":"","outputs":1,"x":527.1428604125977,"y":537.1428661346436,"z":"be5d0074.91504","wires":[[]]},{"id":"e450a9d4.f6b6a8","type":"switchNode","name":"switch ss.self-serve-flag","xml":"<switch test=\"`$ss.self-serve-flag`\">\n","comments":"","outputs":1,"x":507.2855758666992,"y":702.7143535614014,"z":"be5d0074.91504","wires":[["78b4342c.5bbe9c","7b7dd5f.add382c"]]},{"id":"78b4342c.5bbe9c","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":718.9997329711914,"y":775.9996376037598,"z":"be5d0074.91504","wires":[["7362746e.83534c"]]},{"id":"7b7dd5f.add382c","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":718.5712509155273,"y":639.5714712142944,"z":"be5d0074.91504","wires":[["d789f59.74b7f08"]]}]