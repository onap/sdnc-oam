[{"id":"bd533109.36b09","type":"dgstart","name":"DGSTART","outputs":1,"x":113.33332824707031,"y":80,"z":"e8ec1b5b.25eae8","wires":[["eea443c9.7f4b1"]]},{"id":"eea443c9.7f4b1","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":228.61903381347656,"y":121.9047794342041,"z":"e8ec1b5b.25eae8","wires":[["dd75c958.b8a758"]]},{"id":"dd75c958.b8a758","type":"method","name":"method vnf-topology-operation-assign","xml":"<method rpc='vnf-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":201.4286346435547,"y":164.66666316986084,"z":"e8ec1b5b.25eae8","wires":[["d1a098.413fcf68"]]},{"id":"3048fe80.9e8832","type":"comment","name":"vnf-topology-operation-assign","info":"","comments":"","x":489.34485626220703,"y":29.25300407409668,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"59a1abf1.362d04","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vnf-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":499.7142791748047,"y":313.14283180236816,"z":"e8ec1b5b.25eae8","wires":[["58d8d753.dd0b78","d4ec3d98.8441c"]]},{"id":"58d8d753.dd0b78","type":"outcome","name":"CreateVnfInstance","xml":"<outcome value='CreateVnfInstance'>\n","comments":"","outputs":1,"x":753.4285736083984,"y":290.2857131958008,"z":"e8ec1b5b.25eae8","wires":[["a5cb5b34.79eef8"]]},{"id":"d4ec3d98.8441c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":715.428539276123,"y":336.0000410079956,"z":"e8ec1b5b.25eae8","wires":[["b30617c9.3367f8"]]},{"id":"a5cb5b34.79eef8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":938.285701751709,"y":290.2857427597046,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"b30617c9.3367f8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'assign' then request-action must be 'CreateVnfInstance'\" />\n","comments":"","x":955.4285469055176,"y":335.9999990463257,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"6b5bbadc.1a2bd4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":171.07147216796875,"y":3362.0238666534424,"z":"e8ec1b5b.25eae8","wires":[["182d9210.b4f38e","eb062562.bf7758","3fee4c4a.3c8f34","9122a08b.bf42c","31806942.711086","9354e0a.a1a222","c6f4cc14.4d496","78800fc6.84567","ce71f4aa.7dac08","97cb616b.1e662","dec93423.1c7818","c59dce42.ffa6","f35286c9.aba228","d8275d1a.a267b","3efc5bf7.1fbca4","1b685163.16a0df","71880bcd.293be4","a3b29906.9a3a48","444bd395.45fd6c","319a19de.096916","3738d864.8488b8","3d62856f.0bfdaa","3f904e84.236ac2","2f6ee8ac.d68678","e52b4fda.5c0c9","44b4e6e0.efb408","5419c426.25e3dc","7ac2119a.6a992","80da69e6.2e40f8","1736d58c.861d3a","53d39bcb.6061e4","de66456a.ee6e38","58179bd9.e06a74","4f148391.ee5fec"]]},{"id":"55463f33.2c23d","type":"get-resource","name":"get-resource VF_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODEL WHERE customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-model'>\n\n","comments":"","outputs":1,"x":512.0475845336914,"y":404.285701751709,"z":"e8ec1b5b.25eae8","wires":[["bb249ae.0065668","a1041a8c.6b6298"]]},{"id":"c6dbca37.6ee8e8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No model found for VNF customization UUID ' + $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`\" />\n","comments":"","x":953.4760627746582,"y":427.7141876220703,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"bb249ae.0065668","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":712.8332824707031,"y":384.6665391921997,"z":"e8ec1b5b.25eae8","wires":[["be37c095.bab27"]]},{"id":"a1041a8c.6b6298","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":721.404712677002,"y":428.9522523880005,"z":"e8ec1b5b.25eae8","wires":[["c6dbca37.6ee8e8"]]},{"id":"be37c095.bab27","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODEL table\" />\n","comments":"","x":952.8332633972168,"y":382.80944633483887,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"182d9210.b4f38e","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":545.7142486572266,"y":1155.238136291504,"z":"e8ec1b5b.25eae8","wires":[["dcafdf04.e519f","7838bfc2.94cd1"]]},{"id":"dcafdf04.e519f","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":771.4285774230957,"y":1122.3809242248535,"z":"e8ec1b5b.25eae8","wires":[["2f061d23.3fb7a2"]]},{"id":"2f061d23.3fb7a2","type":"set","name":"set vnf-index=0","xml":"<set>\n<parameter name='vnf-index' value='0' />\n","comments":"","x":935.714298248291,"y":1121.3810024261475,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"7838bfc2.94cd1","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":772.8571395874023,"y":1186.666742324829,"z":"e8ec1b5b.25eae8","wires":[["d258b34c.c5851"]]},{"id":"706d6548.bc302c","type":"set","name":"set vnf-index = vnf_length","xml":"<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n","comments":"","x":1111.7142944335938,"y":1164.9524307250977,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"8c19b083.e47a6","type":"for","name":"for each existing VNF","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":1097.142807006836,"y":1210.9523696899414,"z":"e8ec1b5b.25eae8","wires":[["2f9273.624d7d8e"]]},{"id":"d258b34c.c5851","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":908.5713996887207,"y":1186.6667079925537,"z":"e8ec1b5b.25eae8","wires":[["706d6548.bc302c","8c19b083.e47a6"]]},{"id":"2f9273.624d7d8e","type":"switchNode","name":"switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n","comments":"","outputs":1,"x":1451.4285736083984,"y":1210.5238494873047,"z":"e8ec1b5b.25eae8","wires":[["8c465f38.464ce"]]},{"id":"8c465f38.464ce","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1745.7143287658691,"y":1210.0953340530396,"z":"e8ec1b5b.25eae8","wires":[["3b57c25a.0dc1de"]]},{"id":"3b57c25a.0dc1de","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists'`\" />\n","comments":"","x":1894.2856903076172,"y":1210.0952816009521,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"b36e4404.7a83c8","type":"comment","name":"make sure this VNF doesn't exist already","info":"","comments":"","x":1438.571304321289,"y":1168.0952796936035,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"eb062562.bf7758","type":"set","name":"set vnf-topology data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-id'\n value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-type'\n value='`$vnf-topology-operation-input.vnf-information.vnf-type`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-type'\n value='`$db.vf-model.nf-type`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-role'\n value='`$db.vf-model.nf-role`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-function'\n value='`$db.vf-model.nf-function`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-code'\n value='`$db.vf-model.nf-code`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.tenant'\n value='`$vnf-topology-operation-input.vnf-request-input.tenant`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-cloud-region'\n value='`$vnf-topology-operation-input.vnf-request-input.aic-cloud-region`' />\n \n","comments":"","x":511.4285316467285,"y":1686.9049034118652,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"3fee4c4a.3c8f34","type":"switchNode","name":"switch input vnf-name","xml":"<switch test='`$vnf-topology-operation-input.vnf-request-input.vnf-name`'>\n","comments":"","outputs":1,"x":523.9285507202148,"y":2049.0239610671997,"z":"e8ec1b5b.25eae8","wires":[["5fd3dc86.42fc34","442a1f5a.45f7d"]]},{"id":"9122a08b.bf42c","type":"get-resource","name":"get-resource cloud region","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"cloud-region\" \n\t\tkey=\"cloud-region.cloud-owner = $prop.cloud-region.cloud-owner AND \n\t\t     cloud-region.cloud-region-id = $vnf-topology-operation-input.vnf-request-input.aic-cloud-region AND\n\t\t     depth='all'\"\n        pfx='aai.cloud-region' local-only='false' >\n\n","comments":"","outputs":1,"x":556.0714950561523,"y":2945.023696899414,"z":"e8ec1b5b.25eae8","wires":[["c640673a.363ec8","f4fbd63e.8951c8"]]},{"id":"f4fbd63e.8951c8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":781.3176879882812,"y":2963.1745529174805,"z":"e8ec1b5b.25eae8","wires":[["c71217d7.fa2678"]]},{"id":"3c459053.24905","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving cloud region from AAI\" />\n","comments":"","x":1082.984359741211,"y":2963.174570083618,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"c640673a.363ec8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":790.2462844848633,"y":2921.460286140442,"z":"e8ec1b5b.25eae8","wires":[["68d0d255.f3c4dc"]]},{"id":"c6e9688d.5e1bd8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Cloud region not found in AAI\" />\n","comments":"","x":1083.2622604370117,"y":2920.765844345093,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"31806942.711086","type":"get-resource","name":"get-resource VF_TO_NETWORK_ROLE_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_TO_NETWORK_ROLE_MAPPING WHERE vf_customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-network-role-mapping[]'>\n\n","comments":"","outputs":1,"x":621.3095779418945,"y":3256.071216583252,"z":"e8ec1b5b.25eae8","wires":[["274b1aa.42af3e6","ed75e9c6.9b1188"]]},{"id":"274b1aa.42af3e6","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":917.0952491760254,"y":3234.7853813171387,"z":"e8ec1b5b.25eae8","wires":[["b6c05c7e.f22dc"]]},{"id":"ed75e9c6.9b1188","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":925.6666793823242,"y":3279.0710945129395,"z":"e8ec1b5b.25eae8","wires":[["2c1195fd.44baca"]]},{"id":"1bfa425.654c0be","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_TO_NETWORK_ROLE_MAPPING table\" />\n","comments":"","x":1233.7618732452393,"y":3234.5951137542725,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"de751662.485548","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1028.9049835205078,"y":3999.3804264068604,"z":"e8ec1b5b.25eae8","wires":[["672cde72.1b0a1","a529793b.26d8a8","79f514cd.dc546c","a766e419.ba97a8","6ca7130b.1eeb1c","4234ff71.2baba","56c99275.ec16cc","760fe2dd.1dfb2c","a2979752.466c68"]]},{"id":"79f514cd.dc546c","type":"get-resource","name":"get-resource l3-network","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"l3-networks\" \n\t\tkey=\"l3-network.network-role = $db.vf-network-role-mapping[$role-index].network-role\"\n        pfx='aai.l3-network' local-only='false'\n>\n","comments":"","outputs":1,"x":1285.7620582580566,"y":3408.3330307006836,"z":"e8ec1b5b.25eae8","wires":[["9fd4d6bd.8024e8","eb2240a2.6bbf1"]]},{"id":"eb2240a2.6bbf1","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1489.809772491455,"y":3430.4758701324463,"z":"e8ec1b5b.25eae8","wires":[["f0b29bbe.b8cf88"]]},{"id":"1eb7d025.3b3fa","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving l3-network from AAI\" />\n","comments":"","x":1804.8098030090332,"y":3430.8092136383057,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"9fd4d6bd.8024e8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1498.738368988037,"y":3388.7616033554077,"z":"e8ec1b5b.25eae8","wires":[["87d839b8.bf24e8"]]},{"id":"cdbfce71.266e5","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No active l3-network found in AAI with cloud_region_id '\n          + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region + ' and network_role '\n          + $db.vf-network-role-mapping[$network-index].network-role`\" />\n","comments":"","x":1803.4209985733032,"y":3389.7337398529053,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"672cde72.1b0a1","type":"set","name":"set vnf-network data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-role'\n    value='`$db.vf-network-role-mapping[$role-index].network-role`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-name'\n    value='`$aai.l3-network.l3-network[$db-network-index].network-name`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].neutron-id'\n    value='`$aai.l3-network.l3-network[$db-network-index].neutron-network-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].network-id'\n    value='`$aai.l3-network.l3-network[$db-network-index].network-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].contrail-network-fqdn'\n    value='`$aai.l3-network.l3-network[$db-network-index].contrail-network-fqdn`' />\n","comments":"","x":1274.9526481628418,"y":3895.3332738876343,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"ce71f4aa.7dac08","type":"for","name":"for each cloud-region availability zone","xml":"<for index='idx' start='0' end='`$aai.cloud-region.availability-zones.availability-zone_length`' >\n","comments":"","outputs":1,"x":495.3336868286133,"y":5142.452251434326,"z":"e8ec1b5b.25eae8","wires":[["4817a39b.72d80c"]]},{"id":"b6053898.925798","type":"set","name":"set availability-zone","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.availability-zone[$idx]'\n  value='`$aai.cloud-region.availability-zones.availability-zone[$idx].availability-zone-name`' />\n","comments":"","x":957.0003700256348,"y":5111.785665512085,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"97cb616b.1e662","type":"set","name":"set vnf-parameters-data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-parameters-data.'\n  value='vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.' />\n","comments":"","x":454.9526138305664,"y":4992.404611587524,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"d490850.5f8c778","type":"save","name":"save generic-vnf l3-network relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf:relationship-list\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$vnf-nw-index].network-id`\" />\n","comments":"","outputs":1,"x":921.5241470336914,"y":5286.214464187622,"z":"e8ec1b5b.25eae8","wires":[["9daac0d6.cc6e7","5c14f9f7.cc57b8"]]},{"id":"f35286c9.aba228","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":414.7621612548828,"y":5751.832854270935,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"c59dce42.ffa6","type":"set","name":"set vnf-level-oper-status to PendingCreate","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='PendingCreate' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n","comments":"","x":504.5756072998047,"y":5654.170334815979,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"c6f4cc14.4d496","type":"for","name":"for each network-role","xml":"<for index='role-index' start='0' end='`$db.vf-network-role-mapping_length`'>","comments":"","outputs":1,"x":488.9049186706543,"y":3972.7140951156616,"z":"e8ec1b5b.25eae8","wires":[["f2648fe0.20797"]]},{"id":"9354e0a.a1a222","type":"set","name":"set network-index = 0","xml":"<set>\n<parameter name='network-index' value='0' />\n","comments":"","x":523.7380752563477,"y":3310.119010925293,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"a529793b.26d8a8","type":"set","name":"increment network-index","xml":"<set>\n<parameter name='network-index' value='`$network-index + 1`' />\n","comments":"","x":1256.95263671875,"y":4943.09521484375,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"78800fc6.84567","type":"set","name":"set vnf-network_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network_length'\n  value='`$network-index`' />\n","comments":"","x":453.80970001220703,"y":4942.404655456543,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"dec93423.1c7818","type":"set","name":"copy input data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n","comments":"","x":420.0954360961914,"y":5601.8331661224365,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"d8275d1a.a267b","type":"for","name":"for each vnf-network","xml":"<for index='vnf-nw-index' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network_length`' >\n","comments":"","outputs":1,"x":444.52405548095703,"y":5285.214380264282,"z":"e8ec1b5b.25eae8","wires":[["f4852e33.89f31"]]},{"id":"f4852e33.89f31","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":648.1906967163086,"y":5285.214341163635,"z":"e8ec1b5b.25eae8","wires":[["d490850.5f8c778"]]},{"id":"3efc5bf7.1fbca4","type":"set","name":"set new vnf_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n","comments":"","x":494.35717010498047,"y":1207.2620267868042,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"1b685163.16a0df","type":"for","name":"for each cloud-region relationship","xml":"<for index='idx' start='0' end='`$aai.cloud-region.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":568.9286193847656,"y":3032.2618684768677,"z":"e8ec1b5b.25eae8","wires":[["3e7008bf.f77fb8"]]},{"id":"3e7008bf.f77fb8","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship[$idx].related-to`'>\n","comments":"","outputs":1,"x":816.6071624755859,"y":3032.0117979049683,"z":"e8ec1b5b.25eae8","wires":[["419be9bd.3772b8"]]},{"id":"419be9bd.3772b8","type":"outcome","name":"complex","xml":"<outcome value='complex'>\n","comments":"","outputs":1,"x":986.0714836120605,"y":3031.4046201705933,"z":"e8ec1b5b.25eae8","wires":[["9dd085a5.9125b8"]]},{"id":"ac1dc8b5.1c2c08","type":"set","name":"set aic-clli","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-clli'\n  value='`$aai-uid-split[$aai-uid-split_length - 1]`' />\n","comments":"","x":1306.7857818603516,"y":3031.071277618408,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"71880bcd.293be4","type":"switchNode","name":"switch aic-clli","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.aic-clli`'>\n","comments":"","outputs":1,"x":501.97624588012695,"y":3145.357000350952,"z":"e8ec1b5b.25eae8","wires":[["c19aa1c7.7f5f4"]]},{"id":"c19aa1c7.7f5f4","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":650.1190795898438,"y":3145.3569831848145,"z":"e8ec1b5b.25eae8","wires":[["c4e8bad2.09bd68"]]},{"id":"33aec73b.cce3a8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find aic-clli in AAI for aic-cloud-region ' + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n","comments":"","x":940.595272064209,"y":3146.5950288772583,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"8a5e4fd2.9fdbd","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid'\n  value='`$db.vf-model.invariant-uuid`' />\n","comments":"","x":928.4287910461426,"y":2504.2142572402954,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"ec6c8a23.634f28","type":"for","name":"for each l3-network","xml":"<for index='db-network-index' start='0' end='`$aai.l3-network.l3-network_length`' >\n","comments":"","outputs":1,"x":1395.2146263122559,"y":3719.90465259552,"z":"e8ec1b5b.25eae8","wires":[["a76e5ba0.e05798"]]},{"id":"47c50243.5c9d6c","type":"switchNode","name":"switch orchestration-status","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].orchestration-status`'>\n","comments":"","outputs":1,"x":1813.7857971191406,"y":3654.4761171340942,"z":"e8ec1b5b.25eae8","wires":[["c4da1b38.6556c8","f954130e.07bec","d8942898.40ee28","fa30ada7.b8b82","f15951a3.155c8"]]},{"id":"c4da1b38.6556c8","type":"outcome","name":"Pending Delete","xml":"<outcome value='Pending Delete'>\n","comments":"","outputs":1,"x":2054.452667236328,"y":3696.1426210403442,"z":"e8ec1b5b.25eae8","wires":[["5dbe3952.b23ab8"]]},{"id":"f954130e.07bec","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2027.3098068237305,"y":3747.142601966858,"z":"e8ec1b5b.25eae8","wires":[["3e825b72.92f604"]]},{"id":"1232d671.cdc82a","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].related-to`'>\n","comments":"","outputs":1,"x":2563.0241088867188,"y":3692.380518913269,"z":"e8ec1b5b.25eae8","wires":[["3d0e0dda.5ff862","4a3685d2.0b6dec"]]},{"id":"3e825b72.92f604","type":"for","name":"for each relationship","xml":"<for silentFailure='true' index='db-rel-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":2197.3097190856934,"y":3746.713978767395,"z":"e8ec1b5b.25eae8","wires":[["ae76c6a1.158798"]]},{"id":"3d0e0dda.5ff862","type":"outcome","name":"cloud-region","xml":"<outcome value='cloud-region'>\n","comments":"","outputs":1,"x":2737.3098945617676,"y":3715.285343170166,"z":"e8ec1b5b.25eae8","wires":[["dc39f94c.84f728"]]},{"id":"dc39f94c.84f728","type":"for","name":"for each relationship data","xml":"<for silentFailure='true' index='db-data-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data_length`' >\n","comments":"","outputs":1,"x":2934.45259475708,"y":3715.7138109207153,"z":"e8ec1b5b.25eae8","wires":[["a3f7f18f.c8f64"]]},{"id":"a3f7f18f.c8f64","type":"switchNode","name":"switch relationship-key","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-key`'>\n","comments":"","outputs":1,"x":3165.8811950683594,"y":3715.285185813904,"z":"e8ec1b5b.25eae8","wires":[["bbef0ba5.f3c078"]]},{"id":"bbef0ba5.f3c078","type":"outcome","name":"cloud-region.cloud-region-id","xml":"<outcome value='cloud-region.cloud-region-id'>\n","comments":"","outputs":1,"x":3407.3097610473633,"y":3715.2852821350098,"z":"e8ec1b5b.25eae8","wires":[["e8ac5f5d.f1673"]]},{"id":"e8ac5f5d.f1673","type":"switchNode","name":"switch relationship-value == cloud-region-id","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-value == $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`'>\n","comments":"","outputs":1,"x":3711.5956802368164,"y":3715.1423377990723,"z":"e8ec1b5b.25eae8","wires":[["debc9e54.9f827"]]},{"id":"debc9e54.9f827","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3416.595817565918,"y":3832.785291671753,"z":"e8ec1b5b.25eae8","wires":[["b30075b1.232678"]]},{"id":"a766e419.ba97a8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1231.428798675537,"y":3651.19029712677,"z":"e8ec1b5b.25eae8","wires":[["ec6c8a23.634f28","58b0e.d80c54f24"]]},{"id":"6ca7130b.1eeb1c","type":"set","name":"set l3-network-id = -1","xml":"<set>\n<parameter name='l3-network-id' value='-1' />\n","comments":"","x":1275.7621574401855,"y":3523.0949506759644,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"b30075b1.232678","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3562.42879486084,"y":3832.2614002227783,"z":"e8ec1b5b.25eae8","wires":[["3cb11bd0.1c4c94","ffa30adb.733078","97c14cfc.3ab92"]]},{"id":"3cb11bd0.1c4c94","type":"set","name":"set l3-network-id = this l3-network","xml":"<set>\n<parameter name='l3-network-id' value='`$aai.l3-network.l3-network[$db-network-index].network-id`' />\n","comments":"","x":3797.6667976379395,"y":3794.404369354248,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"4234ff71.2baba","type":"switchNode","name":"switch l3-network-id","xml":"<switch test='`$l3-network-id`'>\n","comments":"","outputs":1,"x":1272.7620811462402,"y":3846.761992454529,"z":"e8ec1b5b.25eae8","wires":[["f6d53c26.af9fc"]]},{"id":"f6d53c26.af9fc","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":1442.7620315551758,"y":3846.761748313904,"z":"e8ec1b5b.25eae8","wires":[["3b7d0897.e268d8"]]},{"id":"1a86e753.589449","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find l3-network in AAI for network role ' + $db.vf-network-role-mapping[$role-index].network-role`\" />\n","comments":"","x":1726.0953941345215,"y":3846.7619972229004,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"a3b29906.9a3a48","type":"switchNode","name":"switch input model-invariant-uuid","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`'>\n","comments":"","outputs":1,"x":572.2858657836914,"y":2527.038701057434,"z":"e8ec1b5b.25eae8","wires":[["52facf63.344cc","757f938e.e8acec"]]},{"id":"52facf63.344cc","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":777.9525375366211,"y":2504.181664466858,"z":"e8ec1b5b.25eae8","wires":[["8a5e4fd2.9fdbd"]]},{"id":"757f938e.e8acec","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":779.3811340332031,"y":2548.467255592346,"z":"e8ec1b5b.25eae8","wires":[["a5625b0a.01ab48"]]},{"id":"a5625b0a.01ab48","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n","comments":"","x":933.6668701171875,"y":2547.895827770233,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"a1ed9ba9.dbb3e8","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid'\n  value='`$db.vf-model.uuid`' />\n","comments":"","x":929.3810615539551,"y":2592.7529335021973,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"444bd395.45fd6c","type":"switchNode","name":"switch input model-uuid","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`'>\n","comments":"","outputs":1,"x":544.9048843383789,"y":2615.577438354492,"z":"e8ec1b5b.25eae8","wires":[["ce4b6ca4.8d23c","432a094d.0cd948"]]},{"id":"ce4b6ca4.8d23c","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":778.904857635498,"y":2592.7203702926636,"z":"e8ec1b5b.25eae8","wires":[["a1ed9ba9.dbb3e8"]]},{"id":"432a094d.0cd948","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":780.3334541320801,"y":2637.005961418152,"z":"e8ec1b5b.25eae8","wires":[["a620429c.cc462"]]},{"id":"a620429c.cc462","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n","comments":"","x":934.6191902160645,"y":2636.434533596039,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"39a7e7d2.d067c8","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-version'\n  value='`$db.vf-model.version`' />\n","comments":"","x":926.5239944458008,"y":2681.610140800476,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"319a19de.096916","type":"switchNode","name":"switch input model-version","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-version`'>\n","comments":"","outputs":1,"x":553.0477561950684,"y":2704.434585571289,"z":"e8ec1b5b.25eae8","wires":[["c0174a9a.29d428","df8cba64.d73a18"]]},{"id":"c0174a9a.29d428","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":776.0477409362793,"y":2681.5775480270386,"z":"e8ec1b5b.25eae8","wires":[["39a7e7d2.d067c8"]]},{"id":"df8cba64.d73a18","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":777.4763374328613,"y":2725.863139152527,"z":"e8ec1b5b.25eae8","wires":[["1bd83007.61c8a"]]},{"id":"1bd83007.61c8a","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-version'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-version`' />\n","comments":"","x":931.7620735168457,"y":2725.291711330414,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"844ce787.5c9458","type":"set","name":"set from DB","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-name'\n  value='`$db.vf-model.name`' />\n","comments":"","x":926.5239944458008,"y":2768.752963066101,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"3738d864.8488b8","type":"switchNode","name":"switch input model-name","xml":"<switch test='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-name`'>\n","comments":"","outputs":1,"x":548.0477561950684,"y":2791.577407836914,"z":"e8ec1b5b.25eae8","wires":[["d8f66bbd.90ede8","a564dfff.e4fd7"]]},{"id":"d8f66bbd.90ede8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":776.0477409362793,"y":2768.7203702926636,"z":"e8ec1b5b.25eae8","wires":[["844ce787.5c9458"]]},{"id":"a564dfff.e4fd7","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":777.4763374328613,"y":2813.005961418152,"z":"e8ec1b5b.25eae8","wires":[["5b0c176a.5faf18"]]},{"id":"5b0c176a.5faf18","type":"set","name":"set from input","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-name'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-name`' />\n","comments":"","x":931.7620735168457,"y":2812.434533596039,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"5dbe3952.b23ab8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2207.666759490967,"y":3696.9194984436035,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"f15951a3.155c8","type":"outcome","name":"PendingDelete","xml":"<outcome value='PendingDelete'>\n","comments":"","outputs":1,"x":2052.3334007263184,"y":3651.919412612915,"z":"e8ec1b5b.25eae8","wires":[["c0724856.a71678"]]},{"id":"c0724856.a71678","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2207.547492980957,"y":3652.6962900161743,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"fa30ada7.b8b82","type":"outcome","name":"Pending Create","xml":"<outcome value='Pending Create'>\n","comments":"","outputs":1,"x":2054.3334007263184,"y":3608.585916519165,"z":"e8ec1b5b.25eae8","wires":[["c5efdeea.cd813"]]},{"id":"c5efdeea.cd813","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2207.547492980957,"y":3609.3627939224243,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"d8942898.40ee28","type":"outcome","name":"PendingCreate","xml":"<outcome value='PendingCreate'>\n","comments":"","outputs":1,"x":2054.3334007263184,"y":3565.25266456604,"z":"e8ec1b5b.25eae8","wires":[["1111200a.a57cf"]]},{"id":"1111200a.a57cf","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2207.547492980957,"y":3566.0295419692993,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"b8d1c104.c80f","type":"for","name":"for each A&AI subnet","xml":"<for index='subnet-index' start='0' end='`$aai.l3-network.l3-network[0].subnets.subnet_length`' >\n","comments":"","outputs":1,"x":1740.714427947998,"y":3985.966833591461,"z":"e8ec1b5b.25eae8","wires":[["20a3dcc9.d2c414"]]},{"id":"3bae4397.366dcc","type":"set","name":"set subnet_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data_length'\n   value='`$aai.l3-network.l3-network[0].subnets.subnet_length`' />\n","comments":"","x":1729.3809928894043,"y":4030.9669156074524,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"3d62856f.0bfdaa","type":"set","name":"set availability-zones.max-count and length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.max-count'\n   value='`$db.vf-model.avail-zone-max-count`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.availability-zones.availability-zone_length'\n   value='`$aai.cloud-region.availability-zones.availability-zone_length`' />\n","comments":"","x":515.0001907348633,"y":5230.467719078064,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"3f904e84.236ac2","type":"set","name":"set vnf-name","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name'\n   value='`$tmp.vnf-name`' />\n","comments":"","x":509.1666793823242,"y":2461.086464881897,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"2f6ee8ac.d68678","type":"save","name":"update generic-vnf","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"vnf-name\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name`\" />\n<parameter name=\"prov-status\" value=\"PREPROV\" />\n<!-- <parameter name=\"operational-status\" value=\"out-of-service-path\" /> -->\n<parameter name=\"equipment-role\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.nf-role`\" />\n<parameter name=\"model-invariant-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-invariant-uuid`\" />\n<parameter name=\"model-version-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-uuid`\" />\n<parameter name=\"model-customization-id\" value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-customization-uuid`\" />\n<parameter name=\"in-maint\" value=\"true\" />\n<parameter name=\"selflink\" value=\"`$vnf-object-path`\" />\n","comments":"","outputs":1,"x":435.33345794677734,"y":5440.13348197937,"z":"e8ec1b5b.25eae8","wires":[["1469ffef.b97ab","cf13876.3aba878"]]},{"id":"e52b4fda.5c0c9","type":"set","name":"set vnf-object-path","xml":"<set>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vnf-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology/'`\"/>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vnf-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n","comments":"","x":435.33349609375,"y":5370.133964538574,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"44b4e6e0.efb408","type":"set","name":"set vnf-id","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id'\n   value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n","comments":"","x":497.5000228881836,"y":2412.753007888794,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"5419c426.25e3dc","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bgb-vnf.log' />\n","comments":"","outputs":1,"x":409.6668891906738,"y":5700.610103607178,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"49551691.bbef28","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":1472.000301361084,"y":5306.8003787994385,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"9daac0d6.cc6e7","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1171.3575019836426,"y":5263.753039360046,"z":"e8ec1b5b.25eae8","wires":[["74b80d0f.921a74"]]},{"id":"5c14f9f7.cc57b8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1179.9289321899414,"y":5308.038752555847,"z":"e8ec1b5b.25eae8","wires":[["bb7cb44a.c7ff88"]]},{"id":"4a2656de.07a658","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating generic-vnf in AAI\" />\n","comments":"","x":1474.6908950805664,"y":5263.56258392334,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"5c3a26db.6eb788","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":907.0002365112305,"y":5460.13391494751,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"1469ffef.b97ab","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":609.690788269043,"y":5418.753077507019,"z":"e8ec1b5b.25eae8","wires":[["3a6f52f3.f232ee"]]},{"id":"cf13876.3aba878","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":618.2622184753418,"y":5463.03879070282,"z":"e8ec1b5b.25eae8","wires":[["db3535b7.755d98"]]},{"id":"9e7ab673.481848","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating selflink in generic-vnf in AAI\" />\n","comments":"","x":909.6908302307129,"y":5416.896120071411,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"7ac2119a.6a992","type":"set","name":"set model-customization-uuid","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.onap-model-information.model-customization-uuid'\n  value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n","comments":"","x":560.8333435058594,"y":2864.419611930847,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"9171d9a.b0de928","type":"execute","name":"split related-link","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split'>\n   <parameter name='ctx_memory_result_key' value='aai-uid-split' />\n   <parameter name='original_string' value='`$aai.cloud-region.relationship-list.relationship[$idx].related-link`' />\n   <parameter name='regex' value='/' />\n","comments":"","outputs":1,"x":1326.1666412353516,"y":2985.8331956863403,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"9dd085a5.9125b8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1145.8333435058594,"y":3032.4999837875366,"z":"e8ec1b5b.25eae8","wires":[["9171d9a.b0de928","ac1dc8b5.1c2c08","9cde0ff0.f5cae"]]},{"id":"9cde0ff0.f5cae","type":"break","name":"break","xml":"<break>\n","comments":"","x":1295.8333053588867,"y":3075.8332805633545,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"4817a39b.72d80c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":747.000129699707,"y":5141.547835350037,"z":"e8ec1b5b.25eae8","wires":[["b6053898.925798","24c70532.2ad6da"]]},{"id":"24c70532.2ad6da","type":"save","name":"save generic-vnf availability-zone relationship","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf:relationship-list\"\n   key=\"generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"availability-zone\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"cloud-region.cloud-owner\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.cloud-region.cloud-owner`\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-key\" value=\"cloud-region.cloud-region-id\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-value\" value=\"`$vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-key\" value=\"availability-zone.availability-zone-name\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-value\" value=\"`$aai.cloud-region.availability-zones.availability-zone[$idx].availability-zone-name`\" />\n","comments":"","outputs":1,"x":1040.3335189819336,"y":5164.881289482117,"z":"e8ec1b5b.25eae8","wires":[["5b50bcaf.249204","38b632d2.0a49ee"]]},{"id":"498cd8cb.c2fad8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":1597.4761810302734,"y":5188.800618171692,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"5b50bcaf.249204","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1305.1667709350586,"y":5145.753111839294,"z":"e8ec1b5b.25eae8","wires":[["1b072689.100669"]]},{"id":"38b632d2.0a49ee","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1313.7382011413574,"y":5190.038825035095,"z":"e8ec1b5b.25eae8","wires":[["d98ded51.32dd2"]]},{"id":"5bde5903.f7e3d8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating generic-vnf in AAI\" />\n","comments":"","x":1600.1667747497559,"y":5145.562823295593,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"2c1195fd.44baca","type":"set","name":"set mapping rows to 0","xml":"<set>\n<parameter name='db.vf-network-role-mapping_length' value='0' />\n","comments":"","x":1119.6428146362305,"y":3278.6905822753906,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"80da69e6.2e40f8","type":"switchNode","name":"switch AAI availability-zone_length","xml":"<switch test='`$aai.cloud-region.availability-zones.availability-zone_length`'>\n","comments":"","outputs":1,"x":487.71441650390625,"y":5045.357421875,"z":"e8ec1b5b.25eae8","wires":[["ae28bb3a.052268"]]},{"id":"ae28bb3a.052268","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":706.2858352661133,"y":5044.928831100464,"z":"e8ec1b5b.25eae8","wires":[["897b7391.5ce06"]]},{"id":"fb50ff9c.15485","type":"set","name":"set availability-zone_length to 0","xml":"<set>\n<parameter name='aai.cloud-region.availability-zones.availability-zone_length' value='0' />\n","comments":"","x":1307.7144775390625,"y":5063.500068664551,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"897b7391.5ce06","type":"switchNode","name":"switch AZ max count > 0","xml":"<switch test='`$db.vf-model.avail-zone-max-count &gt; 0`'>\n","comments":"","outputs":1,"x":894.857307434082,"y":5045.357142925262,"z":"e8ec1b5b.25eae8","wires":[["631ac6af.f1eb88","546f88fc.5cb138"]]},{"id":"631ac6af.f1eb88","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1097.7144145965576,"y":5019.642892837524,"z":"e8ec1b5b.25eae8","wires":[["9680f49c.f15f48"]]},{"id":"546f88fc.5cb138","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1099.1430358886719,"y":5063.928640365601,"z":"e8ec1b5b.25eae8","wires":[["fb50ff9c.15485"]]},{"id":"50f7d234.754b5c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No availability zones found in AAI for cloud region '\n       + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" />\n","comments":"","x":1389.142921447754,"y":5017.690585136414,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"723f0c68.e4a634","type":"execute","name":"execute PropertiesNode","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":505.95240020751953,"y":253.09524726867676,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"5fd3dc86.42fc34","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":725.9523696899414,"y":1862.5000114440918,"z":"e8ec1b5b.25eae8","wires":[["68b699c9.b709e8"]]},{"id":"d41ae7b0.2c2728","type":"switchNode","name":"switch ecomp-naming","xml":"<switch test='`$db.vf-model.ecomp-generated-naming`'>\n","comments":"","outputs":1,"x":1103.5717582702637,"y":1763.2144479751587,"z":"e8ec1b5b.25eae8","wires":[["2866d649.b436aa","f6e75ec5.9d553","79482164.75f21"]]},{"id":"68b699c9.b709e8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":871.6668701171875,"y":1862.5001287460327,"z":"e8ec1b5b.25eae8","wires":[["d41ae7b0.2c2728","f6303d1e.a403c"]]},{"id":"f6e75ec5.9d553","type":"outcome","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":1290.000144958496,"y":1763.690574645996,"z":"e8ec1b5b.25eae8","wires":[["fb2ddece.d8b09"]]},{"id":"fb2ddece.d8b09","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"No vnf-name was received but ecomp-generated-naming is not Y\" />\n","comments":"","x":1444.285930633545,"y":1782.2620191574097,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"2866d649.b436aa","type":"outcome","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1290.0001373291016,"y":1722.2620286941528,"z":"e8ec1b5b.25eae8","wires":[["891a0797.cb18c8"]]},{"id":"79482164.75f21","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1290.0000839233398,"y":1806.547706604004,"z":"e8ec1b5b.25eae8","wires":[["fb2ddece.d8b09"]]},{"id":"891a0797.cb18c8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1427.1430549621582,"y":1722.4048957824707,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"442a1f5a.45f7d","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":711.1430969238281,"y":2217.1191873550415,"z":"e8ec1b5b.25eae8","wires":[["4a21d6e3.e1ad38"]]},{"id":"4a21d6e3.e1ad38","type":"set","name":"set tmp.vnf-name","xml":"<set>\n<parameter name='tmp.vnf-name' value=\"`$vnf-topology-operation-input.vnf-request-input.vnf-name`\" />\n","comments":"","x":876.9050598144531,"y":2215.976457595825,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"1c66e9f2.191146","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":1761.9763374328613,"y":1912.261948108673,"z":"e8ec1b5b.25eae8","wires":[["751ec6a1.f034c8","98278954.9e6718"]]},{"id":"751ec6a1.f034c8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2039.119140625,"y":1885.833481311798,"z":"e8ec1b5b.25eae8","wires":[["e8445322.49fee"]]},{"id":"98278954.9e6718","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2043.8808860778809,"y":1931.2143921852112,"z":"e8ec1b5b.25eae8","wires":[["79f2b7df.fb9758"]]},{"id":"1dff847.089327c","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.action' value='ASSIGN' />\n<parameter name='generate-unique-name-input.context-id' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='generate-unique-name-input.index-table-name' value='VNF_NAME_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vnf_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='VNF_INSTANCE' />\n<parameter name='generate-unique-name-input.prefix' value=\"`'z' + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region + $db.vf-model.nf-code`\" />\n","comments":"","x":1716.9765892028809,"y":1863.357267856598,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"79f2b7df.fb9758","type":"set","name":"set tmp.vnf-name to generated name","xml":"<set>\n<parameter name='tmp.vnf-name' value='`$generate-unique-name-output.generated-name`' />\n","comments":"","x":2266.7852821350098,"y":1930.6904673576355,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"e8445322.49fee","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":2192.690601348877,"y":1885.2619910240173,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"f6303d1e.a403c","type":"switchNode","name":"switch naming-policy","xml":"<switch test='`$db.vf-model.naming-policy`'>\n","comments":"","outputs":1,"x":1101.3573417663574,"y":1971.5000648498535,"z":"e8ec1b5b.25eae8","wires":[["7379cd4d.32a3c4","5830b64c.c2b1b8"]]},{"id":"7379cd4d.32a3c4","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1291.3572731018066,"y":1892.9286193847656,"z":"e8ec1b5b.25eae8","wires":[["d8609de4.ea85d"]]},{"id":"5830b64c.c2b1b8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1291.5955123901367,"y":2020.3095636367798,"z":"e8ec1b5b.25eae8","wires":[["647ef690.4b2f08"]]},{"id":"d8609de4.ea85d","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1444.214542388916,"y":1891.5000858306885,"z":"e8ec1b5b.25eae8","wires":[["1dff847.089327c","1c66e9f2.191146"]]},{"id":"848e7ffa.8eb74","type":"call","name":"call GENERIC-RESOURCE-API:naming-policy-generate-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='naming-policy-generate-name' mode='sync' >\n","comments":"","outputs":1,"x":1783.262466430664,"y":2036.0239453315735,"z":"e8ec1b5b.25eae8","wires":[["b2088dd3.f7be4","324a59c.f595fa6"]]},{"id":"647ef690.4b2f08","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1446.1193618774414,"y":2020.3095636367798,"z":"e8ec1b5b.25eae8","wires":[["21472786.f661b8","848e7ffa.8eb74"]]},{"id":"21472786.f661b8","type":"set","name":"set variables for generating name","xml":"<set>\n<parameter name='naming-policy-generate-name-input.policy-instance-name' value='`$db.vf-model.naming-policy`' />\n<parameter name='naming-policy-generate-name-input.naming-type' value='VNF' />\n<parameter name='naming-policy-generate-name-input.context-id' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='naming-policy-generate-name-input.action' value='ASSIGN' />\n<parameter name='naming-policy-generate-name-input.query-parameter' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />","comments":"","x":1693.2623825073242,"y":1990.3095993995667,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"f3961a90.2b1428","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Unable to generate VNF name\" />\n","comments":"","x":2226.119415283203,"y":2009.880883216858,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"b03da668.afc828","type":"set","name":"set tmp.vnf-name to generated name","xml":"<set>\n<parameter name='tmp.vnf-name' value='`$naming-policy-generate-name-output.vnf-name`' />\n","comments":"","x":2304.5479850769043,"y":2054.595185279846,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"118b4943.30c787","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1987.6187744140625,"y":2836.6662101745605,"z":"e8ec1b5b.25eae8","wires":[["c425fe35.c4021","d8047b09.0a7bd8"]]},{"id":"d8047b09.0a7bd8","type":"call","name":"call GENERIC-RESOURCE-API:naming-policy-generate-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='naming-policy-generate-name' mode='sync' >\n","comments":"","outputs":1,"x":2311.9044799804688,"y":2863.237741470337,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"c425fe35.c4021","type":"set","name":"set variables for deleting name","xml":"<set>\n<parameter name='naming-policy-generate-name-input.naming-type' value='VNF' />\n<parameter name='naming-policy-generate-name-input.context-id' value='`$vnf-topology-operation-input.vnf-information.vnf-id`' />\n<parameter name='naming-policy-generate-name-input.action' value='DELETE' />\n","comments":"","x":2213.3330993652344,"y":2816.0948123931885,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"9438a7bc.c12308","type":"comment","name":"Unassign the VNF name","info":"","comments":"","x":2079.2854232788086,"y":2756.6663122177124,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"68d0d255.f3c4dc","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":927.6191101074219,"y":2921.666510105133,"z":"e8ec1b5b.25eae8","wires":[["c6e9688d.5e1bd8","118b4943.30c787"]]},{"id":"c71217d7.fa2678","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":925.952392578125,"y":2963.3332624435425,"z":"e8ec1b5b.25eae8","wires":[["3c459053.24905","118b4943.30c787"]]},{"id":"c4e8bad2.09bd68","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":782.6190643310547,"y":3144.9998922348022,"z":"e8ec1b5b.25eae8","wires":[["33aec73b.cce3a8","118b4943.30c787"]]},{"id":"b6c05c7e.f22dc","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1074.2857513427734,"y":3234.9998922348022,"z":"e8ec1b5b.25eae8","wires":[["1bfa425.654c0be","118b4943.30c787"]]},{"id":"87d839b8.bf24e8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1634.2857704162598,"y":3388.9997596740723,"z":"e8ec1b5b.25eae8","wires":[["cdbfce71.266e5","118b4943.30c787"]]},{"id":"f0b29bbe.b8cf88","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1632.619052886963,"y":3430.6665120124817,"z":"e8ec1b5b.25eae8","wires":[["1eb7d025.3b3fa","118b4943.30c787"]]},{"id":"3b7d0897.e268d8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1575.9523963928223,"y":3846.6665077209473,"z":"e8ec1b5b.25eae8","wires":[["1a86e753.589449","118b4943.30c787"]]},{"id":"9680f49c.f15f48","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1232.9524383544922,"y":5018.333201408386,"z":"e8ec1b5b.25eae8","wires":[["50f7d234.754b5c","118b4943.30c787"]]},{"id":"1b072689.100669","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1452.9524383544922,"y":5146.333201408386,"z":"e8ec1b5b.25eae8","wires":[["5bde5903.f7e3d8","118b4943.30c787"]]},{"id":"d98ded51.32dd2","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1451.2857208251953,"y":5189.999953746796,"z":"e8ec1b5b.25eae8","wires":[["498cd8cb.c2fad8","118b4943.30c787"]]},{"id":"74b80d0f.921a74","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1316.2858123779297,"y":5263.333201408386,"z":"e8ec1b5b.25eae8","wires":[["4a2656de.07a658","118b4943.30c787"]]},{"id":"bb7cb44a.c7ff88","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1314.6190948486328,"y":5306.999953746796,"z":"e8ec1b5b.25eae8","wires":[["49551691.bbef28","118b4943.30c787"]]},{"id":"3a6f52f3.f232ee","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":762.9524726867676,"y":5418.3333168029785,"z":"e8ec1b5b.25eae8","wires":[["9e7ab673.481848","118b4943.30c787"]]},{"id":"db3535b7.755d98","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":761.2857551574707,"y":5462.000069141388,"z":"e8ec1b5b.25eae8","wires":[["5c3a26db.6eb788","118b4943.30c787"]]},{"id":"b2088dd3.f7be4","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2081.428512573242,"y":2010.952452659607,"z":"e8ec1b5b.25eae8","wires":[["f3961a90.2b1428"]]},{"id":"324a59c.f595fa6","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2086.190258026123,"y":2056.33336353302,"z":"e8ec1b5b.25eae8","wires":[["b03da668.afc828"]]},{"id":"f490684e.528558","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":736.6666107177734,"y":1365.9196710586548,"z":"e8ec1b5b.25eae8","wires":[["7bc260b5.4ff39","5afeeeba.9b237"]]},{"id":"1736d58c.861d3a","type":"for","name":"for each instance group id","xml":"<for silentFailure='true' index='inst-group-index' start='0' end='`$vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids_length`' >\n","comments":"","outputs":1,"x":519.9999580383301,"y":1366.5863161087036,"z":"e8ec1b5b.25eae8","wires":[["f490684e.528558"]]},{"id":"7bc260b5.4ff39","type":"get-resource","name":"get-resource instance-group","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"instance-group\" \n\t\tkey=\"instance-group.id = $vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id\"\n        pfx='aai.instance-group' local-only='false' >\n\n","comments":"","outputs":1,"x":967.9999694824219,"y":1289.2530527114868,"z":"e8ec1b5b.25eae8","wires":[["883553c3.b2d8b","21f7ae89.1e0582"]]},{"id":"21f7ae89.1e0582","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1182.2461776733398,"y":1307.4039011001587,"z":"e8ec1b5b.25eae8","wires":[["ca1a018b.805e6"]]},{"id":"883553c3.b2d8b","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1191.1747741699219,"y":1265.6896343231201,"z":"e8ec1b5b.25eae8","wires":[["974f91a5.6729d"]]},{"id":"974f91a5.6729d","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Cannot find instance group id ' +\n      $vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id\n      + ' in AAI'`\" />\n","comments":"","x":1363.999984741211,"y":1263.2530450820923,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"ca1a018b.805e6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving instance-group from AAI\" />\n","comments":"","x":1363.999984741211,"y":1307.2530450820923,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"5afeeeba.9b237","type":"for","name":"for each relationship","xml":"<for index='rel-index' start='0' end='`$aai.instance-group.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":941.6666259765625,"y":1437.586368560791,"z":"e8ec1b5b.25eae8","wires":[["1e61f894.d6fec7"]]},{"id":"1e61f894.d6fec7","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.instance-group.relationship-list.relationship[$rel-index].related-to`'>\n","comments":"","outputs":1,"x":1155.0000686645508,"y":1437.5863075256348,"z":"e8ec1b5b.25eae8","wires":[["ba9b6c16.4914f"]]},{"id":"ba9b6c16.4914f","type":"outcome","name":"collection","xml":"<outcome value='collection'>\n","comments":"","outputs":1,"x":1326.666706085205,"y":1437.586389541626,"z":"e8ec1b5b.25eae8","wires":[["455ef4d5.0aa1fc"]]},{"id":"455ef4d5.0aa1fc","type":"get-resource","name":"get-resource collection","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"collection\" \n\t\tkey=\"collection.collection-id = $aai.instance-group.relationship-list.relationship[$rel-index].relationship-data[0].relationship-value\"\n        pfx='aai.collection' local-only='false' >\n\n","comments":"","outputs":1,"x":1546.6666107177734,"y":1435.9196510314941,"z":"e8ec1b5b.25eae8","wires":[["fe6345c0.36dc28","1f11b2d9.d750ed","e9d5552e.f591d8"]]},{"id":"1f11b2d9.d750ed","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1760.9128036499023,"y":1387.4038400650024,"z":"e8ec1b5b.25eae8","wires":[["4020f4c.62d620c"]]},{"id":"fe6345c0.36dc28","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1769.8414001464844,"y":1345.6895732879639,"z":"e8ec1b5b.25eae8","wires":[["977b3571.591588"]]},{"id":"977b3571.591588","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Cannot find collection ' +\n      $aai.instance-group.relationship-list.relationship[$rel-index].relationship-data[0].relationship-value\n      + ' in AAI'`\" />\n","comments":"","x":1926.6666107177734,"y":1344.2530450820923,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"4020f4c.62d620c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"System error retrieving collection from AAI\" />\n","comments":"","x":1926.6666107177734,"y":1388.2530450820923,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"e9d5552e.f591d8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1760.0000114440918,"y":1524.2530164718628,"z":"e8ec1b5b.25eae8","wires":[["84f48d47.1e81a"]]},{"id":"84f48d47.1e81a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1913.333152770996,"y":1523.5863122940063,"z":"e8ec1b5b.25eae8","wires":[["82b16034.72c0f","41789b77.9ec0c4","65c06bbb.b43474","4cd92fc0.2488d","ec3945da.078a08"]]},{"id":"82b16034.72c0f","type":"for","name":"for each network-instance-group","xml":"<for silentFailure='true' index='nig-index' start='0' end='`$service-data.network-instance-groups.network-instance-group_length`' >\n","comments":"","outputs":1,"x":2151.6664962768555,"y":1474.2530603408813,"z":"e8ec1b5b.25eae8","wires":[["1779f04d.69bc"]]},{"id":"41789b77.9ec0c4","type":"set","name":"set found-network-instance-group to false","xml":"<set>\n<parameter name='found-network-instance-group' value='false' />\n","comments":"","x":2181.666458129883,"y":1427.5864324569702,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"1779f04d.69bc","type":"switchNode","name":"network-instance-group-id matches?","xml":"<switch test='`$vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id\n  == $service-data.network-instance-groups.network-instance-group[$nig-index].network-instance-group-id`'>\n","comments":"","outputs":1,"x":2468.3330078125,"y":1474.253059387207,"z":"e8ec1b5b.25eae8","wires":[["fcb77550.796ac8"]]},{"id":"fcb77550.796ac8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2689.999786376953,"y":1474.2530241012573,"z":"e8ec1b5b.25eae8","wires":[["b7155259.18dea"]]},{"id":"b7155259.18dea","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2819.9998168945312,"y":1474.2531003952026,"z":"e8ec1b5b.25eae8","wires":[["70ace769.5b37d8","1bb2d945.055c07"]]},{"id":"70ace769.5b37d8","type":"set","name":"set found-network-instance-group to true","xml":"<set>\n<parameter name='found-network-instance-group' value='true' />\n","comments":"","x":3053.332992553711,"y":1445.9197254180908,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"1bb2d945.055c07","type":"break","name":"break","xml":"<break>\n","comments":"","x":2946.666606903076,"y":1494.253095626831,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"65c06bbb.b43474","type":"switchNode","name":"switch found-network-instance-group","xml":"<switch test='`$found-network-instance-group`'>\n","comments":"","outputs":1,"x":2163.3331146240234,"y":1524.253041267395,"z":"e8ec1b5b.25eae8","wires":[["2dc995c2.b4565a"]]},{"id":"2dc995c2.b4565a","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2384.9999618530273,"y":1524.2530636787415,"z":"e8ec1b5b.25eae8","wires":[["cad8a7f6.abfb78"]]},{"id":"cad8a7f6.abfb78","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Could not find network instance group ' +\n      $vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id\n      + ' in MD-SAL'`\" />\n","comments":"","x":2531.666534423828,"y":1522.5863981246948,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"53d39bcb.6061e4","type":"set","name":"set tmp.vnf-network-collection_length to 0","xml":"<set>\n<parameter name='tmp.vnf-network-collection_length' value='0' />\n","comments":"","x":568.3332977294922,"y":1317.5864477157593,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"4cd92fc0.2488d","type":"set","name":"set vnf-network-collection data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection[$tmp.vnf-network-collection_length].network-instance-group-function'\n  value='`$aai.instance-group.instance-group-function`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection[$tmp.vnf-network-collection_length].network-instance-group-id'\n  value='`$aai.instance-group.id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection[$tmp.vnf-network-collection_length].network-collection-service-instance-id'\n  value='`$service-data.network-instance-groups.network-instance-group[$nig-index].service-instance-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection[$tmp.vnf-network-collection_length].network-collection-customization-uuid'\n  value='`$aai.collection.collection-customization-id`' />\n","comments":"","x":2143.333438873291,"y":1572.5863771438599,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"ec3945da.078a08","type":"set","name":"increment tmp.vnf-network-collection_length","xml":"<set>\n<parameter name='tmp.vnf-network-collection_length' value='`$tmp.vnf-network-collection_length + 1`' />\n","comments":"","x":2185.000144958496,"y":1619.2530450820923,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"de66456a.ee6e38","type":"set","name":"set vnf-network-collection_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-network-collections.vnf-network-collection_length'\n  value='`$tmp.vnf-network-collection_length`' />\n","comments":"","x":547.4999923706055,"y":1575.0863971710205,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"62f81f1e.1424f","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":672.0000801086426,"y":5534.729342460632,"z":"e8ec1b5b.25eae8","wires":[["76b4e702.640838"]]},{"id":"58179bd9.e06a74","type":"for","name":"for each instance group id","xml":"<for silentFailure='true' index='inst-group-index' start='0' end='`$vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids_length`' >\n","comments":"","outputs":1,"x":455.3334274291992,"y":5535.395987510681,"z":"e8ec1b5b.25eae8","wires":[["62f81f1e.1424f"]]},{"id":"76b4e702.640838","type":"save","name":"save generic-vnf relationship to instance-group","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"generic-vnf:relationship-list\"\n   key=\"generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-information.vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"instance-group\" />\n    <parameter name=\"relationship-list.relationship[0].related-link\"\n      value=\"`'/aai/v$/network/instance-groups/instance-group/'\n        + $vnf-topology-operation-input.vnf-request-input.vnf-network-instance-group-ids[$inst-group-index].vnf-network-instance-group-id`\" />\n","comments":"","outputs":1,"x":955.3334083557129,"y":5534.253023147583,"z":"e8ec1b5b.25eae8","wires":[["8790d355.18cf1","3d210704.8012c8"]]},{"id":"cf023861.798238","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No generic-vnf found in AAI for vnf ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-id`\" />\n","comments":"","x":1512.0000801086426,"y":5552.586276054382,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"8790d355.18cf1","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1214.690631866455,"y":5511.205438613892,"z":"e8ec1b5b.25eae8","wires":[["df30bfde.d3826"]]},{"id":"3d210704.8012c8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1223.262062072754,"y":5555.491151809692,"z":"e8ec1b5b.25eae8","wires":[["70ba0d3c.069cc4"]]},{"id":"aa1a159.3823ae8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating relationship in generic-vnf in AAI\" />\n","comments":"","x":1514.6906814575195,"y":5509.348539352417,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"df30bfde.d3826","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1367.9523162841797,"y":5510.785677909851,"z":"e8ec1b5b.25eae8","wires":[["aa1a159.3823ae8","118b4943.30c787"]]},{"id":"70ba0d3c.069cc4","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1366.2855987548828,"y":5554.4524302482605,"z":"e8ec1b5b.25eae8","wires":[["cf023861.798238","118b4943.30c787"]]},{"id":"56c99275.ec16cc","type":"switchNode","name":"switch subnet_length","xml":"<switch test='`$aai.l3-network.l3-network[0].subnets.subnet_length`'>\n","comments":"","outputs":1,"x":1276.90482711792,"y":3967.3483905792236,"z":"e8ec1b5b.25eae8","wires":[["c2a1b5ea.d961c8","6d55b1f6.6100e","5062f58.6ec680c"]]},{"id":"c2a1b5ea.d961c8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1449.7619895935059,"y":3930.2054500579834,"z":"e8ec1b5b.25eae8","wires":[["c164d981.2b8148"]]},{"id":"6d55b1f6.6100e","type":"outcome","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":1451.190559387207,"y":3968.7766132354736,"z":"e8ec1b5b.25eae8","wires":[["c164d981.2b8148"]]},{"id":"5062f58.6ec680c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1449.7620239257812,"y":4007.3480052948,"z":"e8ec1b5b.25eae8","wires":[["894a23e6.abb5a"]]},{"id":"894a23e6.abb5a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1571.1905784606934,"y":4007.3482723236084,"z":"e8ec1b5b.25eae8","wires":[["b8d1c104.c80f","3bae4397.366dcc"]]},{"id":"c164d981.2b8148","type":"set","name":"set subnet_length to 0","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data_length'\n   value='0' />\n","comments":"","x":1642.61918258667,"y":3938.7766132354736,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"b0716910.236c28","type":"switchNode","name":"switch: sdnc-model-name && sdnc-artifact-name != null","xml":"<switch test=\"`$db.vf-model.sdnc-model-name != '' and $db.vf-model.sdnc-artifact-name != ''`\">","comments":"","outputs":1,"x":1553.1508903503418,"y":949.2529373168945,"z":"e8ec1b5b.25eae8","wires":[["bcb277a4.03f3f8","fe4a9ab9.3f90e8"]]},{"id":"bcb277a4.03f3f8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1856.2222785949707,"y":921.9316024780273,"z":"e8ec1b5b.25eae8","wires":[["7896efad.23d56"]]},{"id":"40c47c9b.137174","type":"switchNode","name":"switch: param[].name","xml":"<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$p].name`\">\n","comments":"","outputs":1,"x":1067.2817306518555,"y":597.4554109573364,"z":"e8ec1b5b.25eae8","wires":[["9e25820f.c5ad7","3afce2da.a4cbfe"]]},{"id":"75da7216.d5d6dc","type":"for","name":"for p in vnf-input-parameters,param[]","xml":"<for silentFailure='true' index='p' start='0' end='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`' >\n","comments":"","outputs":1,"x":773.3888778686523,"y":597.9554433822632,"z":"e8ec1b5b.25eae8","wires":[["40c47c9b.137174"]]},{"id":"fac8ea6c.257f58","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1263.5914459228516,"y":949.2052011489868,"z":"e8ec1b5b.25eae8","wires":[["b0716910.236c28"]]},{"id":"760c4fdd.39f82","type":"call","name":"call self-serve-vnf-assign","xml":"<call module='GENERIC-RESOURCE-API' rpc='self-serve-vnf-assign' mode='sync' >\n","comments":"","outputs":1,"x":2145.5909538269043,"y":717.0983695983887,"z":"e8ec1b5b.25eae8","wires":[["7f61ffc2.3617e"]]},{"id":"53fbd2a9.80e7fc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Failed to create self-serve assignment for vnf with vnf-id=' + $vnf-topology-operation-input.vnf-information.vnf-id`\" />\n","comments":"","x":2529.6623306274414,"y":717.0983200073242,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"fe4a9ab9.3f90e8","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1859.1150245666504,"y":978.5386066436768,"z":"e8ec1b5b.25eae8","wires":[["6b5bbadc.1a2bd4"]]},{"id":"3694a0e3.50648","type":"set","name":"set tmp.exist.sdnc-artifact-name = true","xml":"<set>\n<parameter name='tmp.exist.sdnc-artifact-name' value='true' />","comments":"","x":1609.174659729004,"y":647.3125810623169,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"bd0b550f.f20b78","type":"set","name":"set tmp.exist.sdnc-model-name = true","xml":"<set>\n<parameter name='tmp.exist.sdnc-model-name' value='true' />\n","comments":"","x":1605.8887672424316,"y":597.312596321106,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"3e14018b.25a1fe","type":"switchNode","name":"switch: tmp.exist.sdnc-model-name && tmp.exist.sdnc-artifact-name == true","xml":"<switch test=\"`$tmp.exist.sdnc-model-name == 'true' and $tmp.exist.sdnc-artifact-name == 'true'`\">\n","comments":"","outputs":1,"x":894.6626281738281,"y":864.6100387573242,"z":"e8ec1b5b.25eae8","wires":[["8bc999e5.350fb8","fac8ea6c.257f58"]]},{"id":"8bc999e5.350fb8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1264.8413200378418,"y":786.7290534973145,"z":"e8ec1b5b.25eae8","wires":[["7896efad.23d56"]]},{"id":"8ab0c788.cabc78","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":480.31744384765625,"y":630.1221513748169,"z":"e8ec1b5b.25eae8","wires":[["75da7216.d5d6dc","3e14018b.25a1fe","7a388264.4024fc","d8145bff.5b58a8"]]},{"id":"123b8627.bebeba","type":"comment","name":"SELF-SERVE FORK","info":"","comments":"","x":473.8888854980469,"y":582.2649993896484,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"9e25820f.c5ad7","type":"outcome","name":"sdnc_model_name","xml":"<outcome value='sdnc_model_name'>\n","comments":"","outputs":1,"x":1323.4603064400808,"y":597.3602053778511,"z":"e8ec1b5b.25eae8","wires":[["bd0b550f.f20b78"]]},{"id":"3afce2da.a4cbfe","type":"outcome","name":"sdnc_artifact_name","xml":"<outcome value='sdnc_artifact_name'>\n","comments":"","outputs":1,"x":1326.3174285888672,"y":646.7887773513794,"z":"e8ec1b5b.25eae8","wires":[["3694a0e3.50648"]]},{"id":"7f61ffc2.3617e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2350.8885345458984,"y":716.5864009857178,"z":"e8ec1b5b.25eae8","wires":[["53fbd2a9.80e7fc"]]},{"id":"d1a098.413fcf68","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":253.4126968383789,"y":376.87208461761475,"z":"e8ec1b5b.25eae8","wires":[["723f0c68.e4a634","59a1abf1.362d04","55463f33.2c23d","8ab0c788.cabc78"]]},{"id":"20a3dcc9.d2c414","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1912.3810348510742,"y":3985.952467918396,"z":"e8ec1b5b.25eae8","wires":[["85154396.cb013","f5325de5.ae019","89e0c2e2.7a7e3","d07676cd.122998"]]},{"id":"760fe2dd.1dfb2c","type":"set","name":"clear aai.l3-network","xml":"<set>\n<parameter name='aai.l3-network.' value='' />\n","comments":"","x":1270.952480316162,"y":3358.8095865249634,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"ffa30adb.733078","type":"break","name":"break","xml":"<break>\n","comments":"","x":3712.666416168213,"y":3885.9521503448486,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"58b0e.d80c54f24","type":"set","name":"set found-network to false","xml":"<set>\n<parameter name='found-network' value='false' />\n","comments":"","x":1412.3810081481934,"y":3591.6665544509888,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"ae76c6a1.158798","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2384.095314025879,"y":3745.952350616455,"z":"e8ec1b5b.25eae8","wires":[["1232d671.cdc82a","c5192019.5c36"]]},{"id":"c5192019.5c36","type":"switchNode","name":"switch found-network","xml":"<switch test='`$found-network`'>\n","comments":"","outputs":1,"x":2575.5238609313965,"y":3775.952404975891,"z":"e8ec1b5b.25eae8","wires":[["491daae3.24d854"]]},{"id":"97c14cfc.3ab92","type":"set","name":"set found-network to true","xml":"<set>\n<parameter name='found-network' value='true' />\n","comments":"","x":3768.3812942504883,"y":3840.2378311157227,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"491daae3.24d854","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2744.0953521728516,"y":3775.9523344039917,"z":"e8ec1b5b.25eae8","wires":[["4032fcd9.511d64"]]},{"id":"4032fcd9.511d64","type":"break","name":"break","xml":"<break>\n","comments":"","x":2874.0954208374023,"y":3774.5237283706665,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"a76e5ba0.e05798","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1584.381031036377,"y":3719.6666288375854,"z":"e8ec1b5b.25eae8","wires":[["47c50243.5c9d6c","678a2604.2ed118"]]},{"id":"678a2604.2ed118","type":"switchNode","name":"switch found-network","xml":"<switch test='`$found-network`'>\n","comments":"","outputs":1,"x":1794.3809852600098,"y":3791.666512489319,"z":"e8ec1b5b.25eae8","wires":[["6e62113.f6166f"]]},{"id":"6e62113.f6166f","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1962.9524765014648,"y":3791.6664419174194,"z":"e8ec1b5b.25eae8","wires":[["49c6544b.834c8c"]]},{"id":"49c6544b.834c8c","type":"break","name":"break","xml":"<break>\n","comments":"","x":2092.9525451660156,"y":3790.2378358840942,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"7a388264.4024fc","type":"set","name":"initialize tmp.exist.sdnc-model-name && tmp.exist.sdnc-artifact-name = false","xml":"<set>\n<parameter name='tmp.exist.sdnc-model-name' value='false' />\n<parameter name='tmp.exist.sdnc-artifact-name' value='false' />","comments":"","x":893.4762344360352,"y":500.58631229400635,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"a22c9d12.51325","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":2111.9998893737793,"y":879.2529373168945,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"d38533aa.d54fd","type":"set","name":"set vnf-level-oper-status to PendingCreate","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='PendingCreate' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n","comments":"","x":2201.813335418701,"y":781.5904178619385,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"63841365.9709dc","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/ss-vnfend.log' />\n","comments":"","outputs":1,"x":2106.9046173095703,"y":828.0301866531372,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"7896efad.23d56","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1917.9997100830078,"y":794.2529373168945,"z":"e8ec1b5b.25eae8","wires":[["760c4fdd.39f82","d38533aa.d54fd","63841365.9709dc","a22c9d12.51325"]]},{"id":"89e0c2e2.7a7e3","type":"set","name":"set subnet data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].ip-version'\n   value='`$tmp.ip-version`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].subnet-id'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].neutron-subnet-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].sdnc-subnet-id'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].subnet-role'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-role`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].subnet-name'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-name`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].network-start-address'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].network-start-address`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].gateway-address'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].gateway-address`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].cidr-mask'\n   value='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].cidr-mask`' />\n","comments":"","x":2066.6668014526367,"y":4016.634214401245,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"d07676cd.122998","type":"switchNode","name":"switch dhcp-enabled","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].dhcp-enabled`'>\n","comments":"","outputs":1,"x":2081.1905822753906,"y":4069.477168083191,"z":"e8ec1b5b.25eae8","wires":[["ece733b7.c2ab7","613bc753.1a3078"]]},{"id":"ece733b7.c2ab7","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2244.0477469308034,"y":4048.0485258102417,"z":"e8ec1b5b.25eae8","wires":[["e6054e9f.0ed55"]]},{"id":"613bc753.1a3078","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2242.6190795898438,"y":4093.762951850891,"z":"e8ec1b5b.25eae8","wires":[["badfb568.db4ec8"]]},{"id":"e6054e9f.0ed55","type":"set","name":"set dhcp-enabled to Y","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].dhcp-enabled'\n   value='Y' />\n","comments":"","x":2416.904945373535,"y":4046.619921684265,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"badfb568.db4ec8","type":"set","name":"set dhcp-enabled to N","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].subnets-data.subnet-data[$subnet-index].dhcp-enabled'\n   value='N' />\n","comments":"","x":2414.0477142333984,"y":4093.762951850891,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"85154396.cb013","type":"switchNode","name":"switch subnet-role","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-role`'>\n","comments":"","outputs":1,"x":2081.6667518615723,"y":3898.5248403549194,"z":"e8ec1b5b.25eae8","wires":[["7879703a.5c311"]]},{"id":"7879703a.5c311","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2248.333354949951,"y":3898.524492263794,"z":"e8ec1b5b.25eae8","wires":[["66015853.97e9b8"]]},{"id":"66015853.97e9b8","type":"set","name":"set subnet-role to NONE","xml":"<set>\n<parameter name='aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].subnet-role' value='NONE' />\n","comments":"","x":2430.000141143799,"y":3897.858144760132,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"f5325de5.ae019","type":"switchNode","name":"switch ip-version","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].subnets.subnet[$subnet-index].ip-version`'>\n","comments":"","outputs":1,"x":2076.905086517334,"y":3963.0159463882446,"z":"e8ec1b5b.25eae8","wires":[["97a36cc.e440f9","c66ef49c.bc1028"]]},{"id":"97a36cc.e440f9","type":"outcome","name":"4","xml":"<outcome value='4'>\n","comments":"","outputs":1,"x":2242.619228363037,"y":3944.4443435668945,"z":"e8ec1b5b.25eae8","wires":[["7207ab9c.c24bd4"]]},{"id":"c66ef49c.bc1028","type":"outcome","name":"6","xml":"<outcome value='6'>\n","comments":"","outputs":1,"x":2242.6191902160645,"y":3985.8730869293213,"z":"e8ec1b5b.25eae8","wires":[["4e83553c.c8a3ac"]]},{"id":"7207ab9c.c24bd4","type":"set","name":"set tmp.ip-version to ipv4","xml":"<set>\n<parameter name='tmp.ip-version' value='ipv4' />\n","comments":"","x":2429.761993408203,"y":3943.5872707366943,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"4e83553c.c8a3ac","type":"set","name":"set tmp.ip-version to ipv6","xml":"<set>\n<parameter name='tmp.ip-version' value='ipv6' />\n","comments":"","x":2428.3335456848145,"y":3985.87308883667,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"d8145bff.5b58a8","type":"switchNode","name":"switch: vnf-input-parameters.param_length","xml":"<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n","comments":"","outputs":1,"x":791.9047927856445,"y":546.3958168029785,"z":"e8ec1b5b.25eae8","wires":[["664591b9.95078"]]},{"id":"664591b9.95078","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1055.4762115478516,"y":546.6815567016602,"z":"e8ec1b5b.25eae8","wires":[["6f8e5e3f.fa705"]]},{"id":"6f8e5e3f.fa705","type":"set","name":"set vnf-input-parameters.param_length = 0","xml":"<set>\n<parameter name='vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length' value='0' />\n","comments":"","x":1329.1904525756836,"y":546.5387182235718,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"f2648fe0.20797","type":"switchNode","name":"switch network-role","xml":"<switch test='`$db.vf-network-role-mapping[$role-index].network-role`'>\n","comments":"","outputs":1,"x":709.3332786560059,"y":3971.2529973983765,"z":"e8ec1b5b.25eae8","wires":[["e804954a.844478","ac124cb9.c9e89"]]},{"id":"e804954a.844478","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":875.9998741149902,"y":3939.586247444153,"z":"e8ec1b5b.25eae8","wires":[["ea1e164f.56ab98"]]},{"id":"ac124cb9.c9e89","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":875.9999198913574,"y":3997.919596672058,"z":"e8ec1b5b.25eae8","wires":[["de751662.485548"]]},{"id":"ea1e164f.56ab98","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1007.6666259765625,"y":3937.91943359375,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"a2979752.466c68","type":"get-resource","name":"get-resource VNF_RELATED_NETWORK_ROLE","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VNF_RELATED_NETWORK_ROLE where vnf_customization_uuid = $vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid\n    and network_role = $db.vf-network-role-mapping[$role-index].network-role'\n  pfx='db.vnf-related-network-role[]'>\n\n","comments":"","outputs":1,"x":1371.3333740234375,"y":4300.99951171875,"z":"e8ec1b5b.25eae8","wires":[["d5da04c2.831d68","417a0c6.89cb7f4"]]},{"id":"d5da04c2.831d68","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1640.0000381469727,"y":4131.666353225708,"z":"e8ec1b5b.25eae8","wires":[["73857f5d.9780f"]]},{"id":"40da1bae.aefd54","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VNF_RELATED_NETWORK_ROLE table\" />\n","comments":"","x":1950.0000114440918,"y":4131.475923538208,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"73857f5d.9780f","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1787.1905555725098,"y":4130.214367866516,"z":"e8ec1b5b.25eae8","wires":[["40da1bae.aefd54","118b4943.30c787"]]},{"id":"417a0c6.89cb7f4","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1643.0000686645508,"y":4494.3328647613525,"z":"e8ec1b5b.25eae8","wires":[["fae3c123.fda82"]]},{"id":"fae3c123.fda82","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1809.3333740234375,"y":4492.33251953125,"z":"e8ec1b5b.25eae8","wires":[["d1f90e23.7598f","aba2df1e.ce563","e56630b1.65dd1","bdbd922d.d1ded","147826c5.2960b9","ff3a4d05.fa794","b9de881d.e81fb8","ff11ad51.304dd","5e448db.bf50774"]]},{"id":"4a3685d2.0b6dec","type":"outcome","name":"service-instance","xml":"<outcome value='service-instance'>\n","comments":"","outputs":1,"x":2747.6188430786133,"y":3664.5711908340454,"z":"e8ec1b5b.25eae8","wires":[["29f2c7aa.bc2638"]]},{"id":"29f2c7aa.bc2638","type":"for","name":"for each relationship data","xml":"<for silentFailure='true' index='db-data-index' start='0' end='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data_length`' >\n","comments":"","outputs":1,"x":2973.094680786133,"y":3664.9998207092285,"z":"e8ec1b5b.25eae8","wires":[["96a81b94.9e1e78"]]},{"id":"96a81b94.9e1e78","type":"switchNode","name":"switch relationship-key","xml":"<switch test='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-key`'>\n","comments":"","outputs":1,"x":3208.333251953125,"y":3663.333251953125,"z":"e8ec1b5b.25eae8","wires":[["fd82d26.874d53"]]},{"id":"fd82d26.874d53","type":"outcome","name":"service-instance.service-instance-id","xml":"<outcome value='service-instance.service-instance-id'>\n","comments":"","outputs":1,"x":3474.7616119384766,"y":3663.333315849304,"z":"e8ec1b5b.25eae8","wires":[["4e6e2d9a.8e0d64"]]},{"id":"4e6e2d9a.8e0d64","type":"set","name":"set network-service-instance-id","xml":"<set>\n<parameter name='network-service-instance-id'\n  value='`$aai.l3-network.l3-network[$db-network-index].relationship-list.relationship[$db-rel-index].relationship-data[$db-data-index].relationship-value`' />\n","comments":"","x":3768.333396911621,"y":3661.6667308807373,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"d1f90e23.7598f","type":"execute","name":"generate network-topology-identifier-structure url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.network-topology-identifier-structure`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.part\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$network-service-instance-id`\"/>\n","comments":"","outputs":1,"x":2128.6665420532227,"y":4188.000152587891,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"e56630b1.65dd1","type":"execute","name":"execute RestApiCallNode - get network-topology-identifier-structure","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ntis-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ntis\" />\n\n","comments":"","outputs":1,"x":2185.6663360595703,"y":4291.428893089294,"z":"e8ec1b5b.25eae8","wires":[["3ae666ff.d9d46a"]]},{"id":"aba2df1e.ce563","type":"execute","name":"generate network-topology-identifier-structure url (part 2)","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.part`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ntis-url\"/>\n    <parameter name=\"target\" value=\"{network-id}\"/>\n    <parameter name=\"replacement\" value=\"`$l3-network-id`\"/>\n","comments":"","outputs":1,"x":2150.3331298828125,"y":4231.33349609375,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"4f148391.ee5fec","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bgb-vnfa.log' />\n","comments":"","outputs":1,"x":455.666748046875,"y":4137.99951171875,"z":"e8ec1b5b.25eae8","wires":[[]]},{"id":"3ae666ff.d9d46a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2514.7755241394043,"y":4291.179370880127,"z":"e8ec1b5b.25eae8","wires":[["1925434a.c3edcd"]]},{"id":"cb23ca54.e697b8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`\n    'Error retrieving network-topology-identifier-structure for service instance '\n    + $network-service-instance-id\n    + ' and network-id '\n    + $l3-network-id`\" />\n","comments":"","x":2819.999900817871,"y":4301.665860176086,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"1925434a.c3edcd","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2652.190414428711,"y":4290.404459953308,"z":"e8ec1b5b.25eae8","wires":[["cb23ca54.e697b8","118b4943.30c787"]]},{"id":"bdbd922d.d1ded","type":"set","name":"set is-trunked and segmentation-id in vnf-network","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].is-trunked'\n    value='`$mdsal-ntis.network-topology-identifier-structure.is-trunked`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].segmentation-id'\n    value='`$mdsal-ntis.network-topology-identifier-structure.segmentation-id`' />\n    ","comments":"","x":2128.3333587646484,"y":4351.66651725769,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"ff3a4d05.fa794","type":"save","name":"custom query: get owning entity","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.oe\">\n<parameter name=\"start[0]\" value=\"`'nodes/service-instances/service-instance?service-instance-id=' + $network-service-instance-id `\" />\n<parameter name=\"start_length\" value=\"1\" />\n<parameter name=\"query\" value=\"/query/owning-entity-fromService-instance\" /> \n","comments":"","outputs":1,"x":2069.333251953125,"y":4427,"z":"e8ec1b5b.25eae8","wires":[["452d23cd.89694c","d36953d7.3bd71"]]},{"id":"452d23cd.89694c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2279.571300506592,"y":4405.666354179382,"z":"e8ec1b5b.25eae8","wires":[["9e3df671.a6ba78"]]},{"id":"d36953d7.3bd71","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2286.714195251465,"y":4451.380578994751,"z":"e8ec1b5b.25eae8","wires":[["75caa341.98c94c"]]},{"id":"8e882362.a7d54","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error getting owning entity from service instance\" />\n","comments":"","x":2584.333251953125,"y":4403.66650390625,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"9e3df671.a6ba78","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2421.523796081543,"y":4402.404948234558,"z":"e8ec1b5b.25eae8","wires":[["8e882362.a7d54","118b4943.30c787"]]},{"id":"713603be.2036ac","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Unable to find owning entity from service instance\" />\n","comments":"","x":2582.666748046875,"y":4453.66650390625,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"75caa341.98c94c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2419.857292175293,"y":4452.404948234558,"z":"e8ec1b5b.25eae8","wires":[["713603be.2036ac","118b4943.30c787"]]},{"id":"84c147bf.f09848","type":"save","name":"custom query: get tenant network","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n      resource=\"custom-query\"\n      key=\"format = 'resource'\"\n      force=\"true\"\n      local-only=\"false\"\n      pfx=\"tmp.AnAI-data.get-networks\">\n<parameter name=\"start[0]\" value=\"`'/business/owning-entities/owning-entity/' + $tmp.AnAI-data.oe.results[0].owning-entity.owning-entity-id `\" />\n<parameter name=\"start_length\" value=\"1\" />\n<parameter name=\"query\" value=\"`'/query/getNetworks?networkRole=' + $db.vnf-related-network-role[$rel-network-role-index].related-network-role\n  + '&amp;cloudRegionId=' + $vnf-topology-operation-input.vnf-request-input.aic-cloud-region`\" /> \n","comments":"","outputs":1,"x":2519.000068664551,"y":4600.000137329102,"z":"e8ec1b5b.25eae8","wires":[["fc81a3c7.16632","155caabc.a621e5"]]},{"id":"fc81a3c7.16632","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2732.2381172180176,"y":4578.66663646698,"z":"e8ec1b5b.25eae8","wires":[["670c54d4.9abc8c"]]},{"id":"155caabc.a621e5","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2739.3810119628906,"y":4624.380861282349,"z":"e8ec1b5b.25eae8","wires":[["db8ac4dd.2f1bf8"]]},{"id":"a087be8.ecf174","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error calling getNetworks custom query in AAI\" />\n","comments":"","x":3037.000068664551,"y":4576.666786193848,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"670c54d4.9abc8c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2874.1906127929688,"y":4575.405230522156,"z":"e8ec1b5b.25eae8","wires":[["a087be8.ecf174","118b4943.30c787"]]},{"id":"d486ece4.4e8bb","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No l3-network returned from getNetworks custom query for related network role '\n      + $db.vnf-related-network-role[0].related-network-role`\" />\n","comments":"","x":3035.333564758301,"y":4626.666786193848,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"db8ac4dd.2f1bf8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2872.5241088867188,"y":4625.405230522156,"z":"e8ec1b5b.25eae8","wires":[["d486ece4.4e8bb","118b4943.30c787"]]},{"id":"a2478fc4.d5865","type":"for","name":"for each relationship","xml":"<for index='rel-index' start='0' end='`$tmp.AnAI-data.get-networks.results[0].l3-network.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":2486.000068664551,"y":4726.000282287598,"z":"e8ec1b5b.25eae8","wires":[["3552a801.ece7d8"]]},{"id":"3552a801.ece7d8","type":"switchNode","name":"switch related-to","xml":"<switch test='`$tmp.AnAI-data.get-networks.results[0].l3-network.relationship-list.relationship[$rel-index].related-to`'>\n","comments":"","outputs":1,"x":2684.000068664551,"y":4726.000282287598,"z":"e8ec1b5b.25eae8","wires":[["7c52c16e.8b6a"]]},{"id":"7c52c16e.8b6a","type":"outcome","name":"vlan-tag","xml":"<outcome value='vlan-tag'>\n","comments":"","outputs":1,"x":2854.000068664551,"y":4726.000282287598,"z":"e8ec1b5b.25eae8","wires":[["429b9c27.2483c4"]]},{"id":"429b9c27.2483c4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3022.000068664551,"y":4724.000282287598,"z":"e8ec1b5b.25eae8","wires":[["dcb4370.d4aa8c8","51eb5f36.e3a87","9e6ca1e7.6cd83"]]},{"id":"dcb4370.d4aa8c8","type":"set","name":"set vlan-tag-id","xml":"<set>\n<parameter name='vlan-tag-id' value='`$tmp.AnAI-data.get-networks.results[0].l3-network.relationship-list.relationship[$rel-index].relationship-data[0].relationship-value`' />\n","comments":"","x":3198.000068664551,"y":4684.000282287598,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"51eb5f36.e3a87","type":"get-resource","name":"get-resource vlan-tag","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"vlan-tag\" \n\t\tkey=\"vlan-tag.vlan-tag-id = $vlan-tag-id\"\n        pfx='aai.vlan-tag' local-only='false'\n>\n","comments":"","outputs":1,"x":3220.000068664551,"y":4742.000282287598,"z":"e8ec1b5b.25eae8","wires":[["aa8950d4.db6ad","b4471501.e714b8"]]},{"id":"aa8950d4.db6ad","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3400.047676086426,"y":4724.143348693848,"z":"e8ec1b5b.25eae8","wires":[["f52d0ec.556fcf"]]},{"id":"f52d0ec.556fcf","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":3542.8569564819336,"y":4724.333990573883,"z":"e8ec1b5b.25eae8","wires":[["883325ac.a7d828","118b4943.30c787"]]},{"id":"883325ac.a7d828","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error getting vlan-tag object from AAI\" />\n","comments":"","x":3703.9999618530273,"y":4720.000509262085,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"147826c5.2960b9","type":"for","name":"for each related network role","xml":"<for index='rel-network-role-index' start='0' end='`$db.vnf-related-network-role_length`' >\n","comments":"","outputs":1,"x":2057,"y":4656.333847045898,"z":"e8ec1b5b.25eae8","wires":[["3c69485c.a44408"]]},{"id":"3c69485c.a44408","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2262,"y":4657.6669921875,"z":"e8ec1b5b.25eae8","wires":[["84c147bf.f09848","a2478fc4.d5865","cd9e40b7.8a9e5"]]},{"id":"ff11ad51.304dd","type":"switchNode","name":"switch rn-index","xml":"<switch test='`$rn-index`'>\n","comments":"","outputs":1,"x":2018,"y":4546,"z":"e8ec1b5b.25eae8","wires":[["1ba540c9.8325bf"]]},{"id":"b9de881d.e81fb8","type":"set","name":"set rn-index to related network length","xml":"<set>\n<parameter name='rn-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network_length`' />\n","comments":"","x":2086.66658782959,"y":4496.999853134155,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"1ba540c9.8325bf","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":2182,"y":4546,"z":"e8ec1b5b.25eae8","wires":[["4007d641.ad2628"]]},{"id":"4007d641.ad2628","type":"set","name":"set rn-index to 0","xml":"<set>\n<parameter name='rn-index' value='0' />\n","comments":"","x":2342,"y":4546,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"cd9e40b7.8a9e5","type":"set","name":"set related-network data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].network-id'\n  value='`$tmp.AnAI-data.get-networks.results[0].l3-network.network-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].network-role'\n  value='`$tmp.AnAI-data.get-networks.results[0].l3-network.network-role`' />\n","comments":"","x":2489.6666564941406,"y":4656.66682434082,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"5e448db.bf50774","type":"set","name":"set new related network length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network_length'\n  value='`$rn-index + 1`' />\n","comments":"","x":2052.000068664551,"y":4800.000137329102,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"b4471501.e714b8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":3402.000068664551,"y":4772.000137329102,"z":"e8ec1b5b.25eae8","wires":[["4366aa81.b5af34"]]},{"id":"4366aa81.b5af34","type":"set","name":"set related-network data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].vlan-tags.vlan-interface'\n  value='`$aai.vlan-tag.vlan-tag-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].vlan-tags.upper-tag-id'\n  value='`$aai.vlan-tag.vlan-id-outer`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].vlan-tags.lower-tag-id'\n  value='`$aai.vlan-tag.vlan-id-inner`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-resource-assignments.vnf-networks.vnf-network[$network-index].related-networks.related-network[$rn-index].vlan-tags.is-private'\n  value='`$aai.vlan-tag.is-private`' />\n","comments":"","x":3594.000068664551,"y":4772.000137329102,"z":"e8ec1b5b.25eae8","wires":[]},{"id":"9e6ca1e7.6cd83","type":"break","name":"break","xml":"<break>\n","comments":"","x":3172.000068664551,"y":4810.000137329102,"z":"e8ec1b5b.25eae8","wires":[]}]