[
  {
    "id": "793dbdb3.de8be4",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 95.00390625,
    "y": 45.00390625,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "3a91b25b.2f4cce"
      ]
    ]
  },
  {
    "id": "3a91b25b.2f4cce",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 281.00391006469727,
    "y": 117.0039234161377,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "eca97066.caaf3"
      ]
    ]
  },
  {
    "id": "eca97066.caaf3",
    "type": "method",
    "name": "method sdwan-network-topology-operation-deactivate",
    "xml": "<method rpc='sdwan-network-topology-operation-deactivate' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 269.0040283203125,
    "y": 205.00390625,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "4de7b297.7c56ec"
      ]
    ]
  },
  {
    "id": "4de7b297.7c56ec",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 443.00392150878906,
    "y": 313.0039653778076,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "b335849f.1ecf78",
        "4b508beb.3a8574",
        "49f08c5d.a4c334",
        "c621318b.d31c",
        "335b7a74.877be6",
        "cf0d2147.3c1a7",
        "fc2f3bed.6dcf68",
        "6ed3cf6a.44f1b",
        "2cf71503.16f17a",
        "69c0586.74e3ea8",
        "bd5c4a5d.9d8378",
        "6cc3df01.2a98a",
        "b06c361a.4ff338"
      ]
    ]
  },
  {
    "id": "b335849f.1ecf78",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:validate-sdwan-network-input-parameters",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='validate-sdwan-network-input-parameters' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 901.3928070068359,
    "y": 62.00390625,
    "z": "c3c952bc.05e95",
    "wires": [
      []
    ]
  },
  {
    "id": "4b508beb.3a8574",
    "type": "record",
    "name": "record",
    "xml": "<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.FileRecorder\">\n<parameter name=\"file\" value=\"/opt/opendaylight/current/data/log/svclogic.log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"sdwan-network-topology-operation-deactivate\"/>\n<parameter name=\"field3\" value=\"SDWAN-Deactivate\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 701.5595054626465,
    "y": 115.78175926208496,
    "z": "c3c952bc.05e95",
    "wires": [
      []
    ]
  },
  {
    "id": "49f08c5d.a4c334",
    "type": "set",
    "name": "set networkId and network-object-path",
    "xml": "<set>\n<parameter name='networkId' value='`$network-topology-operation-input.network-information.network-id`' />\n<parameter name=\"network-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $network-topology-operation-input.service-information.service-instance-id  + '/service-data/networks/network/'  + $network-topology-operation-input.network-information.network-id  + '/network-data/'` \" />",
    "comments": "",
    "x": 793.5597496032715,
    "y": 742.3173627853394,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "c621318b.d31c",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 715.3375511169434,
    "y": 931.8727827072144,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "335b7a74.877be6",
    "type": "set",
    "name": "set network-level-oper-status",
    "xml": "<set>\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.network-level-oper-status.order-status' value='PendingDelete' />\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.network-level-oper-status.last-rpc-action' value='`$network-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.network-level-oper-status.last-action' value='`$network-topology-operation-input.request-information.request-action`' />",
    "comments": "",
    "x": 760.4486656188965,
    "y": 803.5395374298096,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "cf0d2147.3c1a7",
    "type": "execute",
    "name": "execute Properties",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n",
    "comments": "",
    "outputs": 1,
    "x": 733.8616104125977,
    "y": 168.78179550170898,
    "z": "c3c952bc.05e95",
    "wires": [
      []
    ]
  },
  {
    "id": "fc2f3bed.6dcf68",
    "type": "set",
    "name": "set network in service-data",
    "xml": "<set>\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.sdnc-request-header.' value='`$network-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.request-information.' value='`$network-topology-operation-input.request-information.`' />\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.service-information.' value='`$network-topology-operation-input.service-information.`' />\n<parameter name='service-data.networks.network[$tmp.nidx].network-data.network-information.' value='`$network-topology-operation-input.network-information.`' />",
    "comments": "",
    "x": 754.004280090332,
    "y": 689.095196723938,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "6ed3cf6a.44f1b",
    "type": "for",
    "name": "for each network-input-parameters",
    "xml": "<for index='idx' start='0' end='`$ctx.network-data.network-request-input.network-input-parameters.param_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 786.00390625,
    "y": 239.00781378149986,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "8e8065b6.1084e8"
      ]
    ]
  },
  {
    "id": "8e8065b6.1084e8",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1042.8373374938965,
    "y": 173.34116491675377,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "db93bdb.d26bf4",
        "ac2e8139.951b",
        "1e600efe.efd971",
        "d6b3741d.b12d48"
      ]
    ]
  },
  {
    "id": "db93bdb.d26bf4",
    "type": "switchNode",
    "name": "switch name",
    "xml": "<switch test=\"`$ctx.network-data.network-request-input.network-input-parameters.param[$idx].name == 'name'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1264.837417602539,
    "y": 63.34119987487793,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "c5296581.642598"
      ]
    ]
  },
  {
    "id": "c5296581.642598",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1438.8375434875488,
    "y": 63.341203689575195,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "209fc8ff.4a3e38"
      ]
    ]
  },
  {
    "id": "209fc8ff.4a3e38",
    "type": "set",
    "name": "set name",
    "xml": "<set>\n<parameter name='prop.name' value='`$ctx.network-data.network-request-input.network-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1601.8374290466309,
    "y": 62.94119834899902,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "2cf71503.16f17a",
    "type": "get-resource",
    "name": "get-resource esr-thirdparty-sdnc",
    "xml": "<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"esr-thirdparty-sdnc\" \n\t\tkey=\"esr-thirdparty-sdnc.thirdparty-sdnc-id = 'SDWAN-Controller' AND \n\t\t     depth = '1'\"\n        pfx='tmp.aai.esr-thirdparty-sdnc' local-only='false' >\n\n",
    "comments": "",
    "outputs": 1,
    "x": 780.00390625,
    "y": 348.00781378149986,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "fc6c7998.f0e088",
        "27566cb3.03e2a4",
        "235c43b0.c60f6c"
      ]
    ]
  },
  {
    "id": "fc6c7998.f0e088",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1025.00390625,
    "y": 294.00781378149986,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "37902c28.eb9774"
      ]
    ]
  },
  {
    "id": "27566cb3.03e2a4",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1028.494873046875,
    "y": 341.5818494260311,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "bebdf762.3c5628"
      ]
    ]
  },
  {
    "id": "235c43b0.c60f6c",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1023.827880859375,
    "y": 382.91516241431236,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "851cb606.194f18"
      ]
    ]
  },
  {
    "id": "37902c28.eb9774",
    "type": "set",
    "name": "set controller data",
    "xml": "<set>\n<parameter name='prop.sdncRestApi.thirdpartySdnc.url' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].service-url`\" />\n<parameter name='prop.sdncRestApi.thirdpartySdnc.user' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].user-name`\" />\n<parameter name='prop.sdncRestApi.thirdpartySdnc.password' value=\"`$tmp.aai.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].password`\" />\n",
    "comments": "",
    "x": 1222.5039672851562,
    "y": 282.00781378149986,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "bebdf762.3c5628",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'An error occurred while querying esr-thirdparty-sdnc from AnAI with thirdparty-sdnc-id = ' + $tmp.thirdparty-sdnc-id`\" />\n\n",
    "comments": "",
    "x": 1205.0662841796875,
    "y": 329.8675855100155,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "851cb606.194f18",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unexpected error occurred while querying esr-thirdparty-sdnc from AnAI with thirdparty-sdnc-id = ' + $tmp.thirdparty-sdnc-id`\" />\n\n",
    "comments": "",
    "x": 1211.6004371643066,
    "y": 378.354355186224,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "69c0586.74e3ea8",
    "type": "execute",
    "name": "execute RestApiCallNode Get token",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"templateFileName\" value=\"`$prop.restapi.templateDir + '/actokentemplate.json'`\" />\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/controller/v2/tokens'`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"post\"/>\n<parameter name=\"responsePrefix\" value=\"token-result\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.openecomp.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>",
    "comments": "",
    "outputs": 1,
    "x": 788.00390625,
    "y": 459.00781378149986,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "96f3aa2e.c54988",
        "cae8eff.6ac8b1"
      ]
    ]
  },
  {
    "id": "96f3aa2e.c54988",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1023.00390625,
    "y": 437.00781378149986,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "91d847c8.f3fc48"
      ]
    ]
  },
  {
    "id": "cae8eff.6ac8b1",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1015.25390625,
    "y": 490.6506970822811,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "7d2fabee.7ea674"
      ]
    ]
  },
  {
    "id": "91d847c8.f3fc48",
    "type": "set",
    "name": "set token-id",
    "xml": "<set>\n<parameter name='prop.sdncRestApi.token_id' value='`$token-result.data.token_id`' />\n",
    "comments": "",
    "x": 1177.00390625,
    "y": 438.00781378149986,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "7d2fabee.7ea674",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error executing get token rest api\" />\n",
    "comments": "",
    "x": 1168.00390625,
    "y": 490.40075811743736,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "ac2e8139.951b",
    "type": "switchNode",
    "name": "switch topology",
    "xml": "<switch test=\"`$ctx.network-data.network-request-input.network-input-parameters.param[$idx].name == 'topology'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1270.253890991211,
    "y": 106.00781416893005,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "1cd087e9.a0e8d8"
      ]
    ]
  },
  {
    "id": "1cd087e9.a0e8d8",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1444.2540168762207,
    "y": 106.00781798362732,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "4dc771ac.bec7e"
      ]
    ]
  },
  {
    "id": "4dc771ac.bec7e",
    "type": "set",
    "name": "set topology",
    "xml": "<set>\n<parameter name='prop.topology' value='`$ctx.network-data.network-request-input.network-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1607.2539024353027,
    "y": 105.60781264305115,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "bd5c4a5d.9d8378",
    "type": "execute",
    "name": "execute RestApiCallNode delete vpn",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"templateFileName\" value=\"`$prop.restapi.templateDir + '/sdwan-vpn-delete.json'`\" />\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/controller/campus/v1/sdwan/overlay-network/vpn/action/batch-delete'`\" />\n<parameter name=\"restapiUser\" value=\"`$prop.sdncRestApi.thirdpartySdnc.user`\" />\n<parameter name=\"restapiPassword\" value=\"`$prop.sdncRestApi.thirdpartySdnc.password`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"post\"/>\n<parameter name=\"responsePrefix\" value=\"vpn-result\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.openecomp.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>\n<parameter name='customHttpHeaders' value=\"`'X-ACCESS-TOKEN=' + $prop.sdncRestApi.token_id`\" />",
    "comments": "",
    "outputs": 1,
    "x": 786.7539825439453,
    "y": 626.0080223083496,
    "z": "c3c952bc.05e95",
    "wires": [
      []
    ]
  },
  {
    "id": "6cc3df01.2a98a",
    "type": "execute",
    "name": "execute RestApiCallNode delete vpn topology",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/controller/campus/v1/sdwan/overlay-network/' + $prop.vpn-id + '/topology'`\" />\n<parameter name=\"restapiUser\" value=\"`$prop.sdncRestApi.thirdpartySdnc.user`\" />\n<parameter name=\"restapiPassword\" value=\"`$prop.sdncRestApi.thirdpartySdnc.password`\" />\n<parameter name=\"format\" value=\"json\"/>\n<parameter name=\"httpMethod\" value=\"delete\"/>\n<parameter name=\"responsePrefix\" value=\"vpn-result\"/>\n<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.openecomp.client.jks\"/>\n<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>\n<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>\n<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>\n<parameter name='customHttpHeaders' value=\"`'X-ACCESS-TOKEN=' + $prop.sdncRestApi.token_id`\" />",
    "comments": "",
    "outputs": 1,
    "x": 816.2539978027344,
    "y": 559.0079069137573,
    "z": "c3c952bc.05e95",
    "wires": [
      []
    ]
  },
  {
    "id": "1e600efe.efd971",
    "type": "switchNode",
    "name": "switch vpn-id",
    "xml": "<switch test=\"`$ctx.network-data.network-request-input.network-input-parameters.param[$idx].name == 'vpn-id'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1264.5039691925049,
    "y": 189.00390815734863,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "c1d7d040.09f8"
      ]
    ]
  },
  {
    "id": "c1d7d040.09f8",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1446.5040016174316,
    "y": 189.00390696525574,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "c45b30c0.c02ff"
      ]
    ]
  },
  {
    "id": "c45b30c0.c02ff",
    "type": "set",
    "name": "set prop.vpn-id",
    "xml": "<set>\n<parameter name='prop.vpn-id' value='`$ctx.network-data.network-request-input.network-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1609.5038871765137,
    "y": 188.60390162467957,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "d6b3741d.b12d48",
    "type": "switchNode",
    "name": "switch tenant-id",
    "xml": "<switch test=\"`$ctx.network-data.network-request-input.network-input-parameters.param[$idx].name == 'tenant-id'`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 1270.25390625,
    "y": 232.00390625,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "3b68a208.b06d0e"
      ]
    ]
  },
  {
    "id": "3b68a208.b06d0e",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1444.2540321350098,
    "y": 232.00391006469727,
    "z": "c3c952bc.05e95",
    "wires": [
      [
        "61b35e07.ec39d"
      ]
    ]
  },
  {
    "id": "61b35e07.ec39d",
    "type": "set",
    "name": "set prop.tenant-id",
    "xml": "<set>\n<parameter name='prop.tenant-id' value='`$ctx.network-data.network-request-input.network-input-parameters.param[$idx].value`' />\n",
    "comments": "",
    "x": 1607.2539176940918,
    "y": 231.6039047241211,
    "z": "c3c952bc.05e95",
    "wires": []
  },
  {
    "id": "b06c361a.4ff338",
    "type": "update",
    "name": "update SDWAN VPN status to AAI",
    "xml": "<update plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='sdwan-vpn' \n      key='sdwan-vpn.id = $network-topology-operation-input.network-information.network-id' >\n<parameter name='id' value='`$network-topology-operation-input.network-information.network-id`' />\n<parameter name='operational-status' value='PendingDelete' />",
    "comments": "",
    "outputs": 1,
    "x": 774.0039443969727,
    "y": 870.5039930343628,
    "z": "c3c952bc.05e95",
    "wires": [
      []
    ]
  }
]
