[{"id":"f857cf6.10b033","type":"dgstart","name":"DGSTART","outputs":1,"x":167,"y":56,"z":"70167245.99734c","wires":[["3c005c61.e4129c"]]},{"id":"3c005c61.e4129c","type":"service-logic","name":"GENERIC-RESOURCE-API 1.2.-SNAPSHOT-111604","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":263.2380790710449,"y":116.95239067077637,"z":"70167245.99734c","wires":[["babb4094.95036"]]},{"id":"babb4094.95036","type":"method","name":"tunnelxconn-topology-operation-assign","xml":"<method rpc='tunnelxconn-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":314.15485763549805,"y":152.19044589996338,"z":"70167245.99734c","wires":[["a8be1828.b146a"]]},{"id":"a8be1828.b146a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":217.47619247436523,"y":295.5237879753113,"z":"70167245.99734c","wires":[["fbfb6c9e.cec218","12281898.8cf38f","672f96a5.399d08","e87814.4ba7d7f","e83faf33.14e778"]]},{"id":"3260586c.270db","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1060.6666564941406,"y":2222.5477046966553,"z":"70167245.99734c","wires":[]},{"id":"9ee5048e.19ac7","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='tunnelxconn-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $tunnelxconn-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":1097.7540550231934,"y":2101.432439804077,"z":"70167245.99734c","wires":[]},{"id":"f85d83c4.298b4","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='PendingCreate' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tunnelxconn-topology-operation-input.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":1186.912841796875,"y":1449.0673828125,"z":"70167245.99734c","wires":[]},{"id":"12281898.8cf38f","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:tunnelxconn-allotted-resources/tunnelxconn-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/tunnelxconn-topology/'` \" />\n\n","comments":"","x":663.738037109375,"y":163.33331298828125,"z":"70167245.99734c","wires":[]},{"id":"fbfb6c9e.cec218","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n<parameter name='tmp.search.parent-service-instance-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n\n\n\n","comments":"","x":711.997314453125,"y":119.59259033203125,"z":"70167245.99734c","wires":[]},{"id":"96b29550.58fc4","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":850.8148803710938,"y":335.26727294921875,"z":"70167245.99734c","wires":[["d5a1496.3dfd238"]]},{"id":"67eda20b.cce1ec","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.tx.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":1190.8626251220703,"y":1743.1008231639862,"z":"70167245.99734c","wires":[["7cbee552.df79bc","1d39e729.3d4b89","b6b59f5.14be1e"]]},{"id":"7cbee552.df79bc","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1459.5040016174316,"y":1794.4322349056602,"z":"70167245.99734c","wires":[["65924014.6bbe6"]]},{"id":"1d39e729.3d4b89","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1450.504051208496,"y":1762.9322606548667,"z":"70167245.99734c","wires":[["65924014.6bbe6"]]},{"id":"b6b59f5.14be1e","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1454.2540893554688,"y":1733.289365530014,"z":"70167245.99734c","wires":[["8b9d44cb.4d3c58"]]},{"id":"65924014.6bbe6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for tunnelxconn-allotted-resource\" />\n","comments":"","x":1616.254150390625,"y":1790.6822509765625,"z":"70167245.99734c","wires":[]},{"id":"61bdacb4.d89f74","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tx-ar.allotted-resource-status.rpc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1198.5293884277344,"y":452.05291748046875,"z":"70167245.99734c","wires":[]},{"id":"f2bed30b.d1fbf","type":"comment","name":"Save consumed-allotted-resources to mdsal","info":"","comments":"","x":1227.2435302734375,"y":1258.7196044921875,"z":"70167245.99734c","wires":[]},{"id":"2a53d27b.7a62a6","type":"comment","name":"GET tunnelxconn-allotted-resource from mdsal","info":"","comments":"","x":573.8148193359375,"y":305.7672119140625,"z":"70167245.99734c","wires":[]},{"id":"d5a1496.3dfd238","type":"returnFailure","name":"return failure - tunnelxconn already exists","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'Existing tunnelxconn-allotted-resource with order status of ' + $mdsal-ar.tunnelxconn-allotted-resource.allotted-resource-data.allotted-resource-oper-status.order-status + '.'`\" />\n","comments":"","x":1160.129150390625,"y":330.6243896484375,"z":"70167245.99734c","wires":[]},{"id":"9f74734e.d80b6","type":"set","name":"set tx-ar-identifiers","xml":"<set>\n<parameter name='tx-ar-identifiers.consuming-service-instance-id' value=\"`$tunnelxconn-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='tx-ar-identifiers.parent-service-instance-id' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='tx-ar-identifiers.allotted-resource-type' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='tx-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n","comments":"","x":1210.38623046875,"y":529.6243896484375,"z":"70167245.99734c","wires":[]},{"id":"4a34df28.9f761","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":1237.338623046875,"y":488.338623046875,"z":"70167245.99734c","wires":[]},{"id":"877116f4.81c61","type":"set","name":"set identifiers in overall structure","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.allotted-resource-identifiers.' value=\"`$tx-ar-identifiers.`\" />\n\n\n","comments":"","x":1227.38623046875,"y":837.910400390625,"z":"70167245.99734c","wires":[]},{"id":"caaf1a69.26d5d","type":"set","name":"set ecomp model information from input","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.' \nvalue=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.`\" />\n\n\n","comments":"","x":1255.957763671875,"y":572.9100952148438,"z":"70167245.99734c","wires":[]},{"id":"703ecf3f.4ff33","type":"switchNode","name":"switch model-invariant-uuid is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid'>\n","comments":"","outputs":1,"x":1236.8148193359375,"y":612.195809841156,"z":"70167245.99734c","wires":[["d019143f.d41858"]]},{"id":"d019143f.d41858","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1463.9576988220215,"y":613.6243271827698,"z":"70167245.99734c","wires":[["bea99689.e1f1c8"]]},{"id":"bea99689.e1f1c8","type":"set","name":"set model-invariant-uuid","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-invariant-uuid' \nvalue=\"`$ar-model.invariant-uuid`\" />\n\n\n","comments":"","x":1665.38627243042,"y":613.0528798103333,"z":"70167245.99734c","wires":[]},{"id":"ce53f3ef.26adb8","type":"switchNode","name":"switch model-uuid is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid'>\n","comments":"","outputs":1,"x":1208.2434158325195,"y":646.4815106391907,"z":"70167245.99734c","wires":[["caf1c0dc.11d9d8"]]},{"id":"caf1c0dc.11d9d8","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1409.6719818115234,"y":647.0529322624207,"z":"70167245.99734c","wires":[["e482370c.02f2a"]]},{"id":"e482370c.02f2a","type":"set","name":"set model-uuid","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-uuid' \nvalue=\"`$ar-model.uuid`\" />\n\n\n","comments":"","x":1602.529140472412,"y":647.0528540611267,"z":"70167245.99734c","wires":[]},{"id":"86c183f5.582b88","type":"switchNode","name":"switch model-version is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-version'>\n","comments":"","outputs":1,"x":1216.8148193359375,"y":688.338623046875,"z":"70167245.99734c","wires":[["a62fa522.3b9718"]]},{"id":"a62fa522.3b9718","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1466.8148002624512,"y":679.3386225700378,"z":"70167245.99734c","wires":[["1be750c7.5a5947"]]},{"id":"1be750c7.5a5947","type":"set","name":"set model-version","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-version' \nvalue=\"`$ar-model.version`\" />\n\n\n","comments":"","x":1659.6719589233398,"y":679.3385443687439,"z":"70167245.99734c","wires":[]},{"id":"db1cfd8b.e4a978","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.ecomp-generated-naming`'>\n","comments":"","outputs":1,"x":1280.38623046875,"y":781.7672729492188,"z":"70167245.99734c","wires":[["12dd332c.c6f66d","49b296fc.6797f8"]]},{"id":"12dd332c.c6f66d","type":"other","name":"outcome Y","xml":"<outcome value='Y'>\n","comments":"","outputs":1,"x":1566.3862915039062,"y":781.1958618164062,"z":"70167245.99734c","wires":[["fa86baa1.a7d418"]]},{"id":"fa86baa1.a7d418","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">\n","atomic":"true","comments":"","outputs":1,"x":1720.1363525390625,"y":783.69580078125,"z":"70167245.99734c","wires":[["d8e0029b.f5e8a8"]]},{"id":"49b296fc.6797f8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1585.608642578125,"y":870.1958618164062,"z":"70167245.99734c","wires":[["9f3a1009.b3798"]]},{"id":"9f3a1009.b3798","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in allotted-resource-model data.  Ecomp-generated-naming should be true\" />\n\n","comments":"","x":1768.608642578125,"y":875.1958618164062,"z":"70167245.99734c","wires":[]},{"id":"d8e0029b.f5e8a8","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.naming-policy`'>\n","comments":"","outputs":1,"x":1856.38623046875,"y":832.767333984375,"z":"70167245.99734c","wires":[["332c63e2.ea8be4","ac3f0d13.266368"]]},{"id":"332c63e2.ea8be4","type":"other","name":"outcome oam_network_policy","xml":"<outcome value='oam_network_policy'>\n","comments":"","outputs":1,"x":2231.244140625,"y":836.3453369140625,"z":"70167245.99734c","wires":[["bc0e3ee8.843078"]]},{"id":"ac3f0d13.266368","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2145.671875,"y":913.1958618164062,"z":"70167245.99734c","wires":[["bc0e3ee8.843078"]]},{"id":"7e0f9284.4b7e44","type":"set","name":"set ar_name","xml":"<set>\n<parameter name='tmp.ar-name' value='$TenantOAMNetworkRole_$LandingNetworkRole_SZ' />\n","comments":"","x":2537.100830078125,"y":871.7672729492188,"z":"70167245.99734c","wires":[]},{"id":"3e8d4809.274d6","type":"execute","name":"execute SliStringUtils - replace TenantOAMNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$TenantOAMNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.untrusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2681.2437858581543,"y":915.6244196891785,"z":"70167245.99734c","wires":[[]]},{"id":"f54fe341.3578c","type":"execute","name":"execute SliStringUtils - replace LandingNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$LandingNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.trusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2668.243896484375,"y":955.7672729492188,"z":"70167245.99734c","wires":[[]]},{"id":"bc0e3ee8.843078","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":2345.5292015075684,"y":911.3387522697449,"z":"70167245.99734c","wires":[["7e0f9284.4b7e44","3e8d4809.274d6","f54fe341.3578c","28ad7a84.2cbe6e"]]},{"id":"28ad7a84.2cbe6e","type":"set","name":"set identifiers.allotted-resource-name","xml":"<set>\n<parameter name='tx-ar-identifiers.allotted-resource-name' value='`$tmp.ar-name`' />\n","comments":"","x":2626.1005859375,"y":1006.052978515625,"z":"70167245.99734c","wires":[]},{"id":"b8567e70.00332","type":"set","name":"set assignments in overall structure","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.' \nvalue=\"`$tx-ar-assignments.`\" />\n\n\n","comments":"","x":1202.8624267578125,"y":1214.6246337890625,"z":"70167245.99734c","wires":[]},{"id":"cfb2080f.44c9c8","type":"set","name":"Handle tx-ar-assignments","xml":"<set>\n<parameter name='tx-ar-assignments.vni' value='`$tmp.manageVni.vni`'/>\n<parameter name='tx-ar-assignments.vgmux-bearer-ip' value='`$tmp.vgmux-bearer-ip`'/>\n<parameter name='tx-ar-assignments.vgmux-lan-ip' value='`$tmp.vgmux-lan-ip`'/>\n<parameter name='tx-ar-assignments.vg-ip' value='`$tmp.manageIpaddr.ip`'/>\n\n","comments":"","x":1180.529052734375,"y":1117.052978515625,"z":"70167245.99734c","wires":[]},{"id":"5e2d9895.cf73","type":"for","name":"for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]","xml":"<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n","comments":"","outputs":1,"x":2253.8155822753906,"y":1316.0411586761475,"z":"70167245.99734c","wires":[["eb2cdea9.cb778"]]},{"id":"85c6f8d0.1b4668","type":"switchNode","name":"switch service-data.consumed-allotted-resources_length","xml":"<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1259.8148193359375,"y":1309.505126953125,"z":"70167245.99734c","wires":[["dc8f6919.70df38","3b9271f8.a4419e"]]},{"id":"dc8f6919.70df38","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1660.207763671875,"y":1288.1124267578125,"z":"70167245.99734c","wires":[["7aeacb5a.99e424"]]},{"id":"3b9271f8.a4419e","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1652.957763671875,"y":1369.1124267578125,"z":"70167245.99734c","wires":[["52a4e536.66c5a4"]]},{"id":"eb2cdea9.cb778","type":"switchNode","name":"switch allotted-resource-id","xml":"<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n","comments":"","outputs":1,"x":2688.4106826782227,"y":1317.85085105896,"z":"70167245.99734c","wires":[["8cf06394.df3ea8"]]},{"id":"8cf06394.df3ea8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2895.220375061035,"y":1321.064962387085,"z":"70167245.99734c","wires":[["21ed97fc.fc9e88"]]},{"id":"52a4e536.66c5a4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1819.8349609375,"y":1363.488525390625,"z":"70167245.99734c","wires":[["5e2d9895.cf73","49ab0d25.8010ec"]]},{"id":"21ed97fc.fc9e88","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3063.4817276000977,"y":1325.9222631454468,"z":"70167245.99734c","wires":[["53f652f8.101e24"]]},{"id":"7aeacb5a.99e424","type":"set","name":"set cidx","xml":"<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n","comments":"","x":1845.0648193359375,"y":1291.32666015625,"z":"70167245.99734c","wires":[]},{"id":"53f652f8.101e24","type":"set","name":"set tmp.cidx and ctx.consumed-ar","xml":"<set>\n<parameter name='tmp.cidx' value='`$cidx`' />\n<parameter name='ctx.consumed-ar.' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].`' />\n<parameter name='tmp.found-cidx' value='true' />","comments":"","x":3309.3391876220703,"y":1320.4937419891357,"z":"70167245.99734c","wires":[]},{"id":"540cbc0e.28865c","type":"set","name":"set consumed allotted resources","xml":"<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n","comments":"","x":1195.6720123291016,"y":1368.826681137085,"z":"70167245.99734c","wires":[]},{"id":"8b9d44cb.4d3c58","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1595.910057067871,"y":1729.4815347194672,"z":"70167245.99734c","wires":[[]]},{"id":"2159536d.de8f1c","type":"comment","name":"Add SZ AR to mdsal","info":"","comments":"","x":1122.148193359375,"y":1679.1956787109375,"z":"70167245.99734c","wires":[]},{"id":"2e4a857d.928342","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":1139.592529296875,"y":1410.2275390625,"z":"70167245.99734c","wires":[[]]},{"id":"549678aa.89574","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":856.57666015625,"y":386.4814453125,"z":"70167245.99734c","wires":[["38e93c63.11d5e4"]]},{"id":"e6a480a5.65c488","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":804.57666015625,"y":882.2908325195312,"z":"70167245.99734c","wires":[["540cbc0e.28865c","2e4a857d.928342","f85d83c4.298b4","67eda20b.cce1ec","9ee5048e.19ac7","3260586c.270db","8b4c6a17.e3e838","61bdacb4.d89f74","9f74734e.d80b6","caaf1a69.26d5d","703ecf3f.4ff33","ce53f3ef.26adb8","86c183f5.582b88","db1cfd8b.e4a978","877116f4.81c61","e2b96e41.dba7a","fcd1f7e3.99e0a8","f8eaf248.0e822","cfb2080f.44c9c8","b8567e70.00332","85c6f8d0.1b4668","19f92301.f6449d","b03dbb12.bc75b","95de12c3.5b4c18","58f3b12c.76c66","7af21cbe.e3109c"]]},{"id":"8b4c6a17.e3e838","type":"set","name":"set id","xml":"<set>\n<parameter name='tx-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='tx-ar.allotted-resource-status.action' value=\"`$tunnelxconn-topology-operation-input.request-information.request-action` \" />\n<parameter name='tx-ar.allotted-resource-status.rpc-name' value=\"tunnelxconn-topology-operation\" />\n<parameter name='tx-ar.allotted-resource-status.rpc-action' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$tunnelxconn-topology-operation-input.request-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$tunnelxconn-topology-operation-input.service-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.tunnelxconn-request-input.' value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.` \" />","comments":"","x":1173.243408203125,"y":408.433837890625,"z":"70167245.99734c","wires":[]},{"id":"58f3b12c.76c66","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $service-data.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $service-data.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $service-data.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"description\" value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$ar-model.invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$ar-model.uuid`\" />\n\t<parameter name=\"operational-status\" value=\"null\" />","comments":"","outputs":1,"x":1162.38623046875,"y":1606.799072265625,"z":"70167245.99734c","wires":[["9e9f4c90.bf0d48","2b5b7235.3d1d0e"]]},{"id":"9e9f4c90.bf0d48","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1412.814842224121,"y":1593.5292553901672,"z":"70167245.99734c","wires":[["efcb7762.8c948"]]},{"id":"efcb7762.8c948","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":1581.3387451171875,"y":1595.1483154296875,"z":"70167245.99734c","wires":[]},{"id":"2b5b7235.3d1d0e","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1423.91015625,"y":1648.291259765625,"z":"70167245.99734c","wires":[["efcb7762.8c948"]]},{"id":"49ab0d25.8010ec","type":"switchNode","name":"switch tmp.found-cidx","xml":"<switch test='`$tmp.found-cidx`'>\n","comments":"","outputs":1,"x":2068.743423461914,"y":1562.2315921783447,"z":"70167245.99734c","wires":[["15a17af4.7b49b5"]]},{"id":"15a17af4.7b49b5","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2258.743377685547,"y":1562.2315292358398,"z":"70167245.99734c","wires":[["5fd31d95.33e68c"]]},{"id":"5fd31d95.33e68c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2424.743377685547,"y":1562.2315292358398,"z":"70167245.99734c","wires":[["d1d7e91e.b628"]]},{"id":"d1d7e91e.b628","type":"set","name":"set tmp.cidx ","xml":"<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n","comments":"","x":2670.600706100464,"y":1562.8030033111572,"z":"70167245.99734c","wires":[]},{"id":"cb0ecda.ef05db","type":"break","name":"break","xml":"<break/>\n","comments":"","x":3228.243408203125,"y":1365.731689453125,"z":"70167245.99734c","wires":[]},{"id":"a9bccdde.a120f","type":"execute","name":"execute RestApiCallNode - Update parent provided service AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='DELETE' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n","comments":"","outputs":1,"x":1946.9521980285645,"y":1729.1904199123383,"z":"70167245.99734c","wires":[["7277c6ff.78bf7","2f0a3a77.128346","3b3333f6.aaf6d4"]]},{"id":"2cdb4052.2746c","type":"comment","name":"Rollback parent","info":"","comments":"","x":1790.9521255493164,"y":1698.8570504188538,"z":"70167245.99734c","wires":[]},{"id":"7277c6ff.78bf7","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2318.2602462768555,"y":1789.8553862571716,"z":"70167245.99734c","wires":[["45c2ac8a.13df9c"]]},{"id":"2f0a3a77.128346","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2309.26029586792,"y":1758.3554120063782,"z":"70167245.99734c","wires":[["45c2ac8a.13df9c"]]},{"id":"3b3333f6.aaf6d4","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2313.0103340148926,"y":1728.7125168815255,"z":"70167245.99734c","wires":[["45c2ac8a.13df9c"]]},{"id":"45c2ac8a.13df9c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2454.666301727295,"y":1724.9046860709786,"z":"70167245.99734c","wires":[[]]},{"id":"10d2c615.b0f73a","type":"comment","name":"Generate naming","info":"","comments":"","x":1211.3862762451172,"y":739.7672252655029,"z":"70167245.99734c","wires":[]},{"id":"672f96a5.399d08","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":656,"y":208,"z":"70167245.99734c","wires":[[]]},{"id":"8d9cde2f.3534f8","type":"get-resource","name":"get-resource parent service instance","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='VNF-API' key='vnfs/vnf-list/$tmp.ar.parent-service-instance-id/service-data/' pfx='parent-service-instance' >\n","comments":"","outputs":1,"x":413,"y":547,"z":"70167245.99734c","wires":[[]]},{"id":"d84542fc.095ae","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":932,"y":483,"z":"70167245.99734c","wires":[["e6a480a5.65c488"]]},{"id":"a3cb0d15.ef9278","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":745,"y":584,"z":"70167245.99734c","wires":[["4ba88fad.67db1"]]},{"id":"4ba88fad.67db1","type":"returnFailure","name":"return failure - parent service instance not found","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'No entry found for parent service instance id ' + $tmp.ar.parent-service-instance-id + '.'`\" />\n","comments":"","x":672,"y":645,"z":"70167245.99734c","wires":[]},{"id":"34c4649e.80cfb4","type":"for","name":"for parent vnf parameters","xml":"<for index='curidx' start='0' end='`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters_length`' >\n","comments":"","outputs":1,"x":1722,"y":929,"z":"70167245.99734c","wires":[["a1fa7464.76606"]]},{"id":"a1fa7464.76606","type":"switchNode","name":"switch parameter name","xml":"<switch test='`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters[$curidx].vnf-parameter-name`'>\n","comments":"","outputs":1,"x":1844,"y":1021,"z":"70167245.99734c","wires":[["9ee00c26.e04e9","7d0d63b5.184dfc"]]},{"id":"9ee00c26.e04e9","type":"other","name":"vgmux_private_ip_0","xml":"<outcome value='vgmux_private_ip_0'>\n","comments":"","outputs":1,"x":2070,"y":1025,"z":"70167245.99734c","wires":[["bc5b4eb5.aba26"]]},{"id":"3085d91f.93577e","type":"set","name":"set tmp.vgmux-bearer-ip","xml":"<set>\n<parameter name='tmp.vgmux-bearer-ip' value='`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters[$curidx].vnf-parameter-value`'/>\n\n","comments":"","x":2302.9999771118164,"y":1086.0000400543213,"z":"70167245.99734c","wires":[]},{"id":"7d0d63b5.184dfc","type":"other","name":"vgmux_private_ip_2","xml":"<outcome value='vgmux_private_ip_2'>\n","comments":"","outputs":1,"x":2072,"y":1085,"z":"70167245.99734c","wires":[["3085d91f.93577e"]]},{"id":"bc5b4eb5.aba26","type":"set","name":"set tmp.vgmux-lan-ip","xml":"<set>\n<parameter name='tmp.vgmux-lan-ip' value='`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters[$curidx].vnf-parameter-value`'/>\n\n","comments":"","x":2292.9999771118164,"y":1028.0000381469727,"z":"70167245.99734c","wires":[]},{"id":"e2b96e41.dba7a","type":"set","name":"set default assignments","xml":"<set>\n<parameter name='tmp.vni' value='123' />\n<parameter name='tmp.vgmux-bearer-ip' value='127.0.0.1' />\n<parameter name='tmp.vgmux-lan-ip' value='127.0.0.1' />","comments":"","x":1202,"y":883,"z":"70167245.99734c","wires":[]},{"id":"e87814.4ba7d7f","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.tx-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":652,"y":251,"z":"70167245.99734c","wires":[[]]},{"id":"f8eaf248.0e822","type":"call","name":"call GENERIC-RESOURCE-API:manage-vni-assignment","xml":"<call module='GENERIC-RESOURCE-API' rpc='manage-vni-assignment' mode='sync' >\n","comments":"","outputs":1,"x":1268,"y":1004,"z":"70167245.99734c","wires":[[]]},{"id":"fcd1f7e3.99e0a8","type":"set","name":"set actions = reserve, pools = VNI, VGW","xml":"<set>\n<parameter name='tmp.manageVni.action' value='reserve' />\n<parameter name='tmp.manageIpaddr.action' value='reserve' />\n<parameter name='tmp.manageVni.pool' value='VNI'/>\n<parameter name='tmp.manageIpaddr.pool' value='VGW'/>","comments":"","x":1221,"y":967,"z":"70167245.99734c","wires":[]},{"id":"e83faf33.14e778","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":576,"y":386,"z":"70167245.99734c","wires":[["549678aa.89574"]]},{"id":"19f92301.f6449d","type":"switchNode","name":"Does parent service instance have vnf parameters?","xml":"<switch test=\"`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters_length != ''`\">\n","comments":"","outputs":1,"x":1269,"y":924,"z":"70167245.99734c","wires":[["4b77905b.74e198"]]},{"id":"4b77905b.74e198","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1531,"y":926,"z":"70167245.99734c","wires":[["34c4649e.80cfb4"]]},{"id":"b03dbb12.bc75b","type":"call","name":"call GENERIC-RESOURCE-API:manage-ipaddr-assignment","xml":"<call module='GENERIC-RESOURCE-API' rpc='manage-ipaddr-assignment' mode='sync' >\n","comments":"","outputs":1,"x":1280,"y":1045,"z":"70167245.99734c","wires":[[]]},{"id":"95de12c3.5b4c18","type":"set","name":"Handle tx parameters","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[0].name' value='VNI'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[0].value' value='`$tmp.manageVni.vni`'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[1].name' value='vgmux_private_ip_2'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[1].value' value='`$tmp.vgmux-bearer-ip`'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[2].name' value='vgmux_private_ip_0'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[2].value' value='`$tmp.vgmux-lan-ip`'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[3].name' value='vgw_private_ip_0'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[3].value' value='`$tmp.manageIpaddr.ip`'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters_length' value='4'/>\n\n","comments":"","x":1167,"y":1174,"z":"70167245.99734c","wires":[]},{"id":"7031fe98.2c6288","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":275,"y":464,"z":"70167245.99734c","wires":[]},{"id":"38e93c63.11d5e4","type":"call","name":"call  get-vnf-api-parent-instance","xml":"\n<call module='GENERIC-RESOURCE-API' rpc='get-vnf-api-parent-instance' mode='sync' >\n","comments":"","outputs":1,"x":672,"y":483,"z":"70167245.99734c","wires":[["d84542fc.095ae","a3cb0d15.ef9278"]]},{"id":"7af21cbe.e3109c","type":"set","name":"setservice data custid, svc instance, svc type","xml":"<set>\n<parameter name='service-data.service-information.global-customer-id' value='`$tunnelxconn-topology-operation-input.service-information.global-customer-id`' />\n<parameter name='service-data.service-information.subscription-service-type' value='`$tunnelxconn-topology-operation-input.service-information.subscription-service-type`' />\n<!--\n<parameter name='service-data.service-information.service-instance-id' value='`$tunnelxconn-topology-operation-input.service-information.service-instance-id`' />\n-->\n<parameter name='service-data.service-information.service-instance-id' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id`\"/>","comments":"","x":1216.4443969726562,"y":1541.666748046875,"z":"70167245.99734c","wires":[]},{"id":"f9011934.3041a8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":821.8888888888889,"y":1544.3333333333333,"z":"70167245.99734c","wires":[]},{"id":"1e544179.ffb5cf","type":"comment","name":"map input to service-data request info","info":"","comments":"","x":1496.3334350585938,"y":1519.888671875,"z":"70167245.99734c","wires":[]},{"id":"cc57223c.b8369","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":816,"y":1129,"z":"70167245.99734c","wires":[]},{"id":"6acf8c23.3105dc","type":"comment","name":"404 is mapping to success ?","info":"","comments":"","x":922,"y":294,"z":"70167245.99734c","wires":[]},{"id":"12de95c4.dcc23a","type":"set","name":"set SDN-ETHERNET-INTERNET/VCPE work around","xml":"<set>\n<parameter name='tunnelxconn-topology-operation-input.service-information.global-customer-id' value = 'SDN-ETHERNET-INTERNET' />\n<parameter name='tunnelxconn-topology-operation-input.service-information.subscription-service-type' value = \"vCPE\" />\n","comments":"","x":1314,"y":371,"z":"70167245.99734c","wires":[]},{"id":"79c9de0c.35d96","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":1536,"y":347,"z":"70167245.99734c","wires":[]},{"id":"880b54b6.ffc6c","type":"comment","name":"took out link on RestAPICall","info":"","comments":"","x":1020,"y":75,"z":"70167245.99734c","wires":[]},{"id":"b735cd6.f00dbb","type":"comment","name":"Added SDN-E-I and vCPE ot INPUT","info":"","comments":"","x":1050,"y":111,"z":"70167245.99734c","wires":[]},{"id":"4c9f8ee8.c9ca38","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":1034,"y":41,"z":"70167245.99734c","wires":[]},{"id":"d5850db9.4637d8","type":"execute","name":"execute printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/tx-conn-assign.log' />\n\n","comments":"","outputs":1,"x":1399,"y":1083,"z":"70167245.99734c","wires":[[]]},{"id":"56c108ca.6ff1e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":998,"y":910,"z":"70167245.99734c","wires":[]},{"id":"d2b1cc73.d58508","type":"comment","name":"vnf-parameters_lenght is null","info":"parent-service-instance.service-data.vnf-topology-information.vnf-parameters_length","comments":"","x":941,"y":938,"z":"70167245.99734c","wires":[]}]
