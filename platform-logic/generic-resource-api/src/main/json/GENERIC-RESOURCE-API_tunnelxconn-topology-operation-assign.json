[{"id":"1ca16a80.2caae6","type":"dgstart","name":"DGSTART","outputs":1,"x":124,"y":75,"z":"1199f92b.84c70f","wires":[["b4f4cd99.19211"]]},{"id":"b4f4cd99.19211","type":"service-logic","name":"GENERIC-RESOURCE-API 1.2.0-SNAPSHOT-111501","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":220.23807907104492,"y":135.95239067077637,"z":"1199f92b.84c70f","wires":[["d56de4ee.d84328"]]},{"id":"d56de4ee.d84328","type":"method","name":"tunnelxconn-topology-operation-assign","xml":"<method rpc='tunnelxconn-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":271.15485763549805,"y":171.19044589996338,"z":"1199f92b.84c70f","wires":[["d1f80a72.54dcb8"]]},{"id":"d1f80a72.54dcb8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":174.47619247436523,"y":314.5237879753113,"z":"1199f92b.84c70f","wires":[["3884d063.bf017","fec1a8b3.26b3b8","dc03e4ee.d84988","c7b45e35.5d99f8","c3103460.280e18"]]},{"id":"6305c3b7.10e66c","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1017.6666564941406,"y":2241.5477046966553,"z":"1199f92b.84c70f","wires":[]},{"id":"9d5729f3.96cf18","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='tunnelxconn-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $tunnelxconn-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":1054.7540550231934,"y":2120.432439804077,"z":"1199f92b.84c70f","wires":[]},{"id":"738ca6aa.bf5888","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='PendingCreate' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tunnelxconn-topology-operation-input.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":1141.9129028320312,"y":1504.0673217773438,"z":"1199f92b.84c70f","wires":[]},{"id":"fec1a8b3.26b3b8","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:tunnelxconn-allotted-resources/tunnelxconn-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/tunnelxconn-topology/'` \" />\n\n","comments":"","x":620.738037109375,"y":182.33331298828125,"z":"1199f92b.84c70f","wires":[]},{"id":"3884d063.bf017","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n\n\n","comments":"","x":668.997314453125,"y":138.59259033203125,"z":"1199f92b.84c70f","wires":[]},{"id":"6fb8a35e.f42ca4","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":807.8148803710938,"y":354.26727294921875,"z":"1199f92b.84c70f","wires":[["28cd7780.0973c"]]},{"id":"295904fd.98be34","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.tx.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":1147.8626251220703,"y":1762.1008231639862,"z":"1199f92b.84c70f","wires":[["cb9d6154.6f8f1","231c9fc8.2d02a","2e60fcec.47401c"]]},{"id":"cb9d6154.6f8f1","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1416.5040016174316,"y":1813.4322349056602,"z":"1199f92b.84c70f","wires":[["f260fd29.62cf58"]]},{"id":"231c9fc8.2d02a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1407.504051208496,"y":1781.9322606548667,"z":"1199f92b.84c70f","wires":[["f260fd29.62cf58"]]},{"id":"2e60fcec.47401c","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1411.2540893554688,"y":1752.289365530014,"z":"1199f92b.84c70f","wires":[["3a94b596.f511e2"]]},{"id":"f260fd29.62cf58","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for tunnelxconn-allotted-resource\" />\n","comments":"","x":1573.254150390625,"y":1809.6822509765625,"z":"1199f92b.84c70f","wires":[]},{"id":"33187c4e.932ecc","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tx-ar.allotted-resource-status.rpc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1157.5294189453125,"y":455.05291748046875,"z":"1199f92b.84c70f","wires":[]},{"id":"ce3cfb1b.f5d3d8","type":"comment","name":"Save consumed-allotted-resources to mdsal","info":"","comments":"","x":1184.2435302734375,"y":1277.7196044921875,"z":"1199f92b.84c70f","wires":[]},{"id":"8519e347.276768","type":"comment","name":"GET tunnelxconn-allotted-resource from mdsal","info":"","comments":"","x":530.8148193359375,"y":324.7672119140625,"z":"1199f92b.84c70f","wires":[]},{"id":"28cd7780.0973c","type":"returnFailure","name":"return failure - tunnelxconn already exists","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'Existing tunnelxconn-allotted-resource with order status of ' + $mdsal-ar.tunnelxconn-allotted-resource.allotted-resource-data.allotted-resource-oper-status.order-status + '.'`\" />\n","comments":"","x":1117.129150390625,"y":349.6243896484375,"z":"1199f92b.84c70f","wires":[]},{"id":"6f7f8e99.efeab8","type":"set","name":"set tx-ar-identifiers","xml":"<set>\n<parameter name='tx-ar-identifiers.consuming-service-instance-id' value=\"`$tunnelxconn-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='tx-ar-identifiers.parent-service-instance-id' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='tx-ar-identifiers.allotted-resource-type' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='tx-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n","comments":"","x":1167.38623046875,"y":548.6243896484375,"z":"1199f92b.84c70f","wires":[]},{"id":"85ef761e.bb2e3","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":1194.338623046875,"y":507.338623046875,"z":"1199f92b.84c70f","wires":[]},{"id":"d94d86ae.bd2ba8","type":"set","name":"set identifiers in overall structure","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.allotted-resource-identifiers.' value=\"`$tx-ar-identifiers.`\" />\n\n\n","comments":"","x":1184.38623046875,"y":856.910400390625,"z":"1199f92b.84c70f","wires":[]},{"id":"4d3ca425.12572c","type":"set","name":"set ecomp model information from input","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.' \nvalue=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.`\" />\n\n\n","comments":"","x":1212.957763671875,"y":591.9100952148438,"z":"1199f92b.84c70f","wires":[]},{"id":"bdc469ae.366338","type":"switchNode","name":"switch model-invariant-uuid is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid'>\n","comments":"","outputs":1,"x":1193.8148193359375,"y":631.195809841156,"z":"1199f92b.84c70f","wires":[["5ea1f53b.39ee54"]]},{"id":"5ea1f53b.39ee54","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1420.9576988220215,"y":632.6243271827698,"z":"1199f92b.84c70f","wires":[["c782a715.0e0b3"]]},{"id":"c782a715.0e0b3","type":"set","name":"set model-invariant-uuid","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-invariant-uuid' \nvalue=\"`$ar-model.invariant-uuid`\" />\n\n\n","comments":"","x":1622.38627243042,"y":632.0528798103333,"z":"1199f92b.84c70f","wires":[]},{"id":"86a14329.ea84b8","type":"switchNode","name":"switch model-uuid is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid'>\n","comments":"","outputs":1,"x":1165.2434158325195,"y":665.4815106391907,"z":"1199f92b.84c70f","wires":[["53567faf.2247e8"]]},{"id":"53567faf.2247e8","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1366.6719818115234,"y":666.0529322624207,"z":"1199f92b.84c70f","wires":[["d22c735a.1eff98"]]},{"id":"d22c735a.1eff98","type":"set","name":"set model-uuid","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-uuid' \nvalue=\"`$ar-model.uuid`\" />\n\n\n","comments":"","x":1559.529140472412,"y":666.0528540611267,"z":"1199f92b.84c70f","wires":[]},{"id":"466f1f08.f7d4a8","type":"switchNode","name":"switch model-version is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-version'>\n","comments":"","outputs":1,"x":1173.8148193359375,"y":707.338623046875,"z":"1199f92b.84c70f","wires":[["a33759a6.7c7e48"]]},{"id":"a33759a6.7c7e48","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1423.8148002624512,"y":698.3386225700378,"z":"1199f92b.84c70f","wires":[["a1dd22b5.33d6d"]]},{"id":"a1dd22b5.33d6d","type":"set","name":"set model-version","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-version' \nvalue=\"`$ar-model.version`\" />\n\n\n","comments":"","x":1616.6719589233398,"y":698.3385443687439,"z":"1199f92b.84c70f","wires":[]},{"id":"9057c540.68dbd","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.ecomp-generated-naming`'>\n","comments":"","outputs":1,"x":1237.38623046875,"y":800.7672729492188,"z":"1199f92b.84c70f","wires":[["335debba.1fe934","fe69e334.1d80a8"]]},{"id":"335debba.1fe934","type":"other","name":"outcome Y","xml":"<outcome value='Y'>\n","comments":"","outputs":1,"x":1523.3862915039062,"y":800.1958618164062,"z":"1199f92b.84c70f","wires":[["45257bd.1a2fa04"]]},{"id":"45257bd.1a2fa04","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">\n","atomic":"true","comments":"","outputs":1,"x":1677.1363525390625,"y":802.69580078125,"z":"1199f92b.84c70f","wires":[["bff7f73d.9b8c2"]]},{"id":"fe69e334.1d80a8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1542.608642578125,"y":889.1958618164062,"z":"1199f92b.84c70f","wires":[["565fbb98.b1aca4"]]},{"id":"565fbb98.b1aca4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in allotted-resource-model data.  Ecomp-generated-naming should be true\" />\n\n","comments":"","x":1725.608642578125,"y":894.1958618164062,"z":"1199f92b.84c70f","wires":[]},{"id":"bff7f73d.9b8c2","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.naming-policy`'>\n","comments":"","outputs":1,"x":1813.38623046875,"y":851.767333984375,"z":"1199f92b.84c70f","wires":[["1f60cb20.1aa2cd","7b3bbb.df36bc44"]]},{"id":"1f60cb20.1aa2cd","type":"other","name":"outcome oam_network_policy","xml":"<outcome value='oam_network_policy'>\n","comments":"","outputs":1,"x":2188.244140625,"y":855.3453369140625,"z":"1199f92b.84c70f","wires":[["9c860bec.e0d66"]]},{"id":"7b3bbb.df36bc44","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2102.671875,"y":932.1958618164062,"z":"1199f92b.84c70f","wires":[["9c860bec.e0d66"]]},{"id":"5116d261.6590bc","type":"set","name":"set ar_name","xml":"<set>\n<parameter name='tmp.ar-name' value='$TenantOAMNetworkRole_$LandingNetworkRole_SZ' />\n","comments":"","x":2494.100830078125,"y":890.7672729492188,"z":"1199f92b.84c70f","wires":[]},{"id":"35817794.2e25d8","type":"execute","name":"execute SliStringUtils - replace TenantOAMNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$TenantOAMNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.untrusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2638.2437858581543,"y":934.6244196891785,"z":"1199f92b.84c70f","wires":[[]]},{"id":"1501141a.25d134","type":"execute","name":"execute SliStringUtils - replace LandingNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$LandingNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.trusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2625.243896484375,"y":974.7672729492188,"z":"1199f92b.84c70f","wires":[[]]},{"id":"9c860bec.e0d66","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":2302.5292015075684,"y":930.3387522697449,"z":"1199f92b.84c70f","wires":[["5116d261.6590bc","35817794.2e25d8","1501141a.25d134","91c79897.77cff"]]},{"id":"91c79897.77cff","type":"set","name":"set identifiers.allotted-resource-name","xml":"<set>\n<parameter name='tx-ar-identifiers.allotted-resource-name' value='`$tmp.ar-name`' />\n","comments":"","x":2583.1005859375,"y":1025.052978515625,"z":"1199f92b.84c70f","wires":[]},{"id":"ea18351a.e0da4","type":"set","name":"set assignments in overall structure","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.' \nvalue=\"`$tx-ar-assignments.`\" />\n\n\n","comments":"","x":1159.8624267578125,"y":1233.6246337890625,"z":"1199f92b.84c70f","wires":[]},{"id":"c4d9f4e0.851328","type":"set","name":"Handle tx-ar-assignments","xml":"<set>\n<parameter name='tx-ar-assignments.vni' value='`$tmp.manageVni.vni`'/>\n<parameter name='tx-ar-assignments.vgmux-bearer-ip' value='`$tmp.vgmux-bearer-ip`'/>\n<parameter name='tx-ar-assignments.vgmux-lan-ip' value='`$tmp.vgmux-lan-ip`'/>\n<parameter name='tx-ar-assignments.vg-ip' value='`$tmp.manageIpaddr.ip`'/>\n\n","comments":"","x":1127.529052734375,"y":1153.052978515625,"z":"1199f92b.84c70f","wires":[]},{"id":"ca4f6251.f676b8","type":"for","name":"for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]","xml":"<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n","comments":"","outputs":1,"x":2210.8155822753906,"y":1335.0411586761475,"z":"1199f92b.84c70f","wires":[["d07b60e4.6703d"]]},{"id":"73b9e044.1a28b8","type":"switchNode","name":"switch service-data.consumed-allotted-resources_length","xml":"<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1216.8148193359375,"y":1328.505126953125,"z":"1199f92b.84c70f","wires":[["73760181.c95de","c367e332.923428"]]},{"id":"73760181.c95de","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1617.207763671875,"y":1307.1124267578125,"z":"1199f92b.84c70f","wires":[["1b189b0a.078ec5"]]},{"id":"c367e332.923428","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1609.957763671875,"y":1388.1124267578125,"z":"1199f92b.84c70f","wires":[["fd2f3b36.28b57"]]},{"id":"d07b60e4.6703d","type":"switchNode","name":"switch allotted-resource-id","xml":"<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n","comments":"","outputs":1,"x":2645.4106826782227,"y":1336.85085105896,"z":"1199f92b.84c70f","wires":[["a97263bc.410ad8"]]},{"id":"a97263bc.410ad8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2852.220375061035,"y":1340.064962387085,"z":"1199f92b.84c70f","wires":[["73531849.83f63"]]},{"id":"fd2f3b36.28b57","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1776.8349609375,"y":1382.488525390625,"z":"1199f92b.84c70f","wires":[["ca4f6251.f676b8","5ef04c10.686ff4"]]},{"id":"73531849.83f63","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3020.4817276000977,"y":1344.9222631454468,"z":"1199f92b.84c70f","wires":[["85f4a2a6.ccdab"]]},{"id":"1b189b0a.078ec5","type":"set","name":"set cidx","xml":"<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n","comments":"","x":1802.0648193359375,"y":1310.32666015625,"z":"1199f92b.84c70f","wires":[]},{"id":"85f4a2a6.ccdab","type":"set","name":"set tmp.cidx and ctx.consumed-ar","xml":"<set>\n<parameter name='tmp.cidx' value='`$cidx`' />\n<parameter name='ctx.consumed-ar.' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].`' />\n<parameter name='tmp.found-cidx' value='true' />","comments":"","x":3266.3391876220703,"y":1339.4937419891357,"z":"1199f92b.84c70f","wires":[]},{"id":"f16149e7.134fe","type":"set","name":"set consumed allotted resources","xml":"<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n","comments":"","x":1152.6720123291016,"y":1387.826681137085,"z":"1199f92b.84c70f","wires":[]},{"id":"3a94b596.f511e2","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1552.910057067871,"y":1748.4815347194672,"z":"1199f92b.84c70f","wires":[[]]},{"id":"d73436ab.76504","type":"comment","name":"Add SZ AR to mdsal","info":"","comments":"","x":1079.148193359375,"y":1698.1956787109375,"z":"1199f92b.84c70f","wires":[]},{"id":"cabff161.c1c3f8","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":1094.592529296875,"y":1447.2275390625,"z":"1199f92b.84c70f","wires":[[]]},{"id":"4ebb5534.09aedc","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":813.57666015625,"y":405.4814453125,"z":"1199f92b.84c70f","wires":[["e7607939.f160a8"]]},{"id":"b542ce05.d12118","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":761.57666015625,"y":901.2908325195312,"z":"1199f92b.84c70f","wires":[["f16149e7.134fe","cabff161.c1c3f8","738ca6aa.bf5888","295904fd.98be34","9d5729f3.96cf18","6305c3b7.10e66c","ae407ab9.d8441","33187c4e.932ecc","6f7f8e99.efeab8","4d3ca425.12572c","bdc469ae.366338","86a14329.ea84b8","466f1f08.f7d4a8","9057c540.68dbd","d94d86ae.bd2ba8","782f995b.c7ea4","1cd93a58.c40ea6","fe6f8a49.b66388","c4d9f4e0.851328","ea18351a.e0da4","73b9e044.1a28b8","fab7807f.a82bb8","ce575bb9.3832c8","c10b9954.5aad48","f67d8a3f.eb864","bb370f0b.999ba8"]]},{"id":"ae407ab9.d8441","type":"set","name":"set id","xml":"<set>\n<parameter name='tx-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='tx-ar.allotted-resource-status.action' value=\"`$tunnelxconn-topology-operation-input.request-information.request-action` \" />\n<parameter name='tx-ar.allotted-resource-status.rpc-name' value=\"tunnelxconn-topology-operation\" />\n<parameter name='tx-ar.allotted-resource-status.rpc-action' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$tunnelxconn-topology-operation-input.request-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$tunnelxconn-topology-operation-input.service-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.tunnelxconn-request-input.' value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.` \" />","comments":"","x":1132.2434387207031,"y":411.433837890625,"z":"1199f92b.84c70f","wires":[]},{"id":"f67d8a3f.eb864","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $service-data.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $service-data.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $service-data.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"description\" value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$ar-model.invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$ar-model.uuid`\" />\n\t<parameter name=\"operational-status\" value=\"null\" />","comments":"","outputs":1,"x":1119.38623046875,"y":1625.799072265625,"z":"1199f92b.84c70f","wires":[["e851470f.6820c","a2e69f5d.317138"]]},{"id":"e851470f.6820c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1369.814842224121,"y":1612.5292553901672,"z":"1199f92b.84c70f","wires":[["10169d60.8e8cf3"]]},{"id":"10169d60.8e8cf3","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":1538.3387451171875,"y":1614.1483154296875,"z":"1199f92b.84c70f","wires":[]},{"id":"a2e69f5d.317138","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1380.91015625,"y":1667.291259765625,"z":"1199f92b.84c70f","wires":[["10169d60.8e8cf3"]]},{"id":"5ef04c10.686ff4","type":"switchNode","name":"switch tmp.found-cidx","xml":"<switch test='`$tmp.found-cidx`'>\n","comments":"","outputs":1,"x":2025.743423461914,"y":1581.2315921783447,"z":"1199f92b.84c70f","wires":[["110b5f4d.dfc181"]]},{"id":"110b5f4d.dfc181","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2215.743377685547,"y":1581.2315292358398,"z":"1199f92b.84c70f","wires":[["aa9b2d21.01bc9"]]},{"id":"aa9b2d21.01bc9","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2381.743377685547,"y":1581.2315292358398,"z":"1199f92b.84c70f","wires":[["c1ca7ac4.055b78"]]},{"id":"c1ca7ac4.055b78","type":"set","name":"set tmp.cidx ","xml":"<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n","comments":"","x":2627.600706100464,"y":1581.8030033111572,"z":"1199f92b.84c70f","wires":[]},{"id":"9b8ea20.c5d2ae","type":"break","name":"break","xml":"<break/>\n","comments":"","x":3185.243408203125,"y":1384.731689453125,"z":"1199f92b.84c70f","wires":[]},{"id":"ea9a4916.25e128","type":"execute","name":"execute RestApiCallNode - Update parent provided service AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='DELETE' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n","comments":"","outputs":1,"x":1903.9521980285645,"y":1748.1904199123383,"z":"1199f92b.84c70f","wires":[["7ba04dee.e05774","30df0c18.2b414c","9b5f8936.710398"]]},{"id":"d07e3308.ff7ba8","type":"comment","name":"Rollback parent","info":"","comments":"","x":1747.9521255493164,"y":1717.8570504188538,"z":"1199f92b.84c70f","wires":[]},{"id":"7ba04dee.e05774","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2275.2602462768555,"y":1808.8553862571716,"z":"1199f92b.84c70f","wires":[["96ad59c0.bb63a"]]},{"id":"30df0c18.2b414c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2266.26029586792,"y":1777.3554120063782,"z":"1199f92b.84c70f","wires":[["96ad59c0.bb63a"]]},{"id":"9b5f8936.710398","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2270.0103340148926,"y":1747.7125168815255,"z":"1199f92b.84c70f","wires":[["96ad59c0.bb63a"]]},{"id":"96ad59c0.bb63a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2411.666301727295,"y":1743.9046860709786,"z":"1199f92b.84c70f","wires":[[]]},{"id":"91997441.0b5168","type":"comment","name":"Generate naming","info":"","comments":"","x":1168.3862762451172,"y":758.7672252655029,"z":"1199f92b.84c70f","wires":[]},{"id":"dc03e4ee.d84988","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":613,"y":227,"z":"1199f92b.84c70f","wires":[[]]},{"id":"e8e8f95a.c2474","type":"get-resource","name":"get-resource parent service instance","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='VNF-API' key='vnfs/vnf-list/$tmp.ar.parent-service-instance-id/service-data/' pfx='parent-service-instance' >\n","comments":"","outputs":1,"x":177,"y":535,"z":"1199f92b.84c70f","wires":[[]]},{"id":"574e94fb.ac4614","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":889,"y":502,"z":"1199f92b.84c70f","wires":[["b542ce05.d12118"]]},{"id":"93178853.42eb18","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":702,"y":603,"z":"1199f92b.84c70f","wires":[["b5b183ef.628608"]]},{"id":"b5b183ef.628608","type":"returnFailure","name":"return failure - parent service instance not found","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'No entry found for parent service instance id ' + $tmp.ar.parent-service-instance-id + '.'`\" />\n","comments":"","x":629,"y":664,"z":"1199f92b.84c70f","wires":[]},{"id":"af858bf.c7af2f8","type":"for","name":"for parent vnf parameters","xml":"<for index='curidx' start='0' end='`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters_length`' >\n","comments":"","outputs":1,"x":1679,"y":948,"z":"1199f92b.84c70f","wires":[["6cc5d5d9.577a24"]]},{"id":"6cc5d5d9.577a24","type":"switchNode","name":"switch parameter name","xml":"<switch test='`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters[$curidx].vnf-parameter-name`'>\n","comments":"","outputs":1,"x":1801,"y":1040,"z":"1199f92b.84c70f","wires":[["40106979.3c1f68","6c9f5586.8d3acc"]]},{"id":"40106979.3c1f68","type":"other","name":"vgmux_private_ip_0","xml":"<outcome value='vgmux_private_ip_0'>\n","comments":"","outputs":1,"x":2027,"y":1044,"z":"1199f92b.84c70f","wires":[["b789fdcd.90ae68"]]},{"id":"e8306c65.d29578","type":"set","name":"set tmp.vgmux-bearer-ip","xml":"<set>\n<parameter name='tmp.vgmux-bearer-ip' value='`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters[$curidx].vnf-parameter-value`'/>\n\n","comments":"","x":2259.9999771118164,"y":1105.0000400543213,"z":"1199f92b.84c70f","wires":[]},{"id":"6c9f5586.8d3acc","type":"other","name":"vgmux_private_ip_2","xml":"<outcome value='vgmux_private_ip_2'>\n","comments":"","outputs":1,"x":2029,"y":1104,"z":"1199f92b.84c70f","wires":[["e8306c65.d29578"]]},{"id":"b789fdcd.90ae68","type":"set","name":"set tmp.vgmux-lan-ip","xml":"<set>\n<parameter name='tmp.vgmux-lan-ip' value='`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters[$curidx].vnf-parameter-value`'/>\n\n","comments":"","x":2249.9999771118164,"y":1047.0000381469727,"z":"1199f92b.84c70f","wires":[]},{"id":"782f995b.c7ea4","type":"set","name":"set default assignments","xml":"<set>\n<parameter name='tmp.vni' value='123' />\n<parameter name='tmp.vgmux-bearer-ip' value='127.0.0.1' />\n<parameter name='tmp.vgmux-lan-ip' value='127.0.0.1' />","comments":"","x":1159,"y":902,"z":"1199f92b.84c70f","wires":[]},{"id":"c7b45e35.5d99f8","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.tx-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":609,"y":270,"z":"1199f92b.84c70f","wires":[[]]},{"id":"fe6f8a49.b66388","type":"call","name":"call GENERIC-RESOURCE-API:manage-vni-assignment","xml":"<call module='GENERIC-RESOURCE-API' rpc='manage-vni-assignment' mode='sync' >\n","comments":"","outputs":1,"x":1225,"y":1023,"z":"1199f92b.84c70f","wires":[[]]},{"id":"1cd93a58.c40ea6","type":"set","name":"set actions = reserve, pools = VNI, VGW","xml":"<set>\n<parameter name='tmp.manageVni.action' value='reserve' />\n<parameter name='tmp.manageIpaddr.action' value='reserve' />\n<parameter name='tmp.manageVni.pool' value='VNI'/>\n<parameter name='tmp.manageIpaddr.pool' value='VGW'/>","comments":"","x":1178,"y":986,"z":"1199f92b.84c70f","wires":[]},{"id":"c3103460.280e18","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":533,"y":405,"z":"1199f92b.84c70f","wires":[["6fb8a35e.f42ca4","4ebb5534.09aedc"]]},{"id":"fab7807f.a82bb8","type":"switchNode","name":"Does parent service instance have vnf parameters?","xml":"<switch test=\"`$parent-service-instance.service-data.vnf-topology-information.vnf-parameters_length != ''`\">\n","comments":"","outputs":1,"x":1226,"y":943,"z":"1199f92b.84c70f","wires":[["821280c.218ce8"]]},{"id":"821280c.218ce8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1488,"y":945,"z":"1199f92b.84c70f","wires":[["af858bf.c7af2f8"]]},{"id":"ce575bb9.3832c8","type":"call","name":"call GENERIC-RESOURCE-API:manage-ipaddr-assignment","xml":"<call module='GENERIC-RESOURCE-API' rpc='manage-ipaddr-assignment' mode='sync' >\n","comments":"","outputs":1,"x":1237,"y":1064,"z":"1199f92b.84c70f","wires":[[]]},{"id":"c10b9954.5aad48","type":"set","name":"Handle tx parameters","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[0].name' value='VNI'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[0].value' value='`$tmp.manageVni.vni`'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[1].name' value='vgmux_private_ip_2'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[1].value' value='`$tmp.vgmux-bearer-ip`'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[2].name' value='vgmux_private_ip_0'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[2].value' value='`$tmp.vgmux-lan-ip`'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[3].name' value='vgw_private_ip_0'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters.param[3].value' value='`$tmp.manageIpaddr.ip`'/>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-parameters_length' value='4'/>\n\n","comments":"","x":1124,"y":1193,"z":"1199f92b.84c70f","wires":[]},{"id":"97512ae7.66d038","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":232,"y":483,"z":"1199f92b.84c70f","wires":[]},{"id":"e7607939.f160a8","type":"call","name":"call  get-vnf-api-parent-instance","xml":"\n<call module='GENERIC-RESOURCE-API' rpc='get-vnf-api-parent-instance' mode='sync' >\n","comments":"","outputs":1,"x":629,"y":502,"z":"1199f92b.84c70f","wires":[["574e94fb.ac4614","93178853.42eb18"]]},{"id":"bb370f0b.999ba8","type":"set","name":"setservice data custid, svc instance, svc type","xml":"<set>\n<parameter name='service-data.service-information.global-customer-id' value='`$tunnelxconn-topology-operation-input.service-information.global-customer-id`' />\n<parameter name='service-data.service-information.subscription-service-type' value='`$tunnelxconn-topology-operation-input.service-information.subscription-service-type`' />\n<!--\n<parameter name='service-data.service-information.service-instance-id' value='`$tunnelxconn-topology-operation-input.service-information.service-instance-id`' />\n-->\n<parameter name='service-data.service-information.service-instance-id' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id`\"/>","comments":"","x":1173.4443969726562,"y":1560.666748046875,"z":"1199f92b.84c70f","wires":[]},{"id":"81296acf.9afab8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":778.8888888888889,"y":1563.3333333333333,"z":"1199f92b.84c70f","wires":[]},{"id":"c87576f3.85ee38","type":"comment","name":"map input to service-data request info","info":"","comments":"","x":1453.3334350585938,"y":1538.888671875,"z":"1199f92b.84c70f","wires":[]},{"id":"f0b09585.ceb66","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":773,"y":1148,"z":"1199f92b.84c70f","wires":[]}]
