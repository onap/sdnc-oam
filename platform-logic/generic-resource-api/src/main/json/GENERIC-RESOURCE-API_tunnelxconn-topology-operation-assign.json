[{"id":"e5a03d9a.1edde","type":"dgstart","name":"DGSTART","outputs":1,"x":168,"y":90,"z":"4627aafc.0cf754","wires":[["1a45e32c.7eec9d"]]},{"id":"1a45e32c.7eec9d","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":264.2380790710449,"y":150.95239067077637,"z":"4627aafc.0cf754","wires":[["8c562652.9938c"]]},{"id":"8c562652.9938c","type":"method","name":"tunnelxconn-topology-operation-assign","xml":"<method rpc='tunnelxconn-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":315.15485763549805,"y":186.19044589996338,"z":"4627aafc.0cf754","wires":[["127b33d3.348d44"]]},{"id":"127b33d3.348d44","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":218.47619247436523,"y":329.5237879753113,"z":"4627aafc.0cf754","wires":[["ed41c58b.0de058","40c517df.179a68","31364232.805fa6","9e41c4b2.1cbae8","f542b0.6e96f55"]]},{"id":"af6119f3.dfb79","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1061.6666564941406,"y":2256.5477046966553,"z":"4627aafc.0cf754","wires":[]},{"id":"358d6fd4.61c","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='tunnelxconn-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $tunnelxconn-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":1098.7540550231934,"y":2135.432439804077,"z":"4627aafc.0cf754","wires":[]},{"id":"a3bcd19.c7f583","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='PendingCreate' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tunnelxconn-topology-operation-input.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":1170.468376159668,"y":1552.6228160858154,"z":"4627aafc.0cf754","wires":[]},{"id":"40c517df.179a68","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:tunnelxconn-allotted-resources/tunnelxconn-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/tunnelxconn-topology/'` \" />\n\n","comments":"","x":664.738037109375,"y":197.33331298828125,"z":"4627aafc.0cf754","wires":[]},{"id":"ed41c58b.0de058","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n\n\n","comments":"","x":712.997314453125,"y":153.59259033203125,"z":"4627aafc.0cf754","wires":[]},{"id":"bb3b1063.64e5e","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":851.8148803710938,"y":369.26727294921875,"z":"4627aafc.0cf754","wires":[["18d55063.8f2ed8"]]},{"id":"b4db148.3666b68","type":"execute","name":"execute RestApiCallNode - PUT AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.tx.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":1191.8626251220703,"y":1777.1008231639862,"z":"4627aafc.0cf754","wires":[["849359cb.597c6","492cd67b.f3ce88","180f6e96.404e19"]]},{"id":"849359cb.597c6","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1460.5040016174316,"y":1828.4322349056602,"z":"4627aafc.0cf754","wires":[["ba0327fc.aba8b8"]]},{"id":"492cd67b.f3ce88","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1451.504051208496,"y":1796.9322606548667,"z":"4627aafc.0cf754","wires":[["ba0327fc.aba8b8"]]},{"id":"180f6e96.404e19","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1455.2540893554688,"y":1767.289365530014,"z":"4627aafc.0cf754","wires":[["d14af406.4287f"]]},{"id":"ba0327fc.aba8b8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for tunnelxconn-allotted-resource\" />\n","comments":"","x":1621.2540893554688,"y":1797.6822844967246,"z":"4627aafc.0cf754","wires":[]},{"id":"5be54f87.d14c2","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$tx-ar.allotted-resource-status.rpc-action`' />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1201.5294189453125,"y":470.05291748046875,"z":"4627aafc.0cf754","wires":[]},{"id":"a2ba5660.2c2fb8","type":"comment","name":"Save consumed-allotted-resources to mdsal","info":"","comments":"","x":1228.2435302734375,"y":1292.7196044921875,"z":"4627aafc.0cf754","wires":[]},{"id":"8b6a893a.d008b8","type":"comment","name":"GET tunnelxconn-allotted-resource from mdsal","info":"","comments":"","x":574.8148193359375,"y":339.7672119140625,"z":"4627aafc.0cf754","wires":[]},{"id":"18d55063.8f2ed8","type":"returnFailure","name":"return failure - tunnelxconn already exists","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'Existing tunnelxconn-allotted-resource with order status of ' + $mdsal-ar.tunnelxconn-allotted-resource.allotted-resource-data.allotted-resource-oper-status.order-status + '.'`\" />\n","comments":"","x":1161.129150390625,"y":364.6243896484375,"z":"4627aafc.0cf754","wires":[]},{"id":"f11c5b51.4f3278","type":"set","name":"set tx-ar-identifiers","xml":"<set>\n<parameter name='tx-ar-identifiers.consuming-service-instance-id' value=\"`$tunnelxconn-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='tx-ar-identifiers.parent-service-instance-id' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='tx-ar-identifiers.allotted-resource-type' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='tx-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n","comments":"","x":1211.38623046875,"y":563.6243896484375,"z":"4627aafc.0cf754","wires":[]},{"id":"a0f58fcb.d9b998","type":"comment","name":"Set allotted-resource-identifiers","info":"","comments":"","x":1238.338623046875,"y":522.338623046875,"z":"4627aafc.0cf754","wires":[]},{"id":"47fd678a.738f08","type":"set","name":"set identifiers in overall structure","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.allotted-resource-identifiers.' value=\"`$tx-ar-identifiers.`\" />\n\n\n","comments":"","x":1228.38623046875,"y":871.910400390625,"z":"4627aafc.0cf754","wires":[]},{"id":"3081a28c.9b5c36","type":"set","name":"set ecomp model information from input","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.' \nvalue=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.`\" />\n\n\n","comments":"","x":1256.957763671875,"y":606.9100952148438,"z":"4627aafc.0cf754","wires":[]},{"id":"c627ed39.e1aaf8","type":"switchNode","name":"switch model-invariant-uuid is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid'>\n","comments":"","outputs":1,"x":1237.8148193359375,"y":646.195809841156,"z":"4627aafc.0cf754","wires":[["37aaff9b.6ef948"]]},{"id":"37aaff9b.6ef948","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1464.9576988220215,"y":647.6243271827698,"z":"4627aafc.0cf754","wires":[["d4ace565.3a0d58"]]},{"id":"d4ace565.3a0d58","type":"set","name":"set model-invariant-uuid","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-invariant-uuid' \nvalue=\"`$ar-model.invariant-uuid`\" />\n\n\n","comments":"","x":1666.38627243042,"y":647.0528798103333,"z":"4627aafc.0cf754","wires":[]},{"id":"11faa499.f9d22b","type":"switchNode","name":"switch model-uuid is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid'>\n","comments":"","outputs":1,"x":1209.2434158325195,"y":680.4815106391907,"z":"4627aafc.0cf754","wires":[["d5fa1186.86df"]]},{"id":"d5fa1186.86df","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1410.6719818115234,"y":681.0529322624207,"z":"4627aafc.0cf754","wires":[["10be4dfe.844d32"]]},{"id":"10be4dfe.844d32","type":"set","name":"set model-uuid","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-uuid' \nvalue=\"`$ar-model.uuid`\" />\n\n\n","comments":"","x":1603.529140472412,"y":681.0528540611267,"z":"4627aafc.0cf754","wires":[]},{"id":"77e8e0e0.62c46","type":"switchNode","name":"switch model-version is null","xml":"<switch test='$tunnelxconn-topology-operation-input.allotted-resource-information.onap-model-information.model-version'>\n","comments":"","outputs":1,"x":1217.8148193359375,"y":713.3386378288269,"z":"4627aafc.0cf754","wires":[["2d586a06.2b22fe"]]},{"id":"2d586a06.2b22fe","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1467.8148002624512,"y":713.3386225700378,"z":"4627aafc.0cf754","wires":[["8505026a.4f24f8"]]},{"id":"8505026a.4f24f8","type":"set","name":"set model-version","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.onap-model-information.model-version' \nvalue=\"`$ar-model.version`\" />\n\n\n","comments":"","x":1660.6719589233398,"y":713.3385443687439,"z":"4627aafc.0cf754","wires":[]},{"id":"520caffa.1e3b98","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.ecomp-generated-naming`'>\n","comments":"","outputs":1,"x":1281.38623046875,"y":815.7672729492188,"z":"4627aafc.0cf754","wires":[["77882b56.1c8fc4","554f7f59.f93b78"]]},{"id":"77882b56.1c8fc4","type":"other","name":"outcome Y","xml":"<outcome value='Y'>\n","comments":"","outputs":1,"x":1567.3862915039062,"y":815.1958618164062,"z":"4627aafc.0cf754","wires":[["6920c7dc.a2a58"]]},{"id":"6920c7dc.a2a58","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">\n","atomic":"true","comments":"","outputs":1,"x":1721.1363525390625,"y":817.69580078125,"z":"4627aafc.0cf754","wires":[["d8057468.473a48"]]},{"id":"554f7f59.f93b78","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1586.608642578125,"y":904.1958618164062,"z":"4627aafc.0cf754","wires":[["ac09c984.93c9a8"]]},{"id":"ac09c984.93c9a8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in allotted-resource-model data.  Ecomp-generated-naming should be true\" />\n\n","comments":"","x":1769.608642578125,"y":909.1958618164062,"z":"4627aafc.0cf754","wires":[]},{"id":"d8057468.473a48","type":"switchNode","name":"switch ar-model.ecomp-generated-naming","xml":"<switch test='`$ar-model.naming-policy`'>\n","comments":"","outputs":1,"x":1857.38623046875,"y":866.767333984375,"z":"4627aafc.0cf754","wires":[["ea4f625c.daf458","dd389be2.410d38"]]},{"id":"ea4f625c.daf458","type":"other","name":"outcome oam_network_policy","xml":"<outcome value='oam_network_policy'>\n","comments":"","outputs":1,"x":2232.244140625,"y":870.3453369140625,"z":"4627aafc.0cf754","wires":[["6fa0da80.617c04"]]},{"id":"dd389be2.410d38","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2146.671875,"y":947.1958618164062,"z":"4627aafc.0cf754","wires":[["6fa0da80.617c04"]]},{"id":"d20fc560.51ea78","type":"set","name":"set ar_name","xml":"<set>\n<parameter name='tmp.ar-name' value='$TenantOAMNetworkRole_$LandingNetworkRole_SZ' />\n","comments":"","x":2538.100830078125,"y":905.7672729492188,"z":"4627aafc.0cf754","wires":[]},{"id":"e41782e3.e0f368","type":"execute","name":"execute SliStringUtils - replace TenantOAMNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$TenantOAMNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.untrusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2682.2437858581543,"y":949.6244196891785,"z":"4627aafc.0cf754","wires":[[]]},{"id":"e75f6e33.825248","type":"execute","name":"execute SliStringUtils - replace LandingNetworkRole","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.ar-name`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-name\"/>\n    <parameter name=\"target\" value=\"$LandingNetworkRole\"/>\n    <parameter name=\"replacement\" value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.trusted-network-role`\"/>\n\n","comments":"","outputs":1,"x":2669.243896484375,"y":989.7672729492188,"z":"4627aafc.0cf754","wires":[[]]},{"id":"6fa0da80.617c04","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":2346.5292015075684,"y":945.3387522697449,"z":"4627aafc.0cf754","wires":[["d20fc560.51ea78","e41782e3.e0f368","e75f6e33.825248","8c24a151.c736c"]]},{"id":"8c24a151.c736c","type":"set","name":"set identifiers.allotted-resource-name","xml":"<set>\n<parameter name='tx-ar-identifiers.allotted-resource-name' value='`$tmp.ar-name`' />\n","comments":"","x":2627.1005859375,"y":1040.052978515625,"z":"4627aafc.0cf754","wires":[]},{"id":"e36ad273.011c6","type":"set","name":"set assignments in overall structure","xml":"<set>\n<parameter name='tx-ar.allotted-resource-data.tunnelxconn-topology.tunnelxconn-assignments.' \nvalue=\"`$tx-ar-assignments.`\" />\n\n\n","comments":"","x":1213.8624267578125,"y":1238.6246337890625,"z":"4627aafc.0cf754","wires":[]},{"id":"ef696041.5b90d8","type":"set","name":"Handle tx-ar-assignments","xml":"<set>\n<parameter name='tx-ar-assignments.vni' value='`$tmp.manage-vni.vni`'/>\n<parameter name='tx-ar-assignments.vgmux-bearer-ip' value='`$tmp.vgmux-bearer-ip`'/>\n<parameter name='tx-ar-assignments.vgmux-lan-ip' value='`$tmp.vgmux-lan-ip`'/>\n<parameter name='tx-ar-assignments.vgw-private-ip-0' value='`$tmp.manage-ipaddr.ip`'/>\n\n","comments":"","x":1182.529052734375,"y":1194.052978515625,"z":"4627aafc.0cf754","wires":[]},{"id":"81c7c31a.0b9c08","type":"for","name":"for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]","xml":"<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n","comments":"","outputs":1,"x":2254.8155822753906,"y":1350.0411586761475,"z":"4627aafc.0cf754","wires":[["a8fdd019.115188"]]},{"id":"b4784ddb.aece58","type":"switchNode","name":"switch service-data.consumed-allotted-resources_length","xml":"<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1260.8148193359375,"y":1343.505126953125,"z":"4627aafc.0cf754","wires":[["45dcd74.e909ba8","69f40501.d12704"]]},{"id":"45dcd74.e909ba8","type":"other","name":"outcome Null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1661.207763671875,"y":1322.1124267578125,"z":"4627aafc.0cf754","wires":[["a82537c1.99c678"]]},{"id":"69f40501.d12704","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1653.957763671875,"y":1403.1124267578125,"z":"4627aafc.0cf754","wires":[["ec015624.23587"]]},{"id":"a8fdd019.115188","type":"switchNode","name":"switch allotted-resource-id","xml":"<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n","comments":"","outputs":1,"x":2689.4106826782227,"y":1351.85085105896,"z":"4627aafc.0cf754","wires":[["9616a8f.73197d8"]]},{"id":"9616a8f.73197d8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2896.220375061035,"y":1355.064962387085,"z":"4627aafc.0cf754","wires":[["2403ce35.8da102"]]},{"id":"ec015624.23587","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1820.8349609375,"y":1397.488525390625,"z":"4627aafc.0cf754","wires":[["81c7c31a.0b9c08","e31fed63.529bb8"]]},{"id":"2403ce35.8da102","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3064.4817276000977,"y":1359.9222631454468,"z":"4627aafc.0cf754","wires":[["ed794a09.288b9"]]},{"id":"a82537c1.99c678","type":"set","name":"set cidx","xml":"<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n","comments":"","x":1846.0648193359375,"y":1325.32666015625,"z":"4627aafc.0cf754","wires":[]},{"id":"ed794a09.288b9","type":"set","name":"set tmp.cidx and ctx.consumed-ar","xml":"<set>\n<parameter name='tmp.cidx' value='`$cidx`' />\n<parameter name='ctx.consumed-ar.' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].`' />\n<parameter name='tmp.found-cidx' value='true' />","comments":"","x":3310.3391876220703,"y":1354.4937419891357,"z":"4627aafc.0cf754","wires":[]},{"id":"24131551.a54552","type":"set","name":"set consumed allotted resources","xml":"<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n","comments":"","x":1196.6720123291016,"y":1402.826681137085,"z":"4627aafc.0cf754","wires":[]},{"id":"d14af406.4287f","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1596.910057067871,"y":1763.4815347194672,"z":"4627aafc.0cf754","wires":[["3f3ebeb1.b63712"]]},{"id":"468bfff8.9cedd","type":"comment","name":"Add SZ AR to mdsal","info":"","comments":"","x":1121.148208618164,"y":1738.1957080364227,"z":"4627aafc.0cf754","wires":[]},{"id":"790cd2d4.165b2c","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":1137.4814224243164,"y":1476.671986579895,"z":"4627aafc.0cf754","wires":[[]]},{"id":"c56eedac.e7ffe8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":857.57666015625,"y":420.4814453125,"z":"4627aafc.0cf754","wires":[["342ab637.9d2c12"]]},{"id":"4de43800.b85998","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":805.57666015625,"y":916.2908325195312,"z":"4627aafc.0cf754","wires":[["24131551.a54552","790cd2d4.165b2c","a3bcd19.c7f583","b4db148.3666b68","358d6fd4.61c","af6119f3.dfb79","f425ba40.7115f8","5be54f87.d14c2","f11c5b51.4f3278","3081a28c.9b5c36","c627ed39.e1aaf8","11faa499.f9d22b","77e8e0e0.62c46","520caffa.1e3b98","47fd678a.738f08","cebf3b05.8ecc9","75aa99cd.2bc41","9dbd9cc2.7689e","ef696041.5b90d8","e36ad273.011c6","b4784ddb.aece58","cd0dd524.fb0c78","1433ef16.581949","2d580163.5c930e"]]},{"id":"f425ba40.7115f8","type":"set","name":"set id","xml":"<set>\n<parameter name='tx-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='tx-ar.allotted-resource-status.action' value=\"`$tunnelxconn-topology-operation-input.request-information.request-action` \" />\n<parameter name='tx-ar.allotted-resource-status.rpc-name' value=\"tunnelxconn-topology-operation\" />\n<parameter name='tx-ar.allotted-resource-status.rpc-action' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$tunnelxconn-topology-operation-input.request-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$tunnelxconn-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$tunnelxconn-topology-operation-input.service-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='tx-ar.allotted-resource-data.allotted-resource-operation-information.tunnelxconn-request-input.' value=\"`$tunnelxconn-topology-operation-input.tunnelxconn-request-input.` \" />","comments":"","x":1176.2434387207031,"y":426.433837890625,"z":"4627aafc.0cf754","wires":[]},{"id":"2d580163.5c930e","type":"update","name":"update AAI allotted-resource","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $service-data.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $service-data.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $service-data.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"description\" value=\"`$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-type`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$ar-model.invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$ar-model.uuid`\" />\n\t<parameter name=\"operational-status\" value=\"null\" />\n","comments":"","outputs":1,"x":1146.052978515625,"y":1626.5767822265625,"z":"4627aafc.0cf754","wires":[["abe0caa5.373ae8","b2e9c1e.d54a94"]]},{"id":"abe0caa5.373ae8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1413.814842224121,"y":1627.5292553901672,"z":"4627aafc.0cf754","wires":[["43ff6c37.a7022c"]]},{"id":"43ff6c37.a7022c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n","comments":"","x":1580.338722229004,"y":1639.1483263969421,"z":"4627aafc.0cf754","wires":[]},{"id":"b2e9c1e.d54a94","type":"failure","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1420.9101295471191,"y":1660.2912230491638,"z":"4627aafc.0cf754","wires":[["43ff6c37.a7022c"]]},{"id":"e31fed63.529bb8","type":"switchNode","name":"switch tmp.found-cidx","xml":"<switch test='`$tmp.found-cidx`'>\n","comments":"","outputs":1,"x":2069.743423461914,"y":1596.2315921783447,"z":"4627aafc.0cf754","wires":[["e9a982b1.ef58e"]]},{"id":"e9a982b1.ef58e","type":"outcomeTrue","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2259.743377685547,"y":1596.2315292358398,"z":"4627aafc.0cf754","wires":[["157da3f3.93a6e4"]]},{"id":"157da3f3.93a6e4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2425.743377685547,"y":1596.2315292358398,"z":"4627aafc.0cf754","wires":[["ca0674a1.25423"]]},{"id":"ca0674a1.25423","type":"set","name":"set tmp.cidx ","xml":"<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n","comments":"","x":2671.600706100464,"y":1596.8030033111572,"z":"4627aafc.0cf754","wires":[]},{"id":"b3603aa4.6cf16","type":"break","name":"break","xml":"<break/>\n","comments":"","x":3229.243408203125,"y":1399.731689453125,"z":"4627aafc.0cf754","wires":[]},{"id":"3f3ebeb1.b63712","type":"execute","name":"execute RestApiCallNode - Update parent provided service AR","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='DELETE' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n","comments":"","outputs":1,"x":1947.9521980285645,"y":1763.1904199123383,"z":"4627aafc.0cf754","wires":[["2c401ba8.1dd6a4","ba3898d2.1f6628","2e69c41e.18f424"]]},{"id":"33f3cbe9.733ea4","type":"comment","name":"Rollback parent","info":"","comments":"","x":1791.9521255493164,"y":1732.8570504188538,"z":"4627aafc.0cf754","wires":[]},{"id":"2c401ba8.1dd6a4","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2319.2602462768555,"y":1823.8553862571716,"z":"4627aafc.0cf754","wires":[["5c77461f.eab298"]]},{"id":"ba3898d2.1f6628","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2310.26029586792,"y":1792.3554120063782,"z":"4627aafc.0cf754","wires":[["5c77461f.eab298"]]},{"id":"2e69c41e.18f424","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2314.0103340148926,"y":1762.7125168815255,"z":"4627aafc.0cf754","wires":[["5c77461f.eab298"]]},{"id":"5c77461f.eab298","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2455.666301727295,"y":1758.9046860709786,"z":"4627aafc.0cf754","wires":[[]]},{"id":"33d27b3b.1ed984","type":"comment","name":"Generate naming","info":"","comments":"","x":1212.3862762451172,"y":773.7672252655029,"z":"4627aafc.0cf754","wires":[]},{"id":"c715248e.047aa8","type":"get-resource","name":"get-resource tunnelxconn-allotted-resource","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='GENERIC-RESOURCE-API' key=\"tunnelxconn-allotted-resources/tunnelxconn-allotted-resource/$tunnelxconn-topology-operation-input.allotted-resource-information.allotted-resource-id/\" pfx='mdsal-ar' >\n","comments":"","outputs":1,"x":557,"y":374,"z":"4627aafc.0cf754","wires":[[]]},{"id":"31364232.805fa6","type":"execute","name":"execute Properties","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":657,"y":242,"z":"4627aafc.0cf754","wires":[[]]},{"id":"342ab637.9d2c12","type":"get-resource","name":"get-resource parent service instance","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='VNF-API' key='vnfs/vnf-list/$tmp.ar.parent-service-instance-id/' pfx='parent-service-instance' >\n","comments":"","outputs":1,"x":670,"y":523,"z":"4627aafc.0cf754","wires":[["231a36e0.5b5c92","fa70aaf0.7e7e58"]]},{"id":"fa70aaf0.7e7e58","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":933,"y":517,"z":"4627aafc.0cf754","wires":[["4de43800.b85998"]]},{"id":"231a36e0.5b5c92","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":746,"y":618,"z":"4627aafc.0cf754","wires":[["ef5be56d.68e6b8"]]},{"id":"ef5be56d.68e6b8","type":"returnFailure","name":"return failure - parent service instance not found","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'No entry found for parent service instance id ' + $tmp.ar.parent-service-instance-id + '.'`\" />\n","comments":"","x":673,"y":679,"z":"4627aafc.0cf754","wires":[]},{"id":"59cf2993.ef07d","type":"for","name":"for parent vnf parameters","xml":"<for index='curparm' start='0' end='`$parent-service-instance.service-data.vnf-topology.vnf-parameters_length`' >\n","comments":"","outputs":1,"x":1723,"y":963,"z":"4627aafc.0cf754","wires":[["9a20a584.dd26e"]]},{"id":"9a20a584.dd26e","type":"switchNode","name":"switch parameter name","xml":"<switch test='$parent-service-instance.service-data.vnf-topology.vnf-parameters[$curidx].vnf-parameter-name'>\n","comments":"","outputs":1,"x":1845,"y":1055,"z":"4627aafc.0cf754","wires":[["45008daf.13f0f4","89c3773d.20de38"]]},{"id":"45008daf.13f0f4","type":"other","name":"vgmux_private_ip_0","xml":"<outcome value='vgmux_private_ip_0'>\n","comments":"","outputs":1,"x":2071,"y":1059,"z":"4627aafc.0cf754","wires":[["add12901.13946"]]},{"id":"add12901.13946","type":"set","name":"set tmp.vgmux-bearer-ip","xml":"<set>\n<parameter name='tmp.vgmux-bearer-ip' value='`$parent-service-instance.service-data.vnf-topology.vnf-parameters[$curidx].vnf-parameter-value`'/>\n\n","comments":"","x":2314,"y":1060,"z":"4627aafc.0cf754","wires":[]},{"id":"89c3773d.20de38","type":"other","name":"vgmux_private_ip_2","xml":"<outcome value='vgmux_private_ip_2'>\n","comments":"","outputs":1,"x":2073,"y":1119,"z":"4627aafc.0cf754","wires":[["f5b75cdc.b16da8"]]},{"id":"f5b75cdc.b16da8","type":"set","name":"set tmp.vgmux-lan-ip","xml":"<set>\n<parameter name='tmp.vgmux-lan-ip' value='`$parent-service-instance.service-data.vnf-topology.vnf-parameters[$curidx].vnf-parameter-value`'/>\n\n","comments":"","x":2316,"y":1120,"z":"4627aafc.0cf754","wires":[]},{"id":"cebf3b05.8ecc9","type":"set","name":"set default assignments","xml":"<set>\n<parameter name='tmp.vni' value='123' />\n<parameter name='tmp.vgmux-bearer-ip' value='127.0.0.1' />\n<parameter name='tmp.vgmux-lan-ip' value='127.0.0.1' />","comments":"","x":1203,"y":917,"z":"4627aafc.0cf754","wires":[]},{"id":"9e41c4b2.1cbae8","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.tx-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":653,"y":285,"z":"4627aafc.0cf754","wires":[[]]},{"id":"9dbd9cc2.7689e","type":"call","name":"call GENERIC-RESOURCE-API:manage-vni-assignment","xml":"<call module='GENERIC-RESOURCE-API' rpc='manage-vni-assignment' mode='sync' >\n","comments":"","outputs":1,"x":1290,"y":1062,"z":"4627aafc.0cf754","wires":[[]]},{"id":"75aa99cd.2bc41","type":"set","name":"set actions = reserve, pools = VNI, VGW","xml":"<set>\n<parameter name='tmp.manage-vni.action' value='reserve' />\n<parameter name='tmp.manage-ipaddr.action' value='reserve' />\n<parameter name='tmp.manage-vni.pool' value='VNI'/>\n<parameter name='tmp.manage-ipaddr.pool' value='VGW'/>","comments":"","x":1226,"y":1008,"z":"4627aafc.0cf754","wires":[]},{"id":"f542b0.6e96f55","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":577,"y":420,"z":"4627aafc.0cf754","wires":[["bb3b1063.64e5e","c56eedac.e7ffe8"]]},{"id":"cd0dd524.fb0c78","type":"switchNode","name":"Does parent service instance have vnf parameters?","xml":"<switch test=\"$parent-service-instance.service-data.vnf-topology.vnf-parameters_length != ''\">\n","comments":"","outputs":1,"x":1270,"y":958,"z":"4627aafc.0cf754","wires":[["9a6edde3.28567"]]},{"id":"9a6edde3.28567","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1532,"y":960,"z":"4627aafc.0cf754","wires":[["59cf2993.ef07d"]]},{"id":"1433ef16.581949","type":"call","name":"call GENERIC-RESOURCE-API:manage-ipaddr-assignment","xml":"<call module='GENERIC-RESOURCE-API' rpc='manage-ipaddr-assignment' mode='sync' >\n","comments":"","outputs":1,"x":1286,"y":1109,"z":"4627aafc.0cf754","wires":[[]]}]