[{"id":"8742d12.7a1d7b","type":"dgstart","name":"DGSTART","outputs":1,"x":183,"y":176.02430057525635,"z":"42cbb89a.8c64f","wires":[["894b3de3.f71528"]]},{"id":"894b3de3.f71528","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":296.8571357727051,"y":215.8338384628296,"z":"42cbb89a.8c64f","wires":[["f890db1d.3600f"]]},{"id":"f890db1d.3600f","type":"method","name":"method vf-module-topology-operation-assign","xml":"<method rpc='vf-module-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":296.42862701416016,"y":256.02430057525635,"z":"42cbb89a.8c64f","wires":[["c8a1e002.809438"]]},{"id":"7dcb9f29.bd27d8","type":"comment","name":"vf-module-topology-operation-assign","info":"","comments":"","x":588.3210983276367,"y":119,"z":"42cbb89a.8c64f","wires":[]},{"id":"f5ba158b.f70238","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vf-module-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":588.1905097961426,"y":431.548122882843,"z":"42cbb89a.8c64f","wires":[["2d4867a.0da5a18","56323370.3acb6c"]]},{"id":"2d4867a.0da5a18","type":"outcome","name":"CreateVfModuleInstance","xml":"<outcome value='CreateVfModuleInstance'>\n","comments":"","outputs":1,"x":850.2381248474121,"y":408.6910090446472,"z":"42cbb89a.8c64f","wires":[["9093ce89.dbd2"]]},{"id":"56323370.3acb6c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":793.9047698974609,"y":454.07199811935425,"z":"42cbb89a.8c64f","wires":[["83310546.dd5548"]]},{"id":"9093ce89.dbd2","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1040.0952892303467,"y":408.69104051589966,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"83310546.dd5548","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'assign' then request-action must be 'CreateVfModuleInstance'\" />\n","comments":"","x":1058.9047775268555,"y":454.40531063079834,"z":"42cbb89a.8c64f","wires":[]},{"id":"a85265fb.59c4f8","type":"get-resource","name":"get-resource VF_MODULE_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODULE_MODEL WHERE customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-module-model'>\n\n","comments":"","outputs":1,"x":635.5237770080566,"y":522.6910729408264,"z":"42cbb89a.8c64f","wires":[["c3c0e66.56b1a98","8973ae47.d019f"]]},{"id":"b078e35d.a7a8b","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No model found for VF module customization UUID ' + $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`\" />\n","comments":"","x":1076.9521980285645,"y":547.1195454597473,"z":"42cbb89a.8c64f","wires":[]},{"id":"c3c0e66.56b1a98","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":901.3094673156738,"y":503.0719037055969,"z":"42cbb89a.8c64f","wires":[["2e22b269.a520a6"]]},{"id":"8973ae47.d019f","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":909.8808975219727,"y":547.3576169013977,"z":"42cbb89a.8c64f","wires":[["b078e35d.a7a8b"]]},{"id":"2e22b269.a520a6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODULE_MODEL table\" />\n","comments":"","x":1076.309398651123,"y":502.21480417251587,"z":"42cbb89a.8c64f","wires":[]},{"id":"7aa1bb6.19ed144","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":630.6190414428711,"y":731.2624082565308,"z":"42cbb89a.8c64f","wires":[["9220ab58.177838","a7e6546c.a7384"]]},{"id":"9220ab58.177838","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":871.3333129882812,"y":708.4051485061646,"z":"42cbb89a.8c64f","wires":[["56bd0e83.72fec"]]},{"id":"a7e6546c.a7384","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":871.0951538085938,"y":749.3576669692993,"z":"42cbb89a.8c64f","wires":[["8c7195ad.71de6"]]},{"id":"c8a1e002.809438","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":237.99999237060547,"y":2426.024260520935,"z":"42cbb89a.8c64f","wires":[["f5ba158b.f70238","a85265fb.59c4f8","7aa1bb6.19ed144","5b156e7.3ede59","78f55d30.9b559c","e85f12eb.c3b7d8","bd4f4b52.b86c9","19a8adcf.8ba972","d68b1f8a.c36f8","ce657ede.d0e7d","dc1a7960.cce6c8","63912568.dc6aac","a1685cb6.6af2e","13ade228.a692e6","bbe284c2.19a1b","dc5bef63.7bbf58","606dd497.672abc","fa9f3efa.3d4728","6e166208.bcc654","a6edf90b.02862","514505ea.10acfc","3f52ef.03031512","75cfcd56.417424","cfc556e3.250c1","bf867b12.1be738","c5587f72.e69778","993e8c87.965df8","f20188a.3ff6c78","3b0dea46.13d54e","7b3e5db3.2dc124","3aff63fe.fa9cd4","4765e816.cfcec","7e0e98ac.d87bf","bb37fcda.2b247","8328b041.fafc2","14eb9411.7f3a24","4cd290dc.dfcc9","d44a8be9.4bdcc","978b88f8.1b362"]]},{"id":"56bd0e83.72fec","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs defined in MD-SAL\" />\n","comments":"","x":1037.999927520752,"y":707.6909036636353,"z":"42cbb89a.8c64f","wires":[]},{"id":"8c7195ad.71de6","type":"for","name":"for each vnf","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":1033.3332977294922,"y":749.0242853164673,"z":"42cbb89a.8c64f","wires":[["f8dadf0d.b36748"]]},{"id":"f8dadf0d.b36748","type":"switchNode","name":"switch service data vnf == input vnf","xml":"<switch test='`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`'>\n","comments":"","outputs":1,"x":1284.6665153503418,"y":748.690972328186,"z":"42cbb89a.8c64f","wires":[["84f14cdf.d12da"]]},{"id":"84f14cdf.d12da","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1514.6666069030762,"y":748.0243263244629,"z":"42cbb89a.8c64f","wires":[["b5e9b140.524d"]]},{"id":"5b156e7.3ede59","type":"set","name":"set vnf-index to -1","xml":"<set>\n<parameter name='vnf-index' value='-1' />\n","comments":"","x":579.6666641235352,"y":662.6909074783325,"z":"42cbb89a.8c64f","wires":[]},{"id":"f8350d6.6984bf","type":"set","name":"set vnf-index to idx","xml":"<set>\n<parameter name='vnf-index' value='`$idx`' />\n","comments":"","x":1836.3332443237305,"y":719.024284362793,"z":"42cbb89a.8c64f","wires":[]},{"id":"78f55d30.9b559c","type":"switchNode","name":"switch vnf-index","xml":"<switch test='`$vnf-index`'>\n","comments":"","outputs":1,"x":569.6666717529297,"y":799.3576040267944,"z":"42cbb89a.8c64f","wires":[["fd955bd1.7d5d98"]]},{"id":"fd955bd1.7d5d98","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":748.000057220459,"y":798.6909799575806,"z":"42cbb89a.8c64f","wires":[["dd7488b1.39828"]]},{"id":"dd7488b1.39828","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find VNF ID ' + $vf-module-topology-operation-input.vnf-information.vnf-id + ' in MD-SAL'`\" />\n","comments":"","x":907.9999656677246,"y":798.0242834091187,"z":"42cbb89a.8c64f","wires":[]},{"id":"e85f12eb.c3b7d8","type":"switchNode","name":"switch vnf order status","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status`'>\n","comments":"","outputs":1,"x":592.6666946411133,"y":870.6910009384155,"z":"42cbb89a.8c64f","wires":[["627847e5.85df","7eed7e27.fd9a"]]},{"id":"627847e5.85df","type":"outcome","name":"Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":792.9999961853027,"y":844.3575849533081,"z":"42cbb89a.8c64f","wires":[["f151c486.4a1088"]]},{"id":"f151c486.4a1088","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":933.0000076293945,"y":844.357626914978,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"7eed7e27.fd9a","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":789.666633605957,"y":886.0242624282837,"z":"42cbb89a.8c64f","wires":[["4fcdf97f.3cb7b"]]},{"id":"4fcdf97f.3cb7b","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF order status is ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status + ' but should be Created'`\" />\n","comments":"","x":949.666633605957,"y":885.6909494400024,"z":"42cbb89a.8c64f","wires":[]},{"id":"bd4f4b52.b86c9","type":"switchNode","name":"switch vf-module_length","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n","comments":"","outputs":1,"x":596.333381652832,"y":962.6909217834473,"z":"42cbb89a.8c64f","wires":[["30be5b0c.6ffa0c","9c2f0421.be6e48"]]},{"id":"30be5b0c.6ffa0c","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":853.7143363952637,"y":929.8336954116821,"z":"42cbb89a.8c64f","wires":[["4684f1cb.f822d8"]]},{"id":"4684f1cb.f822d8","type":"set","name":"set vf-module-index=0","xml":"<set>\n<parameter name='vf-module-index' value='0' />\n","comments":"","x":1041.3333740234375,"y":930.500470161438,"z":"42cbb89a.8c64f","wires":[]},{"id":"9c2f0421.be6e48","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":854.142879486084,"y":994.119553565979,"z":"42cbb89a.8c64f","wires":[["71865ce8.e6eb4c"]]},{"id":"afae93fd.db33b","type":"set","name":"set vf-module-index = vf-module_length","xml":"<set>\n<parameter name='vf-module-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' />\n","comments":"","x":1239.3334197998047,"y":974.3099489212036,"z":"42cbb89a.8c64f","wires":[]},{"id":"24832982.cd0fe6","type":"for","name":"for each existing VF module","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' >\n","comments":"","outputs":1,"x":1198.4285125732422,"y":1018.4051790237427,"z":"42cbb89a.8c64f","wires":[["8d346fb9.665898"]]},{"id":"71865ce8.e6eb4c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":990.8571586608887,"y":994.1194791793823,"z":"42cbb89a.8c64f","wires":[["afae93fd.db33b","24832982.cd0fe6"]]},{"id":"8d346fb9.665898","type":"switchNode","name":"switch vf-module-information.vf-module-id == service-data.vnfs.vnf[].vf-modules.vf-module[].vf-module-id","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.vf-module-id == $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id`'>\n","comments":"","outputs":1,"x":1702.0476150512695,"y":1017.9765901565552,"z":"42cbb89a.8c64f","wires":[["8ff6f911.252038"]]},{"id":"8ff6f911.252038","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2144.666664123535,"y":1017.548041343689,"z":"42cbb89a.8c64f","wires":[["c71f4ab4.b4a088"]]},{"id":"c71f4ab4.b4a088","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VF module id ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id\n       + ' already exists, and status is ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-data.vf-module-level-oper-status.order-status`\" />\n","comments":"","x":2296.571544647217,"y":1017.5480279922485,"z":"42cbb89a.8c64f","wires":[]},{"id":"bee5bef3.86a98","type":"comment","name":"make sure this VF module doesn't exist already","info":"","comments":"","x":1728.4999618530273,"y":972.604082107544,"z":"42cbb89a.8c64f","wires":[]},{"id":"19a8adcf.8ba972","type":"set","name":"set new vf-module_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-module-index + 1`' />\n","comments":"","x":601.3333206176758,"y":1057.6908559799194,"z":"42cbb89a.8c64f","wires":[]},{"id":"d68b1f8a.c36f8","type":"set","name":"set vf-module-topology data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-topology-identifier.vf-module-id' value='`$vf-module-topology-operation-input.vf-module-information.vf-module-id`' />\n<parameter name='tmp.vf-module-topology.vf-module-topology-identifier.vf-module-name' value='`$vf-module-topology-operation-input.vf-module-request-input.vf-module-name`' />\n<parameter name='tmp.vf-module-topology.vf-module-topology-identifier.vf-module-type' value='`$vf-module-topology-operation-input.vf-module-information.vf-module-type`' />\n<parameter name='tmp.vf-module-topology.tenant' value='`$vf-module-topology-operation-input.vf-module-request-input.tenant`' />\n<parameter name='tmp.vf-module-topology.aic-cloud-region' value='`$vf-module-topology-operation-input.vf-module-request-input.aic-cloud-region`' />\n","comments":"","x":607.8333396911621,"y":1170.1909627914429,"z":"42cbb89a.8c64f","wires":[]},{"id":"e4522356.5a7e2","type":"set","name":"set aic-clli","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.aic-clli'\n   value='`$aai-uid-split[$aai-uid-split_length - 1]`' />\n","comments":"","x":1368.7855987548828,"y":1329.4288892745972,"z":"42cbb89a.8c64f","wires":[]},{"id":"ce657ede.d0e7d","type":"switchNode","name":"switch aic-clli","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.aic-clli`'>\n","comments":"","outputs":1,"x":567.8332595825195,"y":1443.3812294006348,"z":"42cbb89a.8c64f","wires":[["a44684c3.293ee8"]]},{"id":"a44684c3.293ee8","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":713.1189498901367,"y":1443.3812980651855,"z":"42cbb89a.8c64f","wires":[["a1923c55.11e4c8"]]},{"id":"a1923c55.11e4c8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find aic-clli in AAI for aic-cloud-region ' + $vf-module-topology-operation-input.vf-module-request-input.aic-cloud-region`\" />\n","comments":"","x":860.2618103027344,"y":1442.9527320861816,"z":"42cbb89a.8c64f","wires":[]},{"id":"dc1a7960.cce6c8","type":"get-resource","name":"get-resource cloud region","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"cloud-region\" \n\t\tkey=\"cloud-region.cloud-owner = 'CloudOwner' AND \n\t\t     cloud-region.cloud-region-id = $vf-module-topology-operation-input.vf-module-request-input.aic-cloud-region\"\n        pfx='aai.cloud-region' local-only='false' >\n\n","comments":"","outputs":1,"x":606.6904754638672,"y":1243.5245008468628,"z":"42cbb89a.8c64f","wires":[["6c625f2a.03864","97f875f7.37eb4"]]},{"id":"97f875f7.37eb4","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":820.9366683959961,"y":1261.6753568649292,"z":"42cbb89a.8c64f","wires":[["ecec7a39.3d0b9"]]},{"id":"ecec7a39.3d0b9","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving cloud region from AAI\" />\n","comments":"","x":995.9366416931152,"y":1261.6753931045532,"z":"42cbb89a.8c64f","wires":[]},{"id":"6c625f2a.03864","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":829.8652648925781,"y":1219.9610900878906,"z":"42cbb89a.8c64f","wires":[["3c76069e.89c31a"]]},{"id":"3c76069e.89c31a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Cloud region not found in AAI\" />\n","comments":"","x":996.214542388916,"y":1219.2666673660278,"z":"42cbb89a.8c64f","wires":[]},{"id":"63912568.dc6aac","type":"set","name":"set vf-module-parameters","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-parameters.'\n  value='vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.' />\n","comments":"","x":603.595287322998,"y":1892.810320854187,"z":"42cbb89a.8c64f","wires":[]},{"id":"a1685cb6.6af2e","type":"set","name":"set order-status to PendingCreate","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.order-status'\n  value='PendingCreate' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'\n  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.last-action'\n  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />\n","comments":"","x":619.2262573242188,"y":5094.417000770569,"z":"42cbb89a.8c64f","wires":[]},{"id":"13ade228.a692e6","type":"get-resource","name":"get-resource VF_MODULE_TO_VFC_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODULE_TO_VFC_MAPPING WHERE vf_module_customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-module-to-vfc-mapping[]'>\n\n","comments":"","outputs":1,"x":676.9286880493164,"y":1946.6671075820923,"z":"42cbb89a.8c64f","wires":[["fae8f604.21bc6","da093ea1.9e3bd"]]},{"id":"fae8f604.21bc6","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":942.7143783569336,"y":1927.0479383468628,"z":"42cbb89a.8c64f","wires":[["e21cede9.2e7c6"]]},{"id":"da093ea1.9e3bd","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":951.2858085632324,"y":1971.3336515426636,"z":"42cbb89a.8c64f","wires":[["d38e8911.141148"]]},{"id":"e21cede9.2e7c6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODULE_TO_VFC_MAPPING table\" />\n","comments":"","x":1117.7143096923828,"y":1926.1908388137817,"z":"42cbb89a.8c64f","wires":[]},{"id":"bbe284c2.19a1b","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$db.vf-module-to-vfc-mapping_length`' >\n","comments":"","outputs":1,"x":577.0476989746094,"y":2575.667359352112,"z":"42cbb89a.8c64f","wires":[["9dcee5b9.30ecb8"]]},{"id":"8cc05378.a5e4a","type":"get-resource","name":"get-resource VFC_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VFC_MODEL WHERE customization_uuid = $db.vf-module-to-vfc-mapping[$vm-type-index].vfc-customization-uuid'\n  pfx='db.vfc-model'>\n\n","comments":"","outputs":1,"x":1018.9524993896484,"y":2067.5720205307007,"z":"42cbb89a.8c64f","wires":[["26da1d88.b25212","d0f431cf.4dd9c8"]]},{"id":"6f26da35.19f5f4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in VFC_MODEL table for customization UUID ' + $db.vf-module-to-vfc-mapping[$db-vm-index].vfc_customization_uuid`\" />\n","comments":"","x":1389.3808479309082,"y":2092.000412940979,"z":"42cbb89a.8c64f","wires":[]},{"id":"26da1d88.b25212","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1214.7381172180176,"y":2047.9527711868286,"z":"42cbb89a.8c64f","wires":[["65dd23cf.74f37c"]]},{"id":"d0f431cf.4dd9c8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1223.3095474243164,"y":2092.2384843826294,"z":"42cbb89a.8c64f","wires":[["6f26da35.19f5f4"]]},{"id":"65dd23cf.74f37c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VFC_MODEL table\" />\n","comments":"","x":1389.7380485534668,"y":2047.0956716537476,"z":"42cbb89a.8c64f","wires":[]},{"id":"9dcee5b9.30ecb8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":768.9524917602539,"y":2574.2387285232544,"z":"42cbb89a.8c64f","wires":[["8cc05378.a5e4a","d7e120d8.399ab","265d99fe.8adbae","faf10db5.cade38","c3472b79.c794e8","b691f5a2.df4868","1b9a0f89.b41b2","6fdd1d65.dd9ee4"]]},{"id":"514505ea.10acfc","type":"set","name":"set vm_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm_length'\n  value='`$db.vf-module-to-vfc-mapping_length`' />\n","comments":"","x":568.833366394043,"y":2006.8577852249146,"z":"42cbb89a.8c64f","wires":[]},{"id":"d7e120d8.399ab","type":"set","name":"set vm data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-type'\n   value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-type`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].nfc-naming-code'\n   value='`$db.vfc-model.nfc-naming-code`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-type-tag'\n   value='`$db.vfc-model.vm-type-tag`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-count'\n   value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' />\n","comments":"","x":969.6667518615723,"y":2193.52449798584,"z":"42cbb89a.8c64f","wires":[]},{"id":"b5e9b140.524d","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1663.0000686645508,"y":746.9440250396729,"z":"42cbb89a.8c64f","wires":[["f8350d6.6984bf","4a2b4adf.81c83c"]]},{"id":"4a2b4adf.81c83c","type":"break","name":"break","xml":"<break>","comments":"","x":1798.0000343322754,"y":768.6106109619141,"z":"42cbb89a.8c64f","wires":[]},{"id":"7323ab19.f1fb84","type":"set","name":"set from DB","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-invariant-uuid'\n  value='`$db.vf-module-model.invariant-uuid`' />\n","comments":"","x":982.1665992736816,"y":1484.7772226333618,"z":"42cbb89a.8c64f","wires":[]},{"id":"dc5bef63.7bbf58","type":"switchNode","name":"switch input model-invariant-uuid","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`'>\n","comments":"","outputs":1,"x":626.0236740112305,"y":1507.6016664505005,"z":"42cbb89a.8c64f","wires":[["f771c9c6.034628","c8403571.75d8a"]]},{"id":"f771c9c6.034628","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":831.6903457641602,"y":1484.7446298599243,"z":"42cbb89a.8c64f","wires":[["7323ab19.f1fb84"]]},{"id":"c8403571.75d8a","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":833.1189422607422,"y":1529.0302209854126,"z":"42cbb89a.8c64f","wires":[["f25740a0.0c3fa"]]},{"id":"f25740a0.0c3fa","type":"set","name":"set from input","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-invariant-uuid'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`' />\n","comments":"","x":987.4046783447266,"y":1528.4587931632996,"z":"42cbb89a.8c64f","wires":[]},{"id":"a2c866ca.334548","type":"set","name":"set from DB","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-uuid'\n  value='`$db.vf-module-model.uuid`' />\n","comments":"","x":983.1188697814941,"y":1573.3158988952637,"z":"42cbb89a.8c64f","wires":[]},{"id":"606dd497.672abc","type":"switchNode","name":"switch input model-uuid","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-uuid`'>\n","comments":"","outputs":1,"x":598.642692565918,"y":1596.1404037475586,"z":"42cbb89a.8c64f","wires":[["19203891.bc30cf","7d8dc9ab.34846"]]},{"id":"19203891.bc30cf","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":832.6426658630371,"y":1573.28333568573,"z":"42cbb89a.8c64f","wires":[["a2c866ca.334548"]]},{"id":"7d8dc9ab.34846","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":834.0712623596191,"y":1617.5689268112183,"z":"42cbb89a.8c64f","wires":[["1c4736a4.9d5379"]]},{"id":"1c4736a4.9d5379","type":"set","name":"set from input","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-uuid'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-uuid`' />\n","comments":"","x":988.3569984436035,"y":1616.9974989891052,"z":"42cbb89a.8c64f","wires":[]},{"id":"838f9e47.a657b8","type":"set","name":"set from DB","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-version'\n  value='`$db.vf-module-model.version`' />\n","comments":"","x":980.2618026733398,"y":1662.1731061935425,"z":"42cbb89a.8c64f","wires":[]},{"id":"fa9f3efa.3d4728","type":"switchNode","name":"switch input model-version","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`'>\n","comments":"","outputs":1,"x":606.7855644226074,"y":1684.9975509643555,"z":"42cbb89a.8c64f","wires":[["5233d71a.ced7f","da1652ca.e4ec5"]]},{"id":"5233d71a.ced7f","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":829.7855491638184,"y":1662.140513420105,"z":"42cbb89a.8c64f","wires":[["838f9e47.a657b8"]]},{"id":"da1652ca.e4ec5","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":831.2141456604004,"y":1706.4261045455933,"z":"42cbb89a.8c64f","wires":[["993309bc.316d8"]]},{"id":"993309bc.316d8","type":"set","name":"set from input","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-version'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`' />\n","comments":"","x":985.4998817443848,"y":1705.8546767234802,"z":"42cbb89a.8c64f","wires":[]},{"id":"26ba33d6.4f7d64","type":"set","name":"set from DB","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-name'\n  value='`$db.vf-module-model.name`' />\n","comments":"","x":980.2618026733398,"y":1749.3159284591675,"z":"42cbb89a.8c64f","wires":[]},{"id":"6e166208.bcc654","type":"switchNode","name":"switch input model-name","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-name`'>\n","comments":"","outputs":1,"x":601.7855644226074,"y":1772.1403732299805,"z":"42cbb89a.8c64f","wires":[["3a68c66b.a88062","d0a0d796.04cde8"]]},{"id":"3a68c66b.a88062","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":829.7855491638184,"y":1749.28333568573,"z":"42cbb89a.8c64f","wires":[["26ba33d6.4f7d64"]]},{"id":"d0a0d796.04cde8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":831.2141456604004,"y":1793.5689268112183,"z":"42cbb89a.8c64f","wires":[["c0cc4286.ab4b48"]]},{"id":"c0cc4286.ab4b48","type":"set","name":"set from input","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-name'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-name`' />\n","comments":"","x":985.4998817443848,"y":1792.9974989891052,"z":"42cbb89a.8c64f","wires":[]},{"id":"a6edf90b.02862","type":"set","name":"set model-customization-uuid","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-customization-uuid'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`' />\n","comments":"","x":616.2378997802734,"y":1844.649362564087,"z":"42cbb89a.8c64f","wires":[]},{"id":"265d99fe.8adbae","type":"for","name":"for each vm","xml":"<for index='vm-index' start='0' end='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' >\n","comments":"","outputs":1,"x":971.3332405090332,"y":2302.777416229248,"z":"42cbb89a.8c64f","wires":[["46caa348.dae174"]]},{"id":"faf10db5.cade38","type":"set","name":"set vm-name-length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name_length'\n  value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' />\n","comments":"","x":994.6666946411133,"y":2237.7776737213135,"z":"42cbb89a.8c64f","wires":[]},{"id":"d2eec622.8295e","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":1437.761863708496,"y":2325.396562576294,"z":"42cbb89a.8c64f","wires":[["b331dbfa.3b84d","cf215d89.9ffde"]]},{"id":"b331dbfa.3b84d","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1733.4761517842617,"y":2298.253825187683,"z":"42cbb89a.8c64f","wires":[["aa4dcc25.6f274"]]},{"id":"cf215d89.9ffde","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1736.8095016479492,"y":2349.9204683303833,"z":"42cbb89a.8c64f","wires":[["ecbc795a.f3f258"]]},{"id":"7dcd8e5b.a33308","type":"set","name":"set variables for generating unique name NEW","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='VM_NAME_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vm_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='VM_INSTANCE' />\n<parameter name='generate-unique-name-input.prefix' value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name + $db.vfc-model.nfc-naming-code`\" />\n<parameter name='generate-unique-name-input.index-length' value='3' />\n\n<!--\n<parameter name='generate-unique-name-input.prefix' value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-name + $db.vfc-model.nfc-naming-code`\" />\n-->\n","comments":"","x":1394.4285774230957,"y":2273.7298889160156,"z":"42cbb89a.8c64f","wires":[]},{"id":"ecbc795a.f3f258","type":"set","name":"set generated name","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name[$vm-index]' value='`$generate-unique-name-output.generated-name`' />\n","comments":"","x":1921.3332176208496,"y":2349.3964862823486,"z":"42cbb89a.8c64f","wires":[]},{"id":"aa4dcc25.6f274","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":1901.3332646687832,"y":2297.682336807251,"z":"42cbb89a.8c64f","wires":[]},{"id":"3f52ef.03031512","type":"set","name":"set vf-module-id","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id'\n   value='`$vf-module-topology-operation-input.vf-module-information.vf-module-id`' />\n","comments":"","x":569.4285469055176,"y":1113.3725385665894,"z":"42cbb89a.8c64f","wires":[]},{"id":"46caa348.dae174","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1135.738182067871,"y":2302.4203205108643,"z":"42cbb89a.8c64f","wires":[["7dcd8e5b.a33308","d2eec622.8295e"]]},{"id":"c3472b79.c794e8","type":"get-resource","name":"get-resource VFC_TO_NETWORK_ROLE_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VFC_TO_NETWORK_ROLE_MAPPING WHERE vfc_customization_uuid = $db.vf-module-to-vfc-mapping[$vm-type-index].vfc-customization-uuid'\n  pfx='db.vfc-to-network-role-mapping[]'>\n\n","comments":"","outputs":1,"x":1098.595329284668,"y":2425.277389526367,"z":"42cbb89a.8c64f","wires":[["cf0687bd.e598e","4a704ca7.8ab134"]]},{"id":"cf0687bd.e598e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1385.8095321655273,"y":2405.658236503601,"z":"42cbb89a.8c64f","wires":[["5d120833.737138"]]},{"id":"4a704ca7.8ab134","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1394.3809623718262,"y":2449.943949699402,"z":"42cbb89a.8c64f","wires":[["6debb183.b41518"]]},{"id":"5d120833.737138","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VFC_TO_NETWORK_ROLE_MAPPING table\" />\n","comments":"","x":1560.8094635009766,"y":2404.80113697052,"z":"42cbb89a.8c64f","wires":[]},{"id":"b691f5a2.df4868","type":"for","name":"for each network-role","xml":"<for index='network-role-index' start='0' end='`$db.vfc-to-network-role-mapping_length`' >\n","comments":"","outputs":1,"x":991.6906204223633,"y":2736.468231201172,"z":"42cbb89a.8c64f","wires":[["36d0034e.833ba4"]]},{"id":"36d0034e.833ba4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1198.1190719604492,"y":2733.134736061096,"z":"42cbb89a.8c64f","wires":[["13d5efa4.e01b18","6684e114.507f68","185f4372.c123c5","91a5c44c.608108","b2d4a39c.3d0218","1875199d.3e005e","fc08b3d2.5d259","e36efe57.44154"]]},{"id":"13d5efa4.e01b18","type":"for","name":"for each network","xml":"<for silentFailure='true' index='idx' start='0' end='`$service-data.networks.network_length`' >\n","comments":"","outputs":1,"x":1407.166633605957,"y":2565.2774925231934,"z":"42cbb89a.8c64f","wires":[["a15c432c.8bcf7"]]},{"id":"6684e114.507f68","type":"set","name":"set network-index to -1","xml":"<set>\n<parameter name='network-index' value='-1' />\n","comments":"","x":1427.1667022705078,"y":2522.4204893112183,"z":"42cbb89a.8c64f","wires":[]},{"id":"a15c432c.8bcf7","type":"switchNode","name":"switch network-role matches","xml":"<switch test='`$service-data.networks.network[$idx].network-data.network-topology.network-topology-identifier-structure.network-role == $db.vfc-to-network-role-mapping[$network-role-index].network-role`'>\n","comments":"","outputs":1,"x":1635.737907409668,"y":2563.8486824035645,"z":"42cbb89a.8c64f","wires":[["ac115be5.329f08"]]},{"id":"ac115be5.329f08","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1834.3095741271973,"y":2563.848886489868,"z":"42cbb89a.8c64f","wires":[["9146a0a9.0e19b"]]},{"id":"9146a0a9.0e19b","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1975.7381420135498,"y":2562.4203147888184,"z":"42cbb89a.8c64f","wires":[["fb415bb3.75456","d6f312f.548dff"]]},{"id":"fb415bb3.75456","type":"set","name":"set network-index to idx","xml":"<set>\n<parameter name='network-index' value='`$idx`' />\n","comments":"","x":2154.30965423584,"y":2539.563310623169,"z":"42cbb89a.8c64f","wires":[]},{"id":"d6f312f.548dff","type":"break","name":"break","xml":"<break>","comments":"","x":2102.8808937072754,"y":2585.2774906158447,"z":"42cbb89a.8c64f","wires":[]},{"id":"185f4372.c123c5","type":"switchNode","name":"switch network-index","xml":"<switch test='`$network-index`'>\n","comments":"","outputs":1,"x":1419.0714721679688,"y":2614.0871295928955,"z":"42cbb89a.8c64f","wires":[["39711ad5.6dbf8e"]]},{"id":"39711ad5.6dbf8e","type":"outcomeTrue","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":1613.3571968078613,"y":2614.0870265960693,"z":"42cbb89a.8c64f","wires":[["d971a29a.9569"]]},{"id":"d971a29a.9569","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No network found in MD-SAL with network-role ' + $db.vfc-to-network-role-mapping[$network-role-index].network-role`\" />\n","comments":"","x":1770.5000457763672,"y":2612.6584968566895,"z":"42cbb89a.8c64f","wires":[]},{"id":"75cfcd56.417424","type":"for","name":"for each cloud-region relationship","xml":"<for index='idx' start='0' end='`$aai.cloud-region.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":628.9442901611328,"y":1332.0311841964722,"z":"42cbb89a.8c64f","wires":[["6d704691.40d188"]]},{"id":"6d704691.40d188","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship[$idx].related-to`'>\n","comments":"","outputs":1,"x":876.6228332519531,"y":1331.7811136245728,"z":"42cbb89a.8c64f","wires":[["832009c2.286ea"]]},{"id":"832009c2.286ea","type":"outcome","name":"complex","xml":"<outcome value='complex'>\n","comments":"","outputs":1,"x":1046.0871543884277,"y":1331.1739358901978,"z":"42cbb89a.8c64f","wires":[["aa276ae6.6a9938"]]},{"id":"ce4135e5.834cf8","type":"execute","name":"split related-link","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split'>\n   <parameter name='ctx_memory_result_key' value='aai-uid-split' />\n   <parameter name='original_string' value='`$aai.cloud-region.relationship-list.relationship[$idx].related-link`' />\n   <parameter name='regex' value='/' />\n","comments":"","outputs":1,"x":1386.1823120117188,"y":1285.6025114059448,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"aa276ae6.6a9938","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1205.8490142822266,"y":1332.269299507141,"z":"42cbb89a.8c64f","wires":[["ce4135e5.834cf8","cc8ebfcf.73556","e4522356.5a7e2"]]},{"id":"cc8ebfcf.73556","type":"break","name":"break","xml":"<break>","comments":"","x":1355.848976135254,"y":1375.602596282959,"z":"42cbb89a.8c64f","wires":[]},{"id":"91a5c44c.608108","type":"set","name":"set network-role and tag","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-role'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].network-role`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-role-tag'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].network-role-tag`' />\n","comments":"","x":1428.8333549499512,"y":2710.277316093445,"z":"42cbb89a.8c64f","wires":[]},{"id":"1b9a0f89.b41b2","type":"set","name":"set vm-network-length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network_length'\n  value='`$db.vfc-to-network-role-mapping_length`' />\n","comments":"","x":985.4999465942383,"y":3125.277581214905,"z":"42cbb89a.8c64f","wires":[]},{"id":"b2d4a39c.3d0218","type":"switchNode","name":"switch ipv4-ip-version","xml":"<switch test='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-ip-version`'>\n","comments":"","outputs":1,"x":1421.452407836914,"y":2793.610643386841,"z":"42cbb89a.8c64f","wires":[["f334dedf.542f88","bfe3b92b.eed028"]]},{"id":"dba4692f.8d24f","type":"set","name":"set network-information-index to -1","xml":"<set>\n<parameter name='network-information-index' value='-1' />\n\n","comments":"","x":1830.97603225708,"y":2758.6107482910156,"z":"42cbb89a.8c64f","wires":[]},{"id":"f334dedf.542f88","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1598.1189270019531,"y":2758.6107835769653,"z":"42cbb89a.8c64f","wires":[["dba4692f.8d24f"]]},{"id":"bfe3b92b.eed028","type":"other","name":"4","xml":"<outcome value='4'>\n","comments":"","outputs":1,"x":1596.8808784484863,"y":2824.5629262924194,"z":"42cbb89a.8c64f","wires":[["4e61e87f.09738"]]},{"id":"5c8aa855.64c57","type":"set","name":"set network-information-index to 0","xml":"<set>\n<parameter name='network-information-index' value='0' />\n","comments":"","x":2001.4521408081055,"y":2799.086787223816,"z":"42cbb89a.8c64f","wires":[]},{"id":"4e61e87f.09738","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1764.0713539123535,"y":2823.8963918685913,"z":"42cbb89a.8c64f","wires":[["5c8aa855.64c57","2a3f7a55.150f16"]]},{"id":"2a3f7a55.150f16","type":"set","name":"set ip-version 4, use-dhcp, and ip-count","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].ip-version'\n   value='4' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].use-dhcp'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-use-dhcp`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].ip-count'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-count`' />\n","comments":"","x":2018.4047241210938,"y":2845.753743171692,"z":"42cbb89a.8c64f","wires":[]},{"id":"1875199d.3e005e","type":"switchNode","name":"switch ipv6-ip-version","xml":"<switch test='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-ip-version`'>\n","comments":"","outputs":1,"x":1421.9286041259766,"y":2920.515425682068,"z":"42cbb89a.8c64f","wires":[["14cad0ce.875937","c6e6105f.d3fb48"]]},{"id":"14cad0ce.875937","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1600.7380981445312,"y":2890.753237724304,"z":"42cbb89a.8c64f","wires":[["850ae6e3.97486"]]},{"id":"c6e6105f.d3fb48","type":"other","name":"6","xml":"<outcome value='6'>\n","comments":"","outputs":1,"x":1602.1666526794434,"y":2955.038794517517,"z":"42cbb89a.8c64f","wires":[["3a97eaa4.4dbd5e"]]},{"id":"d01561e6.8cd2a8","type":"set","name":"increment network-information-index","xml":"<set>\n<parameter name='network-information-index' value='`$network-information-index + 1`' />\n","comments":"","x":2007.880744934082,"y":2929.5628242492676,"z":"42cbb89a.8c64f","wires":[]},{"id":"3a97eaa4.4dbd5e","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1757.4048118591309,"y":2954.0865335464478,"z":"42cbb89a.8c64f","wires":[["d01561e6.8cd2a8","eec3daa5.99fad8"]]},{"id":"850ae6e3.97486","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1743.404727935791,"y":2890.0868558883667,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"fc08b3d2.5d259","type":"switchNode","name":"switch network-information-index","xml":"<switch test='`$network-information-index`'>\n","comments":"","outputs":1,"x":1457.166618347168,"y":3056.9436712265015,"z":"42cbb89a.8c64f","wires":[["e7281cfc.e21008","d353f555.e50738"]]},{"id":"e7281cfc.e21008","type":"outcome","name":"-1","xml":"<outcome value='-1'>","comments":"","outputs":1,"x":1675.4999752044678,"y":3033.610417366028,"z":"42cbb89a.8c64f","wires":[["693a68fa.318578"]]},{"id":"d353f555.e50738","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1675.2619380950928,"y":3079.562731742859,"z":"42cbb89a.8c64f","wires":[["bdc04062.cb736"]]},{"id":"693a68fa.318578","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1812.166690826416,"y":3031.9440774917603,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"bdc04062.cb736","type":"set","name":"set network-information-item_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item_length'\n   value='`$network-information-index + 1`' />\n","comments":"","x":1903.8333053588867,"y":3076.9438695907593,"z":"42cbb89a.8c64f","wires":[]},{"id":"cfc556e3.250c1","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":584,"y":3223.943766593933,"z":"42cbb89a.8c64f","wires":[["3c13f67.7a17c0a"]]},{"id":"3c13f67.7a17c0a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":787.5715255737305,"y":3224.181971549988,"z":"42cbb89a.8c64f","wires":[["13ff9beb.57fecc"]]},{"id":"e36efe57.44154","type":"set","name":"save network-id","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id'\n  value='`$service-data.networks.network[$idx].network-data.network-topology.network-topology-identifier-structure.network-id`' />\n","comments":"This isn't a node in MD-SAL, but we need to save this for later when we are doing EIPAM processing","x":1400.9761810302734,"y":2660.2773237228394,"z":"42cbb89a.8c64f","wires":[]},{"id":"13ff9beb.57fecc","type":"for","name":"for each network-role","xml":"<for index='network-role-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network_length`' >\n","comments":"","outputs":1,"x":988.999885559082,"y":3223.2770223617554,"z":"42cbb89a.8c64f","wires":[["7e085b6a.57a1e4"]]},{"id":"7e085b6a.57a1e4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1190.9047012329102,"y":3222.5150594711304,"z":"42cbb89a.8c64f","wires":[["6e764b1a.339424"]]},{"id":"6e764b1a.339424","type":"for","name":"for each network-information-item","xml":"<for index='ip-version-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item_length`' >\n","comments":"","outputs":1,"x":1435.6665725708008,"y":3222.039451599121,"z":"42cbb89a.8c64f","wires":[["c862c7eb.4210b"]]},{"id":"952a7c8b.3108b","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":680.666633605957,"y":3427.943877220154,"z":"42cbb89a.8c64f","wires":[["d51d4403.6e23e","53daab82.db7afc","a091bfcc.a138b","f5c55689.e07468","5377172.64f6b68"]]},{"id":"d51d4403.6e23e","type":"get-resource","name":"get-resource EIPAM_IP_SUBNETS","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from EIPAM_IP_SUBNETS WHERE network_id = $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id\n    AND address_family = $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-version'\n  pfx='db.eipam-ip-subnets[]'>\n\n","comments":"","outputs":1,"x":1060.6666564941406,"y":3389.6103734970093,"z":"42cbb89a.8c64f","wires":[["cfbb3239.b8a848","97b51176.70bd1"]]},{"id":"a77bfa66.d4c0d","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in EIPAM_IP_SUBNETS table for network ID '\n        + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id\n        + ' and address family ' + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-version`\" />\n","comments":"","x":1450.6665954589844,"y":3411.2771348953247,"z":"42cbb89a.8c64f","wires":[]},{"id":"cfbb3239.b8a848","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1276.0238647460938,"y":3367.2294931411743,"z":"42cbb89a.8c64f","wires":[["a90f1733.6a3458"]]},{"id":"97b51176.70bd1","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1284.5952949523926,"y":3411.515206336975,"z":"42cbb89a.8c64f","wires":[["a77bfa66.d4c0d"]]},{"id":"a90f1733.6a3458","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading EIPAM_IP_SUBNETS table\" />\n","comments":"","x":1451.023796081543,"y":3366.3723936080933,"z":"42cbb89a.8c64f","wires":[]},{"id":"53daab82.db7afc","type":"for","name":"for each record in EIPAM_IP_SUBNETS","xml":"<for index='subnets-index' start='0' end='`$db.eipam-ip-subnets_length`' >\n","comments":"","outputs":1,"x":1079.9524688720703,"y":3694.8485612869263,"z":"42cbb89a.8c64f","wires":[["560fda47.3a4684"]]},{"id":"560fda47.3a4684","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1336.3810195922852,"y":3695.8008489608765,"z":"42cbb89a.8c64f","wires":[["c24dc02e.13602","de66f812.e4a","a3a38e6a.079dd8","c4da5ccb.f7a33","c10c36fb.5411d8"]]},{"id":"c24dc02e.13602","type":"get-resource","name":"get-resource EIPAM_IP_SUBNET_KEYS","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from EIPAM_IP_SUBNET_KEYS WHERE entity_id = $db.eipam-ip-subnets[$subnets-index].entity-id'\n  pfx='db.eipam-ip-subnet-keys[]'>\n\n","comments":"","outputs":1,"x":1647.809585571289,"y":3532.2294569015503,"z":"42cbb89a.8c64f","wires":[["5d37056c.fc355c","7b62aa65.c2e794"]]},{"id":"c7bc51ba.e369f","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in EIPAM_IP_SUBNET_KEYS table for entity ID '\n        + $db.eipam-ip-subnets[$subnets-index].entity-id`\" />","comments":"","x":2062.809585571289,"y":3552.2294569015503,"z":"42cbb89a.8c64f","wires":[]},{"id":"5d37056c.fc355c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1888.1668548583984,"y":3508.1818151474,"z":"42cbb89a.8c64f","wires":[["725f1d1f.458d3c"]]},{"id":"7b62aa65.c2e794","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1896.7382850646973,"y":3552.4675283432007,"z":"42cbb89a.8c64f","wires":[["c7bc51ba.e369f"]]},{"id":"725f1d1f.458d3c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading EIPAM_IP_SUBNET_KEYS table\" />\n","comments":"","x":2063.1667861938477,"y":3507.324715614319,"z":"42cbb89a.8c64f","wires":[]},{"id":"a091bfcc.a138b","type":"set","name":"set max-level to -1","xml":"<set>\n<parameter name='max-level' value='-1' />\n","comments":"","x":1008.7619323730469,"y":3455.5629892349243,"z":"42cbb89a.8c64f","wires":[]},{"id":"de66f812.e4a","type":"for","name":"for each record in EIPAM_IP_SUBNET_KEYS","xml":"<for index='keys-index' start='0' end='`$db.eipam-ip-subnet-keys_length`' >\n","comments":"","outputs":1,"x":1662.3334045410156,"y":3601.27721118927,"z":"42cbb89a.8c64f","wires":[["5a06105e.465d3"]]},{"id":"5a06105e.465d3","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1949.0000534057617,"y":3599.6105489730835,"z":"42cbb89a.8c64f","wires":[["4455ac5e.d4cc4c"]]},{"id":"4455ac5e.d4cc4c","type":"switchNode","name":"switch level > max-level?","xml":"<switch test='`$db.eipam-ip-subnet-keys[$keys-index].level &gt; $max-level`'>\n","comments":"","outputs":1,"x":2165.6666717529297,"y":3599.6104669570923,"z":"42cbb89a.8c64f","wires":[["3b237dae.c892d2"]]},{"id":"3b237dae.c892d2","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2357.333599090576,"y":3599.6104612350464,"z":"42cbb89a.8c64f","wires":[["4415570e.226f78"]]},{"id":"4415570e.226f78","type":"set","name":"set max-level, selected-entity-id, selected-plan-name","xml":"<set>\n<parameter name='max-level' value='`$db.eipam-ip-subnet-keys[$keys-index].level`' />\n<parameter name='selected-entity-id' value='`$db.eipam-ip-subnet-keys[$keys-index].entity-id`' />\n<parameter name='selected-plan-name' value='`$db.eipam-ip-subnets[$subnets-index].plan-name`' />\n","comments":"","x":2649.0001068115234,"y":3597.943717956543,"z":"42cbb89a.8c64f","wires":[]},{"id":"a3a38e6a.079dd8","type":"get-resource","name":"get-resource EIPAM_IP_SUBNET_KEYS","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from EIPAM_IP_SUBNET_KEYS WHERE entity_id = $selected-entity-id order by level'\n  pfx='db.eipam-ip-subnet-keys[]'>\n\n","comments":"","outputs":1,"x":1649.000015258789,"y":3673.1819162368774,"z":"42cbb89a.8c64f","wires":[["eee51654.117c8","5c3a3f7f.5c2fc"]]},{"id":"e9fcdcdb.26176","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in EIPAM_IP_SUBNET_KEYS table for entity ID '\n        + $selected-entity-id`\" />","comments":"","x":2064.000015258789,"y":3693.1819162368774,"z":"42cbb89a.8c64f","wires":[]},{"id":"eee51654.117c8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1889.3572845458984,"y":3649.134274482727,"z":"42cbb89a.8c64f","wires":[["498c375.2ce3148"]]},{"id":"5c3a3f7f.5c2fc","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1897.9287147521973,"y":3693.419987678528,"z":"42cbb89a.8c64f","wires":[["e9fcdcdb.26176"]]},{"id":"498c375.2ce3148","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading EIPAM_IP_SUBNET_KEYS table\" />\n","comments":"","x":2064.3572158813477,"y":3648.277174949646,"z":"42cbb89a.8c64f","wires":[]},{"id":"665a903a.39a88","type":"for","name":"for each record in EIPAM_IP_SUBNET_KEYS","xml":"<for index='level-index' start='0' end='`$db.eipam-ip-subnet-keys_length`' >\n","comments":"","outputs":1,"x":2094.952362060547,"y":3741.753373146057,"z":"42cbb89a.8c64f","wires":[["a2d16cc2.be0708"]]},{"id":"980d5ef5.8056a","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1787.8093643188477,"y":3825.562809944153,"z":"42cbb89a.8c64f","wires":[["665a903a.39a88","41a4c10f.9fd3c8","e5baa84e.6704a","c3b40e73.c92d68","dd718ed9.581ee"]]},{"id":"c4da5ccb.f7a33","type":"for","name":"for each ip in ip-count","xml":"<for index='request-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-count`' >\n","comments":"","outputs":1,"x":1586.142807006836,"y":3825.5644369125366,"z":"42cbb89a.8c64f","wires":[["980d5ef5.8056a"]]},{"id":"a2d16cc2.be0708","type":"set","name":"set eipam data for level","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].pools[$level-index].key-name'\n   value='`$db.eipam-ip-subnet-keys[$level-index].key-name`' />\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].pools[$level-index].key-value'\n   value='`$db.eipam-ip-subnet-keys[$level-index].key-value`' />\n","comments":"","x":2401.8571243286133,"y":3741.5161390304565,"z":"42cbb89a.8c64f","wires":[]},{"id":"41a4c10f.9fd3c8","type":"set","name":"set eipam data pools_length","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].pools_length'\n   value='`$db.eipam-ip-subnet-keys_length`' />\n","comments":"","x":2041.142677307129,"y":3787.2297563552856,"z":"42cbb89a.8c64f","wires":[]},{"id":"bf867b12.1be738","type":"set","name":"set plans-index to 0","xml":"<set>\n<parameter name='plans-index' value='0' />\n","comments":"","x":592.7619171142578,"y":3167.8960371017456,"z":"42cbb89a.8c64f","wires":[]},{"id":"f5c55689.e07468","type":"set","name":"increment plans-index","xml":"<set>\n<parameter name='plans-index' value='`$plans-index + 1`' />\n","comments":"","x":1024.0952224731445,"y":4086.8962841033936,"z":"42cbb89a.8c64f","wires":[]},{"id":"c10c36fb.5411d8","type":"set","name":"set eipam requests_length","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].requests_length'\n   value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-count`' />\n","comments":"","x":1596.6191711425781,"y":3967.229808807373,"z":"42cbb89a.8c64f","wires":[]},{"id":"5377172.64f6b68","type":"set","name":"set eipam plan-name, address-family","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].plan-name' value='`$selected-plan-name`' />\n<parameter name='eipam-ip-block.plans[$plans-index].address-family'\n   value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-version`' />\n","comments":"","x":1072.6666564941406,"y":4039.7527656555176,"z":"42cbb89a.8c64f","wires":[]},{"id":"c5587f72.e69778","type":"set","name":"set eipam plans_length","xml":"<set>\n<parameter name='eipam-ip-block.plans_length' value='`$plans-index`' />\n","comments":"","x":596.4285697937012,"y":4111.944158554077,"z":"42cbb89a.8c64f","wires":[]},{"id":"993e8c87.965df8","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":547.7975158691406,"y":5273.035320281982,"z":"42cbb89a.8c64f","wires":[]},{"id":"f20188a.3ff6c78","type":"set","name":"copy input data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.sdnc-request-header.'\n   value='$vf-module-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.request-information.'\n   value='$vf-module-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.service-information.'\n   value='$vf-module-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vnf-information.'\n   value='$vf-module-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-information.'\n   value='$vf-module-topology-operation-input.vf-module-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-request-input.'\n   value='$vf-module-topology-operation-input.vf-module-request-input.' />\n\n","comments":"","x":567.5832290649414,"y":4963.01509475708,"z":"42cbb89a.8c64f","wires":[]},{"id":"3b0dea46.13d54e","type":"set","name":"copy vf-module-topology data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.' value='$tmp.vf-module-topology.' />\n","comments":"","x":612.4642333984375,"y":4914.8006067276,"z":"42cbb89a.8c64f","wires":[]},{"id":"77c153ff.a0fdb4","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bgb-vfmodule.log' />\n","comments":"","outputs":1,"x":542.678466796875,"y":5225.26513671875,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"285a17dd.85f258","type":"execute","name":"call EIPAM assignIPAddress","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"assignIPAddress\">","comments":"","outputs":1,"x":976.5952911376953,"y":4200.9052267074585,"z":"42cbb89a.8c64f","wires":[["b1f94fd5.364d08"]]},{"id":"b1f94fd5.364d08","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":1190.5952911376953,"y":4200.9052267074585,"z":"42cbb89a.8c64f","wires":[["82176bb2.df71d"]]},{"id":"82176bb2.df71d","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while obtaining new address blocks from EIPAM.\" />\n","comments":"","x":1329.5952911376953,"y":4200.9052267074585,"z":"42cbb89a.8c64f","wires":[]},{"id":"e5baa84e.6704a","type":"set","name":"set eipam client-key, mask","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].client-key'\n   value='`$generate-unique-name-output.generated-name`' />\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].info'\n   value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id`' />\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].mask'\n   value='32' />\n","comments":"","x":2038.2857284545898,"y":3921.0397844314575,"z":"42cbb89a.8c64f","wires":[]},{"id":"3aff63fe.fa9cd4","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":576,"y":4310.276859283447,"z":"42cbb89a.8c64f","wires":[["ad1f9498.166c78"]]},{"id":"ad1f9498.166c78","type":"for","name":"for each vm-network","xml":"<for index='network-role-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network_length`' >\n","comments":"","outputs":1,"x":784.6666831970215,"y":4310.2771854400635,"z":"42cbb89a.8c64f","wires":[["73045686.87b318"]]},{"id":"73045686.87b318","type":"for","name":"for each network-information-item","xml":"<for index='ip-version-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item_length`' >\n","comments":"","outputs":1,"x":1049.6666717529297,"y":4311.94352722168,"z":"42cbb89a.8c64f","wires":[["cc6a69ef.11f9a"]]},{"id":"7b3e5db3.2dc124","type":"set","name":"set plans-index = 0","xml":"<set>\n<parameter name='plans-index' value='0' />\n","comments":"","x":582.9999923706055,"y":4255.276947021484,"z":"42cbb89a.8c64f","wires":[]},{"id":"c72201c5.58c788","type":"for","name":"for each eipam request","xml":"<for index='ip-index' start='0' end='`$eipam-ip-block.plans[$plans-index].requests_length`' >\n","comments":"","outputs":1,"x":1819.6666259765625,"y":4283.6108322143555,"z":"42cbb89a.8c64f","wires":[["e9abc0c8.773628"]]},{"id":"e9abc0c8.773628","type":"set","name":"set ip address","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].network-ips.network-ip[$ip-index]'\n  value='`$eipam-ip-block.plans[$plans-index].requests[$ip-index].ip-prefix`' />\n","comments":"","x":2031.3332633972168,"y":4281.944003105164,"z":"42cbb89a.8c64f","wires":[]},{"id":"7f6bf992.219d08","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1619.6664581298828,"y":4308.610345840454,"z":"42cbb89a.8c64f","wires":[["c72201c5.58c788","34f6a11b.b8862e"]]},{"id":"34f6a11b.b8862e","type":"set","name":"increment plans-index","xml":"<set>\n<parameter name='plans-index' value='`$plans-index + 1`' />\n","comments":"","x":1814.66650390625,"y":4330.27668762207,"z":"42cbb89a.8c64f","wires":[]},{"id":"7e0e98ac.d87bf","type":"save","name":"update vf-module","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"vf-module\"\n   key=\"vf-module.vf-module-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id\n      AND generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"vf-module-name\" value=\"`$tmp.vf-module-topology.vf-module-topology-identifier.vf-module-name`\" />\n<parameter name=\"model-invariant-id\" value=\"`$tmp.vf-module-topology.onap-model-information.model-invariant-uuid`\" />\n<parameter name=\"model-version-id\" value=\"`$tmp.vf-module-topology.onap-model-information.model-uuid`\" />\n<parameter name=\"model-customization-id\" value=\"`$tmp.vf-module-topology.onap-model-information.model-customization-uuid`\" />\n<parameter name=\"selflink\" value=\"`$vf-module-object-path`\" />\n","comments":"","outputs":1,"x":577.9999694824219,"y":4455.27702999115,"z":"42cbb89a.8c64f","wires":[["6df7b312.843a2c","49ca605b.c0502"]]},{"id":"b5ccad1f.ec4688","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No vf-module found in AAI for vf module ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id`\" />\n","comments":"","x":1071.333396911621,"y":4508.610199928284,"z":"42cbb89a.8c64f","wires":[]},{"id":"6df7b312.843a2c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":747.3573303222656,"y":4422.229174613953,"z":"42cbb89a.8c64f","wires":[["f5336f18.2c59b"]]},{"id":"49ca605b.c0502","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":755.9286842346191,"y":4484.8481550216675,"z":"42cbb89a.8c64f","wires":[["e6f82602.adde08"]]},{"id":"421ab118.9b761","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating vf-module in AAI\" />\n","comments":"","x":1082.3572845458984,"y":4440.372731208801,"z":"42cbb89a.8c64f","wires":[]},{"id":"4765e816.cfcec","type":"set","name":"set  vf-module-object-path","xml":"<set>\n<parameter name='vf-module-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $service-data.service-topology.service-topology-identifier.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id\n + '/vf-module-data/vf-module-topology/'`\"/>\n\n\n","comments":"","x":593.6666259765625,"y":4378.27685546875,"z":"42cbb89a.8c64f","wires":[]},{"id":"9b005e27.ead9e","type":"save","name":"save vf-module relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"vf-module:relationship-list\"\n   key=\"vf-module.vf-module-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id\n      AND generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id`\" />\n","comments":"","outputs":1,"x":1037.3094787597656,"y":4584.000018119812,"z":"42cbb89a.8c64f","wires":[["40b049d4.b5d508","90c1d6d6.aba8e"]]},{"id":"40b049d4.b5d508","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1262.1428108215332,"y":4544.871940612793,"z":"42cbb89a.8c64f","wires":[["69557a8b.b931b4"]]},{"id":"90c1d6d6.aba8e","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1270.7142639160156,"y":4622.491083145142,"z":"42cbb89a.8c64f","wires":[["826a647c.0d8d58"]]},{"id":"27342a59.1dd1fe","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating vf-module relationships in AAI\" />\n","comments":"","x":1597.1429443359375,"y":4564.681837081909,"z":"42cbb89a.8c64f","wires":[]},{"id":"bb37fcda.2b247","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":578.3095092773438,"y":4585.666521072388,"z":"42cbb89a.8c64f","wires":[["72590ab7.d86dcc"]]},{"id":"72590ab7.d86dcc","type":"for","name":"for each vm-network","xml":"<for index='network-role-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network_length`' >\n","comments":"","outputs":1,"x":788.9761867523193,"y":4584.000344276428,"z":"42cbb89a.8c64f","wires":[["9b005e27.ead9e"]]},{"id":"8bee56c5.166f68","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No vf-module found in AAI for vf module ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id`\" />\n","comments":"","x":1598.9762382507324,"y":4639.666376113892,"z":"42cbb89a.8c64f","wires":[]},{"id":"eec3daa5.99fad8","type":"set","name":"set ip-version 6, use-dhcp, and ip-count","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].ip-version'\n   value='6' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].use-dhcp'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-use-dhcp`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].ip-count'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-count`' />\n","comments":"","x":2017.7857208251953,"y":2974.2381496429443,"z":"42cbb89a.8c64f","wires":[]},{"id":"c862c7eb.4210b","type":"switchNode","name":"switch use-dhcp","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].use-dhcp`'>\n","comments":"","outputs":1,"x":1683.500114440918,"y":3221.3808994293213,"z":"42cbb89a.8c64f","wires":[["890ce3ec.63743"]]},{"id":"890ce3ec.63743","type":"outcome","name":"N","xml":"<outcome value='N'>\n","comments":"","outputs":1,"x":1853.5000267028809,"y":3219.9525022506714,"z":"42cbb89a.8c64f","wires":[["952a7c8b.3108b"]]},{"id":"cc6a69ef.11f9a","type":"switchNode","name":"switch use-dhcp","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].use-dhcp`'>\n","comments":"","outputs":1,"x":1290.642837524414,"y":4310.666822433472,"z":"42cbb89a.8c64f","wires":[["356204bc.cebf84"]]},{"id":"356204bc.cebf84","type":"outcome","name":"N","xml":"<outcome value='N'>\n","comments":"","outputs":1,"x":1460.642749786377,"y":4309.238425254822,"z":"42cbb89a.8c64f","wires":[["7f6bf992.219d08"]]},{"id":"8328b041.fafc2","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":577.309455871582,"y":4715.667015075684,"z":"42cbb89a.8c64f","wires":[["eb342e48.a6583"]]},{"id":"eb342e48.a6583","type":"for","name":"for each vm","xml":"<for index='vm-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-count`' >\n","comments":"","outputs":1,"x":772.3094863891602,"y":4715.000022888184,"z":"42cbb89a.8c64f","wires":[["7a82dc04.86f99c"]]},{"id":"858885b6.5193e8","type":"save","name":"save VIPR_CONFIGURATION","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource\" resource=\"SQL\"\nkey=\"INSERT INTO VIPR_CONFIGURATION (vnf_id, vnf_name, ecomp_service_instance_id, vm_name, cloud_region_id, cloud_owner) VALUES ( $service-data.vnfs.vnf[$vnf-index].vnf-id , $service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name , $service-data.service-information.service-instance-id , $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name[$vm-index] , $tmp.vf-module-topology.aic-cloud-region , 'CloudOwner')\" >","comments":"","outputs":1,"x":1163.976188659668,"y":4737.667673110962,"z":"42cbb89a.8c64f","wires":[["22e39666.b50efa"]]},{"id":"8650b418.d123","type":"comment","name":"Not a failure","info":"","comments":"","x":1683.976089477539,"y":4737.6676778793335,"z":"42cbb89a.8c64f","wires":[]},{"id":"22e39666.b50efa","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1373.976173400879,"y":4737.66782283783,"z":"42cbb89a.8c64f","wires":[["c5a9e28c.b12c1"]]},{"id":"c5a9e28c.b12c1","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.vf-module-topology-operation-assign:REQID\"/>\n<parameter name=\"field3\" value=\"`$vf-module-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to insert VIPR_CONFIGURATION record\"/>\n","comments":"","outputs":1,"x":1517.3096160888672,"y":4737.667660713196,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"dd718ed9.581ee","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":2127.3094940185547,"y":3875.666248321533,"z":"42cbb89a.8c64f","wires":[["50b7dc37.4a2dd4"]]},{"id":"50b7dc37.4a2dd4","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2414.6905364990234,"y":3873.523669242859,"z":"42cbb89a.8c64f","wires":[["8e15d184.1846f"]]},{"id":"c3b40e73.c92d68","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='EIPAM_CLIENT_KEY_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vnf_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='CLIENT_KEY' />\n<parameter name='generate-unique-name-input.prefix' value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].nfc-naming-code + ':' + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id + ':' + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-version + ':'`\" />\n<parameter name='generate-unique-name-input.index-length' value='' />\n","comments":"","x":2080.6428260803223,"y":3830.6664094924927,"z":"42cbb89a.8c64f","wires":[]},{"id":"8e15d184.1846f","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":2582.547649383545,"y":3872.9521808624268,"z":"42cbb89a.8c64f","wires":[]},{"id":"6fdd1d65.dd9ee4","type":"switchNode","name":"switch ecomp-generated-naming == 'Y'","xml":"<switch test=\"$db.vfc-model.ecomp-generated-naming == 'Y'\">\n","comments":"","outputs":1,"x":1057.3095626831055,"y":2137.333580970764,"z":"42cbb89a.8c64f","wires":[["1e0ee877.417498"]]},{"id":"1e0ee877.417498","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1288.976173400879,"y":2136.3332118988037,"z":"42cbb89a.8c64f","wires":[["438dfe04.53215"]]},{"id":"438dfe04.53215","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'ECOMP generated naming is not Y for VFC customization UUID ' + $db.vf-module-to-vfc-mapping[$db-vm-index].vfc_customization_uuid`\" />\n","comments":"","x":1435.6429138183594,"y":2135.666666984558,"z":"42cbb89a.8c64f","wires":[]},{"id":"eb61c884.195028","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1547.3097381591797,"y":4688.999374389648,"z":"42cbb89a.8c64f","wires":[["fe2bdfdc.c7d078"]]},{"id":"a4699dbe.2bdf2","type":"comment","name":"Not a failure","info":"","comments":"","x":1870.6427917480469,"y":4687.333196640015,"z":"42cbb89a.8c64f","wires":[]},{"id":"fe2bdfdc.c7d078","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.vf-module-topology-operation-assign:REQID\"/>\n<parameter name=\"field3\" value=\"`$vf-module-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to insert VIPR_CONFIGURATION record\"/>\n","comments":"","outputs":1,"x":1693.3096733093262,"y":4689.0000076293945,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"7a82dc04.86f99c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":940.642879486084,"y":4713.99986743927,"z":"42cbb89a.8c64f","wires":[["695784e2.6196ec","858885b6.5193e8"]]},{"id":"695784e2.6196ec","type":"delete","name":"delete any pre-existing records in VIPR_CONFIGURATION","xml":"<delete plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='DELETE from VIPR_CONFIGURATION WHERE vnf_id = $service-data.vnfs.vnf[$vnf-index].vnf-id\n     AND ecomp_service_instance_id = $service-data.service-information.service-instance-id\n     AND vm_name = $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name[$vm-index]' >","comments":"","outputs":1,"x":1253.976203918457,"y":4689.334007263184,"z":"42cbb89a.8c64f","wires":[["eb61c884.195028"]]},{"id":"f30ede2a.6a271","type":"update","name":"update EIPAM_IP_ASSIGNMENTS to PENDING_DELETE...","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource\" resource=\"SQL\"\nkey=\"UPDATE EIPAM_IP_ASSIGNMENTS set status = $tmp.status WHERE info = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-topology-identifier.vf-module-id\" >","comments":"","outputs":1,"x":2960.6429481506348,"y":4325.666910648346,"z":"42cbb89a.8c64f","wires":[["3e0756bb.f7be2a"]]},{"id":"380f2e3a.9189b2","type":"set","name":"set status variable","xml":"<set>\n<parameter name='tmp.status' value=\"`'PENDING_DELETE_' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-topology-identifier.vf-module-id`\" />\n","comments":"","x":2830.642910003662,"y":4279.000282764435,"z":"42cbb89a.8c64f","wires":[]},{"id":"3e0756bb.f7be2a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3265.6428565979004,"y":4324.000210285187,"z":"42cbb89a.8c64f","wires":[["6c6d4ba3.796714"]]},{"id":"6c6d4ba3.796714","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating EIPAM_IP_ASSIGNMENTS table on rollback\" />\n","comments":"","x":3455.6428833007812,"y":4323.8099455833435,"z":"42cbb89a.8c64f","wires":[]},{"id":"8aef50f1.e391e","type":"execute","name":"execute EIPAM unassign IP addresses","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"unassignIPAddress\">\n<parameter name=\"deleteEIPAM_status\" value=\"`$tmp.status`\" />\n","comments":"","outputs":1,"x":2895.6429176330566,"y":4370.6669545173645,"z":"42cbb89a.8c64f","wires":[["4c2b10fb.217ea"]]},{"id":"4c2b10fb.217ea","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3132.309543609619,"y":4370.6668972969055,"z":"42cbb89a.8c64f","wires":[["497b9970.c89e8"]]},{"id":"497b9970.c89e8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in EIPAM unassign IP address on rollback\" />\n","comments":"","x":3322.3095703125,"y":4370.476632595062,"z":"42cbb89a.8c64f","wires":[]},{"id":"78e6782f.e4964","type":"comment","name":"roll back EIPAM","info":"","comments":"","x":2805.6429481506348,"y":4225.667236169179,"z":"42cbb89a.8c64f","wires":[]},{"id":"785ac55a.5e876c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2637.3095741271973,"y":4329.000406742096,"z":"42cbb89a.8c64f","wires":[["380f2e3a.9189b2","f30ede2a.6a271","8aef50f1.e391e"]]},{"id":"f5336f18.2c59b","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":905.6428985595703,"y":4421.999845504761,"z":"42cbb89a.8c64f","wires":[["421ab118.9b761","b7ca3c2a.8306f"]]},{"id":"e6f82602.adde08","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":910.6428375244141,"y":4484.666189193726,"z":"42cbb89a.8c64f","wires":[["b5ccad1f.ec4688","b7ca3c2a.8306f"]]},{"id":"69557a8b.b931b4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1430.6428146362305,"y":4544.666210174561,"z":"42cbb89a.8c64f","wires":[["27342a59.1dd1fe","b7ca3c2a.8306f"]]},{"id":"826a647c.0d8d58","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1425.642734527588,"y":4622.66605091095,"z":"42cbb89a.8c64f","wires":[["8bee56c5.166f68","b7ca3c2a.8306f"]]},{"id":"d38e8911.141148","type":"set","name":"set vf-module-to-vfc-mapping length to 0","xml":"<set>\n<parameter name='db.vf-module-to-vfc-mapping_length' value='0' />\n","comments":"","x":1204.500099182129,"y":1970.952314376831,"z":"42cbb89a.8c64f","wires":[]},{"id":"6debb183.b41518","type":"set","name":"set vfc-to-network-role-mapping length to 0","xml":"<set>\n<parameter name='db.vfc-to-network-role-mapping_length' value='0' />\n","comments":"","x":1657.7857818603516,"y":2449.9523401260376,"z":"42cbb89a.8c64f","wires":[]},{"id":"14eb9411.7f3a24","type":"switchNode","name":"switch plans-index > 0","xml":"<switch test='`$plans-index &gt; 0`'>\n","comments":"","outputs":1,"x":593.5000762939453,"y":4201.3808126449585,"z":"42cbb89a.8c64f","wires":[["d8f73141.9175b8"]]},{"id":"d8f73141.9175b8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":776.3572158813477,"y":4201.381022453308,"z":"42cbb89a.8c64f","wires":[["285a17dd.85f258"]]},{"id":"b7ca3c2a.8306f","type":"switchNode","name":"switch plans-index > 0","xml":"<switch test='`$plans-index &gt; 0`'>\n","comments":"","outputs":1,"x":2284.6665000915527,"y":4328.286042690277,"z":"42cbb89a.8c64f","wires":[["abc3aaf1.1a8d3"]]},{"id":"abc3aaf1.1a8d3","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2467.523639678955,"y":4328.286252498627,"z":"42cbb89a.8c64f","wires":[["785ac55a.5e876c"]]},{"id":"4cd290dc.dfcc9","type":"set","name":"set service-type","xml":"<set>\n<parameter name='service-data.service-information.service-type' value='`$service-data.service-information.subscription-service-type`' />\n","comments":"EIPAM plug-in needs this attribute set with this name","x":573.6666145324707,"y":4154.9522161483765,"z":"42cbb89a.8c64f","wires":[]},{"id":"1ae4b5e5.907d6a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":312,"y":4912.7742395401,"z":"42cbb89a.8c64f","wires":[]},{"id":"a036b971.c69728","type":"comment","name":"Fix $ in value","info":"","comments":"","x":817.7499465942383,"y":4918.0243883132935,"z":"42cbb89a.8c64f","wires":[]},{"id":"d44a8be9.4bdcc","type":"call","name":"call check for VNF-API-preload and copy","xml":"<call module='GENERIC-RESOURCE-API' rpc='gw-vfmodule-update' mode='sync' >\n","comments":"","outputs":1,"x":647.1668701171875,"y":5024.941292762756,"z":"42cbb89a.8c64f","wires":[[]]},{"id":"8a361b3a.5865b8","type":"returnFailure","name":"MARKER Node","xml":"\n","comments":"","x":1517,"y":2230,"z":"42cbb89a.8c64f","wires":[]},{"id":"978b88f8.1b362","type":"set","name":"set service-object-path","xml":"<set>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $service-data.service-topology.service-topology-identifier.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id\n + '/vf-module-data/vf-module-topology/'`\"/>\n<!--\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $service-data.service-topology.service-topology-identifier.service-instance-id\n + '/service-data/service-topology/'`\"/>\n -->\n","comments":"","x":583.083251953125,"y":5156.3330078125,"z":"42cbb89a.8c64f","wires":[]}]
