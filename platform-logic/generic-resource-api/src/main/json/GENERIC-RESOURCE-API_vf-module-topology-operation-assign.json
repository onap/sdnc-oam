[{"id":"70008064.b0567","type":"dgstart","name":"DGSTART","outputs":1,"x":149,"y":108,"z":"ad4f7469.49c2a8","wires":[["685d03d3.088f2c"]]},{"id":"685d03d3.088f2c","type":"service-logic","name":"GENERIC-RESOURCE-API 1.2.0-SNAPSHOT-INT110901","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='1.2.0-SNAPSHOT-INT110901'>","outputs":1,"x":262.8571357727051,"y":147.80953788757324,"z":"ad4f7469.49c2a8","wires":[["b0a04a33.71288"]]},{"id":"b0a04a33.71288","type":"method","name":"method vf-module-topology-operation-assign","xml":"<method rpc='vf-module-topology-operation-assign' mode='sync'>\n","comments":"","outputs":1,"x":262.42862701416016,"y":188,"z":"ad4f7469.49c2a8","wires":[["b182a20d.0b6e98"]]},{"id":"c96f393b.cea5f8","type":"comment","name":"vf-module-topology-operation-assign","info":"","comments":"","x":554.3210983276367,"y":50.97569942474365,"z":"ad4f7469.49c2a8","wires":[]},{"id":"ccb9e614.bca338","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vf-module-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":554.1905097961426,"y":363.52382230758667,"z":"ad4f7469.49c2a8","wires":[["32bbc763.f87c6","4c0ada96.70f06c"]]},{"id":"32bbc763.f87c6","type":"outcome","name":"CreateVfModuleInstance","xml":"<outcome value='CreateVfModuleInstance'>\n","comments":"","outputs":1,"x":816.2381248474121,"y":340.66670846939087,"z":"ad4f7469.49c2a8","wires":[["eca6ec19.369c68"]]},{"id":"4c0ada96.70f06c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":759.9047698974609,"y":386.0476975440979,"z":"ad4f7469.49c2a8","wires":[["eb02ab08.d51f2"]]},{"id":"eca6ec19.369c68","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1006.0952892303467,"y":340.6667399406433,"z":"ad4f7469.49c2a8","wires":[[]]},{"id":"eb02ab08.d51f2","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'assign' then request-action must be 'CreateVfModuleInstance'\" />\n","comments":"","x":1024.9047775268555,"y":386.381010055542,"z":"ad4f7469.49c2a8","wires":[]},{"id":"ca96e484.707f48","type":"get-resource","name":"get-resource VF_MODULE_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODULE_MODEL WHERE customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-module-model'>\n\n","comments":"","outputs":1,"x":601.5237770080566,"y":454.66677236557007,"z":"ad4f7469.49c2a8","wires":[["ecd3b214.6a9538","76f3b3b2.92edfc"]]},{"id":"74dd976f.88b068","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No model found for VF module customization UUID ' + $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`\" />\n","comments":"","x":1042.9521980285645,"y":479.09524488449097,"z":"ad4f7469.49c2a8","wires":[]},{"id":"ecd3b214.6a9538","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":867.3094673156738,"y":435.0476031303406,"z":"ad4f7469.49c2a8","wires":[["74068535.6cd874"]]},{"id":"76f3b3b2.92edfc","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":875.8808975219727,"y":479.33331632614136,"z":"ad4f7469.49c2a8","wires":[["74dd976f.88b068"]]},{"id":"74068535.6cd874","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODULE_MODEL table\" />\n","comments":"","x":1042.309398651123,"y":434.1905035972595,"z":"ad4f7469.49c2a8","wires":[]},{"id":"1518dd0e.360d43","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":596.6190414428711,"y":663.2381076812744,"z":"ad4f7469.49c2a8","wires":[["3aff817c.71173e","8623f29b.c0d1e"]]},{"id":"3aff817c.71173e","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":837.3333129882812,"y":640.3808479309082,"z":"ad4f7469.49c2a8","wires":[["25762eb5.b63ab2"]]},{"id":"8623f29b.c0d1e","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":837.0951538085938,"y":681.333366394043,"z":"ad4f7469.49c2a8","wires":[["b340317b.bcbd98"]]},{"id":"b182a20d.0b6e98","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":203.99999237060547,"y":2357.9999599456787,"z":"ad4f7469.49c2a8","wires":[["ccb9e614.bca338","ca96e484.707f48","1518dd0e.360d43","5c43adc9.2fc46c","bcbdf74b.957b8","453dfa8a.963e5c","fdbae05f.046b88","3943ef3.932be9","10fcffa4.28dbe8","a9dad6c6.aaf1a","8b113cb9.e83f1","de576083.2d80c","80b4752.dc03708","6c14f33c.c31804","31137d21.712e3a","25684f40.c4e53","1e083588.ca84ea","74a6bed9.4b065","525360c0.fca57","2bb92f72.16d668","5a551b8a.bdde84","24d58c33.44da94","e8c4f5a8.1872c8","de6bdfc.8d9452","2a6efe10.fb4a22","2f4ceeb.7e2d412","e15ea898.94a638","91f118e3.3dbd88","824b0322.39a3e8","a06a536a.1e436","32f79430.2a75ec","cd28c3e0.626f1","2519c512.d6b63a","e5284bfb.8db92","bab04b4d.2861a","dcfef0d0.fa5a","8c0907cb.ccd0c8","8820ab5f.0af608"]]},{"id":"25762eb5.b63ab2","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs defined in MD-SAL\" />\n","comments":"","x":1003.999927520752,"y":639.6666030883789,"z":"ad4f7469.49c2a8","wires":[]},{"id":"b340317b.bcbd98","type":"for","name":"for each vnf","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":999.3332977294922,"y":680.9999847412109,"z":"ad4f7469.49c2a8","wires":[["2453413d.0d1ab6"]]},{"id":"2453413d.0d1ab6","type":"switchNode","name":"switch service data vnf == input vnf","xml":"<switch test='`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`'>\n","comments":"","outputs":1,"x":1250.6665153503418,"y":680.6666717529297,"z":"ad4f7469.49c2a8","wires":[["63b29f02.48cd98"]]},{"id":"63b29f02.48cd98","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1480.6666069030762,"y":680.0000257492065,"z":"ad4f7469.49c2a8","wires":[["bc248f24.d15e8"]]},{"id":"5c43adc9.2fc46c","type":"set","name":"set vnf-index to -1","xml":"<set>\n<parameter name='vnf-index' value='-1' />\n","comments":"","x":545.6666641235352,"y":594.6666069030762,"z":"ad4f7469.49c2a8","wires":[]},{"id":"87b8647b.796e8","type":"set","name":"set vnf-index to idx","xml":"<set>\n<parameter name='vnf-index' value='`$idx`' />\n","comments":"","x":1802.3332443237305,"y":650.9999837875366,"z":"ad4f7469.49c2a8","wires":[]},{"id":"bcbdf74b.957b8","type":"switchNode","name":"switch vnf-index","xml":"<switch test='`$vnf-index`'>\n","comments":"","outputs":1,"x":535.6666717529297,"y":731.3333034515381,"z":"ad4f7469.49c2a8","wires":[["fa700b49.9428d"]]},{"id":"fa700b49.9428d","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":714.000057220459,"y":730.6666793823242,"z":"ad4f7469.49c2a8","wires":[["9dde7761.bcafc8"]]},{"id":"9dde7761.bcafc8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find VNF ID ' + $vf-module-topology-operation-input.vnf-information.vnf-id + ' in MD-SAL'`\" />\n","comments":"","x":873.9999656677246,"y":729.9999828338623,"z":"ad4f7469.49c2a8","wires":[]},{"id":"453dfa8a.963e5c","type":"switchNode","name":"switch vnf order status","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status`'>\n","comments":"","outputs":1,"x":558.6666946411133,"y":802.6667003631592,"z":"ad4f7469.49c2a8","wires":[["55fdb2a.2c4cdcc","d484708.cfab61"]]},{"id":"55fdb2a.2c4cdcc","type":"outcome","name":"Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":758.9999961853027,"y":776.3332843780518,"z":"ad4f7469.49c2a8","wires":[["a94e2414.75977"]]},{"id":"a94e2414.75977","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":899.0000076293945,"y":776.3333263397217,"z":"ad4f7469.49c2a8","wires":[[]]},{"id":"d484708.cfab61","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":755.666633605957,"y":817.9999618530273,"z":"ad4f7469.49c2a8","wires":[["96714bcc.3c7248"]]},{"id":"96714bcc.3c7248","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF order status is ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status + ' but should be Created'`\" />\n","comments":"","x":915.666633605957,"y":817.6666488647461,"z":"ad4f7469.49c2a8","wires":[]},{"id":"fdbae05f.046b88","type":"switchNode","name":"switch vf-module_length","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n","comments":"","outputs":1,"x":562.333381652832,"y":894.6666212081909,"z":"ad4f7469.49c2a8","wires":[["71b9deff.fc3638","ae766da3.d4a2a"]]},{"id":"71b9deff.fc3638","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":819.7143363952637,"y":861.8093948364258,"z":"ad4f7469.49c2a8","wires":[["de15d43c.c5b848"]]},{"id":"de15d43c.c5b848","type":"set","name":"set vf-module-index=0","xml":"<set>\n<parameter name='vf-module-index' value='0' />\n","comments":"","x":1007.3333740234375,"y":862.4761695861816,"z":"ad4f7469.49c2a8","wires":[]},{"id":"ae766da3.d4a2a","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":820.142879486084,"y":926.0952529907227,"z":"ad4f7469.49c2a8","wires":[["3d3bc4be.bdb014"]]},{"id":"adc724c1.15b17","type":"set","name":"set vf-module-index = vf-module_length","xml":"<set>\n<parameter name='vf-module-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' />\n","comments":"","x":1205.3334197998047,"y":906.2856483459473,"z":"ad4f7469.49c2a8","wires":[]},{"id":"a982b27c.24acd8","type":"for","name":"for each existing VF module","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' >\n","comments":"","outputs":1,"x":1164.4285125732422,"y":950.3808784484863,"z":"ad4f7469.49c2a8","wires":[["f020a39e.9486a8"]]},{"id":"3d3bc4be.bdb014","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":956.8571586608887,"y":926.095178604126,"z":"ad4f7469.49c2a8","wires":[["adc724c1.15b17","a982b27c.24acd8"]]},{"id":"f020a39e.9486a8","type":"switchNode","name":"switch vf-module-information.vf-module-id == service-data.vnfs.vnf[].vf-modules.vf-module[].vf-module-id","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.vf-module-id == $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id`'>\n","comments":"","outputs":1,"x":1668.0476150512695,"y":949.9522895812988,"z":"ad4f7469.49c2a8","wires":[["11300c1a.b83c24"]]},{"id":"11300c1a.b83c24","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2110.666664123535,"y":949.5237407684326,"z":"ad4f7469.49c2a8","wires":[["b3b28c02.bd1278"]]},{"id":"b3b28c02.bd1278","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VF module id ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id\n       + ' already exists, and status is ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-data.vf-module-level-oper-status.order-status`\" />\n","comments":"","x":2262.571544647217,"y":949.5237274169922,"z":"ad4f7469.49c2a8","wires":[]},{"id":"b29e354b.b4ae58","type":"comment","name":"make sure this VF module doesn't exist already","info":"","comments":"","x":1694.4999618530273,"y":904.5797815322876,"z":"ad4f7469.49c2a8","wires":[]},{"id":"3943ef3.932be9","type":"set","name":"set new vf-module_length","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-module-index + 1`' />\n","comments":"","x":567.3333206176758,"y":989.6665554046631,"z":"ad4f7469.49c2a8","wires":[]},{"id":"10fcffa4.28dbe8","type":"set","name":"set vf-module-topology data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-topology-identifier.vf-module-id' value='`$vf-module-topology-operation-input.vf-module-information.vf-module-id`' />\n<parameter name='tmp.vf-module-topology.vf-module-topology-identifier.vf-module-name' value='`$vf-module-topology-operation-input.vf-module-request-input.vf-module-name`' />\n<parameter name='tmp.vf-module-topology.vf-module-topology-identifier.vf-module-type' value='`$vf-module-topology-operation-input.vf-module-information.vf-module-type`' />\n<parameter name='tmp.vf-module-topology.tenant' value='`$vf-module-topology-operation-input.vf-module-request-input.tenant`' />\n<parameter name='tmp.vf-module-topology.aic-cloud-region' value='`$vf-module-topology-operation-input.vf-module-request-input.aic-cloud-region`' />\n","comments":"","x":573.8333396911621,"y":1102.1666622161865,"z":"ad4f7469.49c2a8","wires":[]},{"id":"85a78fb1.4d4dc","type":"set","name":"set aic-clli","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.aic-clli'\n   value='`$aai-uid-split[$aai-uid-split_length - 1]`' />\n","comments":"","x":1334.7855987548828,"y":1261.4045886993408,"z":"ad4f7469.49c2a8","wires":[]},{"id":"a9dad6c6.aaf1a","type":"switchNode","name":"switch aic-clli","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.aic-clli`'>\n","comments":"","outputs":1,"x":533.8332595825195,"y":1375.3569288253784,"z":"ad4f7469.49c2a8","wires":[["fbc86923.bc8838"]]},{"id":"fbc86923.bc8838","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":679.1189498901367,"y":1375.3569974899292,"z":"ad4f7469.49c2a8","wires":[["f65d2f50.9c8938"]]},{"id":"f65d2f50.9c8938","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find aic-clli in AAI for aic-cloud-region ' + $vf-module-topology-operation-input.vf-module-request-input.aic-cloud-region`\" />\n","comments":"","x":826.2618103027344,"y":1374.9284315109253,"z":"ad4f7469.49c2a8","wires":[]},{"id":"8b113cb9.e83f1","type":"get-resource","name":"get-resource cloud region","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"cloud-region\" \n\t\tkey=\"cloud-region.cloud-owner = 'CloudOwner' AND \n\t\t     cloud-region.cloud-region-id = $vf-module-topology-operation-input.vf-module-request-input.aic-cloud-region\"\n        pfx='aai.cloud-region' local-only='false' >\n\n","comments":"","outputs":1,"x":572.6904754638672,"y":1175.5002002716064,"z":"ad4f7469.49c2a8","wires":[["639326e3.d26cb","be9f549a.ae191"]]},{"id":"be9f549a.ae191","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":786.9366683959961,"y":1193.6510562896729,"z":"ad4f7469.49c2a8","wires":[["b09d2ba3.d6ace8"]]},{"id":"b09d2ba3.d6ace8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving cloud region from AAI\" />\n","comments":"","x":961.9366416931152,"y":1193.6510925292969,"z":"ad4f7469.49c2a8","wires":[]},{"id":"639326e3.d26cb","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":795.8652648925781,"y":1151.9367895126343,"z":"ad4f7469.49c2a8","wires":[["cb66f617.e9715"]]},{"id":"cb66f617.e9715","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Cloud region not found in AAI\" />\n","comments":"","x":962.214542388916,"y":1151.2423667907715,"z":"ad4f7469.49c2a8","wires":[]},{"id":"de576083.2d80c","type":"set","name":"set vf-module-parameters","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-parameters.'\n  value='vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.' />\n","comments":"","x":569.595287322998,"y":1824.7860202789307,"z":"ad4f7469.49c2a8","wires":[]},{"id":"80b4752.dc03708","type":"set","name":"set order-status to PendingCreate","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.order-status'\n  value='PendingCreate' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'\n  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.last-action'\n  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />\n","comments":"","x":585.2262573242188,"y":5026.3927001953125,"z":"ad4f7469.49c2a8","wires":[]},{"id":"6c14f33c.c31804","type":"get-resource","name":"get-resource VF_MODULE_TO_VFC_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODULE_TO_VFC_MAPPING WHERE vf_module_customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-module-to-vfc-mapping[]'>\n\n","comments":"","outputs":1,"x":642.9286880493164,"y":1878.642807006836,"z":"ad4f7469.49c2a8","wires":[["edb5b5bb.fc5f58","1455d0f0.dced9f"]]},{"id":"edb5b5bb.fc5f58","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":908.7143783569336,"y":1859.0236377716064,"z":"ad4f7469.49c2a8","wires":[["cd108514.e039a"]]},{"id":"1455d0f0.dced9f","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":917.2858085632324,"y":1903.3093509674072,"z":"ad4f7469.49c2a8","wires":[["b1d93dfc.ff4fd8"]]},{"id":"cd108514.e039a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODULE_TO_VFC_MAPPING table\" />\n","comments":"","x":1083.7143096923828,"y":1858.1665382385254,"z":"ad4f7469.49c2a8","wires":[]},{"id":"31137d21.712e3a","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$db.vf-module-to-vfc-mapping_length`' >\n","comments":"","outputs":1,"x":543.0476989746094,"y":2507.6430587768555,"z":"ad4f7469.49c2a8","wires":[["279d2e94.67d392"]]},{"id":"5caa36c9.eecab8","type":"get-resource","name":"get-resource VFC_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VFC_MODEL WHERE customization_uuid = $db.vf-module-to-vfc-mapping[$vm-type-index].vfc-customization-uuid'\n  pfx='db.vfc-model'>\n\n","comments":"","outputs":1,"x":984.9524993896484,"y":1999.5477199554443,"z":"ad4f7469.49c2a8","wires":[["3965615c.ce7cde","1514f961.4a5bff"]]},{"id":"3217bf73.616a18","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in VFC_MODEL table for customization UUID ' + $db.vf-module-to-vfc-mapping[$db-vm-index].vfc_customization_uuid`\" />\n","comments":"","x":1355.3808479309082,"y":2023.9761123657227,"z":"ad4f7469.49c2a8","wires":[]},{"id":"3965615c.ce7cde","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1180.7381172180176,"y":1979.9284706115723,"z":"ad4f7469.49c2a8","wires":[["2c9786be.9d0952"]]},{"id":"1514f961.4a5bff","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1189.3095474243164,"y":2024.214183807373,"z":"ad4f7469.49c2a8","wires":[["3217bf73.616a18"]]},{"id":"2c9786be.9d0952","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VFC_MODEL table\" />\n","comments":"","x":1355.7380485534668,"y":1979.0713710784912,"z":"ad4f7469.49c2a8","wires":[]},{"id":"279d2e94.67d392","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":734.9524917602539,"y":2506.214427947998,"z":"ad4f7469.49c2a8","wires":[["5caa36c9.eecab8","c8d08f2c.9e6ca8","277b934f.11e4dc","433b5ff8.624c28","9c3f8f00.e7445","3df7949d.0b91ac","53a68b31.8d8a24","6cff934b.2fbad4"]]},{"id":"5a551b8a.bdde84","type":"set","name":"set vm_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm_length'\n  value='`$db.vf-module-to-vfc-mapping_length`' />\n","comments":"","x":534.833366394043,"y":1938.8334846496582,"z":"ad4f7469.49c2a8","wires":[]},{"id":"c8d08f2c.9e6ca8","type":"set","name":"set vm data","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-type'\n   value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-type`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].nfc-naming-code'\n   value='`$db.vfc-model.nfc-naming-code`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-type-tag'\n   value='`$db.vfc-model.vm-type-tag`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-count'\n   value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' />\n","comments":"","x":935.6667518615723,"y":2125.5001974105835,"z":"ad4f7469.49c2a8","wires":[]},{"id":"bc248f24.d15e8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1629.0000686645508,"y":678.9197244644165,"z":"ad4f7469.49c2a8","wires":[["87b8647b.796e8","92b41525.21a51"]]},{"id":"92b41525.21a51","type":"break","name":"break","xml":"<break>","comments":"","x":1764.0000343322754,"y":700.5863103866577,"z":"ad4f7469.49c2a8","wires":[]},{"id":"49fb272b.7882a","type":"set","name":"set from DB","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-invariant-uuid'\n  value='`$db.vf-module-model.invariant-uuid`' />\n","comments":"","x":948.1665992736816,"y":1416.7529220581055,"z":"ad4f7469.49c2a8","wires":[]},{"id":"25684f40.c4e53","type":"switchNode","name":"switch input model-invariant-uuid","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`'>\n","comments":"","outputs":1,"x":592.0236740112305,"y":1439.5773658752441,"z":"ad4f7469.49c2a8","wires":[["7aeed8e4.d1f6d","b5b34db4.ad9fc8"]]},{"id":"7aeed8e4.d1f6d","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":797.6903457641602,"y":1416.720329284668,"z":"ad4f7469.49c2a8","wires":[["49fb272b.7882a"]]},{"id":"b5b34db4.ad9fc8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":799.1189422607422,"y":1461.0059204101562,"z":"ad4f7469.49c2a8","wires":[["92f483c5.d2972"]]},{"id":"92f483c5.d2972","type":"set","name":"set from input","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-invariant-uuid'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`' />\n","comments":"","x":953.4046783447266,"y":1460.4344925880432,"z":"ad4f7469.49c2a8","wires":[]},{"id":"cf9fada5.339078","type":"set","name":"set from DB","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-uuid'\n  value='`$db.vf-module-model.uuid`' />\n","comments":"","x":949.1188697814941,"y":1505.2915983200073,"z":"ad4f7469.49c2a8","wires":[]},{"id":"1e083588.ca84ea","type":"switchNode","name":"switch input model-uuid","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-uuid`'>\n","comments":"","outputs":1,"x":564.642692565918,"y":1528.1161031723022,"z":"ad4f7469.49c2a8","wires":[["e55b2fd6.0f5678","30540db.2ada172"]]},{"id":"e55b2fd6.0f5678","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":798.6426658630371,"y":1505.2590351104736,"z":"ad4f7469.49c2a8","wires":[["cf9fada5.339078"]]},{"id":"30540db.2ada172","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":800.0712623596191,"y":1549.544626235962,"z":"ad4f7469.49c2a8","wires":[["baa3828b.3bc278"]]},{"id":"baa3828b.3bc278","type":"set","name":"set from input","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-uuid'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-uuid`' />\n","comments":"","x":954.3569984436035,"y":1548.9731984138489,"z":"ad4f7469.49c2a8","wires":[]},{"id":"2460ad34.34bf3a","type":"set","name":"set from DB","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-version'\n  value='`$db.vf-module-model.version`' />\n","comments":"","x":946.2618026733398,"y":1594.1488056182861,"z":"ad4f7469.49c2a8","wires":[]},{"id":"74a6bed9.4b065","type":"switchNode","name":"switch input model-version","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`'>\n","comments":"","outputs":1,"x":572.7855644226074,"y":1616.9732503890991,"z":"ad4f7469.49c2a8","wires":[["6efe9ad9.7fd3f4","64df0b2a.a007a4"]]},{"id":"6efe9ad9.7fd3f4","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":795.7855491638184,"y":1594.1162128448486,"z":"ad4f7469.49c2a8","wires":[["2460ad34.34bf3a"]]},{"id":"64df0b2a.a007a4","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":797.2141456604004,"y":1638.401803970337,"z":"ad4f7469.49c2a8","wires":[["a2ec831d.a8e43"]]},{"id":"a2ec831d.a8e43","type":"set","name":"set from input","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-version'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`' />\n","comments":"","x":951.4998817443848,"y":1637.8303761482239,"z":"ad4f7469.49c2a8","wires":[]},{"id":"58932303.7310e4","type":"set","name":"set from DB","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-name'\n  value='`$db.vf-module-model.name`' />\n","comments":"","x":946.2618026733398,"y":1681.2916278839111,"z":"ad4f7469.49c2a8","wires":[]},{"id":"525360c0.fca57","type":"switchNode","name":"switch input model-name","xml":"<switch test='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-name`'>\n","comments":"","outputs":1,"x":567.7855644226074,"y":1704.1160726547241,"z":"ad4f7469.49c2a8","wires":[["855fb4c3.536358","39ce0516.3ac9c2"]]},{"id":"855fb4c3.536358","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":795.7855491638184,"y":1681.2590351104736,"z":"ad4f7469.49c2a8","wires":[["58932303.7310e4"]]},{"id":"39ce0516.3ac9c2","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":797.2141456604004,"y":1725.544626235962,"z":"ad4f7469.49c2a8","wires":[["d226daac.430d2"]]},{"id":"d226daac.430d2","type":"set","name":"set from input","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-name'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-name`' />\n","comments":"","x":951.4998817443848,"y":1724.9731984138489,"z":"ad4f7469.49c2a8","wires":[]},{"id":"2bb92f72.16d668","type":"set","name":"set model-customization-uuid","xml":"<set>\n<parameter name='tmp.vf-module-topology.onap-model-information.model-customization-uuid'\n  value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`' />\n","comments":"","x":582.2378997802734,"y":1776.6250619888306,"z":"ad4f7469.49c2a8","wires":[]},{"id":"277b934f.11e4dc","type":"for","name":"for each vm","xml":"<for index='vm-index' start='0' end='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' >\n","comments":"","outputs":1,"x":937.3332405090332,"y":2234.7531156539917,"z":"ad4f7469.49c2a8","wires":[["73f467a1.365628"]]},{"id":"433b5ff8.624c28","type":"set","name":"set vm-name-length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name_length'\n  value='`$db.vf-module-to-vfc-mapping[$vm-type-index].vm-count`' />\n","comments":"","x":960.6666946411133,"y":2169.753373146057,"z":"ad4f7469.49c2a8","wires":[]},{"id":"50d5ddc6.51509c","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":1403.761863708496,"y":2257.3722620010376,"z":"ad4f7469.49c2a8","wires":[["12a0dab5.e28c55","f724032e.5e014"]]},{"id":"12a0dab5.e28c55","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1699.4761517842617,"y":2230.2295246124268,"z":"ad4f7469.49c2a8","wires":[["ff0040e6.07b6f8"]]},{"id":"f724032e.5e014","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1702.8095016479492,"y":2281.896167755127,"z":"ad4f7469.49c2a8","wires":[["3d3924e.31a515c"]]},{"id":"a394533f.12fff8","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='VM_NAME_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vm_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='VM_INSTANCE' />\n<parameter name='generate-unique-name-input.prefix' value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-name + $db.vfc-model.nfc-naming-code`\" />\n<parameter name='generate-unique-name-input.index-length' value='3' />\n","comments":"","x":1360.4285774230957,"y":2205.7055883407593,"z":"ad4f7469.49c2a8","wires":[]},{"id":"3d3924e.31a515c","type":"set","name":"set generated name","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name[$vm-index]' value='`$generate-unique-name-output.generated-name`' />\n","comments":"","x":1887.3332176208496,"y":2281.3721857070923,"z":"ad4f7469.49c2a8","wires":[]},{"id":"ff0040e6.07b6f8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":1867.3332646687832,"y":2229.6580362319946,"z":"ad4f7469.49c2a8","wires":[]},{"id":"24d58c33.44da94","type":"set","name":"set vf-module-id","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id'\n   value='`$vf-module-topology-operation-input.vf-module-information.vf-module-id`' />\n","comments":"","x":535.4285469055176,"y":1045.348237991333,"z":"ad4f7469.49c2a8","wires":[]},{"id":"73f467a1.365628","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1101.738182067871,"y":2234.396019935608,"z":"ad4f7469.49c2a8","wires":[["a394533f.12fff8","50d5ddc6.51509c"]]},{"id":"9c3f8f00.e7445","type":"get-resource","name":"get-resource VFC_TO_NETWORK_ROLE_MAPPING","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VFC_TO_NETWORK_ROLE_MAPPING WHERE vfc_customization_uuid = $db.vf-module-to-vfc-mapping[$vm-type-index].vfc-customization-uuid'\n  pfx='db.vfc-to-network-role-mapping[]'>\n\n","comments":"","outputs":1,"x":1064.595329284668,"y":2357.253088951111,"z":"ad4f7469.49c2a8","wires":[["7d9db9c5.b0a8e","23729e3e.18465a"]]},{"id":"7d9db9c5.b0a8e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1351.8095321655273,"y":2337.6339359283447,"z":"ad4f7469.49c2a8","wires":[["bb248569.e31e48"]]},{"id":"23729e3e.18465a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1360.3809623718262,"y":2381.9196491241455,"z":"ad4f7469.49c2a8","wires":[["977486e8.baed78"]]},{"id":"bb248569.e31e48","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VFC_TO_NETWORK_ROLE_MAPPING table\" />\n","comments":"","x":1526.8094635009766,"y":2336.7768363952637,"z":"ad4f7469.49c2a8","wires":[]},{"id":"3df7949d.0b91ac","type":"for","name":"for each network-role","xml":"<for index='network-role-index' start='0' end='`$db.vfc-to-network-role-mapping_length`' >\n","comments":"","outputs":1,"x":957.6906204223633,"y":2668.4439306259155,"z":"ad4f7469.49c2a8","wires":[["1184364a.d5a8f2"]]},{"id":"1184364a.d5a8f2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1164.1190719604492,"y":2665.11043548584,"z":"ad4f7469.49c2a8","wires":[["a179f66a.545b28","a561d376.dcda6","1caf162a.776952","ea611eee.5d8d4","5457b05c.bf3f5","54b03661.5ec7c","d60f9e3a.76d44","2a46e9a5.12dfa6"]]},{"id":"a179f66a.545b28","type":"for","name":"for each network","xml":"<for silentFailure='true' index='idx' start='0' end='`$service-data.networks.network_length`' >\n","comments":"","outputs":1,"x":1373.166633605957,"y":2497.253191947937,"z":"ad4f7469.49c2a8","wires":[["bafde5de.b96fa8"]]},{"id":"a561d376.dcda6","type":"set","name":"set network-index to -1","xml":"<set>\n<parameter name='network-index' value='-1' />\n","comments":"","x":1393.1667022705078,"y":2454.396188735962,"z":"ad4f7469.49c2a8","wires":[]},{"id":"bafde5de.b96fa8","type":"switchNode","name":"switch network-role matches","xml":"<switch test='`$service-data.networks.network[$idx].network-data.network-topology.network-topology-identifier-structure.network-role == $db.vfc-to-network-role-mapping[$network-role-index].network-role`'>\n","comments":"","outputs":1,"x":1601.737907409668,"y":2495.824381828308,"z":"ad4f7469.49c2a8","wires":[["32b667c0.d7416"]]},{"id":"32b667c0.d7416","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1800.3095741271973,"y":2495.824585914612,"z":"ad4f7469.49c2a8","wires":[["c9637852.07dbc8"]]},{"id":"c9637852.07dbc8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1941.7381420135498,"y":2494.396014213562,"z":"ad4f7469.49c2a8","wires":[["775efd26.c4d0b4","9648d2c4.19e108"]]},{"id":"775efd26.c4d0b4","type":"set","name":"set network-index to idx","xml":"<set>\n<parameter name='network-index' value='`$idx`' />\n","comments":"","x":2120.30965423584,"y":2471.5390100479126,"z":"ad4f7469.49c2a8","wires":[]},{"id":"9648d2c4.19e108","type":"break","name":"break","xml":"<break>","comments":"","x":2068.8808937072754,"y":2517.2531900405884,"z":"ad4f7469.49c2a8","wires":[]},{"id":"1caf162a.776952","type":"switchNode","name":"switch network-index","xml":"<switch test='`$network-index`'>\n","comments":"","outputs":1,"x":1385.0714721679688,"y":2546.062829017639,"z":"ad4f7469.49c2a8","wires":[["e75c7333.2624e"]]},{"id":"e75c7333.2624e","type":"outcomeTrue","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":1579.3571968078613,"y":2546.062726020813,"z":"ad4f7469.49c2a8","wires":[["34fbf6ad.9c5712"]]},{"id":"34fbf6ad.9c5712","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No network found in MD-SAL with network-role ' + $db.vfc-to-network-role-mapping[$network-role-index].network-role`\" />\n","comments":"","x":1736.5000457763672,"y":2544.634196281433,"z":"ad4f7469.49c2a8","wires":[]},{"id":"e8c4f5a8.1872c8","type":"for","name":"for each cloud-region relationship","xml":"<for index='idx' start='0' end='`$aai.cloud-region.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":594.9442901611328,"y":1264.0068836212158,"z":"ad4f7469.49c2a8","wires":[["eca99516.ca0a6"]]},{"id":"eca99516.ca0a6","type":"switchNode","name":"switch related-to","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship[$idx].related-to`'>\n","comments":"","outputs":1,"x":842.6228332519531,"y":1263.7568130493164,"z":"ad4f7469.49c2a8","wires":[["b887875d.866818"]]},{"id":"b887875d.866818","type":"outcome","name":"complex","xml":"<outcome value='complex'>\n","comments":"","outputs":1,"x":1012.0871543884277,"y":1263.1496353149414,"z":"ad4f7469.49c2a8","wires":[["8c7a6dbb.a8fb3"]]},{"id":"b2b5905f.977bf8","type":"execute","name":"split related-link","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split'>\n   <parameter name='ctx_memory_result_key' value='aai-uid-split' />\n   <parameter name='original_string' value='`$aai.cloud-region.relationship-list.relationship[$idx].related-link`' />\n   <parameter name='regex' value='/' />\n","comments":"","outputs":1,"x":1352.1823120117188,"y":1217.5782108306885,"z":"ad4f7469.49c2a8","wires":[[]]},{"id":"8c7a6dbb.a8fb3","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1171.8490142822266,"y":1264.2449989318848,"z":"ad4f7469.49c2a8","wires":[["b2b5905f.977bf8","1d40da81.43f385","85a78fb1.4d4dc"]]},{"id":"1d40da81.43f385","type":"break","name":"break","xml":"<break>","comments":"","x":1321.848976135254,"y":1307.5782957077026,"z":"ad4f7469.49c2a8","wires":[]},{"id":"ea611eee.5d8d4","type":"set","name":"set network-role and tag","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-role'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].network-role`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-role-tag'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].network-role-tag`' />\n","comments":"","x":1394.8333549499512,"y":2642.2530155181885,"z":"ad4f7469.49c2a8","wires":[]},{"id":"53a68b31.8d8a24","type":"set","name":"set vm-network-length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network_length'\n  value='`$db.vfc-to-network-role-mapping_length`' />\n","comments":"","x":951.4999465942383,"y":3057.2532806396484,"z":"ad4f7469.49c2a8","wires":[]},{"id":"5457b05c.bf3f5","type":"switchNode","name":"switch ipv4-ip-version","xml":"<switch test='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-ip-version`'>\n","comments":"","outputs":1,"x":1387.452407836914,"y":2725.5863428115845,"z":"ad4f7469.49c2a8","wires":[["499d9e30.259498","9cf4106e.24bac"]]},{"id":"96f887ec.b9e9b","type":"set","name":"set network-information-index to -1","xml":"<set>\n<parameter name='network-information-index' value='-1' />\n\n","comments":"","x":1796.97603225708,"y":2690.5864477157593,"z":"ad4f7469.49c2a8","wires":[]},{"id":"499d9e30.259498","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1564.1189270019531,"y":2690.586483001709,"z":"ad4f7469.49c2a8","wires":[["96f887ec.b9e9b"]]},{"id":"9cf4106e.24bac","type":"other","name":"4","xml":"<outcome value='4'>\n","comments":"","outputs":1,"x":1562.8808784484863,"y":2756.538625717163,"z":"ad4f7469.49c2a8","wires":[["e4d9ca26.e20d4"]]},{"id":"35e24a7c.65f54e","type":"set","name":"set network-information-index to 0","xml":"<set>\n<parameter name='network-information-index' value='0' />\n","comments":"","x":1967.4521408081055,"y":2731.0624866485596,"z":"ad4f7469.49c2a8","wires":[]},{"id":"e4d9ca26.e20d4","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1730.0713539123535,"y":2755.872091293335,"z":"ad4f7469.49c2a8","wires":[["35e24a7c.65f54e","6c07f066.81ac"]]},{"id":"6c07f066.81ac","type":"set","name":"set ip-version 4, use-dhcp, and ip-count","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].ip-version'\n   value='4' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].use-dhcp'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-use-dhcp`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].ip-count'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv4-count`' />\n","comments":"","x":1984.4047241210938,"y":2777.7294425964355,"z":"ad4f7469.49c2a8","wires":[]},{"id":"54b03661.5ec7c","type":"switchNode","name":"switch ipv6-ip-version","xml":"<switch test='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-ip-version`'>\n","comments":"","outputs":1,"x":1387.9286041259766,"y":2852.4911251068115,"z":"ad4f7469.49c2a8","wires":[["fb08b823.23a16","de7ef735.0db5a"]]},{"id":"fb08b823.23a16","type":"outcome","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1566.7380981445312,"y":2822.728937149048,"z":"ad4f7469.49c2a8","wires":[["68de6df.7ea3194"]]},{"id":"de7ef735.0db5a","type":"other","name":"6","xml":"<outcome value='6'>\n","comments":"","outputs":1,"x":1568.1666526794434,"y":2887.0144939422607,"z":"ad4f7469.49c2a8","wires":[["8dd578c5.3cd7d8"]]},{"id":"b51b388a.c29e38","type":"set","name":"increment network-information-index","xml":"<set>\n<parameter name='network-information-index' value='`$network-information-index + 1`' />\n","comments":"","x":1973.880744934082,"y":2861.5385236740112,"z":"ad4f7469.49c2a8","wires":[]},{"id":"8dd578c5.3cd7d8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1723.4048118591309,"y":2886.0622329711914,"z":"ad4f7469.49c2a8","wires":[["b51b388a.c29e38","612eb2e7.bad24c"]]},{"id":"68de6df.7ea3194","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1709.404727935791,"y":2822.0625553131104,"z":"ad4f7469.49c2a8","wires":[[]]},{"id":"d60f9e3a.76d44","type":"switchNode","name":"switch network-information-index","xml":"<switch test='`$network-information-index`'>\n","comments":"","outputs":1,"x":1423.166618347168,"y":2988.919370651245,"z":"ad4f7469.49c2a8","wires":[["9886758e.5a81a8","d68888d2.0a15b8"]]},{"id":"9886758e.5a81a8","type":"outcome","name":"-1","xml":"<outcome value='-1'>","comments":"","outputs":1,"x":1641.4999752044678,"y":2965.5861167907715,"z":"ad4f7469.49c2a8","wires":[["349ff83b.94d97"]]},{"id":"d68888d2.0a15b8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1641.2619380950928,"y":3011.5384311676025,"z":"ad4f7469.49c2a8","wires":[["f2a4e3bf.199b78"]]},{"id":"349ff83b.94d97","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1778.166690826416,"y":2963.919776916504,"z":"ad4f7469.49c2a8","wires":[[]]},{"id":"f2a4e3bf.199b78","type":"set","name":"set network-information-item_length","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item_length'\n   value='`$network-information-index + 1`' />\n","comments":"","x":1869.8333053588867,"y":3008.919569015503,"z":"ad4f7469.49c2a8","wires":[]},{"id":"de6bdfc.8d9452","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":550,"y":3155.9194660186768,"z":"ad4f7469.49c2a8","wires":[["3a058e35.a3fcc2"]]},{"id":"3a058e35.a3fcc2","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":753.5715255737305,"y":3156.1576709747314,"z":"ad4f7469.49c2a8","wires":[["4a5c44bf.6a82c4"]]},{"id":"2a46e9a5.12dfa6","type":"set","name":"save network-id","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id'\n  value='`$service-data.networks.network[$idx].network-data.network-topology.network-topology-identifier-structure.network-id`' />\n","comments":"This isn't a node in MD-SAL, but we need to save this for later when we are doing EIPAM processing","x":1366.9761810302734,"y":2592.253023147583,"z":"ad4f7469.49c2a8","wires":[]},{"id":"4a5c44bf.6a82c4","type":"for","name":"for each network-role","xml":"<for index='network-role-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network_length`' >\n","comments":"","outputs":1,"x":954.999885559082,"y":3155.252721786499,"z":"ad4f7469.49c2a8","wires":[["f0cc4acc.6eaaf"]]},{"id":"f0cc4acc.6eaaf","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1156.9047012329102,"y":3154.490758895874,"z":"ad4f7469.49c2a8","wires":[["468d57c5.7000e8"]]},{"id":"468d57c5.7000e8","type":"for","name":"for each network-information-item","xml":"<for index='ip-version-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item_length`' >\n","comments":"","outputs":1,"x":1401.6665725708008,"y":3154.0151510238647,"z":"ad4f7469.49c2a8","wires":[["a57e59a6.391a2"]]},{"id":"e0282680.33064","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":646.666633605957,"y":3359.9195766448975,"z":"ad4f7469.49c2a8","wires":[["54103416.34fa44","889d55b8.503ca","67466579.32493c","d2fe4d6f.7992a8","896d888c.0ad558"]]},{"id":"54103416.34fa44","type":"get-resource","name":"get-resource EIPAM_IP_SUBNETS","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from EIPAM_IP_SUBNETS WHERE network_id = $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id\n    AND address_family = $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-version'\n  pfx='db.eipam-ip-subnets[]'>\n\n","comments":"","outputs":1,"x":1026.6666564941406,"y":3321.586072921753,"z":"ad4f7469.49c2a8","wires":[["b7162f0b.22f37","504de78d.326a78"]]},{"id":"32989bde.2bbe24","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in EIPAM_IP_SUBNETS table for network ID '\n        + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id\n        + ' and address family ' + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-version`\" />\n","comments":"","x":1416.6665954589844,"y":3343.2528343200684,"z":"ad4f7469.49c2a8","wires":[]},{"id":"b7162f0b.22f37","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1242.0238647460938,"y":3299.205192565918,"z":"ad4f7469.49c2a8","wires":[["1bf2ec5d.22b6f4"]]},{"id":"504de78d.326a78","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1250.5952949523926,"y":3343.4909057617188,"z":"ad4f7469.49c2a8","wires":[["32989bde.2bbe24"]]},{"id":"1bf2ec5d.22b6f4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading EIPAM_IP_SUBNETS table\" />\n","comments":"","x":1417.023796081543,"y":3298.348093032837,"z":"ad4f7469.49c2a8","wires":[]},{"id":"889d55b8.503ca","type":"for","name":"for each record in EIPAM_IP_SUBNETS","xml":"<for index='subnets-index' start='0' end='`$db.eipam-ip-subnets_length`' >\n","comments":"","outputs":1,"x":1045.9524688720703,"y":3626.82426071167,"z":"ad4f7469.49c2a8","wires":[["eca16af9.0f41b"]]},{"id":"eca16af9.0f41b","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1302.3810195922852,"y":3627.77654838562,"z":"ad4f7469.49c2a8","wires":[["b6520671.c8b518","18fa7193.b5a91e","b9661ca3.151f98","d67bf1a.4ee6e9","2bb854cc.098924"]]},{"id":"b6520671.c8b518","type":"get-resource","name":"get-resource EIPAM_IP_SUBNET_KEYS","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from EIPAM_IP_SUBNET_KEYS WHERE entity_id = $db.eipam-ip-subnets[$subnets-index].entity-id'\n  pfx='db.eipam-ip-subnet-keys[]'>\n\n","comments":"","outputs":1,"x":1613.809585571289,"y":3464.205156326294,"z":"ad4f7469.49c2a8","wires":[["ae106921.a51f","f3633618.1ead7"]]},{"id":"dcf8e73a.e6ef6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in EIPAM_IP_SUBNET_KEYS table for entity ID '\n        + $db.eipam-ip-subnets[$subnets-index].entity-id`\" />","comments":"","x":2028.809585571289,"y":3484.205156326294,"z":"ad4f7469.49c2a8","wires":[]},{"id":"ae106921.a51f","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1854.1668548583984,"y":3440.1575145721436,"z":"ad4f7469.49c2a8","wires":[["665ae5f5.132b2c"]]},{"id":"f3633618.1ead7","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1862.7382850646973,"y":3484.4432277679443,"z":"ad4f7469.49c2a8","wires":[["dcf8e73a.e6ef6"]]},{"id":"665ae5f5.132b2c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading EIPAM_IP_SUBNET_KEYS table\" />\n","comments":"","x":2029.1667861938477,"y":3439.3004150390625,"z":"ad4f7469.49c2a8","wires":[]},{"id":"67466579.32493c","type":"set","name":"set max-level to -1","xml":"<set>\n<parameter name='max-level' value='-1' />\n","comments":"","x":974.7619323730469,"y":3387.538688659668,"z":"ad4f7469.49c2a8","wires":[]},{"id":"18fa7193.b5a91e","type":"for","name":"for each record in EIPAM_IP_SUBNET_KEYS","xml":"<for index='keys-index' start='0' end='`$db.eipam-ip-subnet-keys_length`' >\n","comments":"","outputs":1,"x":1628.3334045410156,"y":3533.2529106140137,"z":"ad4f7469.49c2a8","wires":[["ecfae27a.b426"]]},{"id":"ecfae27a.b426","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1915.0000534057617,"y":3531.586248397827,"z":"ad4f7469.49c2a8","wires":[["9ec54304.52a0e"]]},{"id":"9ec54304.52a0e","type":"switchNode","name":"switch level > max-level?","xml":"<switch test='`$db.eipam-ip-subnet-keys[$keys-index].level &gt; $max-level`'>\n","comments":"","outputs":1,"x":2131.6666717529297,"y":3531.586166381836,"z":"ad4f7469.49c2a8","wires":[["e50c9544.f3c6f8"]]},{"id":"e50c9544.f3c6f8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2323.333599090576,"y":3531.58616065979,"z":"ad4f7469.49c2a8","wires":[["c976557f.4cc72"]]},{"id":"c976557f.4cc72","type":"set","name":"set max-level, selected-entity-id, selected-plan-name","xml":"<set>\n<parameter name='max-level' value='`$db.eipam-ip-subnet-keys[$keys-index].level`' />\n<parameter name='selected-entity-id' value='`$db.eipam-ip-subnet-keys[$keys-index].entity-id`' />\n<parameter name='selected-plan-name' value='`$db.eipam-ip-subnets[$subnets-index].plan-name`' />\n","comments":"","x":2615.0001068115234,"y":3529.9194173812866,"z":"ad4f7469.49c2a8","wires":[]},{"id":"b9661ca3.151f98","type":"get-resource","name":"get-resource EIPAM_IP_SUBNET_KEYS","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from EIPAM_IP_SUBNET_KEYS WHERE entity_id = $selected-entity-id order by level'\n  pfx='db.eipam-ip-subnet-keys[]'>\n\n","comments":"","outputs":1,"x":1615.000015258789,"y":3605.157615661621,"z":"ad4f7469.49c2a8","wires":[["6637a664.7146e","acc969af.78f2b8"]]},{"id":"b15a838f.f2eec","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No entries found in EIPAM_IP_SUBNET_KEYS table for entity ID '\n        + $selected-entity-id`\" />","comments":"","x":2030.000015258789,"y":3625.157615661621,"z":"ad4f7469.49c2a8","wires":[]},{"id":"6637a664.7146e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1855.3572845458984,"y":3581.1099739074707,"z":"ad4f7469.49c2a8","wires":[["9a75409e.ba2678"]]},{"id":"acc969af.78f2b8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1863.9287147521973,"y":3625.3956871032715,"z":"ad4f7469.49c2a8","wires":[["b15a838f.f2eec"]]},{"id":"9a75409e.ba2678","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading EIPAM_IP_SUBNET_KEYS table\" />\n","comments":"","x":2030.3572158813477,"y":3580.2528743743896,"z":"ad4f7469.49c2a8","wires":[]},{"id":"728fdafb.41ed84","type":"for","name":"for each record in EIPAM_IP_SUBNET_KEYS","xml":"<for index='level-index' start='0' end='`$db.eipam-ip-subnet-keys_length`' >\n","comments":"","outputs":1,"x":2060.952362060547,"y":3673.729072570801,"z":"ad4f7469.49c2a8","wires":[["81b6098.6acfaf8"]]},{"id":"876b0303.f540f","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1753.8093643188477,"y":3757.5385093688965,"z":"ad4f7469.49c2a8","wires":[["728fdafb.41ed84","3951a55b.a8f3ca","d79fc19e.9ea5a8","d5c86b17.cebc68","8bf8fed1.b6f798"]]},{"id":"d67bf1a.4ee6e9","type":"for","name":"for each ip in ip-count","xml":"<for index='request-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-count`' >\n","comments":"","outputs":1,"x":1552.142807006836,"y":3757.5401363372803,"z":"ad4f7469.49c2a8","wires":[["876b0303.f540f"]]},{"id":"81b6098.6acfaf8","type":"set","name":"set eipam data for level","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].pools[$level-index].key-name'\n   value='`$db.eipam-ip-subnet-keys[$level-index].key-name`' />\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].pools[$level-index].key-value'\n   value='`$db.eipam-ip-subnet-keys[$level-index].key-value`' />\n","comments":"","x":2367.8571243286133,"y":3673.4918384552,"z":"ad4f7469.49c2a8","wires":[]},{"id":"3951a55b.a8f3ca","type":"set","name":"set eipam data pools_length","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].pools_length'\n   value='`$db.eipam-ip-subnet-keys_length`' />\n","comments":"","x":2007.142677307129,"y":3719.2054557800293,"z":"ad4f7469.49c2a8","wires":[]},{"id":"2a6efe10.fb4a22","type":"set","name":"set plans-index to 0","xml":"<set>\n<parameter name='plans-index' value='0' />\n","comments":"","x":558.7619171142578,"y":3099.8717365264893,"z":"ad4f7469.49c2a8","wires":[]},{"id":"d2fe4d6f.7992a8","type":"set","name":"increment plans-index","xml":"<set>\n<parameter name='plans-index' value='`$plans-index + 1`' />\n","comments":"","x":990.0952224731445,"y":4018.871983528137,"z":"ad4f7469.49c2a8","wires":[]},{"id":"2bb854cc.098924","type":"set","name":"set eipam requests_length","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].requests_length'\n   value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-count`' />\n","comments":"","x":1562.6191711425781,"y":3899.2055082321167,"z":"ad4f7469.49c2a8","wires":[]},{"id":"896d888c.0ad558","type":"set","name":"set eipam plan-name, address-family","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].plan-name' value='`$selected-plan-name`' />\n<parameter name='eipam-ip-block.plans[$plans-index].address-family'\n   value='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-version`' />\n","comments":"","x":1038.6666564941406,"y":3971.7284650802612,"z":"ad4f7469.49c2a8","wires":[]},{"id":"2f4ceeb.7e2d412","type":"set","name":"set eipam plans_length","xml":"<set>\n<parameter name='eipam-ip-block.plans_length' value='`$plans-index`' />\n","comments":"","x":562.4285697937012,"y":4043.919857978821,"z":"ad4f7469.49c2a8","wires":[]},{"id":"e15ea898.94a638","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":521.7975616455078,"y":5119.011030197144,"z":"ad4f7469.49c2a8","wires":[]},{"id":"91f118e3.3dbd88","type":"set","name":"copy input data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.sdnc-request-header.'\n   value='$vf-module-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.request-information.'\n   value='$vf-module-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.service-information.'\n   value='$vf-module-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vnf-information.'\n   value='$vf-module-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-information.'\n   value='$vf-module-topology-operation-input.vf-module-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-request-input.'\n   value='$vf-module-topology-operation-input.vf-module-request-input.' />\n<parameter name=\"service-object-path\" \n   value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'+$vf-module-operation-input.service-information.service-instance-id+'/service-data/service-topology/'`\" />\n\n\n","comments":"","x":533.5832290649414,"y":4894.990794181824,"z":"ad4f7469.49c2a8","wires":[]},{"id":"824b0322.39a3e8","type":"set","name":"copy vf-module-topology data","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.' value='$tmp.vf-module-topology.' />\n","comments":"","x":578.4642333984375,"y":4846.776306152344,"z":"ad4f7469.49c2a8","wires":[]},{"id":"3b0c098.d177f76","type":"execute","name":"printContext","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n<parameter name='filename' value='/var/tmp/bgb-vfmodule.log' />\n","comments":"","outputs":1,"x":516.6785125732422,"y":5071.240846633911,"z":"ad4f7469.49c2a8","wires":[[]]},{"id":"f19811af.40dd68","type":"execute","name":"call EIPAM assignIPAddress","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"assignIPAddress\">","comments":"","outputs":1,"x":942.5952911376953,"y":4132.880926132202,"z":"ad4f7469.49c2a8","wires":[["4061fd83.4cfa94"]]},{"id":"4061fd83.4cfa94","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":1156.5952911376953,"y":4132.880926132202,"z":"ad4f7469.49c2a8","wires":[["f5e4207e.ea9bc"]]},{"id":"f5e4207e.ea9bc","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while obtaining new address blocks from EIPAM.\" />\n","comments":"","x":1295.5952911376953,"y":4132.880926132202,"z":"ad4f7469.49c2a8","wires":[]},{"id":"d79fc19e.9ea5a8","type":"set","name":"set eipam client-key, mask","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].client-key'\n   value='`$generate-unique-name-output.generated-name`' />\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].info'\n   value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id`' />\n<parameter name='eipam-ip-block.plans[$plans-index].requests[$request-index].mask'\n   value='32' />\n","comments":"","x":2004.2857284545898,"y":3853.015483856201,"z":"ad4f7469.49c2a8","wires":[]},{"id":"32f79430.2a75ec","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":542,"y":4242.252558708191,"z":"ad4f7469.49c2a8","wires":[["86ed78e.54ea488"]]},{"id":"86ed78e.54ea488","type":"for","name":"for each vm-network","xml":"<for index='network-role-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network_length`' >\n","comments":"","outputs":1,"x":750.6666831970215,"y":4242.252884864807,"z":"ad4f7469.49c2a8","wires":[["a0898ea3.bef378"]]},{"id":"a0898ea3.bef378","type":"for","name":"for each network-information-item","xml":"<for index='ip-version-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item_length`' >\n","comments":"","outputs":1,"x":1015.6666717529297,"y":4243.919226646423,"z":"ad4f7469.49c2a8","wires":[["fa091132.d6318"]]},{"id":"a06a536a.1e436","type":"set","name":"set plans-index = 0","xml":"<set>\n<parameter name='plans-index' value='0' />\n","comments":"","x":548.9999923706055,"y":4187.252646446228,"z":"ad4f7469.49c2a8","wires":[]},{"id":"91cc5457.9d7bc8","type":"for","name":"for each eipam request","xml":"<for index='ip-index' start='0' end='`$eipam-ip-block.plans[$plans-index].requests_length`' >\n","comments":"","outputs":1,"x":1785.6666259765625,"y":4215.586531639099,"z":"ad4f7469.49c2a8","wires":[["45effa4c.c8f33c"]]},{"id":"45effa4c.c8f33c","type":"set","name":"set ip address","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].network-ips.network-ip[$ip-index]'\n  value='`$eipam-ip-block.plans[$plans-index].requests[$ip-index].ip-prefix`' />\n","comments":"","x":1997.3332633972168,"y":4213.919702529907,"z":"ad4f7469.49c2a8","wires":[]},{"id":"69d696de.43ab7","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1585.6664581298828,"y":4240.586045265198,"z":"ad4f7469.49c2a8","wires":[["91cc5457.9d7bc8","ff04458c.3958e8"]]},{"id":"ff04458c.3958e8","type":"set","name":"increment plans-index","xml":"<set>\n<parameter name='plans-index' value='`$plans-index + 1`' />\n","comments":"","x":1780.66650390625,"y":4262.252387046814,"z":"ad4f7469.49c2a8","wires":[]},{"id":"2519c512.d6b63a","type":"save","name":"update vf-module","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"vf-module\"\n   key=\"vf-module.vf-module-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id\n      AND generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"vf-module-name\" value=\"`$tmp.vf-module-topology.vf-module-topology-identifier.vf-module-name`\" />\n<parameter name=\"model-invariant-id\" value=\"`$tmp.vf-module-topology.onap-model-information.model-invariant-uuid`\" />\n<parameter name=\"model-version-id\" value=\"`$tmp.vf-module-topology.onap-model-information.model-uuid`\" />\n<parameter name=\"model-customization-id\" value=\"`$tmp.vf-module-topology.onap-model-information.model-customization-uuid`\" />\n<parameter name=\"selflink\" value=\"`$vf-module-object-path`\" />\n","comments":"","outputs":1,"x":543.9999694824219,"y":4387.252729415894,"z":"ad4f7469.49c2a8","wires":[["79cf6357.1b0704","29fa57b8.2bb7d"]]},{"id":"f4f507ab.82e9a8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No vf-module found in AAI for vf module ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id`\" />\n","comments":"","x":1037.333396911621,"y":4440.585899353027,"z":"ad4f7469.49c2a8","wires":[]},{"id":"79cf6357.1b0704","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":713.3573303222656,"y":4354.204874038696,"z":"ad4f7469.49c2a8","wires":[["205dbf73.505ec8"]]},{"id":"29fa57b8.2bb7d","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":721.9286842346191,"y":4416.823854446411,"z":"ad4f7469.49c2a8","wires":[["1c8d0c38.f49544"]]},{"id":"1a55576d.ac9d41","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating vf-module in AAI\" />\n","comments":"","x":1048.3572845458984,"y":4372.348430633545,"z":"ad4f7469.49c2a8","wires":[]},{"id":"cd28c3e0.626f1","type":"set","name":"set vf-module-object-path","xml":"<set>\n<parameter name='vf-module-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $service-data.service-topology.service-topology-identifier.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id\n + '/vf-module-data/vf-module-topology/'`\"/>\n\n","comments":"","x":570.666633605957,"y":4312.252715110779,"z":"ad4f7469.49c2a8","wires":[]},{"id":"adf6a01c.1b1ad","type":"save","name":"save vf-module relationships","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"vf-module:relationship-list\"\n   key=\"vf-module.vf-module-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id\n      AND generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id\"\n   force=\"true\" pfx=\"tmp.AnAI-data\">\n    <parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n    <parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id`\" />\n","comments":"","outputs":1,"x":1003.3094787597656,"y":4515.975717544556,"z":"ad4f7469.49c2a8","wires":[["af37c9b9.6ba568","eed4f970.c4ce5"]]},{"id":"af37c9b9.6ba568","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1228.1428108215332,"y":4476.847640037537,"z":"ad4f7469.49c2a8","wires":[["cc2e8ba4.5b6b28"]]},{"id":"eed4f970.c4ce5","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1236.7142639160156,"y":4554.466782569885,"z":"ad4f7469.49c2a8","wires":[["41ceb0bb.02ccd"]]},{"id":"1c833009.7da008","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating vf-module relationships in AAI\" />\n","comments":"","x":1563.1429443359375,"y":4496.657536506653,"z":"ad4f7469.49c2a8","wires":[]},{"id":"e5284bfb.8db92","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":544.3095092773438,"y":4517.642220497131,"z":"ad4f7469.49c2a8","wires":[["c5426cb4.3bdc28"]]},{"id":"c5426cb4.3bdc28","type":"for","name":"for each vm-network","xml":"<for index='network-role-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network_length`' >\n","comments":"","outputs":1,"x":754.9761867523193,"y":4515.976043701172,"z":"ad4f7469.49c2a8","wires":[["adf6a01c.1b1ad"]]},{"id":"de8ff6ff.f183e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No vf-module found in AAI for vf module ID ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-id`\" />\n","comments":"","x":1564.9762382507324,"y":4571.642075538635,"z":"ad4f7469.49c2a8","wires":[]},{"id":"612eb2e7.bad24c","type":"set","name":"set ip-version 6, use-dhcp, and ip-count","xml":"<set>\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].ip-version'\n   value='6' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].use-dhcp'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-use-dhcp`' />\n<parameter name='tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$network-information-index].ip-count'\n   value='`$db.vfc-to-network-role-mapping[$network-role-index].ipv6-count`' />\n","comments":"","x":1983.7857208251953,"y":2906.213849067688,"z":"ad4f7469.49c2a8","wires":[]},{"id":"a57e59a6.391a2","type":"switchNode","name":"switch use-dhcp","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].use-dhcp`'>\n","comments":"","outputs":1,"x":1649.500114440918,"y":3153.356598854065,"z":"ad4f7469.49c2a8","wires":[["c953239a.b0577"]]},{"id":"c953239a.b0577","type":"outcome","name":"N","xml":"<outcome value='N'>\n","comments":"","outputs":1,"x":1819.5000267028809,"y":3151.928201675415,"z":"ad4f7469.49c2a8","wires":[["e0282680.33064"]]},{"id":"fa091132.d6318","type":"switchNode","name":"switch use-dhcp","xml":"<switch test='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].use-dhcp`'>\n","comments":"","outputs":1,"x":1256.642837524414,"y":4242.642521858215,"z":"ad4f7469.49c2a8","wires":[["fd59fbd.c1c4408"]]},{"id":"fd59fbd.c1c4408","type":"outcome","name":"N","xml":"<outcome value='N'>\n","comments":"","outputs":1,"x":1426.642749786377,"y":4241.214124679565,"z":"ad4f7469.49c2a8","wires":[["69d696de.43ab7"]]},{"id":"bab04b4d.2861a","type":"for","name":"for each vm-type","xml":"<for index='vm-type-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":543.309455871582,"y":4647.642714500427,"z":"ad4f7469.49c2a8","wires":[["4af60c1a.06b574"]]},{"id":"4af60c1a.06b574","type":"for","name":"for each vm","xml":"<for index='vm-index' start='0' end='`$tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-count`' >\n","comments":"","outputs":1,"x":738.3094863891602,"y":4646.975722312927,"z":"ad4f7469.49c2a8","wires":[["91db1162.e79ad8"]]},{"id":"4483b686.756708","type":"save","name":"save VIPR_CONFIGURATION","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource\" resource=\"SQL\"\nkey=\"INSERT INTO VIPR_CONFIGURATION (vnf_id, vnf_name, ecomp_service_instance_id, vm_name, cloud_region_id, cloud_owner) VALUES ( $service-data.vnfs.vnf[$vnf-index].vnf-id , $service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name , $service-data.service-information.service-instance-id , $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name[$vm-index] , $tmp.vf-module-topology.aic-cloud-region , 'CloudOwner')\" >","comments":"","outputs":1,"x":1129.976188659668,"y":4669.643372535706,"z":"ad4f7469.49c2a8","wires":[["1fcf0da.db4fc72"]]},{"id":"a3c161a.1bfcaa","type":"comment","name":"Not a failure","info":"","comments":"","x":1649.976089477539,"y":4669.643377304077,"z":"ad4f7469.49c2a8","wires":[]},{"id":"1fcf0da.db4fc72","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1339.976173400879,"y":4669.643522262573,"z":"ad4f7469.49c2a8","wires":[["335fc106.800ce6"]]},{"id":"335fc106.800ce6","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.vf-module-topology-operation-assign:REQID\"/>\n<parameter name=\"field3\" value=\"`$vf-module-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to insert VIPR_CONFIGURATION record\"/>\n","comments":"","outputs":1,"x":1483.3096160888672,"y":4669.643360137939,"z":"ad4f7469.49c2a8","wires":[[]]},{"id":"8bf8fed1.b6f798","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":2093.3094940185547,"y":3807.641947746277,"z":"ad4f7469.49c2a8","wires":[["d9d9bd65.bfbd"]]},{"id":"d9d9bd65.bfbd","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2380.6905364990234,"y":3805.4993686676025,"z":"ad4f7469.49c2a8","wires":[["cf1efa03.31986"]]},{"id":"d5c86b17.cebc68","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='EIPAM_CLIENT_KEY_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vnf_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='CLIENT_KEY' />\n<parameter name='generate-unique-name-input.prefix' value=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-topology.vnf-topology-identifier-structure.vnf-name + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].nfc-naming-code + ':' + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-id + ':' + $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-networks.vm-network[$network-role-index].network-information-items.network-information-item[$ip-version-index].ip-version + ':'`\" />\n<parameter name='generate-unique-name-input.index-length' value='' />\n","comments":"","x":2046.6428260803223,"y":3762.6421089172363,"z":"ad4f7469.49c2a8","wires":[]},{"id":"cf1efa03.31986","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":2548.547649383545,"y":3804.9278802871704,"z":"ad4f7469.49c2a8","wires":[]},{"id":"6cff934b.2fbad4","type":"switchNode","name":"switch ecomp-generated-naming == 'Y'","xml":"<switch test=\"$db.vfc-model.ecomp-generated-naming == 'Y'\">\n","comments":"","outputs":1,"x":1023.3095626831055,"y":2069.309280395508,"z":"ad4f7469.49c2a8","wires":[["829a1798.2de68"]]},{"id":"829a1798.2de68","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":1254.976173400879,"y":2068.3089113235474,"z":"ad4f7469.49c2a8","wires":[["f2838907.3f253"]]},{"id":"f2838907.3f253","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'ECOMP generated naming is not Y for VFC customization UUID ' + $db.vf-module-to-vfc-mapping[$db-vm-index].vfc_customization_uuid`\" />\n","comments":"","x":1401.6429138183594,"y":2067.6423664093018,"z":"ad4f7469.49c2a8","wires":[]},{"id":"9a4ae22d.aa76a8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1513.3097381591797,"y":4620.975073814392,"z":"ad4f7469.49c2a8","wires":[["5f010e42.46bf4"]]},{"id":"18954655.76e10a","type":"comment","name":"Not a failure","info":"","comments":"","x":1836.6427917480469,"y":4619.308896064758,"z":"ad4f7469.49c2a8","wires":[]},{"id":"5f010e42.46bf4","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.vf-module-topology-operation-assign:REQID\"/>\n<parameter name=\"field3\" value=\"`$vf-module-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to insert VIPR_CONFIGURATION record\"/>\n","comments":"","outputs":1,"x":1659.3096733093262,"y":4620.975707054138,"z":"ad4f7469.49c2a8","wires":[[]]},{"id":"91db1162.e79ad8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":906.642879486084,"y":4645.975566864014,"z":"ad4f7469.49c2a8","wires":[["f561879.462ac78","4483b686.756708"]]},{"id":"f561879.462ac78","type":"delete","name":"delete any pre-existing records in VIPR_CONFIGURATION","xml":"<delete plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='DELETE from VIPR_CONFIGURATION WHERE vnf_id = $service-data.vnfs.vnf[$vnf-index].vnf-id\n     AND ecomp_service_instance_id = $service-data.service-information.service-instance-id\n     AND vm_name = $tmp.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name[$vm-index]' >","comments":"","outputs":1,"x":1219.976203918457,"y":4621.309706687927,"z":"ad4f7469.49c2a8","wires":[["9a4ae22d.aa76a8"]]},{"id":"afddae56.828be","type":"update","name":"update EIPAM_IP_ASSIGNMENTS to PENDING_DELETE...","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource\" resource=\"SQL\"\nkey=\"UPDATE EIPAM_IP_ASSIGNMENTS set status = $tmp.status WHERE info = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-topology-identifier.vf-module-id\" >","comments":"","outputs":1,"x":2926.6429481506348,"y":4257.64261007309,"z":"ad4f7469.49c2a8","wires":[["e4d2ee58.6736d8"]]},{"id":"c42ea598.5d64f8","type":"set","name":"set status variable","xml":"<set>\n<parameter name='tmp.status' value=\"`'PENDING_DELETE_' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-topology-identifier.vf-module-id`\" />\n","comments":"","x":2796.642910003662,"y":4210.9759821891785,"z":"ad4f7469.49c2a8","wires":[]},{"id":"e4d2ee58.6736d8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3231.6428565979004,"y":4255.97590970993,"z":"ad4f7469.49c2a8","wires":[["8f3d7831.efdbc"]]},{"id":"8f3d7831.efdbc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating EIPAM_IP_ASSIGNMENTS table on rollback\" />\n","comments":"","x":3421.6428833007812,"y":4255.785645008087,"z":"ad4f7469.49c2a8","wires":[]},{"id":"bc2b9a78.b25728","type":"execute","name":"execute EIPAM unassign IP addresses","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"unassignIPAddress\">\n<parameter name=\"deleteEIPAM_status\" value=\"`$tmp.status`\" />\n","comments":"","outputs":1,"x":2861.6429176330566,"y":4302.642653942108,"z":"ad4f7469.49c2a8","wires":[["279f8406.48a924"]]},{"id":"279f8406.48a924","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3098.309543609619,"y":4302.642596721649,"z":"ad4f7469.49c2a8","wires":[["61f42001.daff28"]]},{"id":"61f42001.daff28","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in EIPAM unassign IP address on rollback\" />\n","comments":"","x":3288.3095703125,"y":4302.452332019806,"z":"ad4f7469.49c2a8","wires":[]},{"id":"59f6c99f.1f66f","type":"comment","name":"roll back EIPAM","info":"","comments":"","x":2771.6429481506348,"y":4157.642935593923,"z":"ad4f7469.49c2a8","wires":[]},{"id":"9c1500a.5cc72","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2603.3095741271973,"y":4260.97610616684,"z":"ad4f7469.49c2a8","wires":[["c42ea598.5d64f8","afddae56.828be","bc2b9a78.b25728"]]},{"id":"205dbf73.505ec8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":871.6428985595703,"y":4353.975544929504,"z":"ad4f7469.49c2a8","wires":[["1a55576d.ac9d41","1f1dcc69.b57e6c"]]},{"id":"1c8d0c38.f49544","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":876.6428375244141,"y":4416.641888618469,"z":"ad4f7469.49c2a8","wires":[["f4f507ab.82e9a8","1f1dcc69.b57e6c"]]},{"id":"cc2e8ba4.5b6b28","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1396.6428146362305,"y":4476.641909599304,"z":"ad4f7469.49c2a8","wires":[["1c833009.7da008","1f1dcc69.b57e6c"]]},{"id":"41ceb0bb.02ccd","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1391.642734527588,"y":4554.641750335693,"z":"ad4f7469.49c2a8","wires":[["de8ff6ff.f183e","1f1dcc69.b57e6c"]]},{"id":"b1d93dfc.ff4fd8","type":"set","name":"set vf-module-to-vfc-mapping length to 0","xml":"<set>\n<parameter name='db.vf-module-to-vfc-mapping_length' value='0' />\n","comments":"","x":1170.500099182129,"y":1902.9280138015747,"z":"ad4f7469.49c2a8","wires":[]},{"id":"977486e8.baed78","type":"set","name":"set vfc-to-network-role-mapping length to 0","xml":"<set>\n<parameter name='db.vfc-to-network-role-mapping_length' value='0' />\n","comments":"","x":1623.7857818603516,"y":2381.9280395507812,"z":"ad4f7469.49c2a8","wires":[]},{"id":"dcfef0d0.fa5a","type":"switchNode","name":"switch plans-index > 0","xml":"<switch test='`$plans-index &gt; 0`'>\n","comments":"","outputs":1,"x":559.5000762939453,"y":4133.356512069702,"z":"ad4f7469.49c2a8","wires":[["d20cf7ae.adcb98"]]},{"id":"d20cf7ae.adcb98","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":742.3572158813477,"y":4133.356721878052,"z":"ad4f7469.49c2a8","wires":[["f19811af.40dd68"]]},{"id":"1f1dcc69.b57e6c","type":"switchNode","name":"switch plans-index > 0","xml":"<switch test='`$plans-index &gt; 0`'>\n","comments":"","outputs":1,"x":2250.6665000915527,"y":4260.261742115021,"z":"ad4f7469.49c2a8","wires":[["f4f4f195.0a7fd"]]},{"id":"f4f4f195.0a7fd","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2433.523639678955,"y":4260.26195192337,"z":"ad4f7469.49c2a8","wires":[["9c1500a.5cc72"]]},{"id":"8c0907cb.ccd0c8","type":"set","name":"set service-type","xml":"<set>\n<parameter name='service-data.service-information.service-type' value='`$service-data.service-information.subscription-service-type`' />\n","comments":"EIPAM plug-in needs this attribute set with this name","x":539.6666145324707,"y":4086.92791557312,"z":"ad4f7469.49c2a8","wires":[]},{"id":"5893fa6e.599bb4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n","comments":"","x":278,"y":4844.749938964844,"z":"ad4f7469.49c2a8","wires":[]},{"id":"ea19ca91.58f44","type":"comment","name":"Fix $ in value","info":"","comments":"","x":783.7499465942383,"y":4850.000087738037,"z":"ad4f7469.49c2a8","wires":[]},{"id":"8820ab5f.0af608","type":"call","name":"call check for VNF-API-preload and copy","xml":"<call module='GENERIC-RESOURCE-API' rpc='gw-vfmodule-update' mode='sync' >\n","comments":"","outputs":1,"x":613.1668701171875,"y":4956.9169921875,"z":"ad4f7469.49c2a8","wires":[[]]}]