[
    {
        "id": "66573054.d6959",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 230,
        "y": 62,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "88fd1149.f833f"
            ]
        ]
    },
    {
        "id": "88fd1149.f833f",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 514.2856903076172,
        "y": 123.23810863494873,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "4c164ab.c48bfb4"
            ]
        ]
    },
    {
        "id": "4c164ab.c48bfb4",
        "type": "method",
        "name": "method cll-vnf-topology-operation-cll-F1",
        "xml": "<method rpc='cll-vnf-topology-operation-cll-F1' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 430.4285888671875,
        "y": 201.00003051757812,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "e2c1e393.f72a2"
            ]
        ]
    },
    {
        "id": "e2c1e393.f72a2",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 164.238037109375,
        "y": 704.6666870117188,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "35872244.0dadfe",
                "76353aba.1a1834",
                "1a3db60a.42601a",
                "cde65043.1c4f8",
                "5f4f339e.018654",
                "6f21b0a4.c1ba8",
                "19956ea.f245091"
            ]
        ]
    },
    {
        "id": "35872244.0dadfe",
        "type": "set",
        "name": "set query_param",
        "xml": "<set>\n<parameter name='prop.ethsrvType' value='`$network-route-A`' />\n\n",
        "comments": "",
        "x": 437,
        "y": 659,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "76353aba.1a1834",
        "type": "call",
        "name": "call GENERIC-RESOURCE-API:tsli-vnf-topology-operation-get-otn-tunnel-path-from-oof",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='tsli-vnf-topology-operation-get-otn-tunnel-path-from-oof' mode='sync' >\n\n",
        "comments": "",
        "outputs": 1,
        "x": 658,
        "y": 727,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "1a3db60a.42601a",
        "type": "execute",
        "name": "execute printContext",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='printContext' >\n    <parameter name=\"filename\" value=\"`$filenamemm`\" />\n",
        "comments": "",
        "outputs": 1,
        "x": 448,
        "y": 773,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "19956ea.f245091",
        "type": "call",
        "name": "call GENERIC-RESOURCE-API:cll-vnf-topology-operation-find-maximum-used-tpn",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='cll-vnf-topology-operation-find-maximum-used-tpn' mode='sync' >\n\n",
        "comments": "",
        "outputs": 1,
        "x": 641,
        "y": 837,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "cde65043.1c4f8",
        "type": "for",
        "name": "for vidx..tmp.otninfo_length[]",
        "xml": "<for index='otnidx' start='0' end='`$tmp.otninfo_length`' >",
        "comments": "",
        "outputs": 1,
        "x": 468,
        "y": 993,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "53111f1b.5dbab"
            ]
        ]
    },
    {
        "id": "53111f1b.5dbab",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic='true'>",
        "atomic": "true",
        "comments": "",
        "outputs": 1,
        "x": 737,
        "y": 993,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "78857b79.cfe234",
                "b3432980.49ee6",
                "233e999f.144d9e",
                "7a85fbed.abf844",
                "715b7a53.d039d4",
                "13d7f319.f10ffd",
                "fe43d4e7.2e266",
                "9673bbc9.e232d8",
                "8c1ff0ec.d0238",
                "84f3d24d.36c17"
            ]
        ]
    },
    {
        "id": "78857b79.cfe234",
        "type": "execute",
        "name": "execute UUID generator for vpn-binding $otnidx",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vpn-binding-otnidx-uuid\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1630,
        "y": 807,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "b3432980.49ee6",
        "type": "switchNode",
        "name": "switch dstPort == NULL",
        "xml": "<switch test=\"`$tmp.otninfo[$otnidx].dstPort.dst-access-provider-id == ''`\">\n\n",
        "comments": "",
        "outputs": 1,
        "x": 1344,
        "y": 897,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "fb6a4667.5dee4",
                "8968ad13.112c48"
            ]
        ]
    },
    {
        "id": "fb6a4667.5dee4",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1710,
        "y": 858,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "38cd80d0.a81b08"
            ]
        ]
    },
    {
        "id": "8968ad13.112c48",
        "type": "outcomeFalse",
        "name": "false",
        "xml": "<outcome value='false'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1711,
        "y": 904,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "12ac055c.676cf3"
            ]
        ]
    },
    {
        "id": "38cd80d0.a81b08",
        "type": "set",
        "name": "set access-provider-id and client-id",
        "xml": "<set>\n<parameter name='tmp.access-provider-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-provider-id`' />\n<parameter name='tmp.access-client-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-client-id`' />\n<parameter name='tmp.access-topology-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-topology-id`' />\n<parameter name='tmp.srcdstpnf-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-node-id`' />\n",
        "comments": "",
        "x": 1924,
        "y": 857,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "12ac055c.676cf3",
        "type": "set",
        "name": "set access-provider-id and client-id",
        "xml": "<set>\n<parameter name='tmp.access-provider-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-provider-id`' />\n<parameter name='tmp.access-client-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-client-id`' />\n<parameter name='tmp.access-topology-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-topology-id`' />\n<parameter name='tmp.srcdstpnf-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-node-id`' />\n",
        "comments": "",
        "x": 1922,
        "y": 902,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "233e999f.144d9e",
        "type": "set",
        "name": "set srcdstpnf-name",
        "xml": "<set>\n<parameter name='tmp.srcdstpnf-name' value=\"`'networkId-providerId-' + \n                                             $tmp.access-provider-id + '-clientId-' +\n                                             $tmp.access-client-id + '-topologyId-' + \n                                             $tmp.access-topology-id + '-nodeId-' + \n                                             $tmp.srcdstpnf-id`\" />\n\n",
        "comments": "",
        "x": 1520,
        "y": 971,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "7a85fbed.abf844",
        "type": "get-resource",
        "name": "get-resource tmp.srcdstpnf-name",
        "xml": "<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"pnf\" \n\t\tkey=\"pnf.pnf-name = $tmp.srcdstpnf-name\"\n        pfx='tmp.aai.srcdst-pnf' local-only='false' >\n\n        <!--AND depth = '0'\"-->\n",
        "comments": "",
        "outputs": 1,
        "x": 1564,
        "y": 1019,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "85cf2b2f.efe2d8",
                "40c18c0.1c43574",
                "e3b12e57.7afb78"
            ]
        ]
    },
    {
        "id": "85cf2b2f.efe2d8",
        "type": "success",
        "name": "success",
        "xml": "<outcome value='success'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1776.5,
        "y": 966,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "7b23fddb.009994"
            ]
        ]
    },
    {
        "id": "40c18c0.1c43574",
        "type": "not-found",
        "name": "not-found",
        "xml": "<outcome value='not-found'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1788.5,
        "y": 1016,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "317c3552.8ea652"
            ]
        ]
    },
    {
        "id": "e3b12e57.7afb78",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1779.5,
        "y": 1071,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "c0e357e5.8168d8"
            ]
        ]
    },
    {
        "id": "c0e357e5.8168d8",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unexpected error occurred while querying pnf from AnAI with pnf-name = ' + $prop.connection-attachement.access-node-id`\" />\n\n",
        "comments": "",
        "x": 1924.5,
        "y": 1070,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "317c3552.8ea652",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'An error occurred while querying pnf from AnAI with pnf-name = ' + $prop.connection-attachement.access-node-id`\" />\n\n",
        "comments": "",
        "x": 1935.5,
        "y": 1013,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "7b23fddb.009994",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1901.8824462890625,
        "y": 959.6556701660156,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "f3d54fb4.5c0a1"
            ]
        ]
    },
    {
        "id": "f3d54fb4.5c0a1",
        "type": "for",
        "name": "for each relationship",
        "xml": "<for silentFailure='true' index='spvidx' start='0' end='`$tmp.aai.srcdst-pnf.relationship-list.relationship_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 2063,
        "y": 974,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "763118b6.61e2b8"
            ]
        ]
    },
    {
        "id": "763118b6.61e2b8",
        "type": "switchNode",
        "name": "switch related-to",
        "xml": "<switch test='`$tmp.aai.srcdst-pnf.relationship-list.relationship[$spvidx].related-to`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2258,
        "y": 974,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "45a9ec7c.a92c4c"
            ]
        ]
    },
    {
        "id": "6fd0244b.f38ce4",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 2638,
        "y": 970,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "e527c2f.df2fcc",
                "56d60802.89ee28"
            ]
        ]
    },
    {
        "id": "56d60802.89ee28",
        "type": "execute",
        "name": "get esr-thirdparty-sdnc",
        "xml": "<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"esr-thirdparty-sdnc\" \n\t\tkey=\"esr-thirdparty-sdnc.thirdparty-sdnc-id = $tmp.domainG.esr-thirdparty-id AND \n\t\t     depth = '1'\"\n        pfx='tmp.aai.domainG.esr-thirdparty-sdnc' local-only='false' >",
        "comments": "",
        "outputs": 1,
        "x": 2846,
        "y": 977,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "b854345d.faf84",
                "437ea2b.b00f35c",
                "fed3318a.a11e3"
            ]
        ]
    },
    {
        "id": "e527c2f.df2fcc",
        "type": "set",
        "name": "set esr-thirdparty-sdnc domainG id",
        "xml": "<set>\n<parameter name='tmp.domainG.esr-thirdparty-id' value=\"`$tmp.aai.srcdst-pnf.relationship-list.relationship[$spvidx].relationship-data[0].relationship-value`\" />\n",
        "comments": "",
        "x": 2876,
        "y": 925,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "b854345d.faf84",
        "type": "success",
        "name": "success",
        "xml": "<outcome value='success'>\n",
        "comments": "",
        "outputs": 1,
        "x": 3056,
        "y": 968,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "918d39ea.cf7f2"
            ]
        ]
    },
    {
        "id": "437ea2b.b00f35c",
        "type": "not-found",
        "name": "not-found",
        "xml": "<outcome value='not-found'>\n",
        "comments": "",
        "outputs": 1,
        "x": 3048,
        "y": 1023,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "1afabba1.4179cc"
            ]
        ]
    },
    {
        "id": "fed3318a.a11e3",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 3053,
        "y": 1080,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "e095e0e5.375ba"
            ]
        ]
    },
    {
        "id": "e095e0e5.375ba",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unexpected error occurred while querying pnf from AnAI with pnf-name = ' + $prop.connection-attachement.access-node-id`\" />\n\n",
        "comments": "",
        "x": 3205,
        "y": 1081,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "1afabba1.4179cc",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'An error occurred while querying pnf from AnAI with pnf-name = ' + $prop.connection-attachement.access-node-id`\" />\n\n",
        "comments": "",
        "x": 3216,
        "y": 1026,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "918d39ea.cf7f2",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 3200.38232421875,
        "y": 965.6556701660156,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "47a021ef.066c88"
            ]
        ]
    },
    {
        "id": "45a9ec7c.a92c4c",
        "type": "outcome",
        "name": "esr-thirdparty-sdnc",
        "xml": "<outcome value='esr-thirdparty-sdnc'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2461,
        "y": 978,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "6fd0244b.f38ce4"
            ]
        ]
    },
    {
        "id": "47a021ef.066c88",
        "type": "set",
        "name": "set controller domainA data",
        "xml": "<set>\n<parameter name='prop.sdncRestApi.thirdpartySdnc.domainG.url' value=\"`$tmp.aai.domainG.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].service-url`\" />\n<parameter name='prop.sdncRestApi.thirdpartySdnc.domainG.user' value=\"`$tmp.aai.domainG.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].user-name`\" />\n<parameter name='prop.sdncRestApi.thirdpartySdnc.domainG.password' value=\"`$tmp.aai.domainG.esr-thirdparty-sdnc.esr-system-info-list.esr-system-info[0].password`\" />\n\n\n<!--<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >-->\n<!--<parameter name=\"restapiUrl\" value=\"`$prop.sdncRestApi.thirdpartySdnc.url + '/restconf/data/ietf-network:networks'`\" />-->\n<!--<parameter name=\"restapiUser\" value=\"`$prop.sdncRestApi.thirdpartySdnc.user`\" />-->\n<!--<parameter name=\"restapiPassword\" value=\"`$prop.sdncRestApi.thirdpartySdnc.password`\" />-->\n<!--<parameter name=\"format\" value=\"json\"/>-->\n<!--<parameter name=\"httpMethod\" value=\"get\"/>-->\n<!--<parameter name=\"responsePrefix\" value=\"topology\"/>-->\n<!--<parameter name=\"trustStoreFileName\" value=\"/opt/onap/sdnc/data/stores/truststore.onap.client.jks\"/>-->\n<!--<parameter name=\"trustStorePassword\" value=\"adminadmin\"/>-->\n<!--<parameter name=\"keyStoreFileName\" value=\"/opt/onap/sdnc/data/stores/sdnc.p12\"/>-->\n<!--<parameter name=\"keyStorePassword\" value=\"adminadmin\"/>-->\n",
        "comments": "",
        "x": 3415,
        "y": 962,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "715b7a53.d039d4",
        "type": "switchNode",
        "name": "switch dmnsidx == 0 (domainA)",
        "xml": "<switch test='`$otnidx == 0`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1534,
        "y": 1188,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "f53c2621.eb9438",
                "1c719c21.ec9b04"
            ]
        ]
    },
    {
        "id": "f53c2621.eb9438",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1735,
        "y": 1186,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "39a7b2e1.a50fbe"
            ]
        ]
    },
    {
        "id": "b0d2a923.51103",
        "type": "set",
        "name": "set pce-src-node",
        "xml": "<set>\n<parameter name='tmp.pce-src-node' value='`$tmp.srcdstpnf-name`' />",
        "comments": "",
        "x": 2016,
        "y": 1136,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "c9652673.c83de8",
        "type": "switchNode",
        "name": "switch dmnsidx == last (domainB)",
        "xml": "<switch test='`$otnidx == $tmp.otninfo_length - 1`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1952,
        "y": 1237,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "ab876b76.0d0a8",
                "2a964a93.a3cb96"
            ]
        ]
    },
    {
        "id": "ab876b76.0d0a8",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2182,
        "y": 1233,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "62dd94dd.71b75c"
            ]
        ]
    },
    {
        "id": "1c719c21.ec9b04",
        "type": "outcomeFalse",
        "name": "false",
        "xml": "<outcome value='false'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1735,
        "y": 1235,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "c9652673.c83de8"
            ]
        ]
    },
    {
        "id": "2a964a93.a3cb96",
        "type": "outcomeFalse",
        "name": "false",
        "xml": "<outcome value='false'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2183,
        "y": 1279,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "1f38645a.fd2454"
            ]
        ]
    },
    {
        "id": "1f38645a.fd2454",
        "type": "set",
        "name": "set attachment_param domain G",
        "xml": "<set>\n<parameter name='tmp.domainG-src-access-node-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-node-id`' />\n<parameter name='tmp.domainG-dst-access-node-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-node-id`' />",
        "comments": "",
        "x": 2397,
        "y": 1279,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "ada84f30.11bba8",
        "type": "set",
        "name": "set attachment_param domain A",
        "xml": "<set>\n<parameter name='tmp.domainG-src-access-node-id' value='`$param-prefix-domainA[$param-prefix-domainA_length -3]`' />\n<parameter name='tmp.domainG-dst-access-node-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-node-id`' />",
        "comments": "",
        "x": 2071,
        "y": 1183,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "39a7b2e1.a50fbe",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1859,
        "y": 1177,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "ada84f30.11bba8"
            ]
        ]
    },
    {
        "id": "62dd94dd.71b75c",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 2315,
        "y": 1209,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "c86a8489.80e7c"
            ]
        ]
    },
    {
        "id": "dce0c80a.efad",
        "type": "set",
        "name": "set pce-src-node",
        "xml": "<set>\n<parameter name='tmp.pce-dst-node' value='`$tmp.srcdstpnf-name`' />",
        "comments": "",
        "x": 2471,
        "y": 1225,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "c86a8489.80e7c",
        "type": "set",
        "name": "set attachment_param domain B",
        "xml": "<set>\n<parameter name='tmp.domainG-src-access-node-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-node-id`' />\n<parameter name='tmp.domainG-dst-access-node-id' value='`$param-prefix-domainB[$param-prefix-domainB_length -3]`' />",
        "comments": "",
        "x": 2519,
        "y": 1177,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "6f21b0a4.c1ba8",
        "type": "set",
        "name": "unset parameters",
        "xml": "<set>\n<parameter name='domain-A.tunnel-tp-id' value='' />\n<parameter name='domain-A.node-id' value='' />\n<parameter name='domain-A.network-id' value=\"\" />\n<parameter name='domain-A.provider-id' value=\"\" />\n<parameter name='domain-A.client-id' value=\"\" />\n<parameter name='domain-A.te-topo-id' value=\"\" />\n<parameter name='domain-A.network-type' value=\"\" />\n<parameter name='domain-A.ltpId' value=\"\" />\n<parameter name='tmp.domain-A.network-id' value=\"\" />\n<parameter name='tmp.domain-A.ttp-id' value=\"\" />\n<parameter name='network-route-A' value=\"\" />\n<!--<parameter name='domain-A.' value=\"\" />-->\n\n<parameter name='request-id' value='' />\n<parameter name='otn-source-node' value='' />\n<parameter name='otn-dest-node' value='' />\n<parameter name='bw-odu' value=\"\" />\n<parameter name='src-ttp-id' value='' />\n<parameter name='dst-ttp-id' value='' />\n\n<parameter name='domain-B.tunnel-tp-id' value='' />\n<parameter name='domain-B.node-id' value='' />\n<parameter name='domain-B.network-id' value=\"\" />\n<parameter name='domain-B.provider-id' value=\"\" />\n<parameter name='domain-B.client-id' value=\"\" />\n<parameter name='domain-B.te-topo-id' value=\"\" />\n<parameter name='domain-B.network-type' value=\"\" />\n<parameter name='domain-B.ltpId' value=\"\" />\n<parameter name='tmp.domain-B.network-id' value=\"\" />\n<parameter name='tmp.domain-B.ttp-id' value=\"\" />\n<parameter name='network-route-B' value=\"\" />\n<!--<parameter name='domain-B.' value=\"\" />-->\n\n\n\n\n\n",
        "comments": "",
        "x": 404,
        "y": 2903,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "5f4f339e.018654",
        "type": "set",
        "name": "set srcTtp OTN layer",
        "xml": "<set>\n<!--<parameter name='tmp.srcTtpOtnLayer' value=\"`$tmp.pce-src-node + '-' + -->\n<!--                                             $param-prefix-domainA[$param-prefix-domainA_length -2] + '-' +-->\n<!--                                             $tmp.source.ttp-id`\" />-->\n\n<parameter name='tmp.srcTtpOtnLayer' value=\"`$tmp.pce-src-node`\" />\n\n\n",
        "comments": "",
        "x": 445,
        "y": 915,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "13d7f319.f10ffd",
        "type": "set",
        "name": "set srcTtp+dstTtp pair",
        "xml": "<set>\n<parameter name='tmp.srcTtpdstTtpPair' value=\"`$tmp.otninfo[$otnidx].srcPort.src-tunnel-tp-id + ',' +\n                                               $tmp.otninfo[$otnidx].dstPort.dst-tunnel-tp-id`\" />\n\n\n",
        "comments": "",
        "x": 1510,
        "y": 1268,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "9673bbc9.e232d8",
        "type": "call",
        "name": "call GENERIC-RESOURCE-API:cll-vnf-topology-operation-cll-helper-find-connectivity",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='cll-vnf-topology-operation-cll-helper-find-connectivity' mode='sync' >\n\n",
        "comments": "",
        "outputs": 1,
        "x": 1703,
        "y": 1365,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "fe43d4e7.2e266",
        "type": "set",
        "name": "set current-provider-id and current-cvlan-id",
        "xml": "<set>\n<parameter name='tmp.current-provider-id' value='`$tmp.access-provider-id`' />\n<parameter name='tmp.current-cvlan-id' value='`$tmp.aai.network-route-A.logical-interface-id`' />\n\n",
        "comments": "",
        "x": 1574,
        "y": 1319,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "8c1ff0ec.d0238",
        "type": "switchNode",
        "name": "switch found-connectivity?",
        "xml": "\n<switch test=\"`$found-connectivity`\">\n\n",
        "comments": "",
        "outputs": 1,
        "x": 1383,
        "y": 1520,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "43f2090.27bb178",
                "78a0670.cf2d998"
            ]
        ]
    },
    {
        "id": "43f2090.27bb178",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1669,
        "y": 2339,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "c80f5b2c.e8799"
            ]
        ]
    },
    {
        "id": "340621d.c4a9c5e",
        "type": "comment",
        "name": "call string.contains to check if the cache has srcTtpdstTtpPair",
        "info": "if it had: then no new otn/vpn-binding is needed\n           ==> find the otn. ==>look into the relationships of this connectivity and find the one that has same srcTtp and dstTtp\n           ==> increase the bw\nif not, create a new vpn-binding, attach this vpn-binding into the founded connectivity, and attach it to the middle-man-conn as well.",
        "comments": "",
        "x": 2095,
        "y": 2284,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "b5382f7e.2bd898",
        "type": "comment",
        "name": "create a new connectivity",
        "info": "(this should not be for LEAF side or ROOT side, otherwise error)\n\ncreate a new vpn-binding (done here)\ncreate a new connectivity (done below)\nadd srcTtpdstTtpPair into the cache in this connectivity\nattach the vpn-binding into the connectivity relationship\nattach this connectivity into the middle man\nattach this connectivity into the service-instance",
        "comments": "",
        "x": 1906,
        "y": 1496,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "be6ceee2.825c9",
        "type": "save",
        "name": "save vpn-binding otnIdx resource (aka. OTN) in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='vpn-binding' \n      key='vpn-binding.vpn-id = $prop.vpn-binding-otnidx-uuid' >\n<parameter name='vpn-id' value='`$prop.vpn-binding-otnidx-uuid`' />\n<parameter name='vpn-name' value='`$prop.otn-tunnel-name`' />\n<!--<parameter name='customer-vpn-id' value='`($idx + 1) * 10`' />-->\n<!--<parameter name='customer-vpn-id' value='`($maxtpn + $gfp)`' />-->\n<parameter name='customer-vpn-id' value='`$newToBeUsedMaxtpn`' />\n<!--<parameter name='access-provider-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-provider-id`' />-->\n<parameter name='access-provider-id' value='`$tmp.access-provider-id`' />\n<!--<parameter name='access-client-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-client-id`' />-->\n<parameter name='access-client-id' value='`$tmp.access-client-id`' />\n<!--<parameter name='access-topology-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-topology-id`' />-->\n<parameter name='access-topology-id' value='`$tmp.access-topology-id`' />\n<!--<parameter name='src-access-node-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-node-id`' />-->\n<parameter name='src-access-node-id' value='`$tmp.domainG-src-access-node-id`' />\n<parameter name='src-access-ltp-id' value='`$tmp.otninfo[$otnidx].srcPort.src-tunnel-tp-id`' />\n<!--<parameter name='dst-access-node-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-node-id`' />-->\n<parameter name='dst-access-node-id' value='`$tmp.domainG-dst-access-node-id`' />\n<parameter name='dst-access-ltp-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-tunnel-tp-id`' />\n<parameter name='route-distinguisher' value='`$gfp`' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-uuid`' />\n\n\n<parameter name='vpn-region' value='`$prop.sdncRestApi.thirdpartySdnc.domainG.url`' />\n<parameter name='vpn-description' value='`$prop.sdncRestApi.thirdpartySdnc.domainG.user`' />\n<parameter name='vpn-platform' value='`$prop.sdncRestApi.thirdpartySdnc.domainG.password`' />\n\n<!-- The following line is in lieu of vpn-binding.slice-id (new attribute in latest AAI) -->\n<!--<parameter name='ops-note' value='`$tmp.aai.service-instance.service-instance-id`' />-->\n<parameter name='slice-id' value='`$tmp.aai.service-instance.service-instance-id`' />\n<parameter name='ops-note' value='`$tmp.srcTtpOtnLayer`' />\n\n",
        "comments": "",
        "outputs": 1,
        "x": 2009,
        "y": 1532,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "cf21392c.4841d8"
            ]
        ]
    },
    {
        "id": "cf21392c.4841d8",
        "type": "success",
        "name": "success",
        "xml": "<outcome value='success'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2297,
        "y": 1533,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "7f292268.acccbc"
            ]
        ]
    },
    {
        "id": "7f292268.acccbc",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 2480.5,
        "y": 1531.25390625,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "16c5a50f.2f8633",
        "type": "execute",
        "name": "execute string.contains srcTtpdstTtpPair",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='contains' >\n<parameter name=\"source\" value='`$tmp.the-connectivity.coupling-flag`'/>\n<parameter name=\"target\" value=\"`$tmp.srcTtpdstTtpPair`\"/>\n\n",
        "comments": "",
        "outputs": 1,
        "x": 2083,
        "y": 2336,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "452b77d1.b4f2a8",
                "b1806606.25c148"
            ]
        ]
    },
    {
        "id": "452b77d1.b4f2a8",
        "type": "outcomeFalse",
        "name": "false",
        "xml": "<outcome value='false'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2256,
        "y": 2184,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "b1806606.25c148",
        "type": "outcomeFalse",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2288,
        "y": 2443,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "28b98f8a.d66ba8"
            ]
        ]
    },
    {
        "id": "65dfad8a.1bcc14",
        "type": "save",
        "name": "save vpn-binding otnIdx resource (aka. OTN) in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='vpn-binding' \n      key='vpn-binding.vpn-id = $prop.vpn-binding-otnidx-uuid' >\n<parameter name='vpn-id' value='`$prop.vpn-binding-otnidx-uuid`' />\n<parameter name='vpn-name' value='`$prop.otn-tunnel-name`' />\n<!--<parameter name='customer-vpn-id' value='`($idx + 1) * 10`' />-->\n<!--<parameter name='customer-vpn-id' value='`($maxtpn + $gfp)`' />-->\n<parameter name='customer-vpn-id' value='`$newToBeUsedMaxtpn`' />\n<!--<parameter name='access-provider-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-provider-id`' />-->\n<parameter name='access-provider-id' value='`$tmp.access-provider-id`' />\n<!--<parameter name='access-client-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-client-id`' />-->\n<parameter name='access-client-id' value='`$tmp.access-client-id`' />\n<!--<parameter name='access-topology-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-topology-id`' />-->\n<parameter name='access-topology-id' value='`$tmp.access-topology-id`' />\n<!--<parameter name='src-access-node-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-node-id`' />-->\n<parameter name='src-access-node-id' value='`$tmp.domainG-src-access-node-id`' />\n<parameter name='src-access-ltp-id' value='`$tmp.otninfo[$otnidx].srcPort.src-tunnel-tp-id`' />\n<!--<parameter name='dst-access-node-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-node-id`' />-->\n<parameter name='dst-access-node-id' value='`$tmp.domainG-dst-access-node-id`' />\n<parameter name='dst-access-ltp-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-tunnel-tp-id`' />\n<parameter name='route-distinguisher' value='`$gfp`' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-uuid`' />\n\n\n<parameter name='vpn-region' value='`$prop.sdncRestApi.thirdpartySdnc.domainG.url`' />\n<parameter name='vpn-description' value='`$prop.sdncRestApi.thirdpartySdnc.domainG.user`' />\n<parameter name='vpn-platform' value='`$prop.sdncRestApi.thirdpartySdnc.domainG.password`' />\n\n<!-- The following line is in lieu of vpn-binding.slice-id (new attribute in latest AAI) -->\n<!--<parameter name='ops-note' value='`$tmp.aai.service-instance.service-instance-id`' />-->\n<parameter name='slice-id' value='`$tmp.aai.service-instance.service-instance-id`' />\n<parameter name='ops-note' value='`$tmp.srcTtpOtnLayer`' />\n\n",
        "comments": "",
        "outputs": 1,
        "x": 2695,
        "y": 1974,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "685af2d8.b662dc"
            ]
        ]
    },
    {
        "id": "685af2d8.b662dc",
        "type": "success",
        "name": "success",
        "xml": "<outcome value='success'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2999,
        "y": 1971,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "edef5d31.f27bb8"
            ]
        ]
    },
    {
        "id": "edef5d31.f27bb8",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 3149.5,
        "y": 1978.25390625,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "fca1e078.90281",
        "type": "execute",
        "name": "execute UUID generator for connectivity domain otnidx",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"uuid.connectivity-otnidx-uuid\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1989,
        "y": 1587,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "84e90fcb.be7ce",
        "type": "save",
        "name": "save connectivity resource in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='connectivity' \n      key='connectivity.connectivity-id = $uuid.connectivity-otnidx-uuid'>\n<parameter name='connectivity-id' value='`$uuid.connectivity-otnidx-uuid`' />\n<!--<parameter name='etht-svc-name' value='`$prop.ethernet-service-name`' />-->\n<parameter name='operational-status' value='Created' />\n<!--<parameter name='access-provider-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-provider-id`' />-->\n<!--<parameter name='access-client-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-client-id`' />-->\n<!--<parameter name='access-topology-id' value='`$tmp.otninfo[$otnidx].dstPort.dst-access-topology-id`' />-->\n<!--<parameter name='access-node-id' value='`$tmp.otninfo[$otnidx].srcPort.src-access-node-id`' />-->\n<!--<parameter name='access-ltp-id' value='``' />-->\n<parameter name='cvlan' value='`$tmp.aai.network-route-A.logical-interface-id`' />\n\n<parameter name='coupling-flag' value='`$srcTtpdstTtpPair`' />\n\n<!--<parameter name='bandwidth-profile-name' value='`$prop.sotn.etht-svc-name`' />-->\n<parameter name='bandwidth-profile-name' value='`$gfp`' />\n<parameter name='vpn-type' value='dummy' />\n<parameter name='cir' value='`$gfp *1000000`' />\n<parameter name='eir' value='`$gfp *1000000`' />\n<!--<parameter name='cbs' value='`$prop.sotn.cbs`' />-->\n<!--<parameter name='ebs' value='`$prop.sotn.ebs`' />-->\n<!--<parameter name='color-aware' value='`$prop.sotn.colorAware`' />-->\n\n<!--<parameter name='etht-svc-name' value='`$prop.sotn.etht-svc-name`' />-->\n<parameter name='model-customization-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$network-topology-operation-input.network-information.onap-model-information.model-uuid`' />\n<parameter name='connectivity-selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $network-topology-operation-input.service-information.service-instance-id  + '/service-data/networks/network/'  + $prop.sotn.network-id  + '/network-data/'` \" />\n",
        "comments": "",
        "outputs": 1,
        "x": 1927,
        "y": 1637,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "548a399a.3a9a1",
        "type": "save",
        "name": "save middle-man-conn relationship to connectivity-otnidx, in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='connectivity:relationship-list' \n      key='connectivity.connectivity-id = $middle-man-conn.connectivity-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"connectivity\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/connectivities/connectivity/' + $uuid.connectivity-otnidx-uuid`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"connectivity.connectivity-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$uuid.connectivity-otnidx-uuid`\" />",
        "comments": "",
        "outputs": 1,
        "x": 2028,
        "y": 1682,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "ea27a84e.a57e98",
        "type": "save",
        "name": "save TNNSSI (transport service instance) relationship to connectivity in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $vnf-topology-operation-input.service-information.service-instance-id\n         AND customer.global-customer-id = $vnf-topology-operation-input.service-information.global-customer-id \n         AND service-subscription.service-type = $vnf-topology-operation-input.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"connectivity\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/connectivities/connectivity/' + $uuid.connectivity-otnidx-uuid`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"connectivity.connectivity-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$uuid.connectivity-otnidx-uuid`\" />\n\n\n<!--<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' -->\n<!--      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id -->\n<!--         AND customer.global-customer-id = $service-data.networks.network[$nidx].network-data.service-information.global-customer-id -->\n<!--         AND service-subscription.service-type = $service-data.networks.network[$nidx].network-data.service-information.subscription-service-type' -->\n<!--      force=\"true\" pfx=\"tmp.AnAI-data\">-->\n<!--<parameter name=\"relationship-list.relationship[0].related-to\" value=\"connectivity\" />-->\n<!--<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/connectivities/connectivity/' + $prop.sotn.network-id`\" />-->\n<!--<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"connectivity.connectivity-id\" />-->\n<!--<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.sotn.network-id`\" />-->",
        "comments": "",
        "outputs": 1,
        "x": 2064,
        "y": 1736,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "688a1580.c26934",
        "type": "save",
        "name": "save connectivity-otnidx relationship to vpn-binding-otnidx, in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='vpn-binding:relationship-list' \n      key='vpn-binding.vpn-id = $prop.vpn-binding-otnidx-uuid' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"connectivity\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/connectivities/connectivity/' + $uuid.connectivity-otnidx-uuid`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"connectivity.connectivity-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$uuid.connectivity-otnidx-uuid`\" />",
        "comments": "",
        "outputs": 1,
        "x": 2032,
        "y": 1795,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "ab8e2668.029e08",
        "type": "comment",
        "name": "find middle-man's eth-srv-name",
        "info": "",
        "comments": "",
        "x": 1490,
        "y": 1411,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "84f3d24d.36c17",
        "type": "set",
        "name": "set prop.ethernet-service-name",
        "xml": "<set>\n<parameter name='prop.ethernet-service-name' value='`$middle-man-conn.etht-svc-name`' />\n\n",
        "comments": "",
        "x": 1512,
        "y": 1455,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "ae53151f.a2887",
        "type": "save",
        "name": "save middle-man-conn relationship to tmp.the-connectivity, in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='connectivity:relationship-list' \n      key='connectivity.connectivity-id = $middle-man-conn.connectivity-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"connectivity\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/connectivities/connectivity/' + $tmp.the-connectivity.connectivity-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"connectivity.connectivity-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.the-connectivity.connectivity-id`\" />",
        "comments": "",
        "outputs": 1,
        "x": 2719,
        "y": 2191,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "4e7cd680.120818",
        "type": "save",
        "name": "save TNNSSI (transport service instance) relationship to connectivity in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $vnf-topology-operation-input.service-information.service-instance-id\n         AND customer.global-customer-id = $vnf-topology-operation-input.service-information.global-customer-id \n         AND service-subscription.service-type = $vnf-topology-operation-input.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"connectivity\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/connectivities/connectivity/' + $uuid.connectivity-otnidx-uuid`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"connectivity.connectivity-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$uuid.connectivity-otnidx-uuid`\" />\n\n\n<!--<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' -->\n<!--      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id -->\n<!--         AND customer.global-customer-id = $service-data.networks.network[$nidx].network-data.service-information.global-customer-id -->\n<!--         AND service-subscription.service-type = $service-data.networks.network[$nidx].network-data.service-information.subscription-service-type' -->\n<!--      force=\"true\" pfx=\"tmp.AnAI-data\">-->\n<!--<parameter name=\"relationship-list.relationship[0].related-to\" value=\"connectivity\" />-->\n<!--<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/connectivities/connectivity/' + $prop.sotn.network-id`\" />-->\n<!--<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"connectivity.connectivity-id\" />-->\n<!--<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.sotn.network-id`\" />-->",
        "comments": "",
        "outputs": 1,
        "x": 2750,
        "y": 2230,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "ecdbcb6.a92d738",
        "type": "save",
        "name": "save tmp.the-connectivity relationship to vpn-binding-otnidx, in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='vpn-binding:relationship-list' \n      key='vpn-binding.vpn-id = $prop.vpn-binding-otnidx-uuid' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"connectivity\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/connectivities/connectivity/' + $tmp.the-connectivity.connectivity-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"connectivity.connectivity-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.the-connectivity.connectivity-id`\" />",
        "comments": "",
        "outputs": 1,
        "x": 2721,
        "y": 2303,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "82dff351.eb0b18",
        "type": "comment",
        "name": "update the founded connectivity to have a new coupling-flag",
        "info": "",
        "comments": "",
        "x": 2691,
        "y": 2019,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "4af074ca.bd591c",
        "type": "set",
        "name": "set newFlag",
        "xml": "<set>\n<parameter name='tmp.newFlag' value=\"`$tmp.the-connectivity.coupling-flag + '-' +\n                                               $tmp.srcTtpdstTtpPair`\" />\n\n\n",
        "comments": "",
        "x": 2577,
        "y": 2058,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "5e632476.eb799c",
        "type": "save",
        "name": "update connectivity resource in AAI",
        "xml": "<update plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='connectivity' \n      key='connectivity.connectivity-id = $tmp.the-connectivity.connectivity-id'>\n<parameter name='connectivity-id' value='`$tmp.the-connectivity.connectivity-id`' />\n<parameter name='etht-svc-name' value='`$prop.ethernet-service-name`' />\n<parameter name='operational-status' value='Modified' />\n<parameter name='coupling-flag' value='`$tmp.newFlag`' />\n",
        "comments": "",
        "outputs": 1,
        "x": 2641,
        "y": 2103,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    },
    {
        "id": "6b3b57c6.7c8f5",
        "type": "comment",
        "name": "the following two relationships should have already been there; if not => error",
        "info": "",
        "comments": "",
        "x": 2733,
        "y": 2153,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "453ea410.800c04",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1719,
        "y": 1520,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "be6ceee2.825c9",
                "fca1e078.90281",
                "84e90fcb.be7ce",
                "548a399a.3a9a1",
                "ea27a84e.a57e98",
                "688a1580.c26934"
            ]
        ]
    },
    {
        "id": "78a0670.cf2d998",
        "type": "outcomeFalse",
        "name": "false",
        "xml": "<outcome value='false'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1581,
        "y": 1516,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "453ea410.800c04"
            ]
        ]
    },
    {
        "id": "c80f5b2c.e8799",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic='true'>",
        "atomic": "true",
        "comments": "",
        "outputs": 1,
        "x": 2379,
        "y": 1983,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "65dfad8a.1bcc14",
                "4af074ca.bd591c",
                "5e632476.eb799c",
                "ecdbcb6.a92d738"
            ]
        ]
    },
    {
        "id": "f5aa86ab.3de758",
        "type": "comment",
        "name": "loop through the relationships of this founded connectivity, then",
        "info": "then find the vpn-binding that has same src ttp and dst ttp as this one",
        "comments": "",
        "x": 2384,
        "y": 2408,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "8608bc09.df0608",
        "type": "for",
        "name": "for each relationship",
        "xml": "<for silentFailure='true' index='tcridx' start='0' end='`$tmp.the-connectivity.relationship-list.relationship_length`' >\n\n",
        "comments": "",
        "outputs": 1,
        "x": 2726,
        "y": 2444,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "5d08ac03.36d834"
            ]
        ]
    },
    {
        "id": "5d08ac03.36d834",
        "type": "switchNode",
        "name": "switch related-to",
        "xml": "<switch test='`$tmp.the-connectivity.relationship-list.relationship[$tcridx].related-to`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2938,
        "y": 2442,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "d7fbd393.802b28"
            ]
        ]
    },
    {
        "id": "d7fbd393.802b28",
        "type": "outcome",
        "name": "vpn-binding",
        "xml": "<outcome value='vpn-binding'>\n",
        "comments": "",
        "outputs": 1,
        "x": 3122,
        "y": 2440,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "7b17a25c.8a3ecc"
            ]
        ]
    },
    {
        "id": "7b17a25c.8a3ecc",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 3301,
        "y": 2445,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "404536aa.fd072",
                "ebe21a38.772d1"
            ]
        ]
    },
    {
        "id": "ebe21a38.772d1",
        "type": "set",
        "name": "unset tmp.aai.vpn-binding",
        "xml": "<set>\n<parameter name='tmp.aai.vpn-binding.' value='' />\n",
        "comments": "",
        "x": 3518,
        "y": 2376,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "404536aa.fd072",
        "type": "save",
        "name": "get vpn-binding from aai",
        "xml": "<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"vpn-binding\"\n\t    key=\"vpn-binding.vpn-id = $tmp.the-connectivity.relationship-list.relationship[$tcridx].relationship-data[0].relationship-value\"\n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.aai.vpn-binding\" >\n",
        "comments": "",
        "outputs": 1,
        "x": 3511,
        "y": 2462,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "82eb023b.8b6878",
                "3917c696.d9cc82",
                "ad895865.ea3bc8"
            ]
        ]
    },
    {
        "id": "3917c696.d9cc82",
        "type": "not-found",
        "name": "not-found",
        "xml": "<outcome value='not-found'>\n",
        "comments": "",
        "outputs": 1,
        "x": 3724.490966796875,
        "y": 2446.5740356445312,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "33dd47ac.b200d"
            ]
        ]
    },
    {
        "id": "33dd47ac.b200d",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'An error occurred while querying pnf from AnAI with pnf-name = ' + $prop.l3vpn.pe1_id`\" />\n\n",
        "comments": "",
        "x": 3887.0625,
        "y": 2445.8597412109375,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "49f1ea3b.eabc34",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value='' />\n",
        "comments": "",
        "x": 3888,
        "y": 2491,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "ad895865.ea3bc8",
        "type": "failure",
        "name": "failure",
        "xml": "<outcome value='failure'>\n",
        "comments": "",
        "outputs": 1,
        "x": 3720,
        "y": 2491,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "49f1ea3b.eabc34"
            ]
        ]
    },
    {
        "id": "82eb023b.8b6878",
        "type": "success",
        "name": "success",
        "xml": "<outcome value='success'>\n",
        "comments": "",
        "outputs": 1,
        "x": 3722,
        "y": 2551,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "cb43f8c5.5d2f9"
            ]
        ]
    },
    {
        "id": "cb43f8c5.5d2f9",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 3891,
        "y": 2550,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "b8d3290b.70429"
            ]
        ]
    },
    {
        "id": "28b98f8a.d66ba8",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 2515,
        "y": 2442,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "8608bc09.df0608",
                "57ababe0.ec3414",
                "52276af3.2f9a4c"
            ]
        ]
    },
    {
        "id": "b8d3290b.70429",
        "type": "switchNode",
        "name": "switch srcTtp",
        "xml": "<switch test='`$tmp.aai.vpn-binding.src-access-ltp-id == $tmp.otninfo[$otnidx].srcPort.src-tunnel-tp-id`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 4090,
        "y": 2551,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "4ce3e8eb.f24da8"
            ]
        ]
    },
    {
        "id": "4ce3e8eb.f24da8",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 4253,
        "y": 2549,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "18f785cc.cf347a"
            ]
        ]
    },
    {
        "id": "18f785cc.cf347a",
        "type": "switchNode",
        "name": "switch dstTtp",
        "xml": "<switch test='`$tmp.aai.vpn-binding.dst-access-ltp-id == $tmp.otninfo[$otnidx].dstPort.dst-tunnel-tp-id`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 4434,
        "y": 2549,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "988f1cd5.aa027"
            ]
        ]
    },
    {
        "id": "988f1cd5.aa027",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 4597,
        "y": 2547,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "9caa890d.344aa8"
            ]
        ]
    },
    {
        "id": "dd1b26b2.35eef",
        "type": "set",
        "name": "set tmp.the-vpn-binding",
        "xml": "<set>\n<parameter name='tmp.the-vpn-binding.' value='`$tmp.aai.vpn-binding.`' />\n",
        "comments": "",
        "x": 4954,
        "y": 2554,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "9caa890d.344aa8",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 4736,
        "y": 2546,
        "z": "4fb14ce0.40eb24",
        "wires": [
            [
                "dd1b26b2.35eef",
                "69c80295.f3b48c"
            ]
        ]
    },
    {
        "id": "69c80295.f3b48c",
        "type": "break",
        "name": "break",
        "xml": "<break>\n",
        "comments": "",
        "x": 4900,
        "y": 2598,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "57ababe0.ec3414",
        "type": "set",
        "name": "unset tmp.the-vpn-binding",
        "xml": "<set>\n<parameter name='tmp.the-vpn-binding.' value='' />\n",
        "comments": "",
        "x": 2736,
        "y": 2405,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "b81a7ea3.f58288",
        "type": "comment",
        "name": "increase the bw of the-vpn-binding and change status to modified",
        "info": "increase the bw of the-vpn-binding\nchange status to modified\n",
        "comments": "",
        "x": 2825,
        "y": 2579,
        "z": "4fb14ce0.40eb24",
        "wires": []
    },
    {
        "id": "52276af3.2f9a4c",
        "type": "save",
        "name": "update vpn-binding otnIdx resource (aka. OTN) in AAI",
        "xml": "<update plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='vpn-binding' \n      key='vpn-binding.vpn-id = $tmp.the-vpn-binding.vpn-id' >\n<parameter name='vpn-id' value='`$tmp.the-vpn-binding.vpn-id`' />\n<!--<parameter name='vpn-name' value='`$prop.otn-tunnel-name`' />-->\n<!--<parameter name='customer-vpn-id' value='`($maxtpn + $gfp)`' />-->\n<parameter name='customer-vpn-id' value='`($tmp.the-vpn-binding.customer-vpn-id + $gfp)`' />\n\n<parameter name='route-distinguisher' value='`$gfp`' />\n<parameter name='operational-status' value='Modified' />\n\n\n",
        "comments": "",
        "outputs": 1,
        "x": 2795,
        "y": 2639,
        "z": "4fb14ce0.40eb24",
        "wires": [
            []
        ]
    }
]