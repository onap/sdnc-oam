[{"id":"ef42c66b.3dfe28","type":"dgstart","name":"DGSTART","outputs":1,"x":102.85714721679688,"y":80.98508262634277,"z":"5b67a0de.c1191","wires":[["d058f552.773d88"]]},{"id":"d058f552.773d88","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":218.14285278320312,"y":120.5565299987793,"z":"5b67a0de.c1191","wires":[["f16f3e1d.c41f4"]]},{"id":"f16f3e1d.c41f4","type":"method","name":"method vf-module-topology-operation-unassign","xml":"<method rpc='vf-module-topology-operation-unassign' mode='sync'>\n","comments":"","outputs":1,"x":224.95244598388672,"y":160.9850788116455,"z":"5b67a0de.c1191","wires":[["a61f59cb.b2a0f8"]]},{"id":"63457f36.a0099","type":"comment","name":"vf-module-topology-operation-unassign","info":"","comments":"","x":497.2020034790039,"y":28.571426391601562,"z":"5b67a0de.c1191","wires":[]},{"id":"d0a30d4d.0df84","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vf-module-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":506.3809585571289,"y":259.8422203063965,"z":"5b67a0de.c1191","wires":[["286c8282.164dee","46a465e0.79a2dc"]]},{"id":"286c8282.164dee","type":"outcome","name":"DeleteVfModuleInstance","xml":"<outcome value='DeleteVfModuleInstance'>\n","comments":"","outputs":1,"x":768.4285736083984,"y":236.98510646820068,"z":"5b67a0de.c1191","wires":[["e6a80960.aadf88"]]},{"id":"46a465e0.79a2dc","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":712.0952186584473,"y":282.3660955429077,"z":"5b67a0de.c1191","wires":[["201f9acb.f9a0c6"]]},{"id":"e6a80960.aadf88","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":958.285737991333,"y":236.98513793945312,"z":"5b67a0de.c1191","wires":[[]]},{"id":"201f9acb.f9a0c6","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'deactivate' then request-action must be 'DeleteVfModuleInstance'\" />\n","comments":"","x":977.0952262878418,"y":282.6994080543518,"z":"5b67a0de.c1191","wires":[]},{"id":"a61f59cb.b2a0f8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":126.19048309326172,"y":544.3183727264404,"z":"5b67a0de.c1191","wires":[["d0a30d4d.0df84","783364b6.6904cc","e6cab1bb.99be3","61397b35.1bab24","1add5b5f.d4eb55","6de9253c.11193c","48995b46.021df4","e2eff761.4bbdf8","bd0ec889.7e7588","8cb124a1.258a58","c72a7ac6.668cf8","c2fdd3aa.623e","86f3563e.50aea8","29e2cbda.b6f204","6ad45119.09e6e","f8285267.508dc"]]},{"id":"e6cab1bb.99be3","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":552.8571319580078,"y":404.318395614624,"z":"5b67a0de.c1191","wires":[["e850c155.14d9","94b90f2e.f54da"]]},{"id":"e850c155.14d9","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":793.571403503418,"y":381.4611358642578,"z":"5b67a0de.c1191","wires":[["c95d8e3c.02d6d"]]},{"id":"94b90f2e.f54da","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":793.3332443237305,"y":422.4136543273926,"z":"5b67a0de.c1191","wires":[["fbba99b5.d636c8"]]},{"id":"c95d8e3c.02d6d","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs defined in MD-SAL\" />\n","comments":"","x":960.2380180358887,"y":380.7468910217285,"z":"5b67a0de.c1191","wires":[]},{"id":"fbba99b5.d636c8","type":"for","name":"for each vnf","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":955.5713882446289,"y":422.08027267456055,"z":"5b67a0de.c1191","wires":[["1d38ac25.ac4374"]]},{"id":"1d38ac25.ac4374","type":"switchNode","name":"switch service data vnf == input vnf","xml":"<switch test='`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`'>\n","comments":"","outputs":1,"x":1206.9046058654785,"y":421.7469596862793,"z":"5b67a0de.c1191","wires":[["d0831ba0.3cd008"]]},{"id":"d0831ba0.3cd008","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1436.904697418213,"y":421.08031368255615,"z":"5b67a0de.c1191","wires":[["5f48041a.63d50c"]]},{"id":"783364b6.6904cc","type":"set","name":"set vnf-index to -1","xml":"<set>\n<parameter name='vnf-index' value='-1' />\n","comments":"","x":501.9047546386719,"y":335.7468948364258,"z":"5b67a0de.c1191","wires":[]},{"id":"91307255.722ca","type":"set","name":"set vnf-index to idx","xml":"<set>\n<parameter name='vnf-index' value='`$idx`' />\n","comments":"","x":1758.5713348388672,"y":392.08027172088623,"z":"5b67a0de.c1191","wires":[]},{"id":"61397b35.1bab24","type":"switchNode","name":"switch vnf-index","xml":"<switch test='`$vnf-index`'>\n","comments":"","outputs":1,"x":491.9047622680664,"y":472.4135913848877,"z":"5b67a0de.c1191","wires":[["9df4c462.b59e38"]]},{"id":"9df4c462.b59e38","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":670.2381477355957,"y":471.7469673156738,"z":"5b67a0de.c1191","wires":[["c5f1b68.18c2948"]]},{"id":"c5f1b68.18c2948","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find VNF ID ' + $vf-module-topology-operation-input.vnf-information.vnf-id + ' in MD-SAL'`\" />\n","comments":"","x":830.2380561828613,"y":471.0802707672119,"z":"5b67a0de.c1191","wires":[]},{"id":"5f48041a.63d50c","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1585.2381591796875,"y":420.0000123977661,"z":"5b67a0de.c1191","wires":[["91307255.722ca","2cb9f7a8.b8ebd8"]]},{"id":"2cb9f7a8.b8ebd8","type":"break","name":"break","xml":"<break>\n","comments":"","x":1720.238124847412,"y":441.6665983200073,"z":"5b67a0de.c1191","wires":[]},{"id":"6de9253c.11193c","type":"switchNode","name":"switch vf-module_length","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n","comments":"","outputs":1,"x":516.1904449462891,"y":594.3183994293213,"z":"5b67a0de.c1191","wires":[["69656837.f07e48","eff3e23.a78002"]]},{"id":"69656837.f07e48","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":700.2380828857422,"y":573.1278038024902,"z":"5b67a0de.c1191","wires":[["f062a39d.b6fa"]]},{"id":"eff3e23.a78002","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":699.9999237060547,"y":614.080322265625,"z":"5b67a0de.c1191","wires":[["59a3035.20c9dfc"]]},{"id":"f062a39d.b6fa","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'There are no VF modules defined in MD-SAL for VNF ' + $vf-module-topology-operation-input.vnf-information.vnf-id`\" />\n","comments":"","x":866.9046974182129,"y":572.4135589599609,"z":"5b67a0de.c1191","wires":[]},{"id":"59a3035.20c9dfc","type":"for","name":"for each vf-module","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' >\n","comments":"","outputs":1,"x":862.2380676269531,"y":613.746940612793,"z":"5b67a0de.c1191","wires":[["b620cec7.82ead"]]},{"id":"b620cec7.82ead","type":"switchNode","name":"switch service data vf-module == input vf-module","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`'>\n","comments":"","outputs":1,"x":1168.5712280273438,"y":613.4136762619019,"z":"5b67a0de.c1191","wires":[["7e8af19c.886a5"]]},{"id":"7e8af19c.886a5","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1438.5712814331055,"y":611.0802812576294,"z":"5b67a0de.c1191","wires":[["b7f034b3.b621e8"]]},{"id":"1add5b5f.d4eb55","type":"set","name":"set vf-module-index to -1","xml":"<set>\n<parameter name='vf-module-index' value='-1' />\n","comments":"","x":521.9047393798828,"y":529.0802574157715,"z":"5b67a0de.c1191","wires":[]},{"id":"167f6da.3ade892","type":"set","name":"set vf-module-index to idx","xml":"<set>\n<parameter name='vf-module-index' value='`$idx`' />\n","comments":"","x":1768.5713729858398,"y":582.0802602767944,"z":"5b67a0de.c1191","wires":[]},{"id":"48995b46.021df4","type":"switchNode","name":"switch vf-module-index","xml":"<switch test='`$vf-module-index`'>\n","comments":"","outputs":1,"x":513.5714225769043,"y":665.7469701766968,"z":"5b67a0de.c1191","wires":[["5c3ff9de.44bb78"]]},{"id":"5c3ff9de.44bb78","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":691.9048080444336,"y":665.0803461074829,"z":"5b67a0de.c1191","wires":[["7bd45ad0.114894"]]},{"id":"7bd45ad0.114894","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find VF module ID ' + $vf-module-topology-operation-input.vf-module-information.vf-module-id + ' in MD-SAL'`\" />\n","comments":"","x":851.9047164916992,"y":664.413649559021,"z":"5b67a0de.c1191","wires":[]},{"id":"b7f034b3.b621e8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1571.9048233032227,"y":610.000020980835,"z":"5b67a0de.c1191","wires":[["167f6da.3ade892","8443b090.2daf6"]]},{"id":"8443b090.2daf6","type":"break","name":"break","xml":"<break>\n","comments":"","x":1706.9047889709473,"y":631.6666069030762,"z":"5b67a0de.c1191","wires":[]},{"id":"892a56a9.303a58","type":"switchNode","name":"switch order-status","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.order-status`'>\n","comments":"","outputs":1,"x":502.8571243286133,"y":734.3184070587158,"z":"5b67a0de.c1191","wires":[["9285d8d3.d319a8","95b7cb21.1f05f8"]]},{"id":"9285d8d3.d319a8","type":"outcome","name":"Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":681.1905097961426,"y":709.3184490203857,"z":"5b67a0de.c1191","wires":[["a5b8b544.86dbb8"]]},{"id":"95b7cb21.1f05f8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":677.8571128845215,"y":754.3183898925781,"z":"5b67a0de.c1191","wires":[["a74c3534.fd0f58"]]},{"id":"a5b8b544.86dbb8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Order status must not be Created\" />\n","comments":"","x":849.5237503051758,"y":709.3183784484863,"z":"5b67a0de.c1191","wires":[]},{"id":"a74c3534.fd0f58","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":852.8571243286133,"y":753.9850654602051,"z":"5b67a0de.c1191","wires":[[]]},{"id":"bd0ec889.7e7588","type":"update","name":"update EIPAM_IP_ASSIGNMENTS to PENDING_DELETE...","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource\" resource=\"SQL\"\nkey=\"UPDATE EIPAM_IP_ASSIGNMENTS set status = $tmp.status WHERE info = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-topology-identifier.vf-module-id\" >","comments":"","outputs":1,"x":629.5238494873047,"y":850.9850578308105,"z":"5b67a0de.c1191","wires":[["beb8bd2a.4a234"]]},{"id":"e2eff761.4bbdf8","type":"set","name":"set status variable","xml":"<set>\n<parameter name='tmp.status' value=\"`'PENDING_DELETE_' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-topology-identifier.vf-module-id`\" />\n","comments":"","x":499.52381896972656,"y":804.3183898925781,"z":"5b67a0de.c1191","wires":[]},{"id":"beb8bd2a.4a234","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":934.5237579345703,"y":849.3183574676514,"z":"5b67a0de.c1191","wires":[["662d57d9.522928"]]},{"id":"662d57d9.522928","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating EIPAM_IP_ASSIGNMENTS table\" />\n","comments":"","x":1124.5237846374512,"y":849.1280927658081,"z":"5b67a0de.c1191","wires":[]},{"id":"86f3563e.50aea8","type":"execute","name":"execute EIPAM unassign IP addresses","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"unassignIPAddress\">\n<parameter name=\"deleteEIPAM_status\" value=\"`$tmp.status`\" />\n","comments":"","outputs":1,"x":562.8571472167969,"y":945.9850788116455,"z":"5b67a0de.c1191","wires":[["a2d0cafc.365ad8"]]},{"id":"a2d0cafc.365ad8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":799.5237731933594,"y":945.9850215911865,"z":"5b67a0de.c1191","wires":[["7f146f30.6259a"]]},{"id":"7f146f30.6259a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error in EIPAM unassign IP address\" />\n","comments":"","x":989.5237998962402,"y":945.7947568893433,"z":"5b67a0de.c1191","wires":[]},{"id":"8cb124a1.258a58","type":"for","name":"for each vm-type","xml":"<for silentFailure='true' index='vm-type-index' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":494.5238037109375,"y":990.9850397109985,"z":"5b67a0de.c1191","wires":[["e87db48e.4a5268"]]},{"id":"e87db48e.4a5268","type":"for","name":"for each vm","xml":"<for silentFailure='true' index='vm-index' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-count`' >\n","comments":"","outputs":1,"x":689.5238342285156,"y":990.3180475234985,"z":"5b67a0de.c1191","wires":[["af538482.333f58"]]},{"id":"be98fd19.fa07","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1396.190902709961,"y":988.6506500244141,"z":"5b67a0de.c1191","wires":[["1a47c8d9.c80497"]]},{"id":"24a33e60.d3d282","type":"comment","name":"Not a failure","info":"","comments":"","x":1674.5238990783691,"y":986.9844522476196,"z":"5b67a0de.c1191","wires":[]},{"id":"1a47c8d9.c80497","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"GENERIC-RESOURCE-API.vf-module-topology-operation-assign:REQID\"/>\n<parameter name=\"field3\" value=\"`$vf-module-topology-operation-input.sdnc-request-header.svc-request-id`\"/>\n<parameter name=\"field4\" value=\"Failed to insert VIPR_CONFIGURATION record\"/>\n","comments":"","outputs":1,"x":1542.1908378601074,"y":988.6512832641602,"z":"5b67a0de.c1191","wires":[[]]},{"id":"af538482.333f58","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":857.8572273254395,"y":989.317892074585,"z":"5b67a0de.c1191","wires":[["12e7b0fe.3d6a6f"]]},{"id":"12e7b0fe.3d6a6f","type":"delete","name":"delete any records in VIPR_CONFIGURATION","xml":"<delete plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='DELETE from VIPR_CONFIGURATION WHERE vnf_id = $service-data.vnfs.vnf[$vnf-index].vnf-id\n     AND ecomp_service_instance_id = $service-data.service-information.service-instance-id\n     AND vm_name = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vm-name[$vm-index]' >","comments":"","outputs":1,"x":1144.523941040039,"y":988.9853219985962,"z":"5b67a0de.c1191","wires":[["be98fd19.fa07"]]},{"id":"838f69b9.58a6a8","type":"for","name":"for each vf module","xml":"<for index='idx' start='`$vf-module-index + 1`' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' >\n","comments":"","outputs":1,"x":1068.3649291992188,"y":1619.651578426361,"z":"5b67a0de.c1191","wires":[["60fee760.6f5948"]]},{"id":"7761a206.13b90c","type":"comment","name":"Remove VF Module from service data","info":"","comments":"","x":447.1904296875,"y":1574.890018939972,"z":"5b67a0de.c1191","wires":[]},{"id":"60fee760.6f5948","type":"set","name":"move vf module to remove one","xml":"<set>\n\t<parameter name=\"tmpidx\" value=\"`$idx - 1`\"/>\n\t<parameter name=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$tmpidx].\" value=\"$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].\" />\n\t\n","comments":"","x":1311.9560623168945,"y":1618.6755442619324,"z":"5b67a0de.c1191","wires":[]},{"id":"c72a7ac6.668cf8","type":"switchNode","name":"switch vf-module_length","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n","comments":"","outputs":1,"x":514.6228485107422,"y":1630.9932494163513,"z":"5b67a0de.c1191","wires":[["b9bfc718.c37be8","cd1dd4e9.b606c8"]]},{"id":"b9bfc718.c37be8","type":"outcome","name":"1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":709.9562149047852,"y":1581.8978562355042,"z":"5b67a0de.c1191","wires":[["f977d1d1.c527e"]]},{"id":"f977d1d1.c527e","type":"set","name":"Remove vf modules","xml":"<set>\n\t<parameter name=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.\" value=\"\"/>\n\n","comments":"","x":881.9559860229492,"y":1581.8979754447937,"z":"5b67a0de.c1191","wires":[]},{"id":"cd1dd4e9.b606c8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":708.6229705810547,"y":1676.6596655845642,"z":"5b67a0de.c1191","wires":[["a88e0432.333698"]]},{"id":"fa887e6e.ecc74","type":"set","name":"set new vf module length","xml":"<set>\n\t<parameter name=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length\" value=\"`$lastidx`\"/>\n\n\t\n","comments":"","x":1087.2524642944336,"y":1747.3740553855896,"z":"5b67a0de.c1191","wires":[]},{"id":"bcf186df.a18ec8","type":"set","name":"Remove the last vf module in the list","xml":"<set>\n\t<parameter name=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$lastidx].\" value=\"\"/>\n","comments":"","x":1122.9560775756836,"y":1703.4851927757263,"z":"5b67a0de.c1191","wires":[]},{"id":"a88e0432.333698","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":865.8609008789062,"y":1675.8976674079895,"z":"5b67a0de.c1191","wires":[["838f69b9.58a6a8","bcf186df.a18ec8","fa887e6e.ecc74","15a93259.6757ce"]]},{"id":"c2fdd3aa.623e","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":487.1904602050781,"y":1807.5088725090027,"z":"5b67a0de.c1191","wires":[]},{"id":"29e2cbda.b6f204","type":"set","name":"set service-type","xml":"<set>\n<parameter name='service-data.service-information.service-type' value='`$service-data.service-information.subscription-service-type`' />\n","comments":"EIPAM plug-in needs this attribute set with this name","x":491.1904602050781,"y":896.9047203063965,"z":"5b67a0de.c1191","wires":[]},{"id":"15a93259.6757ce","type":"set","name":"set lastidx","xml":"<set>\n<parameter name='lastidx' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length - 1`' />\n","comments":"EIPAM plug-in needs this attribute set with this name","x":1041.0952453613281,"y":1659.8898921012878,"z":"5b67a0de.c1191","wires":[]},{"id":"e824533b.f1a97","type":"switchNode","name":"switch vf-module_length","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n","comments":"","outputs":1,"x":1513.3570709228516,"y":1308.0714979171753,"z":"5b67a0de.c1191","wires":[["c4b2eea1.4d80f"]]},{"id":"c4b2eea1.4d80f","type":"outcome","name":"1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1697.6427764892578,"y":1308.0714845657349,"z":"5b67a0de.c1191","wires":[["3da2c63e.60caaa"]]},{"id":"27e1e4c.0d3421c","type":"update","name":"update EIPAM_IP_ASSIGNMENTS to PENDING_DELETE...","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource\" resource=\"SQL\"\nkey=\"UPDATE EIPAM_IP_ASSIGNMENTS set status = $tmp.status WHERE info = $aai.instance-group.instance-group[$ig-index].id\" >","comments":"","outputs":1,"x":2127.6427307128906,"y":1307.881142616272,"z":"5b67a0de.c1191","wires":[[]]},{"id":"262889ce.11f6b6","type":"set","name":"set status variable","xml":"<set>\n<parameter name='tmp.status' value=\"`'PENDING_DELETE_' + $aai.instance-group.instance-group[$ig-index].id`\" />\n","comments":"","x":1997.642692565918,"y":1261.2145147323608,"z":"5b67a0de.c1191","wires":[]},{"id":"70154422.eceb0c","type":"execute","name":"execute EIPAM unassign IP addresses","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"unassignIPAddress\">\n<parameter name=\"deleteEIPAM_status\" value=\"`$tmp.status`\" />\n","comments":"","outputs":1,"x":2062.6427001953125,"y":1352.8811864852905,"z":"5b67a0de.c1191","wires":[[]]},{"id":"68a97dc0.9e79b4","type":"comment","name":"roll back EIPAM floating addresses","info":"","comments":"","x":2106.928421020508,"y":1215.0243409474688,"z":"5b67a0de.c1191","wires":[]},{"id":"6ad45119.09e6e","type":"switchNode","name":"switch network-instance-group-function","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[0].vnfcs.vnfc[0].vnic-groups.vnic-group[0].network-instance-group-function`'>\n","comments":"","outputs":1,"x":561.1904830932617,"y":1123.5714311599731,"z":"5b67a0de.c1191","wires":[["78d3972b.dcca58","e57c9eb6.ec585"]]},{"id":"78d3972b.dcca58","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":786.1904525756836,"y":1091.904764175415,"z":"5b67a0de.c1191","wires":[["87fca876.3556d8"]]},{"id":"e57c9eb6.ec585","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":785.9523162841797,"y":1162.857159614563,"z":"5b67a0de.c1191","wires":[["13ee6f1d.03ba61"]]},{"id":"87fca876.3556d8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":912.8571891784668,"y":1090.2380962371826,"z":"5b67a0de.c1191","wires":[[]]},{"id":"13ee6f1d.03ba61","type":"get-resource","name":"get-resource instance group","xml":"<get-resource plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n  resource=\"instance-groups\" \n  key=\"instance-group.instance-group-function = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vlan-vnfc-instance-groups.vlan-vnfc-instance-group[0].vnfcs.vnfc[0].vnic-groups.vnic-group[0].network-instance-group-function\n    AND instance-group.instance-group-type = 'L3-NETWORK'\"\n  pfx='aai.instance-group' local-only='false' >\n\n","comments":"","outputs":1,"x":982.0238723754883,"y":1161.9047365188599,"z":"5b67a0de.c1191","wires":[["718f3db5.71b6e4"]]},{"id":"718f3db5.71b6e4","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1183.690502166748,"y":1162.7381105422974,"z":"5b67a0de.c1191","wires":[["71308ae6.49d8c4"]]},{"id":"8ee09b6d.6b7648","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1333.6904907226562,"y":1361.0716438293457,"z":"5b67a0de.c1191","wires":[["e824533b.f1a97","33645ae3.fb2c56"]]},{"id":"3da2c63e.60caaa","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1823.6904106140137,"y":1307.7381982803345,"z":"5b67a0de.c1191","wires":[["262889ce.11f6b6","27e1e4c.0d3421c","70154422.eceb0c"]]},{"id":"33645ae3.fb2c56","type":"for","name":"for each network-instance-group","xml":"<for index='nig-index' start='0' end='`$service-data.network-instance-groups.network-instance-group_length`' >\n","comments":"","outputs":1,"x":1533.6904220581055,"y":1416.071533203125,"z":"5b67a0de.c1191","wires":[["2d035f6f.76a97"]]},{"id":"2d035f6f.76a97","type":"switchNode","name":"network-instance-group-ids match?","xml":"<switch test='`$aai.instance-group.instance-group[$ig-index].id\n  == $service-data.network-instance-groups.network-instance-group[$nig-index].network-instance-group-id`'>\n","comments":"","outputs":1,"x":1838.6902618408203,"y":1416.0715789794922,"z":"5b67a0de.c1191","wires":[["3d2e877b.9d4ba8"]]},{"id":"3d2e877b.9d4ba8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2060.357032775879,"y":1414.7383575439453,"z":"5b67a0de.c1191","wires":[["9348b4f3.6b18a8"]]},{"id":"9348b4f3.6b18a8","type":"for","name":"for each network","xml":"<for index='network-index' start='0' end='`$service-data.network-instance-groups.network-instance-group[$nig-index].networks.network_length`' >\n","comments":"","outputs":1,"x":2216.0713691711426,"y":1413.452483177185,"z":"5b67a0de.c1191","wires":[["7e561649.5ff568"]]},{"id":"7e561649.5ff568","type":"set","name":"clear vlan-tag-id and set network-status to unassigned","xml":"<set>\n<parameter name='service-data.network-instance-groups.network-instance-group[$nig-index].networks.network[$network-index].vlan-tag-id'\n  value='' />\n<parameter name='service-data.network-instance-groups.network-instance-group[$nig-index].networks.network[$network-index].network-status'\n  value='unassigned' />\n","comments":"","x":2527.499801635742,"y":1412.0239458084106,"z":"5b67a0de.c1191","wires":[]},{"id":"71308ae6.49d8c4","type":"for","name":"for each returned instance-group","xml":"<for index='ig-index' start='0' end='`$aai.instance-group.instance-group_length`' >\n","comments":"","outputs":1,"x":1407.1905059814453,"y":1159.7381143569946,"z":"5b67a0de.c1191","wires":[["e8cd59c1.f78268"]]},{"id":"e8cd59c1.f78268","type":"for","name":"for each relationship","xml":"<for index='rel-index' start='0' end='`$aai.instance-group.instance-group[$ig-index].relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":1658.8571472167969,"y":1158.7381134033203,"z":"5b67a0de.c1191","wires":[["4421cf44.a8694"]]},{"id":"4421cf44.a8694","type":"for","name":"for each relationship-data","xml":"<for index='reldata-index' start='0' end='`$aai.instance-group.instance-group[$ig-index].relationship-list.relationship[$rel-index].relationship-data_length`' >\n","comments":"","outputs":1,"x":1885.5238189697266,"y":1158.0714874267578,"z":"5b67a0de.c1191","wires":[["b68ab651.5c5668"]]},{"id":"b68ab651.5c5668","type":"switchNode","name":"switch relationship-key == service-instance.service-instance-id","xml":"<switch test=\"`$aai.instance-group.instance-group[$ig-index].relationship-list.relationship[$rel-index].relationship-data[$reldata-index].relationship-key\n  == 'service-instance.service-instance-id'`\">\n","comments":"","outputs":1,"x":2243.857406616211,"y":1158.071406364441,"z":"5b67a0de.c1191","wires":[["c36caaa6.259718"]]},{"id":"c36caaa6.259718","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":2540.5238647460938,"y":1158.0714387893677,"z":"5b67a0de.c1191","wires":[["143545fd.16713a"]]},{"id":"143545fd.16713a","type":"switchNode","name":"switch relationship-value == this service-instance-id","xml":"<switch test='`$aai.instance-group.instance-group[$ig-index].relationship-list.relationship[$rel-index].relationship-data[$reldata-index].relationship-value\n  == $service-data.service-information.service-instance-id`'>\n","comments":"","outputs":1,"x":2805.5236892700195,"y":1158.0714082717896,"z":"5b67a0de.c1191","wires":[["d8dc66f3.86a4a8"]]},{"id":"d8dc66f3.86a4a8","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3065.5236587524414,"y":1158.0713987350464,"z":"5b67a0de.c1191","wires":[["8ee09b6d.6b7648"]]},{"id":"f8285267.508dc","type":"for","name":"for each vm-type","xml":"<for silentFailure='true' index='vm-type-index' start='0'\n  end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm_length`' >\n","comments":"","outputs":1,"x":493.6904602050781,"y":1508.4850826263428,"z":"5b67a0de.c1191","wires":[["aaba4d09.53267"]]},{"id":"aaba4d09.53267","type":"for","name":"for each vnfc","xml":"<for silentFailure='true' index='vnfc-index' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names_length`' >\n","comments":"","outputs":1,"x":670.3572006225586,"y":1507.8662776947021,"z":"5b67a0de.c1191","wires":[["bbf5185b.cb6e88"]]},{"id":"bbf5185b.cb6e88","type":"save","name":"delete vnfc in A&AI","xml":"<delete plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\"\n   resource=\"vnfc\"\n   key=\"vnfc.vnfc-name = $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.vf-module-assignments.vms.vm[$vm-type-index].vm-names.vnfc-names[$vnfc-index].vnfc-name\">\n","comments":"","outputs":1,"x":855.119026184082,"y":1507.0566759109497,"z":"5b67a0de.c1191","wires":[[]]},{"id":"7835733b.e5fecc","type":"comment","name":"check removed with US622450","info":"","comments":"","x":1057.142837524414,"y":724.2857279777527,"z":"5b67a0de.c1191","wires":[]}]