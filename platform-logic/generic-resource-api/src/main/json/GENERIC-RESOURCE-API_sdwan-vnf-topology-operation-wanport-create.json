[
  {
    "id": "f7c47e43.722a8",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 131.00390625,
    "y": 50.00390625,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "df50ad92.5b9f3"
      ]
    ]
  },
  {
    "id": "df50ad92.5b9f3",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 230.28960418701172,
    "y": 124.24201414268464,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "7a9c4555.b9551c"
      ]
    ]
  },
  {
    "id": "7a9c4555.b9551c",
    "type": "method",
    "name": "method sdwan-vnf-topology-operation-wanport-create",
    "xml": "<method rpc='sdwan-vnf-topology-operation-wanport-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 254.43252563476562,
    "y": 213.0039258003235,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "19a1bf06.151541"
      ]
    ]
  },
  {
    "id": "19a1bf06.151541",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 362.6706085205078,
    "y": 420.67058992385864,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "a1f3b1e9.35545",
        "f570a4d2.187c18",
        "90591b72.96d098",
        "b3840dbc.6104c",
        "4c4bb443.a3389c",
        "44f64d1d.aa7064",
        "5baacb87.e7da64",
        "f0cbc16c.cad4b",
        "a062fc34.476f9",
        "cf3398f4.969708",
        "b5b128b4.4b50a8",
        "795a527a.112ffc",
        "f82a7101.bfc5b"
      ]
    ]
  },
  {
    "id": "a1f3b1e9.35545",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 652.3375396728516,
    "y": 872.3377075195312,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "f570a4d2.187c18",
    "type": "save",
    "name": "save sdwan device port configuration in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='wan-port-config' \n      key='wan-port-config.id = $prop.vnf-index' >\n<parameter name=\"id\" value=\"`$prop.vnf-index`\" />\n<parameter name=\"name\" value=\"`$prop.wan.name`\" />\n<parameter name=\"device-id\" value=\"`$prop.wan.deviceName`\" />\n<parameter name='vlan-id' value=\"`$prop.wan.vlanId`\" />\n<parameter name=\"ip-address\" value=\"`$prop.wan.ipAdddress`\" />\n<parameter name=\"provider-ip-address\" value=\"`$prop.wan.providerIpAddress`\" />\n<parameter name=\"input-bandwidth\" value=\"`$prop.wan.inputBandwidth`\" />\n<parameter name=\"output-bandwidth\" value=\"`$prop.wan.outputBandwidth`\" />\n<parameter name=\"description\" value=\"`$prop.wan.description`\" />\n<parameter name=\"port-type\" value=\"`$prop.wan.portType`\" />\n<parameter name=\"port-number\" value=\"`$prop.wan.portNumber`\" />\n<parameter name=\"transport-network-name\" value=\"`$prop.wan.transportNetworkName`\" />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />\n",
    "comments": "",
    "outputs": 1,
    "x": 739.0042953491211,
    "y": 779.5599503517151,
    "z": "61d54760.a4d0c8",
    "wires": [
      []
    ]
  },
  {
    "id": "90591b72.96d098",
    "type": "for",
    "name": "for loop idx - VNF input parameters",
    "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 717.0043640136719,
    "y": 446.67932987213135,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "b4473f3b.51629"
      ]
    ]
  },
  {
    "id": "b4473f3b.51629",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 931.7827072143555,
    "y": 444.23491382598877,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "3e1cd824.f76ba8",
        "706d3a5.3e853c4"
      ]
    ]
  },
  {
    "id": "8b4706cb.23dc38",
    "type": "comment",
    "name": "set input parameters",
    "info": "",
    "comments": "",
    "x": 935.6775550842285,
    "y": 572.6009178161621,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "b3840dbc.6104c",
    "type": "switchNode",
    "name": "switch service-data.vnfs.vnf_length",
    "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 727.9937286376953,
    "y": 143.60080528259277,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "2465f202.f0a9ce",
        "506845c6.11b4dc"
      ]
    ]
  },
  {
    "id": "2465f202.f0a9ce",
    "type": "other",
    "name": "NULL",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 964.7079563140869,
    "y": 133.7436351776123,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "75a2f10a.06bc7"
      ]
    ]
  },
  {
    "id": "506845c6.11b4dc",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 960.1366729736328,
    "y": 172.02948570251465,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "4460ebdc.a1f384"
      ]
    ]
  },
  {
    "id": "4460ebdc.a1f384",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1092.8508682250977,
    "y": 177.02942562103271,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "7e7a019f.eac06",
        "6d299d3a.328f54"
      ]
    ]
  },
  {
    "id": "75a2f10a.06bc7",
    "type": "set",
    "name": "set vnf-index=0",
    "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
    "comments": "",
    "x": 1120.9937705993652,
    "y": 132.74371528625488,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "7e7a019f.eac06",
    "type": "set",
    "name": "set vnf-index = vnf_length",
    "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
    "comments": "",
    "x": 1321.993782043457,
    "y": 149.31512928009033,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "6d299d3a.328f54",
    "type": "for",
    "name": "for each existing VNF",
    "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1304.422248840332,
    "y": 189.31509113311768,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "984f572c.ac6fc8"
      ]
    ]
  },
  {
    "id": "984f572c.ac6fc8",
    "type": "switchNode",
    "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
    "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1662.7080307006836,
    "y": 188.88659477233887,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "51f1d598.2ca1cc"
      ]
    ]
  },
  {
    "id": "bbaa30a9.5e134",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
    "comments": "",
    "x": 2105.5650024414062,
    "y": 189.4580249786377,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "51f1d598.2ca1cc",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1967.9936714172363,
    "y": 188.45802116394043,
    "z": "61d54760.a4d0c8",
    "wires": [
      [
        "bbaa30a9.5e134"
      ]
    ]
  },
  {
    "id": "44f64d1d.aa7064",
    "type": "execute",
    "name": "execute generate-vnf-index",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-index\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 706.9936218261719,
    "y": 275.60077476501465,
    "z": "61d54760.a4d0c8",
    "wires": [
      []
    ]
  },
  {
    "id": "4c4bb443.a3389c",
    "type": "set",
    "name": "set new vnf_length",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
    "comments": "",
    "x": 680.9936065673828,
    "y": 240.60078287124634,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "f0cbc16c.cad4b",
    "type": "set",
    "name": "set vnf-level-oper-status to Created",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
    "comments": "",
    "x": 719.9936294555664,
    "y": 691.6010417938232,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "5baacb87.e7da64",
    "type": "set",
    "name": "copy input data",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
    "comments": "",
    "x": 659.8468208312988,
    "y": 645.5972957611084,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "a062fc34.476f9",
    "type": "save",
    "name": "save service relationship in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id \n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"wan-port-config\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/wan-port-configs/wan-port-config/' + $prop.vnf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"wan-port-config.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-index`\" />",
    "comments": "",
    "outputs": 1,
    "x": 705.9936294555664,
    "y": 827.6010503768921,
    "z": "61d54760.a4d0c8",
    "wires": [
      []
    ]
  },
  {
    "id": "cf3398f4.969708",
    "type": "set",
    "name": "set vnf-index and vnf-object-path",
    "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-index`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />",
    "comments": "",
    "x": 712.9936294555664,
    "y": 735.601044178009,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "b5b128b4.4b50a8",
    "type": "record",
    "name": "record",
    "xml": "<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.FileRecorder\">\n<parameter name=\"file\" value=\"/opt/opendaylight/current/data/log/svclogic.log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"sdwan-wanport-vnf-topology-operation-create\"/>\n<parameter name=\"field3\" value=\"SDWAN-Config\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 645.0039329528809,
    "y": 328.0039367675781,
    "z": "61d54760.a4d0c8",
    "wires": [
      []
    ]
  },
  {
    "id": "e311900d.ece88",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 825.0042266845703,
    "y": 416.0039920806885,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "3e1cd824.f76ba8",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1145.038818359375,
    "y": 394.9830369949341,
    "z": "61d54760.a4d0c8",
    "wires": [
      []
    ]
  },
  {
    "id": "706d3a5.3e853c4",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1113.4833221435547,
    "y": 463.98312282562256,
    "z": "61d54760.a4d0c8",
    "wires": []
  },
  {
    "id": "795a527a.112ffc",
    "type": "call",
    "name": "call sdwan-get-wan-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-wan-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 705.0043487548828,
    "y": 576.0042514801025,
    "z": "61d54760.a4d0c8",
    "wires": [
      []
    ]
  },
  {
    "id": "f82a7101.bfc5b",
    "type": "set",
    "name": "set vnf-request-input.",
    "xml": "<set>\n<parameter name='vnf-request-input.' value='`$vnf-topology-operation-input.vnf-request-input.`' />\n",
    "comments": "",
    "x": 671.0039367675781,
    "y": 544.004054069519,
    "z": "61d54760.a4d0c8",
    "wires": []
  }
]
