[
  {
    "id": "469452cb.bb081c",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 110.00390625,
    "y": 47.00390625,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "c7697d03.d4e67"
      ]
    ]
  },
  {
    "id": "c7697d03.d4e67",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 209.28960418701172,
    "y": 121.24201414268464,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "1e04cec3.e58791"
      ]
    ]
  },
  {
    "id": "1e04cec3.e58791",
    "type": "method",
    "name": "method sdwan-vnf-topology-operation-wanport-create",
    "xml": "<method rpc='sdwan-vnf-topology-operation-wanport-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 233.43252563476562,
    "y": 210.0039258003235,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "415535ab.ee3b9c"
      ]
    ]
  },
  {
    "id": "415535ab.ee3b9c",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 341.6706085205078,
    "y": 417.67058992385864,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "d5db9f82.a9caa",
        "105b56f8.ca1c29",
        "e1b2d352.980df",
        "5e7b33b7.c9f95c",
        "1e1b598f.ff6d76",
        "24d8ed6f.1c08a2",
        "76af4df6.0affe4",
        "8d749358.a9898",
        "a234fc68.a7971",
        "f1475869.e78fd8",
        "a35f1e97.dfac6",
        "788b5a8e.cd86b4",
        "17c0b4a9.0b865b"
      ]
    ]
  },
  {
    "id": "d5db9f82.a9caa",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 631.3375396728516,
    "y": 869.3377075195312,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "105b56f8.ca1c29",
    "type": "save",
    "name": "save sdwan device port configuration in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='wan-port-config' \n      key='wan-port-config.id = $prop.vnf-index' >\n<parameter name=\"id\" value=\"`$prop.vnf-index`\" />\n<parameter name=\"name\" value=\"`$prop.wan.name`\" />\n<parameter name=\"device-id\" value=\"`$prop.wan.deviceName`\" />\n<parameter name='vlan-id' value=\"`$prop.wan.vlanId`\" />\n<parameter name=\"ip-address\" value=\"`$prop.wan.ipAdddress`\" />\n<parameter name=\"provider-ip-address\" value=\"`$prop.wan.providerIpAddress`\" />\n<parameter name=\"input-bandwidth\" value=\"`$prop.wan.inputBandwidth`\" />\n<parameter name=\"output-bandwidth\" value=\"`$prop.wan.outputBandwidth`\" />\n<parameter name=\"description\" value=\"`$prop.wan.description`\" />\n<parameter name=\"port-type\" value=\"`$prop.wan.portType`\" />\n<parameter name=\"port-number\" value=\"`$prop.wan.portNumber`\" />\n<parameter name=\"transport-network-name\" value=\"`$prop.wan.transportNetworkName`\" />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />\n",
    "comments": "",
    "outputs": 1,
    "x": 718.0042953491211,
    "y": 776.5599503517151,
    "z": "fb90012b.616c1",
    "wires": [
      []
    ]
  },
  {
    "id": "e1b2d352.980df",
    "type": "for",
    "name": "for loop idx - VNF input parameters",
    "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
    "comments": "",
    "outputs": 1,
    "x": 696.0043640136719,
    "y": 443.67932987213135,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "971e9894.559198"
      ]
    ]
  },
  {
    "id": "971e9894.559198",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 910.7827072143555,
    "y": 441.23491382598877,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "5db5d5cb.e3665c",
        "137642b5.af1c4d"
      ]
    ]
  },
  {
    "id": "54f3a8ba.c8c8f8",
    "type": "comment",
    "name": "set input parameters",
    "info": "",
    "comments": "",
    "x": 914.6775550842285,
    "y": 569.6009178161621,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "5e7b33b7.c9f95c",
    "type": "switchNode",
    "name": "switch service-data.vnfs.vnf_length",
    "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 706.9937286376953,
    "y": 140.60080528259277,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "58cb915c.e63fb",
        "61229cc4.7e2a84"
      ]
    ]
  },
  {
    "id": "58cb915c.e63fb",
    "type": "other",
    "name": "NULL",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 943.7079563140869,
    "y": 130.7436351776123,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "2a580441.a1df1c"
      ]
    ]
  },
  {
    "id": "61229cc4.7e2a84",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 939.1366729736328,
    "y": 169.02948570251465,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "ea6697cb.65e638"
      ]
    ]
  },
  {
    "id": "ea6697cb.65e638",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1071.8508682250977,
    "y": 174.02942562103271,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "1f8d31b6.15942e",
        "3f14ea6e.335126"
      ]
    ]
  },
  {
    "id": "2a580441.a1df1c",
    "type": "set",
    "name": "set vnf-index=0",
    "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
    "comments": "",
    "x": 1099.9937705993652,
    "y": 129.74371528625488,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "1f8d31b6.15942e",
    "type": "set",
    "name": "set vnf-index = vnf_length",
    "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
    "comments": "",
    "x": 1300.993782043457,
    "y": 146.31512928009033,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "3f14ea6e.335126",
    "type": "for",
    "name": "for each existing VNF",
    "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1283.422248840332,
    "y": 186.31509113311768,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "5dff7a8c.9711b4"
      ]
    ]
  },
  {
    "id": "5dff7a8c.9711b4",
    "type": "switchNode",
    "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
    "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1641.7080307006836,
    "y": 185.88659477233887,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "b200b751.6600d8"
      ]
    ]
  },
  {
    "id": "5634d26b.2c620c",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
    "comments": "",
    "x": 2084.5650024414062,
    "y": 186.4580249786377,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "b200b751.6600d8",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1946.9936714172363,
    "y": 185.45802116394043,
    "z": "fb90012b.616c1",
    "wires": [
      [
        "5634d26b.2c620c"
      ]
    ]
  },
  {
    "id": "24d8ed6f.1c08a2",
    "type": "execute",
    "name": "execute generate-vnf-index",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-index\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 685.9936218261719,
    "y": 272.60077476501465,
    "z": "fb90012b.616c1",
    "wires": [
      []
    ]
  },
  {
    "id": "1e1b598f.ff6d76",
    "type": "set",
    "name": "set new vnf_length",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
    "comments": "",
    "x": 659.9936065673828,
    "y": 237.60078287124634,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "8d749358.a9898",
    "type": "set",
    "name": "set vnf-level-oper-status to Created",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
    "comments": "",
    "x": 704.9936981201172,
    "y": 688.6010332107544,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "76af4df6.0affe4",
    "type": "set",
    "name": "copy input data",
    "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
    "comments": "",
    "x": 638.8468208312988,
    "y": 642.5972957611084,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "a234fc68.a7971",
    "type": "save",
    "name": "save service relationship in AAI",
    "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id \n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"wan-port-config\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/wan-port-configs/wan-port-config/' + $prop.vnf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"wan-port-config.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-index`\" />",
    "comments": "",
    "outputs": 1,
    "x": 688.9936981201172,
    "y": 824.6011228561401,
    "z": "fb90012b.616c1",
    "wires": [
      []
    ]
  },
  {
    "id": "f1475869.e78fd8",
    "type": "set",
    "name": "set vnf-index and vnf-object-path",
    "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-index`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-index  + '/vnf-data/'` \" />",
    "comments": "",
    "x": 691.9936294555664,
    "y": 732.601044178009,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "a35f1e97.dfac6",
    "type": "record",
    "name": "record",
    "xml": "<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.FileRecorder\">\n<parameter name=\"file\" value=\"/opt/opendaylight/current/data/log/svclogic.log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"sdwan-wanport-vnf-topology-operation-create\"/>\n<parameter name=\"field3\" value=\"SDWAN-Config\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 624.0039329528809,
    "y": 325.0039367675781,
    "z": "fb90012b.616c1",
    "wires": [
      []
    ]
  },
  {
    "id": "e6a6ec15.a72f5",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 804.0042266845703,
    "y": 413.0039920806885,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "5db5d5cb.e3665c",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1124.038818359375,
    "y": 391.9830369949341,
    "z": "fb90012b.616c1",
    "wires": [
      []
    ]
  },
  {
    "id": "137642b5.af1c4d",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1092.4833221435547,
    "y": 460.98312282562256,
    "z": "fb90012b.616c1",
    "wires": []
  },
  {
    "id": "788b5a8e.cd86b4",
    "type": "call",
    "name": "call sdwan-get-wan-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-wan-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 669.0043525695801,
    "y": 574.0043067932129,
    "z": "fb90012b.616c1",
    "wires": [
      []
    ]
  },
  {
    "id": "17c0b4a9.0b865b",
    "type": "set",
    "name": "set vnf-request-input.",
    "xml": "<set>\n<parameter name='vnf-request-input.' value='`$vnf-topology-operation-input.vnf-request-input.`' />\n",
    "comments": "",
    "x": 650.0039367675781,
    "y": 541.004054069519,
    "z": "fb90012b.616c1",
    "wires": []
  }
]
