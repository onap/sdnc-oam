[{"id":"9d78fb25.8da918","type":"dgstart","name":"DGSTART","outputs":1,"x":128,"y":76.81381225585938,"z":"af884d85.e79ff","wires":[["900b6f3d.c1c1"]]},{"id":"d35e37bc.ff7dc8","type":"method","name":"eipam-allocate-network-role-subnet","xml":"<method rpc='eipam-allocate-network-role-subnet' mode='sync'>\n","comments":"","outputs":1,"x":681.8667907714844,"y":79.68048095703125,"z":"af884d85.e79ff","wires":[["ba9acfa1.1a81c"]]},{"id":"900b6f3d.c1c1","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":356.95001220703125,"y":80.13049697875977,"z":"af884d85.e79ff","wires":[["d35e37bc.ff7dc8"]]},{"id":"f80c53d6.792a7","type":"comment","name":"ChangeLog","info":"1.0.0: Release 1702 - EIPAM only allows allocating one address plan request at a time\n1.0.1: Release 1702 - introduced new input, eipam-ip-block.allocate-version to call EIPAM allocateSubnet individually\n                    - change toplevel block to Atomic, so if subet already exists, then it returns as failure\n                    - Update error msg\n1.0.2: Release 1702 - Remove check for existing subnet so can be called to create multiple subnet with same CLII_ZONE & NETWORK_ROLE, as \n\t\t\t\t\t\tin the autogrowth scenario\n1.0.3: Release 1702 - Req update to change level 1 & 2 key-name & key-values\n\t\t\t\t\t- update status to ACTIVE for level subnet\n\t\t\t\t\t- update service-type from $network-topology-operation-input.service-information.subscription-service-type to $tmp.service-type\n\t\t\t\t\t(cannot use the input field as not always populated in NTO-assign)\n\t\t\t\t\t- check for error when querying for entry in EIPAM_IP_POOLS before inserting to EIPAM_IP_SUBNETS\n1.0.4: Release 1707 - Add eipam-ip-block.subnet-size-override for level 2\n\n5/10 - 1707 - updated pool key-names for AIC_AIM_LANDING_NETWORK_V4\n6/20 - 1710 - change any underscores _  to colon : for all level 1 and level 2 Pool KeyNames\n6/21 - 1710 - Task 403314 - QIP Parent pool consolidation\n\t\t\t- New V6 plans - \n\t\t\t\tAIC_ATM_UNPROTECTED_V6\n\t\t\t\tAIC_ATM_PROTECTED_V6\n\t\t\t\tAIC_AIM_LANDING_V6\n\t\t\t\t\n","comments":"","x":183.68618774414062,"y":112,"z":"af884d85.e79ff","wires":[]},{"id":"ba9acfa1.1a81c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":150.68618774414062,"y":209.87387084960938,"z":"af884d85.e79ff","wires":[["ee269459.0d29d8","82edc9cf.f072c8","3e573341.752dac"]]},{"id":"ee269459.0d29d8","type":"set","name":"set: data initialization","xml":"<set>\n\t<parameter name=\"tmp.eipam-error\" value=\"false\" />\n\t<parameter name=\"eipam-ip-block.ip-prefix\" value='' />\n\t<parameter name=\"eipam-ip-block.mask\" value='' />\n\t<parameter name=\"pfx.eipam-pool-row\" value='' />\n\t<parameter name=\"tmp.level1-key-name\" value=\"CLLI:CLOUD_REGION\" />\n\t<parameter name=\"tmp.level2-key-name\" value=\"NETWORK_ROLE:NETWORK_ID\" />","comments":"","x":365.1201171875,"y":208.81381225585938,"z":"af884d85.e79ff","wires":[]},{"id":"5d98bd32.198a54","type":"set","name":"set EIPAM plan info for Level 2 pool for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"N\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"Y\"/>\n\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"2\"/>\n\n\t<!-- Level 1 -->\n\t<parameter name=\"eipam-ip-block.pools[0].key-name\" value=\"`$tmp.level1-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[0].key-value\" value=\"`$tmp.level1-key-value`\"/>\n\n\t<!-- Level 2 -->\n\t<parameter name=\"eipam-ip-block.pools[1].key-name\" value=\"`$tmp.level2-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[1].key-value\" value=\"`$tmp.level2-key-value`\"/>","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2131.9706802368164,"y":505.6710214614868,"z":"af884d85.e79ff","wires":[]},{"id":"82edc9cf.f072c8","type":"switchNode","name":"switch: eipam-ip-block.allocate-version","xml":"<switch test=\"`$eipam-ip-block.allocate-version`\">","comments":"Need to know which ipv version to get the plan name from the network-model.","outputs":1,"x":370,"y":551.8138084411621,"z":"af884d85.e79ff","wires":[["f2b84662.2a28c8","73d6dbe6.4a70f4","fd5c5be.70454a8"]]},{"id":"f2b84662.2a28c8","type":"other","name":"ipv4","xml":"<outcome value='ipv4'>","comments":"","outputs":1,"x":610.000114440918,"y":411.8138122558594,"z":"af884d85.e79ff","wires":[["797fa21e.81a99c"]]},{"id":"797fa21e.81a99c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":764.000057220459,"y":410.81381607055664,"z":"af884d85.e79ff","wires":[["db16e381.0a927"]]},{"id":"73d6dbe6.4a70f4","type":"other","name":"Null","xml":"<outcome value=''>","comments":"","outputs":1,"x":552.0000610351562,"y":1213.0541076660156,"z":"af884d85.e79ff","wires":[["f625de69.a30ae"]]},{"id":"b4f8397b.808218","type":"set","name":"set EIPAM plan info for Level 1 pool for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v6-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"Y\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"N\"/>\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"1\"/>\n\n\t<!-- Level 1 -->\n\t<parameter name=\"eipam-ip-block.pools[0].key-name\" value=\"`$tmp.level1-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[0].key-value\" value=\"`$tmp.level1-key-value`\"/>","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2137.736862182617,"y":1018.8138976097107,"z":"af884d85.e79ff","wires":[]},{"id":"cc146f0d.ef15","type":"set","name":"set EIPAM plan info for Level 2 pool for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v6-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"N\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"Y\"/>\n\t\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"2\"/>\n\n\t<!-- Level 1 -->\n\t<parameter name=\"eipam-ip-block.pools[0].key-name\" value=\"`$tmp.level1-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[0].key-value\" value=\"`$tmp.level1-key-value`\"/>\n\n\t<!-- Level 2 -->\n\t<parameter name=\"eipam-ip-block.pools[1].key-name\" value=\"`$tmp.level2-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[1].key-value\" value=\"`$tmp.level2-key-value`\"/>","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2188.564437866211,"y":1464.0996627807617,"z":"af884d85.e79ff","wires":[]},{"id":"65bbfb9e.a49d24","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":766.8799324035645,"y":1097.8138160705566,"z":"af884d85.e79ff","wires":[["4d50f209.31bbec"]]},{"id":"2fafc82a.bc12e8","type":"get-resource","name":"get-resource V4 - validate if level 2 subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v4-address-plan and s.network_id = $tmp.network-id and s.entity_id = k.entity_id and k.level = 2 and k.key_value = $network-model.network-role ;\"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":2256.999969482422,"y":469.0000305175781,"z":"af884d85.e79ff","wires":[["2f55848b.f08e5c","de928710.7cb6a8","2a00bb0d.8dc174"]]},{"id":"1875a49c.c38f6b","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNET_KEYS and EIPAM_IP_SUBNETS failed.\" />\n\t","comments":"","x":2677.9998626708984,"y":422.0000305175781,"z":"af884d85.e79ff","wires":[]},{"id":"2f55848b.f08e5c","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2529.999954223633,"y":460.0000305175781,"z":"af884d85.e79ff","wires":[["ae4526b8.ab5478"]]},{"id":"db16e381.0a927","type":"switchNode","name":"switch: eipam-ip-block.level","xml":"<switch test=\"`$eipam-ip-block.level`\">","comments":"","outputs":1,"x":987.0810928344727,"y":410.99999618530273,"z":"af884d85.e79ff","wires":[["ad4bebf.6ec2118","ebec96ad.d0a718","ab9c32c6.9fd19"]]},{"id":"ad4bebf.6ec2118","type":"other","name":"2","xml":"<outcome value='2'>","comments":"","outputs":1,"x":1134.0812072753906,"y":523,"z":"af884d85.e79ff","wires":[["e4c14f7a.9980d"]]},{"id":"ebec96ad.d0a718","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1110.0812072753906,"y":653.0000305175781,"z":"af884d85.e79ff","wires":[["305345ea.b1a54a"]]},{"id":"305345ea.b1a54a","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.level for appropriate EIPAM request.\" />\n\t","comments":"","x":1270.0811767578125,"y":653.0000610351562,"z":"af884d85.e79ff","wires":[]},{"id":"de928710.7cb6a8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2528.8617401123047,"y":424.0000305175781,"z":"af884d85.e79ff","wires":[["1875a49c.c38f6b"]]},{"id":"2a00bb0d.8dc174","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2532.861770629883,"y":496.0000305175781,"z":"af884d85.e79ff","wires":[[]]},{"id":"d0aa2357.d318f","type":"get-resource","name":"get-resource V4 - validate if level 1 subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v4-address-plan and s.entity_id = k.entity_id and k.level = 1 and k.key_value = $tmp.level1-key-value ; \"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":2050.411331176758,"y":67.99999237060547,"z":"af884d85.e79ff","wires":[["93f2cc3a.b0aa8","9a9a66f7.3a6078","6f91b4fe.93cf2c"]]},{"id":"83766193.dc8cc","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNET_KEYS and EIPAM_IP_SUBNETS failed.\" />\n\t","comments":"","x":2471.4113159179688,"y":20,"z":"af884d85.e79ff","wires":[]},{"id":"93f2cc3a.b0aa8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2323.411407470703,"y":58,"z":"af884d85.e79ff","wires":[["fc0f2420.6aefd8"]]},{"id":"ab9c32c6.9fd19","type":"other","name":"1","xml":"<outcome value='1'>","comments":"","outputs":1,"x":1127.4925231933594,"y":216,"z":"af884d85.e79ff","wires":[["6dd579f2.58b018"]]},{"id":"9a9a66f7.3a6078","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2322.273193359375,"y":22,"z":"af884d85.e79ff","wires":[["83766193.dc8cc"]]},{"id":"6f91b4fe.93cf2c","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2326.273223876953,"y":94,"z":"af884d85.e79ff","wires":[[]]},{"id":"a449a4a2.cb78d8","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"201\" />\n","comments":"","x":2677.1500549316406,"y":88,"z":"af884d85.e79ff","wires":[]},{"id":"61ecde9a.69227","type":"get-resource","name":"get-resource V6 - validate if level 2 subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v6-address-plan and s.network_id = $tmp.network-id and s.entity_id = k.entity_id and k.level = 2 and k.key_value = $network-model.network-role ;\"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":1408.636459350586,"y":1386.1141357421875,"z":"af884d85.e79ff","wires":[["ae21a219.72b19","9045464c.c34088","8ad23758.1a1c08"]]},{"id":"5bbb3e3d.f153","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNET_KEYS and EIPAM_IP_SUBNETS failed.\" />\n\t","comments":"","x":1829.636245727539,"y":1337.1141357421875,"z":"af884d85.e79ff","wires":[]},{"id":"ae21a219.72b19","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1681.6364440917969,"y":1375.1141357421875,"z":"af884d85.e79ff","wires":[["64ab1a79.79a634"]]},{"id":"4d50f209.31bbec","type":"switchNode","name":"switch: eipam-ip-block.level","xml":"<switch test=\"`$eipam-ip-block.level`\">","comments":"","outputs":1,"x":973.7175750732422,"y":1094.2569961547852,"z":"af884d85.e79ff","wires":[["4591adec.ffb634","ebaca2f.16b246","8a7bbb2b.80f878"]]},{"id":"4591adec.ffb634","type":"other","name":"2","xml":"<outcome value='2'>","comments":"","outputs":1,"x":1138.7174987792969,"y":1460.1141357421875,"z":"af884d85.e79ff","wires":[["308b870d.1f9aa8"]]},{"id":"ebaca2f.16b246","type":"other","name":"NULL","xml":"<outcome value=''>","comments":"","outputs":1,"x":1135.7174987792969,"y":1505.1141357421875,"z":"af884d85.e79ff","wires":[["c041621d.2bed1"]]},{"id":"c041621d.2bed1","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.level for appropriate EIPAM request.\" />\n\t","comments":"","x":1295.7173767089844,"y":1505.1141357421875,"z":"af884d85.e79ff","wires":[]},{"id":"9045464c.c34088","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1680.4982299804688,"y":1339.1141357421875,"z":"af884d85.e79ff","wires":[["5bbb3e3d.f153"]]},{"id":"8ad23758.1a1c08","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":1684.4982604980469,"y":1411.1141357421875,"z":"af884d85.e79ff","wires":[[]]},{"id":"4a066f5e.85d33","type":"get-resource","name":"get-resource V6 - validate if level 1 subnet does not exists","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_SUBNETS s, EIPAM_IP_SUBNET_KEYS k WHERE s.plan_name = $network-model.eipam-v6-address-plan and s.entity_id = k.entity_id and k.level = 1 and k.key_value = $tmp.level1-key-value ;\"\n        pfx='tmp.eipam-subnet-row'>\n\n","comments":"","outputs":1,"x":1990.0480270385742,"y":843.1141834259033,"z":"af884d85.e79ff","wires":[["840cadc8.a9cb6","3888df63.597fd","b3d793ce.fda54"]]},{"id":"6901fbcf.b89164","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Query to DB table EIPAM_IP_SUBNET_KEYS and EIPAM_IP_SUBNETS failed.\" />\n\t","comments":"","x":2411.0480308532715,"y":794.1142139434814,"z":"af884d85.e79ff","wires":[]},{"id":"840cadc8.a9cb6","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2263.048122406006,"y":832.1142139434814,"z":"af884d85.e79ff","wires":[["61aba367.170f9c"]]},{"id":"8a7bbb2b.80f878","type":"other","name":"1","xml":"<outcome value='1'>","comments":"","outputs":1,"x":1137.1290168762207,"y":988.1141662597656,"z":"af884d85.e79ff","wires":[["ff91e5b0.4d5e38"]]},{"id":"3888df63.597fd","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2261.9099082946777,"y":796.1142139434814,"z":"af884d85.e79ff","wires":[["6901fbcf.b89164"]]},{"id":"b3d793ce.fda54","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2265.909938812256,"y":868.1142139434814,"z":"af884d85.e79ff","wires":[[]]},{"id":"daf71f52.1419","type":"set","name":"set EIPAM plan info for Level 1 pool for allocateSubnet","xml":"<set>\n\t<parameter name=\"eipam-ip-block.plan-name\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n\t<parameter name=\"eipam-ip-block.activate-subnet-flag\" value=\"Y\"/>\t\n\t<parameter name=\"eipam-ip-block.leaf-level-indicator\" value=\"N\"/>\n\t<!-- Number of Pool Levels -->\n\t<parameter name=\"eipam-ip-block.pools_length\" value=\"1\"/>\n\n\t<!-- Level 1 -->\n\t<parameter name=\"eipam-ip-block.pools[0].key-name\" value=\"`$tmp.level1-key-name`\"/>\n\t<parameter name=\"eipam-ip-block.pools[0].key-value\" value=\"`$tmp.level1-key-value`\"/>","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2124.534698486328,"y":180.81381225585938,"z":"af884d85.e79ff","wires":[]},{"id":"3fad2aec.a70926","type":"save","name":"insert EIPAM_IP_SUBNETS for level 1 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v4-address-plan ,\n             status = 'ACTIVE' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv4-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-row'>\n","comments":"","outputs":1,"x":2094.540802001953,"y":325.96417236328125,"z":"af884d85.e79ff","wires":[["61c10117.b9459","1a12c79c.b44ef8"]]},{"id":"6dd579f2.58b018","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1332.4894104003906,"y":213.96395874023438,"z":"af884d85.e79ff","wires":[["daf71f52.1419","8136ada7.7f831","3fad2aec.a70926","950dccde.bc93d","74c5e3f9.66273c","6a5af7e2.3dc6d8"]]},{"id":"8136ada7.7f831","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":2055.0812072753906,"y":225.81381225585938,"z":"af884d85.e79ff","wires":[["dcf19076.269d2"]]},{"id":"dcf19076.269d2","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2265.0812377929688,"y":227.2041778564453,"z":"af884d85.e79ff","wires":[["8274ac50.7d1b5"]]},{"id":"8274ac50.7d1b5","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2429.081268310547,"y":230.20420837402344,"z":"af884d85.e79ff","wires":[]},{"id":"e4c14f7a.9980d","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1314.5705871582031,"y":524.8138122558594,"z":"af884d85.e79ff","wires":[["5d98bd32.198a54","3ed4edab.9101d2","56faed60.ea7514","c58b39d.02995c8","1180173f.f62099","826cf92.097f708","d6ec4d5a.4fa56","2244b12.dafd04e"]]},{"id":"3ed4edab.9101d2","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":2059.6126403808594,"y":571.8138122558594,"z":"af884d85.e79ff","wires":[["2c4f9b60.58a254"]]},{"id":"2c4f9b60.58a254","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2269.6126708984375,"y":573.2041778564453,"z":"af884d85.e79ff","wires":[["12bdf050.06dfd"]]},{"id":"12bdf050.06dfd","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2433.6127014160156,"y":576.2042083740234,"z":"af884d85.e79ff","wires":[]},{"id":"56faed60.ea7514","type":"save","name":"insert EIPAM_IP_SUBNETS for level 2 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v4-address-plan ,\n             status = 'ALLOCATED' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv4-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-subnet-row'>\n","comments":"","outputs":1,"x":2094.612518310547,"y":679.8138732910156,"z":"af884d85.e79ff","wires":[["57363548.9396cc","211c740e.cf417c"]]},{"id":"c58b39d.02995c8","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 1 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level1-key-name ,\n             key_value = $tmp.level1-key-value ,\n             level = 1 ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-key-row'>\n","comments":"","outputs":1,"x":2109.612335205078,"y":721.8138160705566,"z":"af884d85.e79ff","wires":[["211c740e.cf417c","3f850f8f.72c47"]]},{"id":"1180173f.f62099","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 2 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level2-key-name ,\n             key_value = $tmp.level2-key-value ,\n             level = 2 ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-key-row'>\n","comments":"","outputs":1,"x":2108.6124572753906,"y":767.8138465881348,"z":"af884d85.e79ff","wires":[["211c740e.cf417c","3f850f8f.72c47"]]},{"id":"950dccde.bc93d","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 1 V4","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level1-key-name ,\n             key_value = $tmp.level1-key-value ,\n             level = 1 ; \"\n    force='true'\n        pfx='pfx.eipam-v4subnet-key-row'>\n","comments":"","outputs":1,"x":2112.816864013672,"y":362.9639587402344,"z":"af884d85.e79ff","wires":[["1a12c79c.b44ef8","fc216a73.da41f8"]]},{"id":"74c5e3f9.66273c","type":"get-resource","name":"get-resource V4 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v4-address-plan and level = 1 and key_value = $tmp.level1-key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":2054.189239501953,"y":274.81380462646484,"z":"af884d85.e79ff","wires":[["b7560d4.843d4f","7f808d14.fa37e4"]]},{"id":"826cf92.097f708","type":"get-resource","name":"get-resource V4 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v4-address-plan and level = 2 and parent_pool = $tmp.level1-key-value AND key_value = $tmp.level2-key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":2051.188995361328,"y":623.8138732910156,"z":"af884d85.e79ff","wires":[["827b1620.4c4d08","cdde130e.69af4"]]},{"id":"1fd6bf21.0a00b1","type":"save","name":"insert EIPAM_IP_SUBNETS for level 1 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v6-address-plan ,\n             status = 'ACTIVE' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv6-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-row'>\n","comments":"","outputs":1,"x":2107.3451232910156,"y":1168.4146118164062,"z":"af884d85.e79ff","wires":[["25e2d931.1b6566","82bca903.e58df8"]]},{"id":"b05ae73e.f76a38","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":2067.8855895996094,"y":1070.2642517089844,"z":"af884d85.e79ff","wires":[["4693175c.e53f58"]]},{"id":"4693175c.e53f58","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2277.8856201171875,"y":1071.6546173095703,"z":"af884d85.e79ff","wires":[["b82df8d0.875478"]]},{"id":"b82df8d0.875478","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2441.8856506347656,"y":1074.6546478271484,"z":"af884d85.e79ff","wires":[]},{"id":"9adb7ede.b6ee6","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 1 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level1-key-name ,\n             key_value = $tmp.level1-key-value ,\n             level = 1 ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-key-row'>\n","comments":"","outputs":1,"x":2125.6212463378906,"y":1207.4143981933594,"z":"af884d85.e79ff","wires":[["a03e18b9.56ab08","82bca903.e58df8"]]},{"id":"32c22ce1.cfbb64","type":"get-resource","name":"get-resource V6 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v6-address-plan and level = 1 and key_value = $tmp.level1-key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":2066.9935607910156,"y":1116.2642822265625,"z":"af884d85.e79ff","wires":[["3e64d396.04c79c","96a0c906.f7cd38"]]},{"id":"13462f06.ec5931","type":"execute","name":"execute EIPAM allocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"allocateSubnet\">\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":2122.2672424316406,"y":1542.7146453857422,"z":"af884d85.e79ff","wires":[["9ded8a81.952bf8"]]},{"id":"9ded8a81.952bf8","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2332.2672729492188,"y":1544.1050109863281,"z":"af884d85.e79ff","wires":[["f5bc2f24.a6b84"]]},{"id":"f5bc2f24.a6b84","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while allocating V4 subnet in EIPAM.\" />\n\t","comments":"","x":2496.2672424316406,"y":1547.10498046875,"z":"af884d85.e79ff","wires":[]},{"id":"3e343055.aa6c4","type":"save","name":"insert EIPAM_IP_SUBNETS for level 2 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNETS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             service_type = $tmp.service-type ,\n             ip_address = $eipam-ip-block.ip-prefix ,\n             prefix_length = $eipam-ip-block.mask ,\n             plan_name = $network-model.eipam-v6-address-plan ,\n             status = 'ALLOCATED' ,\n             pool_id = $pfx.eipam-pool-row.pool-id ,\n             address_family = $network-model.ipv6-ip-version ,\n             network_id = $tmp.network-id ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-row'>\n","comments":"","outputs":1,"x":2154.267120361328,"y":1650.7147216796875,"z":"af884d85.e79ff","wires":[["dc201cfd.44ef1","60365290.cd138c"]]},{"id":"55a6980.64c9068","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 1 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level1-key-name ,\n             key_value = $tmp.level1-key-value ,\n             level = 1 ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-key-row'>\n","comments":"","outputs":1,"x":2172.2669372558594,"y":1692.7146492004395,"z":"af884d85.e79ff","wires":[["60365290.cd138c","249dd9a9.94ecc6"]]},{"id":"9747e41b.cbfc48","type":"save","name":"insert EIPAM_IP_SUBNET_KEYS for level 2 V6","xml":"<save\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"INSERT EIPAM_IP_SUBNET_KEYS\n             SET\n             entity_id = $eipam-ip-block.entity-id ,\n             key_name = $tmp.level2-key-name ,\n             key_value = $tmp.level2-key-value ,\n             level = 2 ; \"\n    force='true'\n        pfx='pfx.eipam-v6subnet-key-row'>\n","comments":"","outputs":1,"x":2171.267059326172,"y":1738.7146797180176,"z":"af884d85.e79ff","wires":[["60365290.cd138c","249dd9a9.94ecc6"]]},{"id":"4fae9372.cdb14c","type":"get-resource","name":"get-resource V6 - get pool_id","xml":"<get-resource\n        plugin='org.onap.ccsdk.sli.adaptors.sli.resource.sql.SqlResource'\n        resource='SQL'\n        key=\"SELECT * from EIPAM_IP_POOLS WHERE plan_name = $network-model.eipam-v6-address-plan and level = 2 and parent_pool = $tmp.level1-key-value AND key_value = $tmp.level2-key-value ; \"\n        pfx='pfx.eipam-pool-row'>\n\n","comments":"","outputs":1,"x":2118.8436584472656,"y":1596.7147216796875,"z":"af884d85.e79ff","wires":[["c412ff05.61872","8db85c57.32fac"]]},{"id":"ff91e5b0.4d5e38","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1305.9460144042969,"y":985.2643127441406,"z":"af884d85.e79ff","wires":[["b4f8397b.808218","b05ae73e.f76a38","32c22ce1.cfbb64","1fd6bf21.0a00b1","9adb7ede.b6ee6","22f94d7b.eb0dd2"]]},{"id":"308b870d.1f9aa8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1295.6607360839844,"y":1458.7147216796875,"z":"af884d85.e79ff","wires":[["cc146f0d.ef15","13462f06.ec5931","4fae9372.cdb14c","3e343055.aa6c4","55a6980.64c9068","9747e41b.cbfc48","963762f2.b6052","4f4eeaa0.dc8a84"]]},{"id":"fd5c5be.70454a8","type":"other","name":"ipv6","xml":"<outcome value='ipv6'>","comments":"","outputs":1,"x":582.7717437744141,"y":1095.9640197753906,"z":"af884d85.e79ff","wires":[["65bbfb9e.a49d24"]]},{"id":"3e573341.752dac","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"200\" />\n","comments":"","x":300,"y":684.1141662597656,"z":"af884d85.e79ff","wires":[]},{"id":"9adfc428.56b8e8","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"V4 Level 2 Subnet already exists.\" />\n\t","comments":"","x":2898.2161560058594,"y":511.8138427734375,"z":"af884d85.e79ff","wires":[]},{"id":"2ba67659.6b018a","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"V6 Level 1 Subnet already exists.\" />\n\t","comments":"","x":2272.216094970703,"y":966.2643127441406,"z":"af884d85.e79ff","wires":[]},{"id":"e7d56588.f6fc68","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"V6 Level 2 Subnet already exists.\" />\n\t","comments":"","x":2052.216278076172,"y":1413.7147216796875,"z":"af884d85.e79ff","wires":[]},{"id":"f625de69.a30ae","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"Please set the eipam-ip-block.allocate-version for appropriate EIPAM request.\" />\n\t","comments":"","x":719.1141052246094,"y":1213.5645751953125,"z":"af884d85.e79ff","wires":[]},{"id":"23c76a06.097e96","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"201\" />\n","comments":"","x":2614.159355163574,"y":864.4145069122314,"z":"af884d85.e79ff","wires":[]},{"id":"c01d1cf.e66dbe","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 1 subnet already exists, SKIP.\"/>\n<parameter name=\"field7\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n","comments":"","outputs":1,"x":2652.9159240722656,"y":48.813812255859375,"z":"af884d85.e79ff","wires":[[]]},{"id":"fb0abddf.f31a3","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 1 subnet already exists, SKIP.\"/>\n<parameter name=\"field7\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n","comments":"","outputs":1,"x":2593.366630554199,"y":833.2642993927002,"z":"af884d85.e79ff","wires":[[]]},{"id":"fc0f2420.6aefd8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2474.3663482666016,"y":53.813812255859375,"z":"af884d85.e79ff","wires":[["c01d1cf.e66dbe","a449a4a2.cb78d8"]]},{"id":"ae4526b8.ab5478","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2681.3662719726562,"y":457.96398544311523,"z":"af884d85.e79ff","wires":[["39c4b9ca.7881d6","9adfc428.56b8e8"]]},{"id":"c9e7ed18.fb707","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].plan-name`\"/>\n<parameter name=\"field5\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].requests[0].pools[0].key-name`\"/>\n<parameter name=\"field6\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].requests[0].pools[0].key-value`\"/>\n<parameter name=\"field7\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].requests[0].pools[1].key-name`\"/>\n<parameter name=\"field8\" value=\"`$eipam-ip-block.plans[$eipam-ip-block.plans_length].requests[0].pools[1].key-value`\"/>\n","comments":"","outputs":1,"x":2520.366241455078,"y":487.8138084411621,"z":"af884d85.e79ff","wires":[[]]},{"id":"39c4b9ca.7881d6","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 2 subnet already exists, SKIP.\"/>\n\n<!-- Level 2 -->\n\t<parameter name=\"field7\" value=\"NETWORK_ROLE_NETWORK_ID\"/>\n\t<parameter name=\"field8\" value=\"`$tmp.level2-key-value`\"/>\n","comments":"","outputs":1,"x":2877.3663024902344,"y":478.8138427734375,"z":"af884d85.e79ff","wires":[[]]},{"id":"61aba367.170f9c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2409.745048522949,"y":834.2643604278564,"z":"af884d85.e79ff","wires":[["fb0abddf.f31a3","23c76a06.097e96"]]},{"id":"64ab1a79.79a634","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1836.744888305664,"y":1372.7147216796875,"z":"af884d85.e79ff","wires":[["9520eb16.67d2a8","e7d56588.f6fc68"]]},{"id":"9520eb16.67d2a8","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 2 subnet already exists, SKIP.\"/>\n\n<!-- Level 2 -->\n\t<parameter name=\"field7\" value=\"NETWORK_ROLE_NETWORK_ID\"/>\n\t<parameter name=\"field8\" value=\"`$tmp.level2-key-value`\"/>\n","comments":"","outputs":1,"x":2038.7447814941406,"y":1374.8648681640625,"z":"af884d85.e79ff","wires":[[]]},{"id":"82b48f60.6d084","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2620.8376426696777,"y":321.96395111083984,"z":"af884d85.e79ff","wires":[]},{"id":"61c10117.b9459","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2405.8377990722656,"y":320.8138084411621,"z":"af884d85.e79ff","wires":[["82b48f60.6d084"]]},{"id":"1a12c79c.b44ef8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2401.9305725097656,"y":416.96395111083984,"z":"af884d85.e79ff","wires":[[]]},{"id":"57363548.9396cc","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2428.6458168029785,"y":695.8138465881348,"z":"af884d85.e79ff","wires":[["671fdfa6.ed9b"]]},{"id":"211c740e.cf417c","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2430.738800048828,"y":730.9640159606934,"z":"af884d85.e79ff","wires":[[]]},{"id":"25e2d931.1b6566","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2435.6458168029785,"y":1162.4144325256348,"z":"af884d85.e79ff","wires":[["65c7a1dc.26042"]]},{"id":"82bca903.e58df8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2447.738800048828,"y":1252.5645751953125,"z":"af884d85.e79ff","wires":[[]]},{"id":"dc201cfd.44ef1","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2502.645538330078,"y":1664.8648681640625,"z":"af884d85.e79ff","wires":[["41da34b9.6acf9c"]]},{"id":"60365290.cd138c","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":2509.738800048828,"y":1759.0150146484375,"z":"af884d85.e79ff","wires":[[]]},{"id":"101618fb.c286e7","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2620.9515686035156,"y":366.8138122558594,"z":"af884d85.e79ff","wires":[]},{"id":"fc216a73.da41f8","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2406.9520568847656,"y":367.6636657714844,"z":"af884d85.e79ff","wires":[["101618fb.c286e7"]]},{"id":"10e97b0.9f4c385","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2603.951446533203,"y":766.9640159606934,"z":"af884d85.e79ff","wires":[]},{"id":"3f850f8f.72c47","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2428.951934814453,"y":766.8138694763184,"z":"af884d85.e79ff","wires":[["10e97b0.9f4c385"]]},{"id":"671fdfa6.ed9b","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2596.9518127441406,"y":696.9639892578125,"z":"af884d85.e79ff","wires":[]},{"id":"14c77d95.9716d2","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2598.951690673828,"y":1203.4144287109375,"z":"af884d85.e79ff","wires":[]},{"id":"65c7a1dc.26042","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2597.952178955078,"y":1161.4144020080566,"z":"af884d85.e79ff","wires":[]},{"id":"a03e18b9.56ab08","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2436.951690673828,"y":1203.4144287109375,"z":"af884d85.e79ff","wires":[["14c77d95.9716d2"]]},{"id":"43b98d6f.bc4fd4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNET_KEYS table.' />\n","comments":"","x":2666.257598876953,"y":1713.0150146484375,"z":"af884d85.e79ff","wires":[]},{"id":"41da34b9.6acf9c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value='failed to update EIPAM_IP_SUBNETS table.' />\n","comments":"","x":2660.258087158203,"y":1663.0150146484375,"z":"af884d85.e79ff","wires":[]},{"id":"249dd9a9.94ecc6","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2504.257598876953,"y":1713.0150146484375,"z":"af884d85.e79ff","wires":[["43b98d6f.bc4fd4"]]},{"id":"22f94d7b.eb0dd2","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n<parameter name=\"field7\" value=\"Level 1 subnet saved to DB.\"/>","comments":"","outputs":1,"x":2012.9219055175781,"y":1249.7147216796875,"z":"af884d85.e79ff","wires":[[]]},{"id":"963762f2.b6052","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n\n<!-- Level 2 -->\n\t<parameter name=\"field6\" value=\"NETWORK_ROLE_NETWORK_ID\"/>\n\t<parameter name=\"field7\" value=\"`$tmp.level2-key-value`\"/>\n<parameter name=\"field8\" value=\"Level 2 subnet saved to DB.\"/>","comments":"","outputs":1,"x":2069.951934814453,"y":1802.3153076171875,"z":"af884d85.e79ff","wires":[[]]},{"id":"d6ec4d5a.4fa56","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n\n<!-- Level 2 -->\n\t<parameter name=\"field6\" value=\"NETWORK_ROLE_NETWORK_ID\"/>\n\t<parameter name=\"field7\" value=\"`$tmp.level2-key-value`\"/>\n<parameter name=\"field8\" value=\"Level 2 subnet saved to DB.\"/>","comments":"","outputs":1,"x":1989.9519348144531,"y":804.4144287109375,"z":"af884d85.e79ff","wires":[[]]},{"id":"6a5af7e2.3dc6d8","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level1-key-value`\"/>\n<parameter name=\"field6\" value=\"`$tmp.eipam-pool-row.pool-id`\"/>\n<parameter name=\"field7\" value=\"Level 1 subnet saved to DB.\"/>","comments":"","outputs":1,"x":1496.9519348144531,"y":299.9639587402344,"z":"af884d85.e79ff","wires":[[]]},{"id":"b7560d4.843d4f","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2257.1861877441406,"y":261.39998626708984,"z":"af884d85.e79ff","wires":[["e89ff97b.78ef88"]]},{"id":"e89ff97b.78ef88","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V4 subnet in EIPAM.\" />\n\t","comments":"","x":2462.1861877441406,"y":275.40001678466797,"z":"af884d85.e79ff","wires":[]},{"id":"7f808d14.fa37e4","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2271.1861877441406,"y":296.39998626708984,"z":"af884d85.e79ff","wires":[["e89ff97b.78ef88"]]},{"id":"827b1620.4c4d08","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2249.2911376953125,"y":618.595832824707,"z":"af884d85.e79ff","wires":[["ddcc1433.a96368"]]},{"id":"ddcc1433.a96368","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V4 subnet in EIPAM.\" />\n\t","comments":"","x":2454.2911376953125,"y":632.5958633422852,"z":"af884d85.e79ff","wires":[]},{"id":"cdde130e.69af4","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2263.2911376953125,"y":653.595832824707,"z":"af884d85.e79ff","wires":[["ddcc1433.a96368"]]},{"id":"3e64d396.04c79c","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2274.5860900878906,"y":1103.4000244140625,"z":"af884d85.e79ff","wires":[["5f7c6c18.d238a4"]]},{"id":"5f7c6c18.d238a4","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V6 subnet in EIPAM.\" />\n\t","comments":"","x":2479.5860900878906,"y":1117.4000549316406,"z":"af884d85.e79ff","wires":[]},{"id":"96a0c906.f7cd38","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2288.5860900878906,"y":1138.4000244140625,"z":"af884d85.e79ff","wires":[["5f7c6c18.d238a4"]]},{"id":"c412ff05.61872","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":2330.5860900878906,"y":1581.4000244140625,"z":"af884d85.e79ff","wires":[["8cc59441.64b398"]]},{"id":"8cc59441.64b398","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"tmp.eipam-error\" value=\"true\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"An error occured while looking for entry in EIPAM_IP_POOLS for V6 subnet in EIPAM.\" />\n\t","comments":"","x":2535.585968017578,"y":1595.4000244140625,"z":"af884d85.e79ff","wires":[]},{"id":"8db85c57.32fac","type":"not-found","name":"not-found","xml":"<outcome value=\"not-found\">","comments":"","outputs":1,"x":2344.5860900878906,"y":1616.4000244140625,"z":"af884d85.e79ff","wires":[["8cc59441.64b398"]]},{"id":"4a8b2577.7984dc","type":"switchNode","name":"switch: network-model.eipam-v4-address-plan","xml":"<switch test=\"`$network-model.eipam-v4-address-plan`\">","comments":"","outputs":1,"x":1042.5454330444336,"y":169.84091186523438,"z":"af884d85.e79ff","wires":[["2f687662.53b65a"]]},{"id":"2f687662.53b65a","type":"other","name":"AIC_AIM_LANDING_NETWORK_V4","xml":"<outcome value=\"AIC_AIM_LANDING_NETWORK_V4\">","comments":"","outputs":1,"x":1381.5454177856445,"y":163.84090614318848,"z":"af884d85.e79ff","wires":[["10891762.65bb69"]]},{"id":"10891762.65bb69","type":"set","name":"set key-names","xml":"<set>\n\t<parameter name=\"tmp.level1-key-name\" value=\"CLLI:CLOUD_REGION\" />\n\t<parameter name=\"tmp.level2-key-name\" value=\"NETWORK_ROLE:NETWORK_ID\" />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":1687.636215209961,"y":158.7499942779541,"z":"af884d85.e79ff","wires":[]},{"id":"36d2f99d.8a0186","type":"switchNode","name":"switch: network-model.eipam-v6-address-plan","xml":"<switch test=\"`$network-model.eipam-v6-address-plan`\">","comments":"","outputs":1,"x":1033.2366485595703,"y":928.3332672119141,"z":"af884d85.e79ff","wires":[["479f2e45.8de72","83a60962.897ed8","4b7654f6.8b1abc","be62e3d3.32c4"]]},{"id":"479f2e45.8de72","type":"other","name":"AIC_AIM_LANDING_NETWORK_V6","xml":"<outcome value=\"AIC_AIM_LANDING_NETWORK_V6\">","comments":"","outputs":1,"x":1372.2366333007812,"y":922.3332614898682,"z":"af884d85.e79ff","wires":[["13598bf8.358084"]]},{"id":"13598bf8.358084","type":"set","name":"set key-names","xml":"<set>\n\t<parameter name=\"tmp.level1-key-name\" value=\"CLLI:CLOUD_REGION\" />\n\t<parameter name=\"tmp.level2-key-name\" value=\"NETWORK_ROLE:NETWORK_ID\" />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":1678.3274307250977,"y":917.2423496246338,"z":"af884d85.e79ff","wires":[]},{"id":"be62e3d3.32c4","type":"other","name":"AIC_DATA_PLANE_UNPROTECTED_V6","xml":"<outcome value=\"AIC_DATA_PLANE_UNPROTECTED_V6\">","comments":"","outputs":1,"x":1396.2366485595703,"y":808.333309173584,"z":"af884d85.e79ff","wires":[["13598bf8.358084"]]},{"id":"83a60962.897ed8","type":"other","name":"AIC_DATA_PLANE_PROTECTED_V6","xml":"<outcome value=\"AIC_DATA_PLANE_PROTECTED_V6\">","comments":"","outputs":1,"x":1382.9033432006836,"y":884.3333358764648,"z":"af884d85.e79ff","wires":[["13598bf8.358084"]]},{"id":"4b7654f6.8b1abc","type":"other","name":"AIC_DATA_PLANE_PRIVATE_V6","xml":"<outcome value=\"AIC_DATA_PLANE_PRIVATE_V6\">","comments":"","outputs":1,"x":1371.2367095947266,"y":848.333288192749,"z":"af884d85.e79ff","wires":[["13598bf8.358084"]]},{"id":"2244b12.dafd04e","type":"switchNode","name":"switch: eipam-ip-block.subnet-size-override","xml":"<switch test=\"`$eipam-ip-block.subnet-size-override`\">","comments":"","outputs":1,"x":2093.428695678711,"y":541.428544998169,"z":"af884d85.e79ff","wires":[["b8333eb5.e8961"]]},{"id":"239857e5.61ee78","type":"set","name":"set subnet override if not set","xml":"<set>\n\t<parameter name=\"eipam-ip-block.subnet-size-override\" value=\"`$network-model.ipv4-cidr-mask`\" />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2826.2856979370117,"y":570.0001010894775,"z":"af884d85.e79ff","wires":[]},{"id":"b8333eb5.e8961","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2364.8575019836426,"y":540.0000820159912,"z":"af884d85.e79ff","wires":[["433e270d.669408"]]},{"id":"85152c24.0dd9e","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v4-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level2-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 2 subnet override not set, default to network model value.\"/>\n\n","comments":"","outputs":1,"x":2756.28564453125,"y":538.4285888671875,"z":"af884d85.e79ff","wires":[[]]},{"id":"433e270d.669408","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2572.6640625,"y":538.4286499023438,"z":"af884d85.e79ff","wires":[["85152c24.0dd9e","239857e5.61ee78"]]},{"id":"4f4eeaa0.dc8a84","type":"switchNode","name":"switch: eipam-ip-block.subnet-size-override","xml":"<switch test=\"`$eipam-ip-block.subnet-size-override`\">","comments":"","outputs":1,"x":2147.428466796875,"y":1497.142822265625,"z":"af884d85.e79ff","wires":[["c3f5f010.6248"]]},{"id":"c3f5f010.6248","type":"outcome","name":"outcome null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2418.8572731018066,"y":1495.7143592834473,"z":"af884d85.e79ff","wires":[["56df1329.aeed6c"]]},{"id":"56df1329.aeed6c","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2626.663833618164,"y":1494.1429271697998,"z":"af884d85.e79ff","wires":[["b9263db2.c71ae","414d97ea.0ebc88"]]},{"id":"414d97ea.0ebc88","type":"set","name":"set subnet override if not set","xml":"<set>\n\t<parameter name=\"eipam-ip-block.subnet-size-override\" value=\"`$network-model.ipv6-cidr-mask`\" />\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","x":2878.0695419311523,"y":1523.9004917144775,"z":"af884d85.e79ff","wires":[]},{"id":"b9263db2.c71ae","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"network-topology-operation\"/>\n<parameter name=\"field3\" value=\"eipam-allocate-network-role-subnet\"/>\n<parameter name=\"field4\" value=\"`$network-model.eipam-v6-address-plan`\"/>\n<parameter name=\"field5\" value=\"`$tmp.level2-key-value`\"/>\n<parameter name=\"field6\" value=\"Level 2 subnet override not set, default to network model value.\"/>\n\n","comments":"","outputs":1,"x":2808.0694885253906,"y":1492.3289794921875,"z":"af884d85.e79ff","wires":[[]]}]
