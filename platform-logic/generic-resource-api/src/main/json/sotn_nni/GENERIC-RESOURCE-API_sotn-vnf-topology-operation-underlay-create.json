[
    {
        "id": "630403de.7c4dfc",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 130,
        "y": 71,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "80c50a18.8d75c"
            ]
        ]
    },
    {
        "id": "80c50a18.8d75c",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 414.2856903076172,
        "y": 132.23810863494873,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "2da8c00e.5874f"
            ]
        ]
    },
    {
        "id": "2da8c00e.5874f",
        "type": "method",
        "name": "method sotn-vnf-topology-operation-underlay-create",
        "xml": "<method rpc='sotn-vnf-topology-operation-underlay-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 420.42860412597656,
        "y": 217.00003051757812,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "c4830870.f71be"
            ]
        ]
    },
    {
        "id": "c4830870.f71be",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 790.238037109375,
        "y": 241.66668701171875,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "d09b0487.d267f8",
                "4e465113.c34b3",
                "6d4651f1.9a44a",
                "b93f8dee.f542a",
                "18feff02.43bff9",
                "e9275990.6ea4e",
                "273e48bf.25ca5",
                "4b57404f.d373b8",
                "4822a493.73c54c",
                "567e338.a899b4c",
                "616296b0.6f36",
                "cdecd2ad.ea2458",
                "9b5e953e.0822e8"
            ]
        ]
    },
    {
        "id": "4e465113.c34b3",
        "type": "set",
        "name": "set vnf-level-oper-status to Created",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
        "comments": "",
        "x": 1212.3848495483398,
        "y": 605.6706197531894,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "d09b0487.d267f8",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
        "comments": "",
        "x": 1204.238037109375,
        "y": 500.6668718131259,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "18feff02.43bff9",
        "type": "execute",
        "name": "execute generate-vnf-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-id\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1192.5715408325195,
        "y": 450.3334558280185,
        "z": "adc7d7d7.2ba55",
        "wires": [
            []
        ]
    },
    {
        "id": "567e338.a899b4c",
        "type": "set",
        "name": "set vnf-index to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.vnf-id' value='`$prop.vnf-id`' />\n",
        "comments": "",
        "x": 1203.5716171264648,
        "y": 557.3334596427158,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "6d4651f1.9a44a",
        "type": "switchNode",
        "name": "switch service-data.vnfs.vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1219.5713577270508,
        "y": 120.33337858039886,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "c4be7092.54bab",
                "bebf6c90.f10358"
            ]
        ]
    },
    {
        "id": "c4be7092.54bab",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 1454.285743713379,
        "y": 115.47619893867522,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "55302818.0621f"
            ]
        ]
    },
    {
        "id": "55302818.0621f",
        "type": "set",
        "name": "set vnf-index=0",
        "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
        "comments": "",
        "x": 1614.5714492797852,
        "y": 115.4762904914096,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "bebf6c90.f10358",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1450.714282989502,
        "y": 148.76203039009124,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "d6fccb24.04a71"
            ]
        ]
    },
    {
        "id": "543cefe7.718a7",
        "type": "set",
        "name": "set vnf-index = vnf_length",
        "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
        "comments": "",
        "x": 1843.5715255737305,
        "y": 127.04775598365813,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "5d18757b.848c24",
        "type": "for",
        "name": "for each existing VNF",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1832.000144958496,
        "y": 162.0477278502658,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "8ce4ca7d.ffb71"
            ]
        ]
    },
    {
        "id": "d6fccb24.04a71",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1585.428565979004,
        "y": 150.76199987251312,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "543cefe7.718a7",
                "5d18757b.848c24"
            ]
        ]
    },
    {
        "id": "8ce4ca7d.ffb71",
        "type": "switchNode",
        "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
        "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2225.2858810424805,
        "y": 162.6192119391635,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "46146016.cb5b58"
            ]
        ]
    },
    {
        "id": "46146016.cb5b58",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2506.5715827941895,
        "y": 161.1906173499301,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "14fd2dd2.04e2ea"
            ]
        ]
    },
    {
        "id": "fac5d84d.dacdb8",
        "type": "comment",
        "name": "make sure this vnf-id doesn't exist already",
        "info": "",
        "comments": "",
        "x": 2194.428497314453,
        "y": 126.19060399848968,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "b93f8dee.f542a",
        "type": "set",
        "name": "set new vnf_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
        "comments": "",
        "x": 1150.571533203125,
        "y": 398.33343505859375,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "e9275990.6ea4e",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 1151.5715026855469,
        "y": 868.5969713004306,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "4822a493.73c54c",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id\n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"generic-vnf\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/generic-vnfs/generic-vnf/' + $prop.vnf-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"generic-vnf.vnf-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-id`\" />\n\n\n<!--key='service-instance.service-instance-id = $service-data.service-information.service-instance-id -->\n<!--key='service-instance.service-instance-id = $service-data.service-instance-id -->\n",
        "comments": "",
        "outputs": 1,
        "x": 1184.2382736206055,
        "y": 817.5968644889072,
        "z": "adc7d7d7.2ba55",
        "wires": [
            []
        ]
    },
    {
        "id": "273e48bf.25ca5",
        "type": "set",
        "name": "set vnf-index and vnf-object-path",
        "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-id`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-id  + '/vnf-data/'` \" />",
        "comments": "",
        "x": 1205.571533203125,
        "y": 646.5968902381137,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "14fd2dd2.04e2ea",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
        "comments": "",
        "x": 2635.142951965332,
        "y": 212.19063165504485,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "4b57404f.d373b8",
        "type": "save",
        "name": "save AnAI - vnf-instance.orchestration-status",
        "xml": "<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"generic-vnf\"   \n\t\tkey='generic-vnf.vnf-id = $prop.vnf-id' >\n<parameter name=\"orchestration-status\" value=\"Created\" />\n<parameter name=\"in-maint\" value = \"true\" />\n<parameter name=\"vnf-type\" value='`$prop.vnfName`' />\n<parameter name=\"vnf-name\" value = \"`$prop.vnfName`\"/>\n<parameter name=\"model-invariant-id\" value = \"`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`\"/>\n<parameter name=\"model-version-id\" value = \"`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`\"/>\n<parameter name=\"model-customization-id\" value = \"`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`\"/>",
        "comments": "",
        "outputs": 1,
        "x": 1260.5458374023438,
        "y": 756.2471072943881,
        "z": "adc7d7d7.2ba55",
        "wires": [
            []
        ]
    },
    {
        "id": "1ddf67d5.b35a7",
        "type": "comment",
        "name": "TODO: change AAI models",
        "info": "",
        "comments": "",
        "x": 1194.1820983886719,
        "y": 715.9743230612949,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "eb3e5b54.ee7cc8",
        "type": "execute",
        "name": "execute split parameterName",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1620.7395858764648,
        "y": 209.75002291519195,
        "z": "adc7d7d7.2ba55",
        "wires": [
            []
        ]
    },
    {
        "id": "a93d9d55.574d98",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1424.483383178711,
        "y": 214.00189593154937,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "eb3e5b54.ee7cc8",
                "34cb35bb.2ef0aa"
            ]
        ]
    },
    {
        "id": "616296b0.6f36",
        "type": "for",
        "name": "for loop idx - VNF input parameters",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1209.7050399780273,
        "y": 216.44631197769195,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "a93d9d55.574d98"
            ]
        ]
    },
    {
        "id": "cdecd2ad.ea2458",
        "type": "set",
        "name": "set vnf-request-input.",
        "xml": "<set>\n<parameter name='vnf-request-input.' value='`$vnf-topology-operation-input.vnf-request-input.`' />\n",
        "comments": "",
        "x": 1166.7046737670898,
        "y": 286.77101900894195,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "34cb35bb.2ef0aa",
        "type": "set",
        "name": "set parameterName",
        "xml": "<set>\n<parameter name=\"`vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
        "comments": "",
        "x": 1597.7395858764648,
        "y": 255.75002291519195,
        "z": "adc7d7d7.2ba55",
        "wires": []
    },
    {
        "id": "9b5e953e.0822e8",
        "type": "for",
        "name": "for each sdwan-get-request-input-param",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1222.7395858764648,
        "y": 338.75002291519195,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "42766226.3db64c"
            ]
        ]
    },
    {
        "id": "42766226.3db64c",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1448.9722518920898,
        "y": 337.09377291519195,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "85dff1eb.0e22b8"
            ]
        ]
    },
    {
        "id": "85dff1eb.0e22b8",
        "type": "switchNode",
        "name": "switch vnf name",
        "xml": "<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name == 'name'`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1605.4722518920898,
        "y": 335.0938339503482,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "2f903a44.280976"
            ]
        ]
    },
    {
        "id": "2f903a44.280976",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1766.4726181030273,
        "y": 335.09389498550445,
        "z": "adc7d7d7.2ba55",
        "wires": [
            [
                "55b726c2.cd02d"
            ]
        ]
    },
    {
        "id": "55b726c2.cd02d",
        "type": "set",
        "name": "set vnf name",
        "xml": "<set>\n<parameter name='prop.vnfName' value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].value`' />\n",
        "comments": "",
        "x": 1924.4727401733398,
        "y": 333.6939316065982,
        "z": "adc7d7d7.2ba55",
        "wires": []
    }
]