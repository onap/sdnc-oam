[{"id":"1d697de8.1c8bd2","type":"dgstart","name":"DGSTART","outputs":1,"x":92.85714721679688,"y":84.33332824707031,"z":"fe1687cb.6748b8","wires":[["738f4ec8.3ebfb"]]},{"id":"738f4ec8.3ebfb","type":"service-logic","name":"SUBNET-API ${project.version}","module":"SUBNET-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='SUBNET-API' version='${project.version}'>","outputs":1,"x":406.6905059814453,"y":85.33332824707031,"z":"fe1687cb.6748b8","wires":[["b53de678.5aad68"]]},{"id":"634eb01d.99ae1","type":"execute","name":"execute EIPAM activatesubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"activateSubnet\">\n\n","outputs":1,"x":650.5477447509766,"y":323.7619323730469,"z":"fe1687cb.6748b8","wires":[["c72da6f0.5e41e8","74dfc0f7.c1b15"]]},{"id":"c72da6f0.5e41e8","type":"success","name":"outcome: success","xml":"<outcome value=\"success\">","comments":"","outputs":1,"x":928.0714569091797,"y":201.4285888671875,"z":"fe1687cb.6748b8","wires":[["bcd2c580.735ef8"]]},{"id":"74dfc0f7.c1b15","type":"other","name":"outcome Other ","xml":"<outcome value=\"Other\"> \n\n","outputs":1,"x":912.1667938232422,"y":452.8094787597656,"z":"fe1687cb.6748b8","wires":[["e9a87b58.c5a9f8"]]},{"id":"a713f47b.c8cca8","type":"returnFailure","name":"return failure","xml":" <return status=\"failure\">\n               <parameter name=\"error-code\" value=\"3000\" />\n              <parameter name=\"error-message\" value=\"ActivateSubnet failure, need to manually activate in EIPAM\" />\n","comments":"","x":1420.2615509033203,"y":609.6665649414062,"z":"fe1687cb.6748b8","wires":[]},{"id":"7ad0948d.fae1dc","type":"save","name":"save: EIPAM IP Subnets Active","xml":"<save plugin=\"com.att.sdnctl.sli.resource.gamma.GammaResource\" resource=\"eipam-ip-subnets\"\n\tkey=\"entity-id = $eipam-ip-block.entity-id\" force=\"true\">\n        <parameter name=\"status\" value=\"ACTIVE\" />\n       \n","outputs":1,"x":1470.7381744384766,"y":52.42860412597656,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"69ddb424.aac11c","type":"comment","name":"MANAGED-NETWORK-NOTIFICATION","info":"","x":472.55714416503906,"y":20,"z":"fe1687cb.6748b8","wires":[]},{"id":"b53de678.5aad68","type":"method","name":"managed-network-notification","xml":"<method rpc='managed-network-notification' mode='sync'>\n","outputs":1,"x":772.5571899414062,"y":84.19999694824219,"z":"fe1687cb.6748b8","wires":[["aae4bb44.e823e8"]]},{"id":"aae4bb44.e823e8","type":"block","name":"block","xml":"<block>","atomic":"false","outputs":1,"x":151.55712890625,"y":149.1999969482422,"z":"fe1687cb.6748b8","wires":[["87f499a7.89d588","63a281f0.52912"]]},{"id":"87f499a7.89d588","type":"record","name":"record","xml":"<record plugin=\"org.onap.ccsdk.sli.core.sli.recording.Slf4jRecorder\">\n<parameter name=\"logger\" value=\"message-log\"/>\n<parameter name=\"field1\" value=\"__TIMESTAMP__\"/>\n<parameter name=\"field2\" value=\"managed-network-notification\"/>\n<parameter name=\"field3\" value=\"`$managed-network-notification-input.request-id`\"/>\n<parameter name=\"field4\" value=\"`$managed-network-notification-input.managed-network-status.status.code`\"/>\n<parameter name=\"field5\" value=\"`$managed-network-notification-input.managed-network-status.status.description`\"/>\n<parameter name=\"field6\" value=\"`$managed-network-notification-input.managed-network-status.final-notification-indicator`\"/>\n\n","comments":"","outputs":1,"x":352.1286163330078,"y":150.0614776611328,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"5eb284fa.4e019c","type":"returnSuccess","name":"return success","xml":" <return status=\"success\">\n \n","x":1427.0713806152344,"y":293.7618827819824,"z":"fe1687cb.6748b8","wires":[]},{"id":"22f650d9.d8db3","type":"set","name":"set: status = Active","xml":"<set>\n\t<parameter name=\"eipam-ip-block.status\" value=\"ACTIVE\" />","x":1432.3717193603516,"y":101.79519653320312,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"21eddabf.11f436","type":"save","name":"save: status = Active","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource\" resource=\"eipam-ip-block\">\n\t<parameter name=\"eipam-ip-block.status\" value=\"ACTIVE\" />","outputs":1,"x":1440.0382232666016,"y":150.1285400390625,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"bcd2c580.735ef8","type":"block","name":"block","xml":"<block>","atomic":"false","outputs":1,"x":1129.4046783447266,"y":201.09521484375,"z":"fe1687cb.6748b8","wires":[["7ad0948d.fae1dc","22f650d9.d8db3","21eddabf.11f436","5eb284fa.4e019c","cb0701c6.2633d","7b60262a.6e15b8"]]},{"id":"e9a87b58.c5a9f8","type":"block","name":"block","xml":"<block>","atomic":"true","comments":"","outputs":1,"x":1127.1666412353516,"y":452.8095397949219,"z":"fe1687cb.6748b8","wires":[["a713f47b.c8cca8","9989a7a9.198118","704cf48a.cb80ac","30ca370b.971358","4be470e7.693da","d998050.b2340f8"]]},{"id":"63a281f0.52912","type":"switchNode","name":"switch: status Successful","xml":"<switch test=\"`$managed-network-notification-input.managed-network-status.status.code`\">\n\n","outputs":1,"x":149.55712890625,"y":269.2000274658203,"z":"fe1687cb.6748b8","wires":[["b9ae7f80.7ea4c","e0cc590d.ec4548"]]},{"id":"b9ae7f80.7ea4c","type":"success","name":"outcome: Success","xml":"<outcome value=\"Success\">","outputs":1,"x":410.55711364746094,"y":269.20001220703125,"z":"fe1687cb.6748b8","wires":[["634eb01d.99ae1"]]},{"id":"e0cc590d.ec4548","type":"other","name":"outcome: Other","xml":"<outcome value=\"Other\">","outputs":1,"x":327.5570983886719,"y":472.1999969482422,"z":"fe1687cb.6748b8","wires":[["2aa26002.ad155"]]},{"id":"2aa26002.ad155","type":"execute","name":"execute EIPAM deallocateSubnet","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"deallocateSubnet\">\n\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":315.0419616699219,"y":697.8561706542969,"z":"fe1687cb.6748b8","wires":[["5d00b0bf.3d073","fa532c4.fd22ed"]]},{"id":"5fe6bc2a.78ee84","type":"save","name":"save: EIPAM IP Subnets DEALLOCATED","xml":"<save plugin=\"com.att.sdnctl.sli.resource.gamma.GammaResource\" resource=\"eipam-ip-subnets\"\n\tkey=\"entity-id = $eipam-ip-block.entity-id\" force=\"true\">\n        <parameter name=\"status\" value=\"DEALLOCATED\" />\n       \n","comments":"","outputs":1,"x":1741.9998321533203,"y":865.7842407226562,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"5ee29eaa.01846","type":"set","name":"set: status = ERROR","xml":"<set>\n\t<parameter name=\"eipam-ip-block.status\" value=\"ERROR\" />","x":1708.1887969970703,"y":914.9341735839844,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"60bc6aba.ddb804","type":"save","name":"save: status = ERROR","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource\" resource=\"eipam-ip-block\">\n\t<parameter name=\"eipam-ip-block.status\" value=\"ERROR\" />","outputs":1,"x":1710.1889190673828,"y":962.7120971679688,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"2d6b5fe.839f2a","type":"block","name":"block","xml":"<block>","atomic":"false","comments":"","outputs":1,"x":1474.7672271728516,"y":865.9460144042969,"z":"fe1687cb.6748b8","wires":[["5fe6bc2a.78ee84","5ee29eaa.01846","60bc6aba.ddb804","743bfc5f.f7aad4","5a06f6a5.be2ce8","b4e34055.70014"]]},{"id":"743bfc5f.f7aad4","type":"returnFailure","name":"return failure ","xml":"  <return status=\"failure\">\n              <parameter name=\"error-code\" value=\"1000\" />\n              <parameter name=\"error-message\" value=\"Failure from NCS and deletePool failed in EIPAM, need to manually delete.\" />\n","comments":"","x":1684.7671661376953,"y":1104.5015563964844,"z":"fe1687cb.6748b8","wires":[]},{"id":"9989a7a9.198118","type":"save","name":"save: EIPAM IP Subnets ERROR","xml":"<save plugin=\"com.att.sdnctl.sli.resource.gamma.GammaResource\" resource=\"eipam-ip-subnets\"\n\tkey=\"entity-id = $eipam-ip-block.entity-id\" force=\"true\">\n        <parameter name=\"status\" value=\"ERROR\" />\n       \n","outputs":1,"x":1484.5823516845703,"y":373.6729736328125,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"704cf48a.cb80ac","type":"set","name":"set: status = ERROR","xml":"<set>\n\t<parameter name=\"eipam-ip-block.status\" value=\"ERROR\" />","x":1444.8826446533203,"y":421.48956298828125,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"30ca370b.971358","type":"save","name":"save: status = ERROR","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource\" resource=\"eipam-ip-block\">\n\t<parameter name=\"eipam-ip-block.status\" value=\"ERROR\" />","outputs":1,"x":1449.8827056884766,"y":470.48956298828125,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"5d00b0bf.3d073","type":"success","name":"outcome: success","xml":"<outcome value=\"success\">","comments":"","outputs":1,"x":628.9261627197266,"y":703.2610778808594,"z":"fe1687cb.6748b8","wires":[["585b522e.fbe72c"]]},{"id":"5a06f6a5.be2ce8","type":"save","name":"Update AAI: SDN_C_BACKOUT_ERROR, PREPROV","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" resource=\"vpe\" \n\t\tkey=\"vnf-id = $data-change-notification-input.key-data[0].key-value\" pfx=\"vpe-after\">\n\t<parameter name=\"operational-state\" value=\"SDN_C_BACKOUT_ERROR\" />\n\t<parameter name=\"summary-status\" value=\"`$aai-summary-status-message`\" />\n\t<parameter name=\"prov-status\" value=\"PREPROV\" />\n\t","comments":"","outputs":1,"x":1811.8571319580078,"y":1059.8334655761719,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"4be470e7.693da","type":"save","name":"Update AAI: EIPAM_ERROR, PREPROV","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" resource=\"vpe\" \n\t\tkey=\"vnf-id = $data-change-notification-input.key-data[0].key-value\" pfx=\"vpe-after\">\n\t<parameter name=\"operational-state\" value=\"EIPAM_ERROR\" />\n\t<parameter name=\"summary-status\" value=\"`$aai-summary-status-message`\" />\n\t<parameter name=\"prov-status\" value=\"PREPROV\" />\n\t","comments":"","outputs":1,"x":1508.0238189697266,"y":561.0832214355469,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"cb0701c6.2633d","type":"save","name":"Update AAI: SDNC_COMPLETED","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" resource=\"vpe\" key=\"vnf-id = $data-change-notification-input.key-data[0].key-value\" pfx=\"vpe-after\">\n\t<parameter name=\"operational-state\" value=\"SDNC_COMPLETED\" />\n\t<parameter name=\"summary-status\" value=\"`$aai-summary-status-message`\" />\n","comments":"","outputs":1,"x":1483.0237731933594,"y":247.5000114440918,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"b4e34055.70014","type":"execute","name":"execute: set aai-summary-status-message","xml":"<execute plugin='org.onap.ccsdk.sli.adaptors.sli.aai.AAIService' method='setStatusMethod' >\n<parameter name=\"key1\" value=\"Failure from NCS and deletePool failed in EIPAM, need to manually delete.\"/>","comments":"","outputs":1,"x":1778.8571319580078,"y":1010.0834655761719,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"d998050.b2340f8","type":"execute","name":"execute: set aai-summary-status-message","xml":"<execute plugin='org.onap.ccsdk.sli.adaptors.sli.aai.AAIService' method='setStatusMethod' >\n<parameter name=\"key1\" value=\"ActivateSubnet failure, need to manually activate in EIPAM.\"/>","comments":"","outputs":1,"x":1511.8572540283203,"y":515.5832824707031,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"7b60262a.6e15b8","type":"execute","name":"execute: set aai-summary-status-message with timestamp","xml":"<execute plugin='org.onap.ccsdk.sli.adaptors.sli.aai.AAIService' method='setStatusMethod' >\n<parameter name=\"key1\" value=\"SUCCESS: eipam-ip-block.status is ACTIVE.\"/>","comments":"","outputs":1,"x":1555.8572540283203,"y":199.08334350585938,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"fa532c4.fd22ed","type":"other","name":"outcome Other ","xml":"<outcome value=\"Other\"> \n\n","outputs":1,"x":602.5057067871094,"y":1134.633544921875,"z":"fe1687cb.6748b8","wires":[["c5dee3e7.cdd41"]]},{"id":"585b522e.fbe72c","type":"execute","name":"execute EIPAM deletePool","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"deletePool\">\n\n","comments":"subnet and subnet_keys are deleted in the EIPAMPlugin","outputs":1,"x":913.5058288574219,"y":712.6335601806641,"z":"fe1687cb.6748b8","wires":[["d384c427.925d78","6f76ee0b.cd146"]]},{"id":"98bded5a.99026","type":"returnFailure","name":"return failure","xml":" <return status=\"failure\">\n              <parameter name=\"error-code\" value=\"2000\" />\n              <parameter name=\"error-message\" value=\"Failure from NCS and deleted pool/subnet in EIPAM\"/>\n \n","comments":"","x":1524.7760772705078,"y":806.6335754394531,"z":"fe1687cb.6748b8","wires":[]},{"id":"85368279.ecf69","type":"set","name":"set: status = Deleted","xml":"<set>\n\t<parameter name=\"eipam-ip-block.status\" value=\"DELETED\" />","comments":"","x":1549.8167266845703,"y":667.0675354003906,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"d384c427.925d78","type":"success","name":"outcome: success","xml":"<outcome value=\"success\">","comments":"","outputs":1,"x":1165.367446899414,"y":714.0281066894531,"z":"fe1687cb.6748b8","wires":[["5e92b424.f60bec"]]},{"id":"5e92b424.f60bec","type":"block","name":"block","xml":"<block>","atomic":"false","outputs":1,"x":1362.9116973876953,"y":714.9361267089844,"z":"fe1687cb.6748b8","wires":[["85368279.ecf69","98bded5a.99026","a6e3d85b.a8fe78","165124ec.ec08eb"]]},{"id":"a6e3d85b.a8fe78","type":"save","name":"Update AAI: SDN_C_BACKOUT_ERROR, PREPROV","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" resource=\"vpe\" key=\"vnf-id = $data-change-notification-input.key-data[0].key-value\" pfx=\"vpe-after\">\n\t<parameter name=\"operational-state\" value=\"SDN_C_BACKOUT_ERROR\" />\n\t<parameter name=\"summary-status\" value=\"`$aai-summary-status-message`\" />\n\t<parameter name=\"prov-status\" value=\"PREPROV\" />\n","comments":"","outputs":1,"x":1651.2985382080078,"y":761.8501892089844,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"165124ec.ec08eb","type":"execute","name":"execute: set aai-summary-status-message","xml":"<execute plugin='org.onap.ccsdk.sli.adaptors.sli.aai.AAIService' method='setStatusMethod' >\n<parameter name=\"key1\" value=\"Failure from NCS and deleted pool/subnet in EIPAM.\"/>","comments":"","outputs":1,"x":1619.2985382080078,"y":714.3502807617188,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"6f76ee0b.cd146","type":"other","name":"outcome Other ","xml":"<outcome value=\"Other\"> \n\n","outputs":1,"x":1155.0883483886719,"y":868.6335601806641,"z":"fe1687cb.6748b8","wires":[["2d6b5fe.839f2a"]]},{"id":"221af66d.6cc54a","type":"save","name":"save: EIPAM IP Subnets ERROR","xml":"<save plugin=\"com.att.sdnctl.sli.resource.gamma.GammaResource\" resource=\"eipam-ip-subnets\"\n\tkey=\"entity-id = $eipam-ip-block.entity-id\" force=\"true\">\n        <parameter name=\"status\" value=\"ERROR\" />\n       \n","outputs":1,"x":1111.7639770507812,"y":1135.8977355957031,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"66787785.d87018","type":"set","name":"set: status = ERROR","xml":"<set>\n\t<parameter name=\"eipam-ip-block.status\" value=\"ERROR\" />","x":1077.9529418945312,"y":1185.0476684570312,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"f85cd896.2992c8","type":"save","name":"save: status = ERROR","xml":"<save plugin=\"org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource\" resource=\"eipam-ip-block\">\n\t<parameter name=\"eipam-ip-block.status\" value=\"ERROR\" />","outputs":1,"x":1079.9530639648438,"y":1232.8255920410156,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"c5dee3e7.cdd41","type":"block","name":"block","xml":"<block>","atomic":"false","comments":"","outputs":1,"x":844.5313720703125,"y":1133.0594177246094,"z":"fe1687cb.6748b8","wires":[["221af66d.6cc54a","66787785.d87018","f85cd896.2992c8","5a7001d8.ef0f6","918cc60e.942f48","2eaa51b4.b221be"]]},{"id":"5a7001d8.ef0f6","type":"returnFailure","name":"return failure ","xml":"  <return status=\"failure\">\n              <parameter name=\"error-code\" value=\"1000\" />\n              <parameter name=\"error-message\" value=\"Failure from NCS and deletePool failed in EIPAM, need to manually delete.\" />\n","comments":"","x":1054.5313110351562,"y":1374.6150512695312,"z":"fe1687cb.6748b8","wires":[]},{"id":"918cc60e.942f48","type":"save","name":"Update AAI: SDN_C_BACKOUT_ERROR, PREPROV","xml":"<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" resource=\"vpe\" \n\t\tkey=\"vnf-id = $data-change-notification-input.key-data[0].key-value\" pfx=\"vpe-after\">\n\t<parameter name=\"operational-state\" value=\"SDN_C_BACKOUT_ERROR\" />\n\t<parameter name=\"summary-status\" value=\"`$aai-summary-status-message`\" />\n\t<parameter name=\"prov-status\" value=\"PREPROV\" />\n\t","comments":"","outputs":1,"x":1181.6212768554688,"y":1329.9469604492188,"z":"fe1687cb.6748b8","wires":[[]]},{"id":"2eaa51b4.b221be","type":"execute","name":"execute: set aai-summary-status-message","xml":"<execute plugin='org.onap.ccsdk.sli.adaptors.sli.aai.AAIService' method='setStatusMethod' >\n<parameter name=\"key1\" value=\"Failure from NCS and deletePool failed in EIPAM, need to manually delete.\"/>","comments":"","outputs":1,"x":1148.6212768554688,"y":1280.1969604492188,"z":"fe1687cb.6748b8","wires":[[]]}]
