[{"id":"6078f16e.94239","type":"dgstart","name":"DGSTART","outputs":1,"x":144,"y":80,"z":"8671a4bd.e74828","wires":[["fdea0245.f423d"]]},{"id":"fdea0245.f423d","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":290.2380828857422,"y":154.95239353179932,"z":"8671a4bd.e74828","wires":[["d039b1a6.c7dd"]]},{"id":"d039b1a6.c7dd","type":"method","name":"contrail-route-topology-operation-unassign","xml":"<method rpc='contrail-route-topology-operation-unassign' mode='sync'>\n","comments":"","outputs":1,"x":370.1548500061035,"y":224.1904420852661,"z":"8671a4bd.e74828","wires":[["278298dd.a26aa8"]]},{"id":"278298dd.a26aa8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":278.4761848449707,"y":367.523784160614,"z":"8671a4bd.e74828","wires":[["1b5604e4.1c439b","c80598df.46ba08","90c6b844.d26288","1af3eb88.118b54","926dc61b.e662e8","5533a49a.eb94bc","b29dd56e.42e818","36106131.09979e","974a60a8.16f7e","a81908e8.66b878","94075fb2.8885b","50486a0e.128a74","cdd2e6e3.1748e8"]]},{"id":"c80598df.46ba08","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":545.0001029968262,"y":1169.5480337142944,"z":"8671a4bd.e74828","wires":[]},{"id":"1b5604e4.1c439b","type":"set","name":"set output to api handler","xml":"<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $contrail-route-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n","comments":"","x":573.7540092468262,"y":1132.0038270950317,"z":"8671a4bd.e74828","wires":[]},{"id":"a81908e8.66b878","type":"set","name":"set allotted-resource-oper-status","xml":"<set>\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Active' />\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$contrail-route-topology-operation-input.request-information.request-action`' />\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$contrail-route-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$contrail-route-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n","comments":"","x":602.0875015258789,"y":899.3847255706787,"z":"8671a4bd.e74828","wires":[]},{"id":"1af3eb88.118b54","type":"set","name":"set tmp.ar.self-link","xml":"<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:contrail-route-allotted-resources/contrail-route-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/contrail-route-topology/'` \" />\n\n","comments":"","x":540.7380561828613,"y":341.3333215713501,"z":"8671a4bd.e74828","wires":[]},{"id":"90c6b844.d26288","type":"set","name":"set tmp.ar.allotted-resource-id,etc","xml":"<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$contrail-route-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n<parameter name='tmp.ar.parent-service-instance-id' value='`$contrail-route-topology-operation-input.allotted-resource-information.parent-service-instance-id`' />\n<parameter name='tmp.ar.sz-vnf-id' value='`$contrail-route-topology-operation-input.allotted-resource-data.security-zone-topology.security-zone-assignments.security-zone-vnf-id`' />\n\n\n","comments":"","x":587.9973182678223,"y":307.5925874710083,"z":"8671a4bd.e74828","wires":[]},{"id":"926dc61b.e662e8","type":"execute","name":"execute Properties - pull properties file","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n","comments":"","outputs":1,"x":610.9934158325195,"y":377.2315502166748,"z":"8671a4bd.e74828","wires":[[]]},{"id":"b29dd56e.42e818","type":"execute","name":"execute RestApiCallNode - Get AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":617.5187454223633,"y":545.459508895874,"z":"8671a4bd.e74828","wires":[["b380ca61.347388","2ba1e073.32012"]]},{"id":"5533a49a.eb94bc","type":"execute","name":"generate allotted-resource url","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.cr-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n","comments":"","outputs":1,"x":575.0648460388184,"y":437.01722526550293,"z":"8671a4bd.e74828","wires":[[]]},{"id":"b380ca61.347388","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":862.8148498535156,"y":546.2673225402832,"z":"8671a4bd.e74828","wires":[["ec13614c.a7a1d"]]},{"id":"36106131.09979e","type":"execute","name":"execute RestApiCallNode - DELETE AR by id","xml":"<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='DELETE' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n","comments":"","outputs":1,"x":630.1959762573242,"y":973.4342184066772,"z":"8671a4bd.e74828","wires":[["3852bf78.0486c","62c7bf4b.768c7","1e995a14.504956"]]},{"id":"3852bf78.0486c","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":900.5039939880371,"y":1026.4324192032218,"z":"8671a4bd.e74828","wires":[["acbe5422.ea59e8"]]},{"id":"62c7bf4b.768c7","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":891.5040435791016,"y":994.9324449524283,"z":"8671a4bd.e74828","wires":[["acbe5422.ea59e8"]]},{"id":"1e995a14.504956","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":895.2540817260742,"y":965.2895498275757,"z":"8671a4bd.e74828","wires":[["e934c1a7.96fdf"]]},{"id":"acbe5422.ea59e8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for contrail-route-allotted-resource\" />\n","comments":"","x":1061.2540817260742,"y":995.6824687942863,"z":"8671a4bd.e74828","wires":[]},{"id":"ec13614c.a7a1d","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1031.814853668213,"y":544.7672233581543,"z":"8671a4bd.e74828","wires":[["c7645ab6.9eb898"]]},{"id":"c7645ab6.9eb898","type":"switchNode","name":"switch cr length","xml":"<switch test='`$mdsal-ar.contrail-route-allotted-resource_length`'>\n","comments":"","outputs":1,"x":1242.6720962524414,"y":544.3863525390625,"z":"8671a4bd.e74828","wires":[["61c49916.42b6a8","8d424701.1f4b68"]]},{"id":"61c49916.42b6a8","type":"other","name":"outcome 1","xml":"<outcome value='1'>\n","comments":"","outputs":1,"x":1432.0054016113281,"y":544.3863105773926,"z":"8671a4bd.e74828","wires":[["36bb8ffe.6efc7"]]},{"id":"98542804.66f4c8","type":"set","name":"set ar from get","xml":"<set>\n<parameter name='ar.' value='$mdsal-ar.contrail-route-allotted-resource[0].' />\n","comments":"","x":1905.1962203979492,"y":507.62452602386475,"z":"8671a4bd.e74828","wires":[]},{"id":"36bb8ffe.6efc7","type":"block","name":"block: atomic","xml":"<block atomic='true'>\n","atomic":"false","comments":"","outputs":1,"x":1616.529291152954,"y":541.2911443710327,"z":"8671a4bd.e74828","wires":[["98542804.66f4c8","ec6a6da.ebd6e9","4947b25a.1aec9c","e970570e.cc3e28"]]},{"id":"ec6a6da.ebd6e9","type":"set","name":"set oper-status","xml":"<set>\n<parameter name='sz-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$sz-ar.allotted-resource-data.allotted-resource-operation-information.request-information.request-action`' />\n<parameter name='sz-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$sz-ar.allotted-resource-status.rpc-action`' />\n<parameter name='sz-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$sz-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.svc-request-id`' />\n\n","comments":"","x":1913.1961479187012,"y":571.719669342041,"z":"8671a4bd.e74828","wires":[]},{"id":"76e27cbc.f1e1e4","type":"comment","name":"GET security-zone-allotted-resource from mdsal","info":"","comments":"","x":630.8147926330566,"y":512.7672119140625,"z":"8671a4bd.e74828","wires":[]},{"id":"e970570e.cc3e28","type":"switchNode","name":"switch order-status","xml":"<switch test='`$ar.allotted-resource-data.allotted-resource-oper-status.order-status`'>\n","comments":"","outputs":1,"x":1926.9102401733398,"y":538.6245155334473,"z":"8671a4bd.e74828","wires":[["6c1bbe13.30319","304eb865.e2d648"]]},{"id":"6c1bbe13.30319","type":"outcome","name":"outcome Created","xml":"<outcome value='Created'>\n","comments":"","outputs":1,"x":2160.1771850585938,"y":527.0054798126221,"z":"8671a4bd.e74828","wires":[["3b1d14d0.0288dc"]]},{"id":"304eb865.e2d648","type":"outcome","name":"outcome Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2156.844108581543,"y":565.9103012084961,"z":"8671a4bd.e74828","wires":[["f0543e57.ab39a"]]},{"id":"3b1d14d0.0288dc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" \n    value=\"`'Existing contrail-route-allotted-resource with order status of ' + $ar.allotted-resource-data.allotted-resource-oper-status.order-status + '.'`\" />\n","comments":"","x":2383.176887512207,"y":526.243501663208,"z":"8671a4bd.e74828","wires":[]},{"id":"50486a0e.128a74","type":"set","name":"set ar-assignments.contrail-id","xml":"<set>\n<parameter name='ar-assignments.contrail-id' value=\"`$contrail-api-output.contrail-id`\" />\n\n\n\n","comments":"","x":596.8623962402344,"y":738.0530757904053,"z":"8671a4bd.e74828","wires":[]},{"id":"4947b25a.1aec9c","type":"set","name":"save backup copy of mdsal-ar for rollback","xml":"<set>\n<parameter name='bk-cr-ar' value='$mdsal-ar.' />\n","comments":"","x":1993.0532722473145,"y":474.4340181350708,"z":"8671a4bd.e74828","wires":[]},{"id":"4648c12.da07b4","type":"comment","name":"Create urls for restapi","info":"","comments":"","x":545.9576530456543,"y":406.62435245513916,"z":"8671a4bd.e74828","wires":[]},{"id":"e934c1a7.96fdf","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1036.9100494384766,"y":961.4817190170288,"z":"8671a4bd.e74828","wires":[[]]},{"id":"974a60a8.16f7e","type":"execute","name":"execute getTime","xml":"<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n","comments":"","outputs":1,"x":552.9100952148438,"y":865.8148574829102,"z":"8671a4bd.e74828","wires":[[]]},{"id":"a70e9ffa.b6b9e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"Error: Contrail Route not found\" />\n    \n","comments":"","x":1615.666997909546,"y":657.3333854675293,"z":"8671a4bd.e74828","wires":[]},{"id":"2ba1e073.32012","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":854.6666526794434,"y":581.3334074020386,"z":"8671a4bd.e74828","wires":[["8b180a16.53ad58"]]},{"id":"8b180a16.53ad58","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1034.666603088379,"y":581.9999580383301,"z":"8671a4bd.e74828","wires":[["a70e9ffa.b6b9e"]]},{"id":"94075fb2.8885b","type":"set","name":"set ar data","xml":"<set>\n<parameter name='ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='ar.allotted-resource-status.action' value=\"`$contrail-route-topology-operation-input.request-information.request-action` \" />\n<parameter name='ar.allotted-resource-status.rpc-name' value=\"contrail-route-topology-operation\" />\n<parameter name='ar.allotted-resource-status.rpc-action' value=\"`$contrail-route-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$contrail-route-topology-operation-input.request-information.` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$contrail-route-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$contrail-route-topology-operation-input.service-information.` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$contrail-route-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='ar.allotted-resource-data.allotted-resource-operation-information.contrail-route-request-input.' value=\"`$contrail-route-topology-operation-input.contrail-route-request-input.` \" />\n","comments":"","x":524.6666412353516,"y":609.6666030883789,"z":"8671a4bd.e74828","wires":[]},{"id":"8d424701.1f4b68","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1420.3333549499512,"y":581.6666707992554,"z":"8671a4bd.e74828","wires":[["a70e9ffa.b6b9e"]]},{"id":"f0543e57.ab39a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2361.3336181640625,"y":566.0953178405762,"z":"8671a4bd.e74828","wires":[[]]},{"id":"cdd2e6e3.1748e8","type":"set","name":"set dummy cid","xml":"<set>\n<parameter name='contrail-api-output.contrail-id' value=\"dummycid\" />\n","comments":"","x":547.3333206176758,"y":709.9999656677246,"z":"8671a4bd.e74828","wires":[]},{"id":"dad675fb.beed78","type":"comment","name":"Call contrail api here","info":"","comments":"","x":523.9999504089355,"y":669.9999895095825,"z":"8671a4bd.e74828","wires":[]},{"id":"40b7c210.a67bcc","type":"comment","name":"Need to rollback aai here","info":"","comments":"","x":1287.3333435058591,"y":995.000063896179,"z":"8671a4bd.e74828","wires":[]},{"id":"8e046298.84999","type":"comment","name":"Create  network policy in AAI","info":"","comments":"","x":586.666618347168,"y":814.9999513626099,"z":"8671a4bd.e74828","wires":[]}]
