[
    {
        "id": "39688a3a.06a796",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 265.00390625,
        "y": 145.999990940094,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "921891f8.416e5"
            ]
        ]
    },
    {
        "id": "921891f8.416e5",
        "type": "method",
        "name": "sdwan-vf-operation-site-create",
        "xml": "<method rpc='sdwan-vf-operation-site-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 264.00390625,
        "y": 245.999990940094,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "22a013b4.ab58dc"
            ]
        ]
    },
    {
        "id": "695e0384.f33d9c",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 94.50390625,
        "y": 56.999998569488525,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "39688a3a.06a796"
            ]
        ]
    },
    {
        "id": "22a013b4.ab58dc",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 423.00389099121094,
        "y": 361.99999952316284,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "4325b612.73e1e8",
                "a6c02374.2dca",
                "40ba27b5.057bf8",
                "d6478b6b.a2b888",
                "59e1bfa3.d11e4",
                "1c5585c5.9cdc3a",
                "a7e8dd90.c6661",
                "2f9ca627.c38e7a",
                "40436b2a.16f614",
                "64771e44.2196d",
                "bb863987.8db5d8",
                "462de6d9.81f588"
            ]
        ]
    },
    {
        "id": "4325b612.73e1e8",
        "type": "for",
        "name": "for each vnf",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 723.3333129882812,
        "y": 253.49612379074097,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "63fc0005.8f2ee"
            ]
        ]
    },
    {
        "id": "63fc0005.8f2ee",
        "type": "switchNode",
        "name": "switch this vnf-id == input vnf-id",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`\">    \n",
        "comments": "",
        "outputs": 1,
        "x": 975.3334045410156,
        "y": 252.1627869606018,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "c555201.0223fe"
            ]
        ]
    },
    {
        "id": "6fae689f.7fef88",
        "type": "set",
        "name": "set vnf-index",
        "xml": "<set>\n<parameter name='vnf-index' value='`$idx`' />\n",
        "comments": "",
        "x": 1346.9998931884766,
        "y": 254.16278982162476,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "c555201.0223fe",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1193.6667213439941,
        "y": 254.1627688407898,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "6fae689f.7fef88"
            ]
        ]
    },
    {
        "id": "d6478b6b.a2b888",
        "type": "for",
        "name": "for loop idx - VF input parameters",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param_length`\">\n\n",
        "comments": "",
        "outputs": 1,
        "x": 797.2540969848633,
        "y": 475.6666569709778,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "e10e6c76.58a1d"
            ]
        ]
    },
    {
        "id": "e10e6c76.58a1d",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1012.0324401855469,
        "y": 473.2222409248352,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "9a3f095b.53aca8",
                "454b0ff.c77c1f"
            ]
        ]
    },
    {
        "id": "9a3f095b.53aca8",
        "type": "execute",
        "name": "execute split parameterName",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1208.2886428833008,
        "y": 450.9703793525696,
        "z": "5099ec4c.e95b94",
        "wires": [
            []
        ]
    },
    {
        "id": "454b0ff.c77c1f",
        "type": "set",
        "name": "set parameterName",
        "xml": "<set>\n<parameter name=\"`vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
        "comments": "",
        "x": 1177.7330703735352,
        "y": 487.9704957008362,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "1b7ed90b.0ee057",
        "type": "comment",
        "name": "Take the parameter names by removing prefix",
        "info": "",
        "comments": "",
        "x": 1181.2542991638184,
        "y": 410.33332538604736,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "a6c02374.2dca",
        "type": "switchNode",
        "name": "switch vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 737.75390625,
        "y": 208.99999284744263,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "698329a9.119718"
            ]
        ]
    },
    {
        "id": "698329a9.119718",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 924.4205856323242,
        "y": 208.33329057693481,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "f31a5878.bf4fd8"
            ]
        ]
    },
    {
        "id": "f31a5878.bf4fd8",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs in MD-SAL\" />\n",
        "comments": "",
        "x": 1106.0872116088867,
        "y": 208.33329057693481,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "40ba27b5.057bf8",
        "type": "switchNode",
        "name": "switch vf-modules.vf-module_length",
        "xml": "<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 779.0038957595825,
        "y": 328.99999380111694,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "51b4cfc4.d81ec",
                "9cba331b.ccedc"
            ]
        ]
    },
    {
        "id": "51b4cfc4.d81ec",
        "type": "other",
        "name": "Null",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 1010.00390625,
        "y": 304.999990940094,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "3f2cb9e5.051a76"
            ]
        ]
    },
    {
        "id": "9cba331b.ccedc",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1010.00390625,
        "y": 344.999990940094,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "e0c33286.cb104"
            ]
        ]
    },
    {
        "id": "3f2cb9e5.051a76",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='0' />\n",
        "comments": "",
        "x": 1152.50390625,
        "y": 304.999990940094,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "e0c33286.cb104",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1154.3609504699707,
        "y": 344.9365029335022,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "8b8b9efa.275ce",
                "1791a391.e4fccc"
            ]
        ]
    },
    {
        "id": "1791a391.e4fccc",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' />\n\n\n",
        "comments": "",
        "x": 1307.059425354004,
        "y": 314.55560162616894,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "8b8b9efa.275ce",
        "type": "for",
        "name": "for each existing vf-index",
        "xml": "<for index='idx' start='0' end='`$vf-index`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1363.4879302978516,
        "y": 367.7777314186096,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "aaa91538.94bcc8"
            ]
        ]
    },
    {
        "id": "bd3d2242.9164e",
        "type": "comment",
        "name": "make sure this network doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1587.1386604309082,
        "y": 326.03178882598877,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "aaa91538.94bcc8",
        "type": "switchNode",
        "name": "switch vf-module-id found",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1638.7736511230469,
        "y": 367.3492341041565,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "a84edb80.0d80e8"
            ]
        ]
    },
    {
        "id": "a84edb80.0d80e8",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1539.503849029541,
        "y": 425.92066526412964,
        "z": "5099ec4c.e95b94",
        "wires": [
            [
                "7ca646fd.066d78"
            ]
        ]
    },
    {
        "id": "7ca646fd.066d78",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id already found in service-data\" />\n",
        "comments": "",
        "x": 1687.2539520263672,
        "y": 425.77785733295605,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "40436b2a.16f614",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-id' value='`$prop.site-vf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.sdnc-request-header.' value='`$vf-module-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.request-information.' value='`$vf-module-topology-operation-input.request-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.service-information.' value='`$vf-module-topology-operation-input.service-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vnf-information.' value='`$vf-module-topology-operation-input.vnf-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-information.' value='`$vf-module-topology-operation-input.vf-module-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-topology.' value='`$tmp.vf-module-topology.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index+1`' />\n\n",
        "comments": "",
        "x": 790.8571014404297,
        "y": 755.4962139129639,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "2f9ca627.c38e7a",
        "type": "execute",
        "name": "execute generate-vf-module-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.site-vf-index\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 799.1905975341797,
        "y": 702.1629467010498,
        "z": "5099ec4c.e95b94",
        "wires": [
            []
        ]
    },
    {
        "id": "a7e8dd90.c6661",
        "type": "set",
        "name": "set new vf-module_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index + 1`' />",
        "comments": "",
        "x": 773.1905746459961,
        "y": 648.1628403663635,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "59e1bfa3.d11e4",
        "type": "set",
        "name": "set vf-module-request-input.",
        "xml": "<set>\n<parameter name='vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n",
        "comments": "",
        "x": 788.1902351379395,
        "y": 538.1542210578918,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "1c5585c5.9cdc3a",
        "type": "call",
        "name": "call sdwan-get-vf-module-site-param",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-vf-module-site-param' mode='sync' >\n",
        "comments": "",
        "outputs": 1,
        "x": 804.190544128418,
        "y": 590.154402256012,
        "z": "5099ec4c.e95b94",
        "wires": [
            []
        ]
    },
    {
        "id": "64771e44.2196d",
        "type": "set",
        "name": "set vf-module-object-path",
        "xml": "<set>\n<parameter name='vf-module-id' value='`$prop.site-vf-index`' />\n<parameter name='vf-module-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $prop.site-vf-index\n + '/vf-module-data/vf-module-topology/'`\"/>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology/'`\"/>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n",
        "comments": "",
        "x": 786.0039939880371,
        "y": 806.0000591278076,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "bb863987.8db5d8",
        "type": "set",
        "name": "set vf-module-level-oper-status",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.order-status'  value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />\n",
        "comments": "",
        "x": 795.5040130615234,
        "y": 854.9999685287476,
        "z": "5099ec4c.e95b94",
        "wires": []
    },
    {
        "id": "670cd372.9429ec",
        "type": "save",
        "name": "save sdwan vpn resource in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource' \n      key='site-resource.site-resource-id = $prop.site-vf-index' >\n<parameter name='site-resource-id' value='`$prop.site-vf-index`' />\n<parameter name='site-resource-name' value='`$prop.site.name`' />\n<parameter name='description' value='`$prop.site.description`' />\n<parameter name='type' value='`$prop.site.type`' />\n<parameter name='role' value='`$prop.site.role`' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vf-module-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $service-data.vnfs.vnf[$vnf-index].vnf-id  + '/vnf-data/vf-modules/vf-module/' + $prop.site-vf-index + '/vf-module-data/'` \" />",
        "comments": "",
        "outputs": 1,
        "x": 798.0039482116699,
        "y": 900.4999747276306,
        "z": "5099ec4c.e95b94",
        "wires": [
            []
        ]
    },
    {
        "id": "4d453124.5225e",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='generic-vnf:relationship-list' \n      key='generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"sdwan-vpn\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/sdwan-vpns/sdwan-vpn/' + $prop.site-vf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"sdwan-vpn.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.site-vf-index`\" />\n\n\n<!--save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource:relationship-list' \n      key='site-resource.site-resource-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"sdwan-site\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/sdwan-sites/sdwan-site/' + $prop.site-vf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"sdwan-vpn.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.site-vf-index`\" /-->\n",
        "comments": "",
        "outputs": 1,
        "x": 797.0038909912109,
        "y": 947.5000224113464,
        "z": "5099ec4c.e95b94",
        "wires": [
            []
        ]
    },
    {
        "id": "462de6d9.81f588",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 745.7264213562012,
        "y": 993.6738653182983,
        "z": "5099ec4c.e95b94",
        "wires": []
    }
]