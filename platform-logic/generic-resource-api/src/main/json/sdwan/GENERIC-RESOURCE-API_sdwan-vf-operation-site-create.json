[
    {
        "id": "258bcafa.79bf06",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 266.03125,
        "y": 144.9999885559082,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "9bdb9e8e.fc91"
            ]
        ]
    },
    {
        "id": "9bdb9e8e.fc91",
        "type": "method",
        "name": "sdwan-vf-operation-site-create",
        "xml": "<method rpc='sdwan-vf-operation-site-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 265.03125,
        "y": 244.9999885559082,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "4e709fae.1c775"
            ]
        ]
    },
    {
        "id": "fc2baffa.66fa7",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 95.53125,
        "y": 55.999996185302734,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "258bcafa.79bf06"
            ]
        ]
    },
    {
        "id": "4e709fae.1c775",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 424.03123474121094,
        "y": 360.99999713897705,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "acd6003d.6dfca",
                "21470918.3e15c6",
                "3151dd23.ba54b2",
                "8614c9af.f2a168",
                "f9c4ee22.e9af9",
                "5f0f5624.a59618",
                "b4c9cc03.46dc3",
                "5c7cec14.359604",
                "e9c8a9da.47c4f8",
                "98aa747d.2a9398",
                "58b6985.56c4e68",
                "305291b1.70145e",
                "b4f132d.d1316d",
                "e34dc5db.302258"
            ]
        ]
    },
    {
        "id": "acd6003d.6dfca",
        "type": "for",
        "name": "for each vnf",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 724.3606567382812,
        "y": 252.49612140655518,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "c71ece4b.a9227"
            ]
        ]
    },
    {
        "id": "c71ece4b.a9227",
        "type": "switchNode",
        "name": "switch this vnf-id == input vnf-id",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`\">    \n",
        "comments": "",
        "outputs": 1,
        "x": 976.3607482910156,
        "y": 251.16278457641602,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "8e9db92d.de5298"
            ]
        ]
    },
    {
        "id": "df35036a.1cbc9",
        "type": "set",
        "name": "set vnf-index",
        "xml": "<set>\n<parameter name='vnf-index' value='`$idx`' />\n",
        "comments": "",
        "x": 1348.0272369384766,
        "y": 253.16278743743896,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "8e9db92d.de5298",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1194.6940650939941,
        "y": 253.162766456604,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "df35036a.1cbc9"
            ]
        ]
    },
    {
        "id": "8614c9af.f2a168",
        "type": "for",
        "name": "for loop idx - VF input parameters",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param_length`\">\n\n",
        "comments": "",
        "outputs": 1,
        "x": 798.2814407348633,
        "y": 474.666654586792,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "9c6e372a.321958"
            ]
        ]
    },
    {
        "id": "9c6e372a.321958",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1013.0597839355469,
        "y": 472.2222385406494,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "55704a9e.c001b4",
                "2146a1d1.902b4e"
            ]
        ]
    },
    {
        "id": "55704a9e.c001b4",
        "type": "execute",
        "name": "execute split parameterName",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1209.3159866333008,
        "y": 449.9703769683838,
        "z": "5296f6cf.8621c8",
        "wires": [
            []
        ]
    },
    {
        "id": "2146a1d1.902b4e",
        "type": "set",
        "name": "set parameterName",
        "xml": "<set>\n<parameter name=\"`vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
        "comments": "",
        "x": 1178.7604141235352,
        "y": 486.9704933166504,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "8bae53ff.a556f",
        "type": "comment",
        "name": "Take the parameter names by removing prefix",
        "info": "",
        "comments": "",
        "x": 1182.2816429138184,
        "y": 409.3333230018616,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "21470918.3e15c6",
        "type": "switchNode",
        "name": "switch vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 738.78125,
        "y": 207.99999046325684,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "af6755.8c2218a8"
            ]
        ]
    },
    {
        "id": "af6755.8c2218a8",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 925.4479293823242,
        "y": 207.33328819274902,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "a08b3903.260428"
            ]
        ]
    },
    {
        "id": "a08b3903.260428",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs in MD-SAL\" />\n",
        "comments": "",
        "x": 1107.1145553588867,
        "y": 207.33328819274902,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "3151dd23.ba54b2",
        "type": "switchNode",
        "name": "switch vf-modules.vf-module_length",
        "xml": "<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 780.0312395095825,
        "y": 327.99999141693115,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "7b46b3d5.bcf76c",
                "ffa6296b.631ee8"
            ]
        ]
    },
    {
        "id": "7b46b3d5.bcf76c",
        "type": "other",
        "name": "Null",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 1011.03125,
        "y": 303.9999885559082,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "9fb15c37.03582"
            ]
        ]
    },
    {
        "id": "ffa6296b.631ee8",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1011.03125,
        "y": 343.9999885559082,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "d0214db.1da13b"
            ]
        ]
    },
    {
        "id": "9fb15c37.03582",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='0' />\n",
        "comments": "",
        "x": 1153.53125,
        "y": 303.9999885559082,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "d0214db.1da13b",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1155.3882942199707,
        "y": 343.9365005493164,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "84b451e6.1dd73",
                "7b673bd4.2d0d84"
            ]
        ]
    },
    {
        "id": "7b673bd4.2d0d84",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' />\n\n\n",
        "comments": "",
        "x": 1308.086769104004,
        "y": 313.55559924198315,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "84b451e6.1dd73",
        "type": "for",
        "name": "for each existing vf-index",
        "xml": "<for index='idx' start='0' end='`$vf-index`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1364.5152740478516,
        "y": 366.7777290344238,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "2f7da765.cbd1e8"
            ]
        ]
    },
    {
        "id": "19b41fcd.b4604",
        "type": "comment",
        "name": "make sure this network doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1588.1660041809082,
        "y": 325.031786441803,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "2f7da765.cbd1e8",
        "type": "switchNode",
        "name": "switch vf-module-id found",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1639.8009948730469,
        "y": 366.3492317199707,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "b8ad0b1d.10a4a8"
            ]
        ]
    },
    {
        "id": "b8ad0b1d.10a4a8",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1540.531192779541,
        "y": 424.92066287994385,
        "z": "5296f6cf.8621c8",
        "wires": [
            [
                "bc7d6657.9e8668"
            ]
        ]
    },
    {
        "id": "bc7d6657.9e8668",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id already found in service-data\" />\n",
        "comments": "",
        "x": 1688.2812957763672,
        "y": 424.77785494877025,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "e9c8a9da.47c4f8",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-id' value='`$prop.site-vf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.sdnc-request-header.' value='`$vf-module-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.request-information.' value='`$vf-module-topology-operation-input.request-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.service-information.' value='`$vf-module-topology-operation-input.service-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vnf-information.' value='`$vf-module-topology-operation-input.vnf-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-information.' value='`$vf-module-topology-operation-input.vf-module-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-topology.' value='`$tmp.vf-module-topology.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index+1`' />\n\n",
        "comments": "",
        "x": 791.8844451904297,
        "y": 754.4962115287781,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "5c7cec14.359604",
        "type": "execute",
        "name": "execute generate-vf-module-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.site-vf-index\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 800.2179412841797,
        "y": 701.162944316864,
        "z": "5296f6cf.8621c8",
        "wires": [
            []
        ]
    },
    {
        "id": "b4c9cc03.46dc3",
        "type": "set",
        "name": "set new vf-module_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index + 1`' />",
        "comments": "",
        "x": 774.2179183959961,
        "y": 647.1628379821777,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "f9c4ee22.e9af9",
        "type": "set",
        "name": "set vf-module-request-input.",
        "xml": "<set>\n<parameter name='vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n",
        "comments": "",
        "x": 789.2175788879395,
        "y": 537.154218673706,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "5f0f5624.a59618",
        "type": "call",
        "name": "call sdwan-get-vf-module-site-param",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-vf-module-site-param' mode='sync' >\n",
        "comments": "",
        "outputs": 1,
        "x": 805.217887878418,
        "y": 589.1543998718262,
        "z": "5296f6cf.8621c8",
        "wires": [
            []
        ]
    },
    {
        "id": "98aa747d.2a9398",
        "type": "set",
        "name": "set vf-module-object-path",
        "xml": "<set>\n<parameter name='vf-module-id' value='`$prop.site-vf-index`' />\n<parameter name='vf-module-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $prop.site-vf-index\n + '/vf-module-data/vf-module-topology/'`\"/>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology/'`\"/>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n",
        "comments": "",
        "x": 787.0313377380371,
        "y": 805.0000567436218,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "58b6985.56c4e68",
        "type": "set",
        "name": "set vf-module-level-oper-status",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.order-status'  value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />\n",
        "comments": "",
        "x": 796.5313568115234,
        "y": 853.9999661445618,
        "z": "5296f6cf.8621c8",
        "wires": []
    },
    {
        "id": "b4f132d.d1316d",
        "type": "save",
        "name": "save sdwan vpn resource in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource' \n      key='site-resource.site-resource-id = $prop.site-vf-index' >\n<parameter name='site-resource-id' value='`$prop.site-vf-index`' />\n<parameter name='site-resource-name' value='`$prop.site.name`' />\n<parameter name='description' value='`$prop.site.description`' />\n<parameter name='type' value='`$prop.site.type`' />\n<parameter name='role' value='`$prop.site.role`' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vf-module-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $service-data.vnfs.vnf[$vnf-index].vnf-id  + '/vnf-data/vf-modules/vf-module/' + $prop.site-vf-index + '/vf-module-data/'` \" />",
        "comments": "",
        "outputs": 1,
        "x": 799.0312919616699,
        "y": 899.4999723434448,
        "z": "5296f6cf.8621c8",
        "wires": [
            []
        ]
    },
    {
        "id": "e34dc5db.302258",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='generic-vnf:relationship-list' \n      key='generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"site-resource\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/site-resources/site-resource/' + $prop.site-vf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"site-resource.site-resource-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.site-vf-index`\" />\n",
        "comments": "",
        "outputs": 1,
        "x": 798.0312347412109,
        "y": 946.5000200271606,
        "z": "5296f6cf.8621c8",
        "wires": [
            []
        ]
    },
    {
        "id": "305291b1.70145e",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 746.7537651062012,
        "y": 992.6738629341125,
        "z": "5296f6cf.8621c8",
        "wires": []
    }
]