[
    {
        "id": "f2c51e78.6ee01",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 233.5,
        "y": 162.99999046325684,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "e7f78c27.133fa"
            ]
        ]
    },
    {
        "id": "e7f78c27.133fa",
        "type": "method",
        "name": "sdwan-vf-operation-site-create",
        "xml": "<method rpc='sdwan-vf-operation-site-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 232.5,
        "y": 262.99999046325684,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "31fa463e.82923a"
            ]
        ]
    },
    {
        "id": "bac9bd77.fe0f",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 85,
        "y": 68.00000381469727,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "f2c51e78.6ee01"
            ]
        ]
    },
    {
        "id": "31fa463e.82923a",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 391.49998474121094,
        "y": 378.9999990463257,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "dda69c6e.0dcdc",
                "73e90791.30e428",
                "539f4691.77ee38",
                "b886ea54.85e0f8",
                "be0d3540.8ebb28",
                "788efb60.76f4a4",
                "154ced05.a101f3",
                "76dbb250.b292cc",
                "df7eb194.69b7e",
                "6868f266.5fe7ec",
                "e78bb1b3.a529d",
                "2b07f61e.bf4a1a",
                "fd37bb03.271ec8",
                "395e35c1.a6a5fa"
            ]
        ]
    },
    {
        "id": "dda69c6e.0dcdc",
        "type": "for",
        "name": "for each vnf",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 691.8294067382812,
        "y": 270.4961233139038,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "e02bea98.6a2108"
            ]
        ]
    },
    {
        "id": "e02bea98.6a2108",
        "type": "switchNode",
        "name": "switch this vnf-id == input vnf-id",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`\">    \n",
        "comments": "",
        "outputs": 1,
        "x": 943.8294982910156,
        "y": 269.16278648376465,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "44afa032.ce578"
            ]
        ]
    },
    {
        "id": "c12c2186.d601b",
        "type": "set",
        "name": "set vnf-index",
        "xml": "<set>\n<parameter name='vnf-index' value='`$idx`' />\n",
        "comments": "",
        "x": 1315.4959869384766,
        "y": 271.1627893447876,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "44afa032.ce578",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1162.1628150939941,
        "y": 271.16276836395264,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "c12c2186.d601b"
            ]
        ]
    },
    {
        "id": "b886ea54.85e0f8",
        "type": "for",
        "name": "for loop idx - VF input parameters",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param_length`\">\n\n",
        "comments": "",
        "outputs": 1,
        "x": 765.7501907348633,
        "y": 492.6666564941406,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "d6ac010b.ad6e"
            ]
        ]
    },
    {
        "id": "d6ac010b.ad6e",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 980.5285339355469,
        "y": 490.22224044799805,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "265e23d4.36e02c",
                "e3c83d1b.72db1"
            ]
        ]
    },
    {
        "id": "265e23d4.36e02c",
        "type": "execute",
        "name": "execute split parameterName",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1176.7847366333008,
        "y": 467.9703788757324,
        "z": "147f59c8.d7f266",
        "wires": [
            []
        ]
    },
    {
        "id": "e3c83d1b.72db1",
        "type": "set",
        "name": "set parameterName",
        "xml": "<set>\n<parameter name=\"`vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
        "comments": "",
        "x": 1146.2291641235352,
        "y": 504.970495223999,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "6cbee016.f6042",
        "type": "comment",
        "name": "Take the parameter names by removing prefix",
        "info": "",
        "comments": "",
        "x": 1149.7503929138184,
        "y": 427.3333249092102,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "73e90791.30e428",
        "type": "switchNode",
        "name": "switch vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 706.25,
        "y": 225.99999237060547,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "d8c3ff3.9b067"
            ]
        ]
    },
    {
        "id": "d8c3ff3.9b067",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 892.9166793823242,
        "y": 225.33329010009766,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "94ec6856.a83cd8"
            ]
        ]
    },
    {
        "id": "94ec6856.a83cd8",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs in MD-SAL\" />\n",
        "comments": "",
        "x": 1074.5833053588867,
        "y": 225.33329010009766,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "539f4691.77ee38",
        "type": "switchNode",
        "name": "switch vf-modules.vf-module_length",
        "xml": "<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 747.4999895095825,
        "y": 345.9999933242798,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "83439569.31aa38",
                "bcb4cae0.4f9908"
            ]
        ]
    },
    {
        "id": "83439569.31aa38",
        "type": "other",
        "name": "Null",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 978.5,
        "y": 321.99999046325684,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "ba3dff03.8dc24"
            ]
        ]
    },
    {
        "id": "bcb4cae0.4f9908",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 978.5,
        "y": 361.99999046325684,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "890fe4fa.c0f128"
            ]
        ]
    },
    {
        "id": "ba3dff03.8dc24",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='0' />\n",
        "comments": "",
        "x": 1121,
        "y": 321.99999046325684,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "890fe4fa.c0f128",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1122.8570442199707,
        "y": 361.93650245666504,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "3895380d.b43d08",
                "ba2eca23.0f6508"
            ]
        ]
    },
    {
        "id": "ba2eca23.0f6508",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' />\n\n\n",
        "comments": "",
        "x": 1275.555519104004,
        "y": 331.5556011493318,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "3895380d.b43d08",
        "type": "for",
        "name": "for each existing vf-index",
        "xml": "<for index='idx' start='0' end='`$vf-index`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1331.9840240478516,
        "y": 384.77773094177246,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "8202a636.7f9518"
            ]
        ]
    },
    {
        "id": "51af10a6.1b1e3",
        "type": "comment",
        "name": "make sure this network doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1555.6347541809082,
        "y": 343.0317883491516,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "8202a636.7f9518",
        "type": "switchNode",
        "name": "switch vf-module-id found",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1607.2697448730469,
        "y": 384.34923362731934,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "ce7e5cca.15004"
            ]
        ]
    },
    {
        "id": "ce7e5cca.15004",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1507.999942779541,
        "y": 442.9206647872925,
        "z": "147f59c8.d7f266",
        "wires": [
            [
                "7c5cfe61.fdc3f"
            ]
        ]
    },
    {
        "id": "7c5cfe61.fdc3f",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id already found in service-data\" />\n",
        "comments": "",
        "x": 1655.7500457763672,
        "y": 442.7778568561189,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "df7eb194.69b7e",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-id' value='`$prop.site-vf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.sdnc-request-header.' value='`$vf-module-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.request-information.' value='`$vf-module-topology-operation-input.request-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.service-information.' value='`$vf-module-topology-operation-input.service-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vnf-information.' value='`$vf-module-topology-operation-input.vnf-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-information.' value='`$vf-module-topology-operation-input.vf-module-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-topology.' value='`$tmp.vf-module-topology.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index+1`' />\n\n",
        "comments": "",
        "x": 759.3531951904297,
        "y": 772.4962134361267,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "76dbb250.b292cc",
        "type": "execute",
        "name": "execute generate-vf-module-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.site-vf-index\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 767.6866912841797,
        "y": 719.1629462242126,
        "z": "147f59c8.d7f266",
        "wires": [
            []
        ]
    },
    {
        "id": "154ced05.a101f3",
        "type": "set",
        "name": "set new vf-module_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index + 1`' />",
        "comments": "",
        "x": 741.6866683959961,
        "y": 665.1628398895264,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "be0d3540.8ebb28",
        "type": "set",
        "name": "set vf-module-request-input.",
        "xml": "<set>\n<parameter name='vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n",
        "comments": "",
        "x": 756.6863288879395,
        "y": 555.1542205810547,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "788efb60.76f4a4",
        "type": "call",
        "name": "call sdwan-get-vf-module-site-param",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-vf-module-site-param' mode='sync' >\n",
        "comments": "",
        "outputs": 1,
        "x": 772.686637878418,
        "y": 607.1544017791748,
        "z": "147f59c8.d7f266",
        "wires": [
            []
        ]
    },
    {
        "id": "6868f266.5fe7ec",
        "type": "set",
        "name": "set vf-module-object-path",
        "xml": "<set>\n<parameter name='vf-module-id' value='`$prop.site-vf-index`' />\n<parameter name='vf-module-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $prop.site-vf-index\n + '/vf-module-data/vf-module-topology/'`\"/>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology/'`\"/>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n",
        "comments": "",
        "x": 754.5000877380371,
        "y": 823.0000586509705,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "e78bb1b3.a529d",
        "type": "set",
        "name": "set vf-module-level-oper-status",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.order-status'  value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />\n",
        "comments": "",
        "x": 764.0001068115234,
        "y": 871.9999680519104,
        "z": "147f59c8.d7f266",
        "wires": []
    },
    {
        "id": "fd37bb03.271ec8",
        "type": "save",
        "name": "save sdwan vpn resource in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource' \n      key='site-resource.site-resource-id = $prop.site-vf-index' >\n<parameter name='site-resource-id' value='`$prop.site-vf-index`' />\n<parameter name='site-resource-name' value='`$prop.site.name`' />\n<parameter name='description' value='`$prop.site.description`' />\n<parameter name='type' value='`$prop.site.type`' />\n<parameter name='role' value='`$prop.site.role`' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vf-module-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $service-data.vnfs.vnf[$vnf-index].vnf-id  + '/vnf-data/vf-modules/vf-module/' + $prop.site-vf-index + '/vf-module-data/'` \" />",
        "comments": "",
        "outputs": 1,
        "x": 766.5000419616699,
        "y": 917.4999742507935,
        "z": "147f59c8.d7f266",
        "wires": [
            []
        ]
    },
    {
        "id": "395e35c1.a6a5fa",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='generic-vnf:relationship-list' \n      key='generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"site-resource\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/site-resources/site-resource/' + $prop.site-vf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"site-resource.site-resource-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.site-vf-index`\" />\n",
        "comments": "",
        "outputs": 1,
        "x": 765.4999847412109,
        "y": 964.5000219345093,
        "z": "147f59c8.d7f266",
        "wires": [
            []
        ]
    },
    {
        "id": "2b07f61e.bf4a1a",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 714.2225151062012,
        "y": 1010.6738648414612,
        "z": "147f59c8.d7f266",
        "wires": []
    }
]