[
    {
        "id": "bc28da2b.7303d8",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 323.0104064941406,
        "y": 132.99999237060547,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "dad83918.445348"
            ]
        ]
    },
    {
        "id": "dad83918.445348",
        "type": "method",
        "name": "sdwan-vf-operation-wanport-create",
        "xml": "<method rpc='sdwan-vf-operation-wanport-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 322.0104064941406,
        "y": 232.99999237060547,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "ffb1ada3.8a76c"
            ]
        ]
    },
    {
        "id": "55cf0e90.e3564",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 179.51040267944336,
        "y": 42,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "bc28da2b.7303d8"
            ]
        ]
    },
    {
        "id": "ffb1ada3.8a76c",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 481.01039123535156,
        "y": 349.0000009536743,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "470949db.a87688",
                "1946860c.52d49a",
                "986d9d2e.d652e",
                "176bae50.e7ba42",
                "1c96aac1.62b6a5",
                "d12731ca.f4e9a",
                "ad8e03c8.3f99",
                "99ca206c.689c4",
                "45a27310.e17b0c",
                "98b0c583.6fb0e8",
                "f3463186.010ce",
                "4efead29.a28254",
                "187c318b.c5572e",
                "29c03152.ef4a3e"
            ]
        ]
    },
    {
        "id": "470949db.a87688",
        "type": "for",
        "name": "for each vnf",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 781.3398132324219,
        "y": 240.49612522125244,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "4bf0f7e7.44aea8"
            ]
        ]
    },
    {
        "id": "4bf0f7e7.44aea8",
        "type": "switchNode",
        "name": "switch this vnf-id == input vnf-id",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`\">    \n",
        "comments": "",
        "outputs": 1,
        "x": 1033.3399047851562,
        "y": 239.16278839111328,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "3d05a6f7.8cda9a"
            ]
        ]
    },
    {
        "id": "d918203.c2e31e",
        "type": "set",
        "name": "set vnf-index",
        "xml": "<set>\n<parameter name='vnf-index' value='`$idx`' />\n",
        "comments": "",
        "x": 1405.0063934326172,
        "y": 241.16279125213623,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "3d05a6f7.8cda9a",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1251.6732215881348,
        "y": 241.16277027130127,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "d918203.c2e31e"
            ]
        ]
    },
    {
        "id": "176bae50.e7ba42",
        "type": "for",
        "name": "for loop idx - VF input parameters",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param_length`\">\n\n",
        "comments": "",
        "outputs": 1,
        "x": 855.2605972290039,
        "y": 462.66665840148926,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "18c22866.3fa9a8"
            ]
        ]
    },
    {
        "id": "18c22866.3fa9a8",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1070.0389404296875,
        "y": 460.2222423553467,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "f7311df1.3a06f",
                "eb8b9c09.06311"
            ]
        ]
    },
    {
        "id": "f7311df1.3a06f",
        "type": "execute",
        "name": "execute split parameterName",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1266.2951431274414,
        "y": 437.97038078308105,
        "z": "eaff5db6.7dde1",
        "wires": [
            []
        ]
    },
    {
        "id": "eb8b9c09.06311",
        "type": "set",
        "name": "set parameterName",
        "xml": "<set>\n<parameter name=\"`vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
        "comments": "",
        "x": 1235.7395706176758,
        "y": 474.97049713134766,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "f77b19d7.8bb178",
        "type": "comment",
        "name": "Take the parameter names by removing prefix",
        "info": "",
        "comments": "",
        "x": 1239.260799407959,
        "y": 397.33332681655884,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "1946860c.52d49a",
        "type": "switchNode",
        "name": "switch vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 795.7604064941406,
        "y": 195.9999942779541,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "89c152d0.6fb2c"
            ]
        ]
    },
    {
        "id": "89c152d0.6fb2c",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 982.4270858764648,
        "y": 195.3332920074463,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "869ba82c.b1cd68"
            ]
        ]
    },
    {
        "id": "869ba82c.b1cd68",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs in MD-SAL\" />\n",
        "comments": "",
        "x": 1164.0937118530273,
        "y": 195.3332920074463,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "986d9d2e.d652e",
        "type": "switchNode",
        "name": "switch vf-modules.vf-module_length",
        "xml": "<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 837.0103960037231,
        "y": 315.9999952316284,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "6d96cae7.544aa4",
                "7b4aef1d.e8397"
            ]
        ]
    },
    {
        "id": "6d96cae7.544aa4",
        "type": "other",
        "name": "Null",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 1068.0104064941406,
        "y": 291.99999237060547,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "8b1de33b.f87d8"
            ]
        ]
    },
    {
        "id": "7b4aef1d.e8397",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1068.0104064941406,
        "y": 331.99999237060547,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "e6620c2c.848df"
            ]
        ]
    },
    {
        "id": "8b1de33b.f87d8",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='0' />\n",
        "comments": "",
        "x": 1210.5104064941406,
        "y": 291.99999237060547,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "e6620c2c.848df",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1212.3674507141113,
        "y": 331.9365043640137,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "9a648de3.1f16d",
                "8d5a09c0.be4698"
            ]
        ]
    },
    {
        "id": "8d5a09c0.be4698",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' />\n\n\n",
        "comments": "",
        "x": 1365.0659255981445,
        "y": 301.5556030566804,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "9a648de3.1f16d",
        "type": "for",
        "name": "for each existing vf-index",
        "xml": "<for index='idx' start='0' end='`$vf-index`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1421.4944305419922,
        "y": 354.7777328491211,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "35f2967d.f1236a"
            ]
        ]
    },
    {
        "id": "9105950c.e52f88",
        "type": "comment",
        "name": "make sure this network doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1645.1451606750488,
        "y": 313.03179025650024,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "35f2967d.f1236a",
        "type": "switchNode",
        "name": "switch vf-module-id found",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1696.7801513671875,
        "y": 354.34923553466797,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "7879d3b9.a48b9c"
            ]
        ]
    },
    {
        "id": "7879d3b9.a48b9c",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1597.5103492736816,
        "y": 412.9206666946411,
        "z": "eaff5db6.7dde1",
        "wires": [
            [
                "d7b29734.9c35b8"
            ]
        ]
    },
    {
        "id": "d7b29734.9c35b8",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id already found in service-data\" />\n",
        "comments": "",
        "x": 1745.2604522705078,
        "y": 412.7778587634675,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "99ca206c.689c4",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-id' value='`$prop.site-vf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.sdnc-request-header.' value='`$vf-module-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.request-information.' value='`$vf-module-topology-operation-input.request-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.service-information.' value='`$vf-module-topology-operation-input.service-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vnf-information.' value='`$vf-module-topology-operation-input.vnf-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-information.' value='`$vf-module-topology-operation-input.vf-module-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-topology.' value='`$tmp.vf-module-topology.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index+1`' />\n",
        "comments": "",
        "x": 849.8635559082031,
        "y": 742.4961910247803,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "ad8e03c8.3f99",
        "type": "execute",
        "name": "execute generate-vf-module-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.wan-port-vf-index\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 862.1971206665039,
        "y": 688.1629104614258,
        "z": "eaff5db6.7dde1",
        "wires": [
            []
        ]
    },
    {
        "id": "d12731ca.f4e9a",
        "type": "set",
        "name": "set new vf-module_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index + 1`' />",
        "comments": "",
        "x": 834.1970672607422,
        "y": 635.1628475189209,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "1c96aac1.62b6a5",
        "type": "set",
        "name": "set vf-module-request-input.",
        "xml": "<set>\n<parameter name='vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n",
        "comments": "",
        "x": 846.1967353820801,
        "y": 525.1542224884033,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "45a27310.e17b0c",
        "type": "set",
        "name": "set vf-module-object-path",
        "xml": "<set>\n<parameter name='vf-module-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $prop.wan-port-vf-index\n + '/vf-module-data/vf-module-topology/'`\"/>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology/'`\"/>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n",
        "comments": "",
        "x": 838.0104808807373,
        "y": 794.0000371932983,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "98b0c583.6fb0e8",
        "type": "set",
        "name": "set vf-module-level-oper-status",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.order-status'  value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />",
        "comments": "",
        "x": 852.5105400085449,
        "y": 843.9999303817749,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "187c318b.c5572e",
        "type": "save",
        "name": "save sdwan vpn resource in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='wan-port-config' \n      key='wan-port-config.wan-port-config-id = $prop.vnf-index' >\n<parameter name=\"wan-port-config-id\" value=\"`$prop.vnf-index`\" />\n<parameter name=\"wan-port-config-name\" value=\"`$prop.wan.name`\" />\n<parameter name=\"device-id\" value=\"`$prop.wan.deviceName`\" />\n<parameter name='vlan-id' value=\"`$prop.wan.vlanId`\" />\n<parameter name=\"ip-address\" value=\"`$prop.wan.ipAddress`\" />\n<parameter name=\"provider-ip-address\" value=\"`$prop.wan.providerIpAddress`\" />\n<parameter name=\"input-bandwidth\" value=\"`$prop.wan.inputBandwidth`\" />\n<parameter name=\"output-bandwidth\" value=\"`$prop.wan.outputBandwidth`\" />\n<parameter name=\"description\" value=\"`$prop.wan.description`\" />\n<parameter name=\"port-type\" value=\"`$prop.wan.portType`\" />\n<parameter name=\"port-number\" value=\"`$prop.wan.portNumber`\" />\n<parameter name=\"transport-network-name\" value=\"`$prop.wan.transportNetworkName`\" />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vf-module-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $service-data.vnfs.vnf[$vnf-index].vnf-id  + '/vnf-data/vf-modules/vf-module/' + $prop.site-vf-index + '/vf-module-data/'` \" />\n",
        "comments": "",
        "outputs": 1,
        "x": 856.0104484558105,
        "y": 887.4999761581421,
        "z": "eaff5db6.7dde1",
        "wires": [
            []
        ]
    },
    {
        "id": "29c03152.ef4a3e",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='generic-vnf:relationship-list' \n      key='generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"sdwan-vpn\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/sdwan-vpns/sdwan-vpn/' + $prop.site-vf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"sdwan-vpn.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.site-vf-index`\" />\n\n\n<!--save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource:relationship-list' \n      key='site-resource.site-resource-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"sdwan-site\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/sdwan-sites/sdwan-site/' + $prop.site-vf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"sdwan-vpn.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.site-vf-index`\" /-->\n",
        "comments": "",
        "outputs": 1,
        "x": 853.0103759765625,
        "y": 933.5000076293945,
        "z": "eaff5db6.7dde1",
        "wires": [
            []
        ]
    },
    {
        "id": "f3463186.010ce",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 803.7329216003418,
        "y": 980.6738667488098,
        "z": "eaff5db6.7dde1",
        "wires": []
    },
    {
        "id": "4efead29.a28254",
        "type": "call",
        "name": "call sdwan-get-wan-param",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-wan-param' mode='sync' >\n",
        "comments": "",
        "outputs": 1,
        "x": 845.8992767333984,
        "y": 587.8888759613037,
        "z": "eaff5db6.7dde1",
        "wires": [
            []
        ]
    }
]