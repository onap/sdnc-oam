[
  {
    "id": "ad2ef973.e6a378",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 131,
    "y": 55,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "151183ce.27c78c"
      ]
    ]
  },
  {
    "id": "151183ce.27c78c",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 314.00000381469727,
    "y": 129.000018119812,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "89afc74f.956348"
      ]
    ]
  },
  {
    "id": "89afc74f.956348",
    "type": "method",
    "name": "sdwan-attachment-topology-operation-create",
    "xml": "<method rpc='sdwan-attachment-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 302.0001220703125,
    "y": 217.00000095367432,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "580de8c5.e06e78"
      ]
    ]
  },
  {
    "id": "580de8c5.e06e78",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 222.00005340576172,
    "y": 966.0002489089966,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "1fbb291d.155017",
        "f8c6b86f.980db8",
        "655b6d38.675514",
        "87b8ca30.cf86e8",
        "3718c342.00f4ac",
        "3fc33b48.8d6bf4",
        "15c0d821.288668",
        "99b25b64.985da8",
        "cc1d8a7e.c8e908",
        "aec371b2.f4eb6",
        "7c0d6a4c.141ba4",
        "605ed84a.e90ef8",
        "cf809c65.e205f",
        "5ffc39de.e33178",
        "b70e6d89.61807",
        "2fe0bf35.0314b",
        "4b90a515.ea737c",
        "30825693.105b0a",
        "a79587b.c624178",
        "9d0211a4.58ce8",
        "5c590a79.9e0264",
        "adeabb6e.cf7758",
        "7ee858c0.930c58"
      ]
    ]
  },
  {
    "id": "74beb7.011b0148",
    "type": "comment",
    "name": "Set allotted resource id if not sent by SO",
    "info": "",
    "comments": "",
    "x": 706.0767517089844,
    "y": 126.43391990661621,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "1fbb291d.155017",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 652.0000305175781,
    "y": 181.99999332427979,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "4a85a033.b553c",
        "de2e876a.0ba078"
      ]
    ]
  },
  {
    "id": "4a85a033.b553c",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 850.0001182556152,
    "y": 151.999981880188,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "63eb9d84.765954"
      ]
    ]
  },
  {
    "id": "de2e876a.0ba078",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 849.0000267028809,
    "y": 188.99999237060547,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "eef884cd.26a128"
      ]
    ]
  },
  {
    "id": "eef884cd.26a128",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-id",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n",
    "comments": "",
    "x": 1047.000015258789,
    "y": 186.0000114440918,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "f8c6b86f.980db8",
    "type": "set",
    "name": "set tmp.ar.self-link",
    "xml": "<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:connection-attachment-allotted-resources/connection-attachment-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/connection-attachment-topology/'` \" />\n\n",
    "comments": "",
    "x": 619.9999542236328,
    "y": 403.0001001358032,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "655b6d38.675514",
    "type": "execute",
    "name": "execute Properties",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n",
    "comments": "",
    "outputs": 1,
    "x": 620.2618713378906,
    "y": 484.6667814254761,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "87b8ca30.cf86e8",
    "type": "execute",
    "name": "generate allotted-resource tmp.ar-url",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.connection-attachment-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 673.2619323730469,
    "y": 571.6666994094849,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "63eb9d84.765954",
    "type": "execute",
    "name": "execute tmp.ar.allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"tmp.ar.allotted-resource-id\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1065.0000953674316,
    "y": 152.9999876022339,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "7fcc0333.e4b76c"
      ]
    ]
  },
  {
    "id": "7fcc0333.e4b76c",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1283.0001373291016,
    "y": 152.99995136260986,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "dc8faa82.0a80d8"
      ]
    ]
  },
  {
    "id": "dc8faa82.0a80d8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value=\"An error occured while generation allotted resource ID\" />\n",
    "comments": "",
    "x": 1449.0000915527344,
    "y": 152.9999656677246,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "83948a24.3af768",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1179.0002307891846,
    "y": 643.7778720855713,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "64a66d0e.2cab24"
      ]
    ]
  },
  {
    "id": "fd6c452f.f52a18",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: Existing connection attachment allotted resource\" />\n    \n",
    "comments": "",
    "x": 1912.5186100006104,
    "y": 644.8439435958862,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "df1c313d.a9cf4",
    "type": "comment",
    "name": "Check for non existence of allotted resource",
    "info": "",
    "comments": "",
    "x": 1035.0001525878906,
    "y": 577.7779388427734,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "3c6b3ac8.5f54b6",
    "type": "for",
    "name": "for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]",
    "xml": "<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1555.6666984558105,
    "y": 788.0000512599945,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "e0e0a661.74b9e8"
      ]
    ]
  },
  {
    "id": "3fc33b48.8d6bf4",
    "type": "switchNode",
    "name": "switch service-data.consumed-allotted-resources_length",
    "xml": "<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 737.6660232543945,
    "y": 764.7140836715698,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "98246edb.9d503",
        "303d6837.0384d8"
      ]
    ]
  },
  {
    "id": "98246edb.9d503",
    "type": "other",
    "name": "outcome Null",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 1041.8089218139648,
    "y": 733.5715208053589,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "1bc15eed.fd45b1"
      ]
    ]
  },
  {
    "id": "303d6837.0384d8",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1018.8089714050293,
    "y": 794.571475982666,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "b930de42.50a21"
      ]
    ]
  },
  {
    "id": "b930de42.50a21",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1178.9360618591309,
    "y": 792.697452545166,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "3c6b3ac8.5f54b6",
        "7d532296.0d9bfc",
        "6dd5cf93.f0258"
      ]
    ]
  },
  {
    "id": "1bc15eed.fd45b1",
    "type": "set",
    "name": "set cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n",
    "comments": "",
    "x": 1191.6659049987793,
    "y": 731.2855710983276,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "15c0d821.288668",
    "type": "set",
    "name": "set consumed allotted resources",
    "xml": "<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n",
    "comments": "",
    "x": 666.5233154296875,
    "y": 868.2856483459473,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "7d532296.0d9bfc",
    "type": "switchNode",
    "name": "switch tmp.found-cidx",
    "xml": "<switch test='`$tmp.found-cidx`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1368.0511093139648,
    "y": 824.708975315094,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "106270aa.e9c6ff"
      ]
    ]
  },
  {
    "id": "106270aa.e9c6ff",
    "type": "outcomeTrue",
    "name": "false",
    "xml": "<outcome value='false'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1558.0510635375977,
    "y": 824.7089123725891,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "e1144596.6d5ba8"
      ]
    ]
  },
  {
    "id": "e1144596.6d5ba8",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1724.0510635375977,
    "y": 824.7089123725891,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "b93f3869.6459e8"
      ]
    ]
  },
  {
    "id": "e0e0a661.74b9e8",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n",
    "comments": "",
    "outputs": 1,
    "x": 1972.7783279418945,
    "y": 785.000078201294,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "326d00a0.76b6c"
      ]
    ]
  },
  {
    "id": "326d00a0.76b6c",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2154.587902069092,
    "y": 785.4645252227783,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "cec76fbc.ec734"
      ]
    ]
  },
  {
    "id": "b93f3869.6459e8",
    "type": "set",
    "name": "set tmp.cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n",
    "comments": "",
    "x": 1885.924446105957,
    "y": 824.2206134796143,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "9dc9afd9.071d8",
    "type": "comment",
    "name": "Add to consumed service consumed-allotted-resources in mdsal",
    "info": "Prepare data and add to service-data",
    "comments": "",
    "x": 758.667236328125,
    "y": 695.0000476837158,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "79d72e28.e5bf",
    "type": "comment",
    "name": "This set resource will be added to MDSAL by provider code",
    "info": "Below we add to service-data.consumed-allotted-resource at last index",
    "comments": "",
    "x": 746.0001525878906,
    "y": 833.7781400680542,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "7ee858c0.930c58",
    "type": "update",
    "name": "save AAI allotted-resource",
    "xml": "<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $connection-attachment-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $connection-attachment-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $connection-attachment-topology-operation-input.service-information.service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n    <parameter name=\"id\" value=\"`$tmp.ar.allotted-resource-id`\" />\n\t<parameter name=\"role\" value=\"`$prop.connection-attachment.role`\" />\t\n    <parameter name=\"vpn-name\" value=\"`$prop.connection-attachment.sdwanVpnName`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid`\" />\n\t<parameter name=\"operational-status\" value=\"Created\" />\n",
    "comments": "",
    "outputs": 1,
    "x": 656.6908569335938,
    "y": 1793.531904220581,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "54e2f563.b3af5c",
        "291816ed.18393a"
      ]
    ]
  },
  {
    "id": "54e2f563.b3af5c",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 851.4527931213379,
    "y": 1784.4845056533813,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "a3778d99.3c015"
      ]
    ]
  },
  {
    "id": "a3778d99.3c015",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n",
    "comments": "",
    "x": 1017.9766731262207,
    "y": 1796.1035766601562,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "291816ed.18393a",
    "type": "failure",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 858.5480804443359,
    "y": 1817.246473312378,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "a3778d99.3c015"
      ]
    ]
  },
  {
    "id": "ac365c56.4b2",
    "type": "comment",
    "name": "Save Resource to AAI",
    "info": "",
    "comments": "",
    "x": 690.5005340576172,
    "y": 1761.833875656128,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "81ef7e04.cd917",
    "type": "comment",
    "name": "Set allotted resource type if not sent by SO",
    "info": "",
    "comments": "",
    "x": 692,
    "y": 235.00000095367432,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "3718c342.00f4ac",
    "type": "switchNode",
    "name": "switch allotted-resource-type",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 653.9233093261719,
    "y": 275.5660572052002,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "64aa0e9c.b1d09",
        "7800ea8d.a7f124"
      ]
    ]
  },
  {
    "id": "64aa0e9c.b1d09",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 856.9234619140625,
    "y": 260.56606006622314,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "f530af4a.706e5"
      ]
    ]
  },
  {
    "id": "7800ea8d.a7f124",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 849.9232902526855,
    "y": 300.5660800933838,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "7a986711.0ca2d8"
      ]
    ]
  },
  {
    "id": "7a986711.0ca2d8",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`' />\n",
    "comments": "",
    "x": 1081.9232749938965,
    "y": 300.56608486175537,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "369cb772.706cb8",
    "type": "comment",
    "name": "For storage in AAI connection-attachment-topology",
    "info": "",
    "comments": "",
    "x": 716.9999618530273,
    "y": 370.0000009536743,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "492255d4.2adf4c",
    "type": "comment",
    "name": "Obtain different URL, template location etc",
    "info": "For saving resource information to MDSAL & for AAI",
    "comments": "",
    "x": 691.9999465942383,
    "y": 451.8889102935791,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "ddea3893.c96cd8",
    "type": "comment",
    "name": "Used for Put AR by id to MDSAL",
    "info": "",
    "comments": "",
    "x": 658.0000305175781,
    "y": 540.8889274597168,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "a440e95e.3176f8",
    "type": "comment",
    "name": "Obtain the last index in services",
    "info": "ServiceData is added by Provider code",
    "comments": "",
    "x": 659.4444732666016,
    "y": 726.8888721466064,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "a79587b.c624178",
    "type": "set",
    "name": "set output to api handler",
    "xml": "<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='connection-attachment-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $connection-attachment-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n",
    "comments": "",
    "x": 642.2681427001953,
    "y": 1700.359203338623,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "9d0211a4.58ce8",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 610.6812286376953,
    "y": 1862.9749298095703,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "f530af4a.706e5",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value=\"SDWANAttachmentInstance\" />\n",
    "comments": "",
    "x": 1096.0001487731934,
    "y": 260.99998664855957,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "30825693.105b0a",
    "type": "execute",
    "name": "execute RestApiCallNode - PUT AR by id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.sdwan-attachment.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 693.0002746582031,
    "y": 1634.00013256073,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "7725804e.b7ea",
        "ff126c78.d9f65",
        "34ce7aa1.c96186"
      ]
    ]
  },
  {
    "id": "7725804e.b7ea",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 942.6416282653809,
    "y": 1672.3314628601074,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "d7cd6db2.d2286"
      ]
    ]
  },
  {
    "id": "ff126c78.d9f65",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 933.6416778564453,
    "y": 1640.831488609314,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "d7cd6db2.d2286"
      ]
    ]
  },
  {
    "id": "34ce7aa1.c96186",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 937.391716003418,
    "y": 1611.1885934844613,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "6ccc24c6.03b4dc"
      ]
    ]
  },
  {
    "id": "d7cd6db2.d2286",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1103.391716003418,
    "y": 1641.5815124511719,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "6ccc24c6.03b4dc",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1079.0476837158203,
    "y": 1607.3807626739144,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "7c0d6a4c.141ba4",
    "type": "execute",
    "name": "execute RestApiCallNode - Update parent provided service AR",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 757.9999542236328,
    "y": 1150.000165939331,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "494a716e.866ba",
        "227c3021.44dc4",
        "ff8b452c.8d9bc8"
      ]
    ]
  },
  {
    "id": "494a716e.866ba",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1066.3080139160156,
    "y": 1181.998441696167,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "aaeb645f.80fed8"
      ]
    ]
  },
  {
    "id": "227c3021.44dc4",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1057.30806350708,
    "y": 1150.4984674453735,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "aaeb645f.80fed8"
      ]
    ]
  },
  {
    "id": "ff8b452c.8d9bc8",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1061.0581016540527,
    "y": 1120.8555723205209,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "74f3a310.0128fc"
      ]
    ]
  },
  {
    "id": "aaeb645f.80fed8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1227.0581016540527,
    "y": 1151.2484912872314,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "74f3a310.0128fc",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1202.714069366455,
    "y": 1117.047741509974,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "9405156b.c649a8",
    "type": "comment",
    "name": "Put the parent allotted resource in mdsal",
    "info": "",
    "comments": "",
    "x": 686.9999008178711,
    "y": 1112.000072479248,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "cf809c65.e205f",
    "type": "set",
    "name": "set connection-attachment-ar-identifiers",
    "xml": "<set>\n<parameter name='connection-attachment-ar-identifiers.consuming-service-instance-id' value=\"`$connection-attachment-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n",
    "comments": "",
    "x": 683.3570861816406,
    "y": 1314.5716915130615,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "605ed84a.e90ef8",
    "type": "set",
    "name": "set ar-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.action' value=\"`$connection-attachment-topology-operation-input.request-information.request-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-name' value=\"connection-attachment-topology-operation\" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-action' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$connection-attachment-topology-operation-input.request-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$connection-attachment-topology-operation-input.service-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.' value=\"`$connection-attachment-topology-operation-input.connection-attachment-request-input.` \" />",
    "comments": "",
    "x": 603.2139129638672,
    "y": 1282.381194114685,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "5ffc39de.e33178",
    "type": "set",
    "name": "set identifiers in overall structure",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.allotted-resource-identifiers.' \nvalue=\"`$connection-attachment-ar-identifiers.`\" />\n\n\n",
    "comments": "",
    "x": 662.1668853759766,
    "y": 1348.6668767929077,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "b70e6d89.61807",
    "type": "execute",
    "name": "execute getTime",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 614.4997253417969,
    "y": 1422.0004043579102,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "2fe0bf35.0314b",
    "type": "set",
    "name": "set allotted-resource-oper-status",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Created' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$connection-attachment-topology-operation-input.request-information.request-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n",
    "comments": "",
    "x": 665.4867630004883,
    "y": 1477.9516372680664,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "4b90a515.ea737c",
    "type": "set",
    "name": "set model-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.onap-model-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.` \" />",
    "comments": "",
    "x": 610.0553817749023,
    "y": 1383.5557622909546,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "a3fd3ef0.9cf2",
    "type": "comment",
    "name": "Prepare data for allotted-resource addition to MDSAL",
    "info": "This will add to allotted-resource which is present inside service.",
    "comments": "",
    "x": 727.3888702392578,
    "y": 1248.5556087493896,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "aec371b2.f4eb6",
    "type": "execute",
    "name": "generate parent-ar url - replace allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.parent-ar-url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 722.5000152587891,
    "y": 1076.0000114440918,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "cc1d8a7e.c8e908",
    "type": "execute",
    "name": "generate parent-ar url - replace service-instance-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.parent-provided-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 718.4999389648438,
    "y": 1033.000147819519,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "af622d17.e96e6",
    "type": "comment",
    "name": "Prepare Parent AR URL",
    "info": "Preparation to set provided-allotted-resource in parent service instance",
    "comments": "",
    "x": 636.5003967285156,
    "y": 962.0001010894775,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "99b25b64.985da8",
    "type": "set",
    "name": "set tmp.ar.parent-service-instance-id",
    "xml": "<set>\n<parameter name='tmp.ar.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n\n",
    "comments": "",
    "x": 675.5001907348633,
    "y": 995.5000405311584,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "cec76fbc.ec734",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource as cosumed allotted resource already exists.\" />\n",
    "comments": "",
    "x": 2232.7569732666016,
    "y": 833.645830154419,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "6dd5cf93.f0258",
    "type": "set",
    "name": "set tmp.found-cidx",
    "xml": "<set>\n<parameter name='tmp.found-cidx' value=\"`false`\" />\n\n\n",
    "comments": "",
    "x": 1358.6461448669434,
    "y": 745.3125731945038,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "fcf58d3f.726c9",
    "type": "comment",
    "name": "Add to parent services provided-allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 747.2015075683594,
    "y": 929.9792575836182,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "edb39741.2151b8",
    "type": "comment",
    "name": "Add to allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 667.9686965942383,
    "y": 1215.9689378738403,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "64a66d0e.2cab24",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1341.000051498413,
    "y": 643.2777614593506,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "c5b1dd9f.c626c"
      ]
    ]
  },
  {
    "id": "c5b1dd9f.c626c",
    "type": "switchNode",
    "name": "switch cr length",
    "xml": "<switch test='`$mdsal-ar.connection-attachment-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1528.8574314117432,
    "y": 643.8968968391418,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "dea64b0a.33d1a8"
      ]
    ]
  },
  {
    "id": "dea64b0a.33d1a8",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1728.1905536651611,
    "y": 643.896975517273,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "fd6c452f.f52a18"
      ]
    ]
  },
  {
    "id": "5c590a79.9e0264",
    "type": "execute",
    "name": "execute RestApiCallNode - get-resource connection-attachment-allotted-resource",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 813.0000534057617,
    "y": 638.0000371932983,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "83948a24.3af768",
        "a688402e.6a3a9"
      ]
    ]
  },
  {
    "id": "a688402e.6a3a9",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1181.0000839233398,
    "y": 608.0000352859497,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "a6697dc2.ce9f3"
      ]
    ]
  },
  {
    "id": "a6697dc2.ce9f3",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1333.0000839233398,
    "y": 607.0000352859497,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "adeabb6e.cf7758",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 619.0039215087891,
    "y": 1553.2500038146973,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "96f36120.1f9af",
        "6b505cd5.c78924"
      ]
    ]
  },
  {
    "id": "96f36120.1f9af",
    "type": "for",
    "name": "for each sdwan-get-request-input-param",
    "xml": "<for index='i' start='0' end='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 954.0041198730469,
    "y": 1499.2501260638237,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "7401fe63.179e9"
      ]
    ]
  },
  {
    "id": "4e61fb49.c94114",
    "type": "comment",
    "name": "Required for filling template values",
    "info": "This is done because connection-attachment is generic resource and doesn't have specific parameters",
    "comments": "",
    "x": 976.4486236572266,
    "y": 1533.0832867622375,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "d4660c0f.147f3",
    "type": "comment",
    "name": "Remove VNFC prefix",
    "info": "",
    "comments": "",
    "x": 1037.003963470459,
    "y": 1455.6944618225098,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "7401fe63.179e9",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1201.0039672851562,
    "y": 1500.6943712234497,
    "z": "77e7049e.a5a37c",
    "wires": [
      [
        "6a638cf5.ebb554",
        "3e399a15.de4336"
      ]
    ]
  },
  {
    "id": "50ce4566.040d7c",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 1469.0038146972656,
    "y": 1416.250369310379,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "6a638cf5.ebb554",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1420.0384826660156,
    "y": 1451.2294654846191,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  },
  {
    "id": "3e399a15.de4336",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1408.4829559326172,
    "y": 1555.2294359207153,
    "z": "77e7049e.a5a37c",
    "wires": []
  },
  {
    "id": "6b505cd5.c78924",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:sdwan-get-saved-ar-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-saved-ar-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 995.0039672851562,
    "y": 1573.2500658035278,
    "z": "77e7049e.a5a37c",
    "wires": [
      []
    ]
  }
]
