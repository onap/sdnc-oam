[
    {
        "id": "3ecdadeb.18aa62",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 432.00389862060547,
        "y": 378.9999885559082,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "b1de8da9.db8a2",
                "d704787.9944088",
                "c4e200e6.2e02b",
                "5f812e79.2be7e",
                "2b234f37.76666",
                "7dbca450.42794c",
                "7e93696e.840218",
                "676ec3b1.844d3c",
                "e3e05047.2e5b8",
                "91a71daa.ef5c2",
                "b3c3b183.55c72",
                "d01634bb.bb46b8",
                "43cde2b5.87e1ac",
                "c6fbc47.00d1938",
                "98c6c3b2.42b6b"
            ]
        ]
    },
    {
        "id": "b1de8da9.db8a2",
        "type": "for",
        "name": "for loop idx - VF input parameters",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param_length`\">\n\n",
        "comments": "",
        "outputs": 1,
        "x": 778.2540588378906,
        "y": 361.66665744781494,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "d245ffbf.59c6c"
            ]
        ]
    },
    {
        "id": "d245ffbf.59c6c",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 993.0324020385742,
        "y": 359.22224140167236,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "82c635c3.382618",
                "bcda53d8.f6893"
            ]
        ]
    },
    {
        "id": "82c635c3.382618",
        "type": "execute",
        "name": "execute split parameterName",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1189.2886047363281,
        "y": 336.97037982940674,
        "z": "dfb806d8.8899e8",
        "wires": [
            []
        ]
    },
    {
        "id": "bcda53d8.f6893",
        "type": "set",
        "name": "set parameterName",
        "xml": "<set>\n<parameter name=\"`vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
        "comments": "",
        "x": 1158.7330322265625,
        "y": 373.97049617767334,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "ac17a6a.af45258",
        "type": "comment",
        "name": "Take the parameter names by removing prefix",
        "info": "",
        "comments": "",
        "x": 816.2542610168457,
        "y": 318.3333249092102,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "c4e200e6.2e02b",
        "type": "set",
        "name": "set new vf-module_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index + 1`' />",
        "comments": "",
        "x": 757.190673828125,
        "y": 520.1629304885864,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "d704787.9944088",
        "type": "set",
        "name": "set vf-module-request-input.",
        "xml": "<set>\n<parameter name='vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n",
        "comments": "",
        "x": 764.1902618408203,
        "y": 415.1541962623596,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "7e93696e.840218",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-id' value='`$prop.vf-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.sdnc-request-header.' value='`$vf-module-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.request-information.' value='`$vf-module-topology-operation-input.request-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.service-information.' value='`$vf-module-topology-operation-input.service-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vnf-information.' value='`$vf-module-topology-operation-input.vnf-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-information.' value='`$vf-module-topology-operation-input.vf-module-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n\n<!--parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-topology.' value='`$tmp.vf-module-topology.`' /-->\n<!--parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index+1`' /-->\n",
        "comments": "",
        "x": 769.3570175170898,
        "y": 628.3335423469543,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "676ec3b1.844d3c",
        "type": "set",
        "name": "set vf-module-object-path",
        "xml": "<set>\n<parameter name='vf-module-id' value='`$prop.vf-id`'/> \n<parameter name='vf-module-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $vf-module-topology-operation-input.vf-module-information.vf-module-id\n + '/vf-module-data/vf-module-topology/'`\"/>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology/'`\"/>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n",
        "comments": "",
        "x": 757.503942489624,
        "y": 679.8373885154724,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "e3e05047.2e5b8",
        "type": "save",
        "name": "save sdwan lan-port-config resource in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='lan-port-config' \n      key='lan-port-config.lan-port-config-id = $prop.vf-id' >\n<parameter name=\"lan-port-config-id\" value=\"`$prop.vf-id`\" />\n<parameter name=\"device-id\" value='`$prop.lan.deviceName`' />\n<parameter name=\"port-switch\" value='`$prop.lan.portSwitch`' />\n<parameter name=\"port-type\" value='`$prop.lan.portType`' />\n<parameter name=\"port-number\" value='`$prop.lan.portnumber`' />\n<parameter name=\"ipv4-address\" value='`$prop.lan.ipAddress`' />\n<parameter name='vlan-tag' value='`$prop.lan.vlanId`' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vf-module-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $service-data.vnfs.vnf[$vnf-index].vnf-id  + '/vnf-data/vf-modules/vf-module/' + $prop.vf-id + '/vf-module-data/'` \" />\n",
        "comments": "",
        "outputs": 1,
        "x": 812.5039215087891,
        "y": 772.3373708724976,
        "z": "dfb806d8.8899e8",
        "wires": [
            []
        ]
    },
    {
        "id": "91a71daa.ef5c2",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='generic-vnf:relationship-list' \n      key='generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"lan-port-config\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/lan-port-configs/lan-port-config/' + $prop.vf-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"lan-port-config-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vf-id`\" />\n",
        "comments": "",
        "outputs": 1,
        "x": 772.5038375854492,
        "y": 819.3373589515686,
        "z": "dfb806d8.8899e8",
        "wires": [
            []
        ]
    },
    {
        "id": "b3c3b183.55c72",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 723.2263832092285,
        "y": 866.5112180709839,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "5f812e79.2be7e",
        "type": "switchNode",
        "name": "switch vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 733.424467086792,
        "y": 68.5038731098175,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "ecb5481e.49db98"
            ]
        ]
    },
    {
        "id": "ecb5481e.49db98",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 920.0911464691162,
        "y": 67.83717083930969,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "5cc69be0.888194"
            ]
        ]
    },
    {
        "id": "5cc69be0.888194",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs in MD-SAL\" />\n",
        "comments": "",
        "x": 1101.7577724456787,
        "y": 67.83717083930969,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "2b234f37.76666",
        "type": "switchNode",
        "name": "switch vf-modules.vf-module_length",
        "xml": "<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 771.6744890213013,
        "y": 245.50386714935303,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "43b76269.61638c",
                "80f9fdd1.5acfa"
            ]
        ]
    },
    {
        "id": "43b76269.61638c",
        "type": "other",
        "name": "Null",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 1002.6744995117188,
        "y": 221.50386428833008,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "30daa7e7.f7d908"
            ]
        ]
    },
    {
        "id": "80f9fdd1.5acfa",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1002.6744995117188,
        "y": 261.5038642883301,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "15ffa14c.a3471f"
            ]
        ]
    },
    {
        "id": "30daa7e7.f7d908",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='0' />\n",
        "comments": "",
        "x": 1145.1744995117188,
        "y": 221.50386428833008,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "15ffa14c.a3471f",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1147.0315437316895,
        "y": 261.4403762817383,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "81c65311.3e7fa",
                "1c59d473.dd26bc"
            ]
        ]
    },
    {
        "id": "1c59d473.dd26bc",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' />\n\n\n",
        "comments": "",
        "x": 1299.7300186157227,
        "y": 231.05947497440502,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "81c65311.3e7fa",
        "type": "for",
        "name": "for each existing vf-index",
        "xml": "<for index='idx' start='0' end='`$vf-index`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1356.1585235595703,
        "y": 284.2816047668457,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "aaf0ab5e.460008"
            ]
        ]
    },
    {
        "id": "85ce8231.1cc8f",
        "type": "comment",
        "name": "make sure this network doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1579.809253692627,
        "y": 242.53566217422485,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "aaf0ab5e.460008",
        "type": "switchNode",
        "name": "switch vf-module-id found",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1631.4442443847656,
        "y": 283.8531074523926,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "1a7eae6b.66a2b2"
            ]
        ]
    },
    {
        "id": "1a7eae6b.66a2b2",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1532.1744422912598,
        "y": 342.4245386123657,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "40223de2.189ee4"
            ]
        ]
    },
    {
        "id": "40223de2.189ee4",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id already found in service-data\" />\n",
        "comments": "",
        "x": 1679.924545288086,
        "y": 342.28173068119213,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "7dbca450.42794c",
        "type": "call",
        "name": "call sdwan-get-vf-module-lanport-param",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-vf-module-lanport-param' mode='sync' >\n",
        "comments": "",
        "outputs": 1,
        "x": 803.0039367675781,
        "y": 468.0000219345093,
        "z": "dfb806d8.8899e8",
        "wires": [
            []
        ]
    },
    {
        "id": "d01634bb.bb46b8",
        "type": "set",
        "name": "set vf-module-level-oper-status",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.order-status'  value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />\n",
        "comments": "",
        "x": 774.00390625,
        "y": 722.00390625,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "80c0749d.c5b758",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 101.00390625,
        "y": 95.00390625,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "1e8e9be2.f38a84"
            ]
        ]
    },
    {
        "id": "1e8e9be2.f38a84",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 215.50390434265137,
        "y": 202.00389766693115,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "441193b5.7a563c"
            ]
        ]
    },
    {
        "id": "441193b5.7a563c",
        "type": "method",
        "name": "sdwan-vf-operation-lanport-create",
        "xml": "<method rpc='sdwan-vf-operation-lanport-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 214.50390434265137,
        "y": 302.00389766693115,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "3ecdadeb.18aa62"
            ]
        ]
    },
    {
        "id": "43cde2b5.87e1ac",
        "type": "execute",
        "name": "execute generate-vf-id",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vf-id\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 756.0039520263672,
        "y": 576.5038995742798,
        "z": "dfb806d8.8899e8",
        "wires": [
            []
        ]
    },
    {
        "id": "c6fbc47.00d1938",
        "type": "for",
        "name": "for each vnf",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 723.0038871765137,
        "y": 123.00390815734863,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "a2640a51.5d0d78"
            ]
        ]
    },
    {
        "id": "a2640a51.5d0d78",
        "type": "switchNode",
        "name": "switch this vnf-id == input vnf-id",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`\">    \n",
        "comments": "",
        "outputs": 1,
        "x": 974.0039825439453,
        "y": 118.67052865028381,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "d22976f8.730608"
            ]
        ]
    },
    {
        "id": "d22976f8.730608",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1192.3372993469238,
        "y": 120.6705105304718,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "92022bc5.0cdcc8"
            ]
        ]
    },
    {
        "id": "92022bc5.0cdcc8",
        "type": "set",
        "name": "set vnf-index",
        "xml": "<set>\n<parameter name='vnf-index' value='`$idx`' />\n",
        "comments": "",
        "x": 1345.6704711914062,
        "y": 120.67053151130676,
        "z": "dfb806d8.8899e8",
        "wires": []
    },
    {
        "id": "98c6c3b2.42b6b",
        "type": "switchNode",
        "name": "switch vnf-index",
        "xml": "<switch test='`$vnf-index`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 737.00390625,
        "y": 184.00390625,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "681068c6.40fb78"
            ]
        ]
    },
    {
        "id": "681068c6.40fb78",
        "type": "other",
        "name": "Null",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 899.0039520263672,
        "y": 183.00390529632568,
        "z": "dfb806d8.8899e8",
        "wires": [
            [
                "f9b4e412.cab938"
            ]
        ]
    },
    {
        "id": "f9b4e412.cab938",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"vnf id not found in service-data\" />\n",
        "comments": "",
        "x": 1048.2540435791016,
        "y": 180.78178310394287,
        "z": "dfb806d8.8899e8",
        "wires": []
    }
]

