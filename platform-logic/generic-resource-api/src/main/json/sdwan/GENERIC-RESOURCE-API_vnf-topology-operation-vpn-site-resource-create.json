[
    {
        "id": "4d340fd2.1d47a",
        "type": "method",
        "name": "method vnf-topology-operation-vpn-site-resource-create",
        "xml": "<method rpc='vnf-topology-operation-vpn-site-resource-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 251.00390625,
        "y": 191.9999925820157,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "dd995ca6.5527c"
            ]
        ]
    },
    {
        "id": "83ce2cf0.a21b",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 127.57528686523438,
        "y": 44,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "d4e5788.5ad9988"
            ]
        ]
    },
    {
        "id": "d4e5788.5ad9988",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 229.86099243164062,
        "y": 102.23810407798737,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "4d340fd2.1d47a"
            ]
        ]
    },
    {
        "id": "dd995ca6.5527c",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 231.24195098876953,
        "y": 363.6666643349454,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "9e4483c6.3ac77",
                "a13164e4.2addc8",
                "3a6751cb.2db1fe",
                "deb0deb9.10aa8",
                "8f8480.f469fb8",
                "f27c92ed.2a351",
                "4152c1db.9724f",
                "34769e57.986742",
                "27f27223.64947e",
                "5e423ee5.be879",
                "dfdcb682.501ff8"
            ]
        ]
    },
    {
        "id": "a13164e4.2addc8",
        "type": "set",
        "name": "set vnf-level-oper-status to Created",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
        "comments": "",
        "x": 665.3887023925781,
        "y": 617.6705932617188,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "9e4483c6.3ac77",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
        "comments": "",
        "x": 657.2418899536133,
        "y": 512.6668453216553,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "8f8480.f469fb8",
        "type": "execute",
        "name": "execute generate-vnf-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-id\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 645.5753936767578,
        "y": 462.33342933654785,
        "z": "b6e8aa45.a03d48",
        "wires": [
            []
        ]
    },
    {
        "id": "dfdcb682.501ff8",
        "type": "set",
        "name": "set vnf-index to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.vnf-id' value='`$prop.vnf-id`' />\n",
        "comments": "",
        "x": 656.5754699707031,
        "y": 569.3334331512451,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "3a6751cb.2db1fe",
        "type": "switchNode",
        "name": "switch service-data.vnfs.vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 660.5752716064453,
        "y": 242.3333559036255,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "2c3f6b93.ddbca4",
                "29bbdb18.cfe584"
            ]
        ]
    },
    {
        "id": "2c3f6b93.ddbca4",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 895.2896575927734,
        "y": 237.47617626190186,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "8e783130.b1886"
            ]
        ]
    },
    {
        "id": "8e783130.b1886",
        "type": "set",
        "name": "set vnf-index=0",
        "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
        "comments": "",
        "x": 1055.5753631591797,
        "y": 237.47626781463623,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "29bbdb18.cfe584",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 891.7181968688965,
        "y": 270.76200771331787,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "64bc2d84.970e54"
            ]
        ]
    },
    {
        "id": "c816157.792fce8",
        "type": "set",
        "name": "set vnf-index = vnf_length",
        "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
        "comments": "",
        "x": 1284.575439453125,
        "y": 249.04773330688477,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "a9c0fb1a.4ae688",
        "type": "for",
        "name": "for each existing VNF",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1273.0040588378906,
        "y": 284.04770517349243,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "e4810c54.16f7c"
            ]
        ]
    },
    {
        "id": "64bc2d84.970e54",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1026.4324798583984,
        "y": 272.76197719573975,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "c816157.792fce8",
                "a9c0fb1a.4ae688"
            ]
        ]
    },
    {
        "id": "e4810c54.16f7c",
        "type": "switchNode",
        "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
        "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1666.289794921875,
        "y": 284.61918926239014,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "d88564b1.978518"
            ]
        ]
    },
    {
        "id": "d88564b1.978518",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1947.575496673584,
        "y": 283.19059467315674,
        "z": "b6e8aa45.a03d48",
        "wires": [
            [
                "eb2d673c.26d6e8"
            ]
        ]
    },
    {
        "id": "5a4256cd.31fdd8",
        "type": "comment",
        "name": "make sure this vnf-id doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1635.4324111938477,
        "y": 248.1905813217163,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "deb0deb9.10aa8",
        "type": "set",
        "name": "set new vnf_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
        "comments": "",
        "x": 617.5753936767578,
        "y": 410.33342599868774,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "f27c92ed.2a351",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 604.5753555297852,
        "y": 880.59694480896,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "5e423ee5.be879",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id \n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"generic-vnf\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/generic-vnfs/generic-vnf/' + $prop.vnf-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"generic-vnf.vnf-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-id`\" />\n\n",
        "comments": "",
        "outputs": 1,
        "x": 667.2421264648438,
        "y": 827.5968379974365,
        "z": "b6e8aa45.a03d48",
        "wires": [
            []
        ]
    },
    {
        "id": "4152c1db.9724f",
        "type": "set",
        "name": "set vnf-index and vnf-object-path",
        "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-id`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-id  + '/vnf-data/'` \" />",
        "comments": "",
        "x": 658.5753860473633,
        "y": 658.5968637466431,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "34769e57.986742",
        "type": "set",
        "name": "set vnf-request-input.",
        "xml": "<set>\n<parameter name='vnf-request-input.' value='`$vnf-topology-operation-input.vnf-request-input.`' />\n",
        "comments": "",
        "x": 623.5750274658203,
        "y": 361.3247985839844,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "eb2d673c.26d6e8",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
        "comments": "",
        "x": 2076.1468658447266,
        "y": 334.1906089782715,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "6aca9b4.e7d1e64",
        "type": "comment",
        "name": "Take the parameter names by removing prefix",
        "info": "",
        "comments": "",
        "x": 1369.5754776000977,
        "y": 337.66667556762695,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "301883bc.025f5c",
        "type": "comment",
        "name": "TODO: change AAI models",
        "info": "",
        "comments": "",
        "x": 647.1859512329102,
        "y": 727.9742965698242,
        "z": "b6e8aa45.a03d48",
        "wires": []
    },
    {
        "id": "27f27223.64947e",
        "type": "save",
        "name": "save AnAI - vnf-instance.orchestration-status",
        "xml": "<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"generic-vnf\"   \n\t\tkey=\"generic-vnf.vnf-id = $prop.vnf-id\" >\n<parameter name=\"orchestration-status\" value=\"create\" />\n<parameter name=\"vnf-type\" value=\"some vnf-type\" />",
        "comments": "",
        "outputs": 1,
        "x": 713.549690246582,
        "y": 768.2470808029175,
        "z": "b6e8aa45.a03d48",
        "wires": [
            []
        ]
    }
]