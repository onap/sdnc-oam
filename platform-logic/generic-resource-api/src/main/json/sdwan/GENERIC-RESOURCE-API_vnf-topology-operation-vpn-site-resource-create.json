[
    {
        "id": "aeae6125.a8d28",
        "type": "method",
        "name": "method vnf-topology-operation-vpn-site-resource-create",
        "xml": "<method rpc='vnf-topology-operation-vpn-site-resource-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 265,
        "y": 223.9999925820157,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "10f15a6d.ba1d76"
            ]
        ]
    },
    {
        "id": "3eb5635c.ae734c",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 141.57138061523438,
        "y": 76,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "1821ad11.5dad23"
            ]
        ]
    },
    {
        "id": "1821ad11.5dad23",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 243.85708618164062,
        "y": 134.23810407798737,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "aeae6125.a8d28"
            ]
        ]
    },
    {
        "id": "10f15a6d.ba1d76",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 245.23804473876953,
        "y": 395.6666643349454,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "175dc57.fde8c3b",
                "3afb3c65.1ca3a4",
                "fadde341.82f5a",
                "9885c8cf.ded0d8",
                "a5e91b3d.29e478",
                "6e79157a.cf280c",
                "fff46357.6f3ad",
                "5da9f931.70bc48",
                "df8e278a.898b28",
                "3a3acb9a.529fc4",
                "ff8a3cb6.2dc93",
                "1bd26429.61c74c"
            ]
        ]
    },
    {
        "id": "3afb3c65.1ca3a4",
        "type": "set",
        "name": "set vnf-level-oper-status to Created",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
        "comments": "",
        "x": 667.3848571777344,
        "y": 759.670597076416,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "175dc57.fde8c3b",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
        "comments": "",
        "x": 659.2380447387695,
        "y": 654.6668491363525,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "a5e91b3d.29e478",
        "type": "execute",
        "name": "execute generate-vnf-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-id\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 647.5715484619141,
        "y": 604.3334331512451,
        "z": "3deddfaf.57c2f",
        "wires": [
            []
        ]
    },
    {
        "id": "ff8a3cb6.2dc93",
        "type": "set",
        "name": "set vnf-index to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.vnf-id' value='`$prop.vnf-id`' />\n",
        "comments": "",
        "x": 658.5716247558594,
        "y": 711.3334369659424,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "fadde341.82f5a",
        "type": "switchNode",
        "name": "switch service-data.vnfs.vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 674.5713653564453,
        "y": 274.3333559036255,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "fe0779f6.a341a8",
                "9f0ded05.d925c"
            ]
        ]
    },
    {
        "id": "fe0779f6.a341a8",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 909.2857513427734,
        "y": 269.47617626190186,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "e3b683ce.f47fd"
            ]
        ]
    },
    {
        "id": "e3b683ce.f47fd",
        "type": "set",
        "name": "set vnf-index=0",
        "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
        "comments": "",
        "x": 1069.5714569091797,
        "y": 269.47626781463623,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "9f0ded05.d925c",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 905.7142906188965,
        "y": 302.76200771331787,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "411ddf99.4fbb3"
            ]
        ]
    },
    {
        "id": "b6024395.bc24",
        "type": "set",
        "name": "set vnf-index = vnf_length",
        "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
        "comments": "",
        "x": 1298.571533203125,
        "y": 281.04773330688477,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "3b57b625.74c07a",
        "type": "for",
        "name": "for each existing VNF",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1287.0001525878906,
        "y": 316.04770517349243,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "a7076dba.f36af"
            ]
        ]
    },
    {
        "id": "411ddf99.4fbb3",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1040.4285736083984,
        "y": 304.76197719573975,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "b6024395.bc24",
                "3b57b625.74c07a"
            ]
        ]
    },
    {
        "id": "a7076dba.f36af",
        "type": "switchNode",
        "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
        "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1680.285888671875,
        "y": 316.61918926239014,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "b4dc78a5.d896c8"
            ]
        ]
    },
    {
        "id": "b4dc78a5.d896c8",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1961.571590423584,
        "y": 315.19059467315674,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "51ac74f.88fd58c"
            ]
        ]
    },
    {
        "id": "4be264b1.270e6c",
        "type": "comment",
        "name": "make sure this vnf-id doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1649.4285049438477,
        "y": 280.1905813217163,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "9885c8cf.ded0d8",
        "type": "set",
        "name": "set new vnf_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
        "comments": "",
        "x": 619.5715484619141,
        "y": 552.333429813385,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "6e79157a.cf280c",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 606.5715103149414,
        "y": 1022.5969486236572,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "3a3acb9a.529fc4",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id \n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"generic-vnf\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/generic-vnfs/generic-vnf/' + $prop.vnf-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"generic-vnf.vnf-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-id`\" />\n\n",
        "comments": "",
        "outputs": 1,
        "x": 669.23828125,
        "y": 969.5968418121338,
        "z": "3deddfaf.57c2f",
        "wires": [
            []
        ]
    },
    {
        "id": "fff46357.6f3ad",
        "type": "set",
        "name": "set vnf-index and vnf-object-path",
        "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-id`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-id  + '/vnf-data/'` \" />",
        "comments": "",
        "x": 660.5715408325195,
        "y": 800.5968675613403,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "5da9f931.70bc48",
        "type": "set",
        "name": "set vnf-request-input.",
        "xml": "<set>\n<parameter name='vnf-request-input.' value='`$vnf-topology-operation-input.vnf-request-input.`' />\n",
        "comments": "",
        "x": 625.5711822509766,
        "y": 503.32480239868164,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "51ac74f.88fd58c",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
        "comments": "",
        "x": 2090.1429595947266,
        "y": 366.1906089782715,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "df8e278a.898b28",
        "type": "save",
        "name": "save AnAI - vnf-instance.orchestration-status",
        "xml": "<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"generic-vnf\"   \n\t\tkey=\"generic-vnf.vnf-id = $prop.vnf-id\" >\n<parameter name=\"orchestration-status\" value=\"create\" />\n<parameter name=\"vnf-type\" value=\"some vnf-type\" />",
        "comments": "",
        "outputs": 1,
        "x": 715.5458450317383,
        "y": 910.2470846176147,
        "z": "3deddfaf.57c2f",
        "wires": [
            []
        ]
    },
    {
        "id": "6f579a3f.d15af4",
        "type": "comment",
        "name": "TODO: change AAI models",
        "info": "",
        "comments": "",
        "x": 649.1821060180664,
        "y": 869.9743003845215,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "1bd26429.61c74c",
        "type": "switchNode",
        "name": "switch service-data.vnf-request-input.vnf-name",
        "xml": "<switch test='`$vnf-topology-operation-input.vnf-request-input.vnf-name`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 693.0000152587891,
        "y": 393.0000114440918,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "33ff6eed.504462",
                "e2af6995.223f28",
                "cc14ee3a.bceeb"
            ]
        ]
    },
    {
        "id": "33ff6eed.504462",
        "type": "outcomeTrue",
        "name": "SDWAN-vpn",
        "xml": "<outcome value='SDWAN-vpn'>",
        "comments": "",
        "outputs": 1,
        "x": 990.6667137145996,
        "y": 378.0000114440918,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "55868aa1.2254e4"
            ]
        ]
    },
    {
        "id": "e2af6995.223f28",
        "type": "outcomeTrue",
        "name": "SDWAN-site",
        "xml": "<outcome value='SDWAN-site'>",
        "comments": "",
        "outputs": 1,
        "x": 983.6666870117188,
        "y": 428,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "496e33ab.398b4c"
            ]
        ]
    },
    {
        "id": "cc14ee3a.bceeb",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 966.6666870117188,
        "y": 478,
        "z": "3deddfaf.57c2f",
        "wires": [
            [
                "c9a98bce.5a8c88"
            ]
        ]
    },
    {
        "id": "c9a98bce.5a8c88",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: vnf-name should be either SDWAN-vpn or SDWAN-site.\" />\n",
        "comments": "",
        "x": 1137.333366394043,
        "y": 476.00001335144043,
        "z": "3deddfaf.57c2f",
        "wires": []
    },
    {
        "id": "55868aa1.2254e4",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 1172,
        "y": 379,
        "z": "3deddfaf.57c2f",
        "wires": [
            []
        ]
    },
    {
        "id": "496e33ab.398b4c",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 1163,
        "y": 427,
        "z": "3deddfaf.57c2f",
        "wires": [
            []
        ]
    }
]