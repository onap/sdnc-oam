[
    {
        "id": "b9291e92.c9255",
        "type": "method",
        "name": "method vnf-topology-operation-vpn-site-resource-create",
        "xml": "<method rpc='vnf-topology-operation-vpn-site-resource-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 305.0104064941406,
        "y": 235.00000021141022,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "dd81ebe9.6162a8"
            ]
        ]
    },
    {
        "id": "73603019.39164",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 181.581787109375,
        "y": 87.00000762939453,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "5a7ebd21.156e64"
            ]
        ]
    },
    {
        "id": "5a7ebd21.156e64",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 283.86749267578125,
        "y": 145.2381117073819,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "b9291e92.c9255"
            ]
        ]
    },
    {
        "id": "dd81ebe9.6162a8",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">",
        "atomic": "true",
        "outputs": 1,
        "x": 285.24845123291016,
        "y": 406.6666719643399,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "6139d0bf.9b573",
                "e3c66cc8.8f2d2",
                "b3629e5f.359cb",
                "24aedeb1.3afbf2",
                "80feb204.819f7",
                "cacf5f5c.ac2a6",
                "b170843d.a81678",
                "18de8cbf.217ba3",
                "65134f17.8060a",
                "1ce81dfb.4136e2",
                "e184e777.a68468",
                "4507139f.07b97c",
                "856b92b5.d6559"
            ]
        ]
    },
    {
        "id": "e3c66cc8.8f2d2",
        "type": "set",
        "name": "set vnf-level-oper-status to Created",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.order-status' value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-rpc-action' value='`$vnf-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-level-oper-status.last-action' value='`$vnf-topology-operation-input.request-information.request-action`' />\n",
        "comments": "",
        "x": 707.395263671875,
        "y": 770.6706047058105,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "6139d0bf.9b573",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-id' value='`$prop.vnf-id`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.sdnc-request-header.' value='$vnf-topology-operation-input.sdnc-request-header.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.request-information.' value='$vnf-topology-operation-input.request-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.' value='$vnf-topology-operation-input.service-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.' value='$vnf-topology-operation-input.vnf-information.' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-request-input.' value='$vnf-topology-operation-input.vnf-request-input.' />\n\n",
        "comments": "",
        "x": 699.2484512329102,
        "y": 665.6668567657471,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "80feb204.819f7",
        "type": "execute",
        "name": "execute generate-vnf-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.vnf-id\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 687.5819549560547,
        "y": 615.3334407806396,
        "z": "c61f2a05.814fb8",
        "wires": [
            []
        ]
    },
    {
        "id": "1ce81dfb.4136e2",
        "type": "set",
        "name": "set vnf-index to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vnf-information.vnf-id' value='`$prop.vnf-id`' />\n",
        "comments": "",
        "x": 698.58203125,
        "y": 722.3334445953369,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "b3629e5f.359cb",
        "type": "switchNode",
        "name": "switch service-data.vnfs.vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 714.5817718505859,
        "y": 285.33336353302,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "db9e64e8.4dc2d8",
                "a8f4bece.3c2af"
            ]
        ]
    },
    {
        "id": "db9e64e8.4dc2d8",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 949.2961578369141,
        "y": 280.4761838912964,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "159832fb.b45fcd"
            ]
        ]
    },
    {
        "id": "159832fb.b45fcd",
        "type": "set",
        "name": "set vnf-index=0",
        "xml": "<set>\n<parameter name='vnf-index' value='0' />\n",
        "comments": "",
        "x": 1109.5818634033203,
        "y": 280.47627544403076,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "a8f4bece.3c2af",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 945.7246971130371,
        "y": 313.7620153427124,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "866de9a0.b88c58"
            ]
        ]
    },
    {
        "id": "85e49c71.8ab91",
        "type": "set",
        "name": "set vnf-index = vnf_length",
        "xml": "<set>\n<parameter name='vnf-index' value='`$service-data.vnfs.vnf_length`' />\n",
        "comments": "",
        "x": 1338.5819396972656,
        "y": 292.0477409362793,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "d39623fd.3899b",
        "type": "for",
        "name": "for each existing VNF",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1327.0105590820312,
        "y": 327.04771280288696,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "c0e2972a.720cb8"
            ]
        ]
    },
    {
        "id": "866de9a0.b88c58",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1080.438980102539,
        "y": 315.7619848251343,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "85e49c71.8ab91",
                "d39623fd.3899b"
            ]
        ]
    },
    {
        "id": "c0e2972a.720cb8",
        "type": "switchNode",
        "name": "switch vnf-information.vnf-id == service-data.vnfs.vnf[].vnf-id",
        "xml": "<switch test='`$vnf-topology-operation-input.vnf-information.vnf-id == $service-data.vnfs.vnf[$idx].vnf-id`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1720.2962951660156,
        "y": 327.61919689178467,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "3cdbfaf5.6c7216"
            ]
        ]
    },
    {
        "id": "3cdbfaf5.6c7216",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 2001.5819969177246,
        "y": 326.19060230255127,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "f6b30645.aa9bd8"
            ]
        ]
    },
    {
        "id": "405acf79.875e9",
        "type": "comment",
        "name": "make sure this vnf-id doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1689.4389114379883,
        "y": 291.19058895111084,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "24aedeb1.3afbf2",
        "type": "set",
        "name": "set new vnf_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf_length' value='`$vnf-index + 1`' />\n",
        "comments": "",
        "x": 659.5819549560547,
        "y": 563.3334374427795,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "cacf5f5c.ac2a6",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 646.581916809082,
        "y": 1033.5969562530518,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "65134f17.8060a",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='service-instance:relationship-list' \n      key='service-instance.service-instance-id = $service-data.service-information.service-instance-id\n         AND customer.global-customer-id = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.global-customer-id \n         AND service-subscription.service-type = $service-data.vnfs.vnf[$vnf-index].vnf-data.service-information.subscription-service-type' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"generic-vnf\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/generic-vnfs/generic-vnf/' + $prop.vnf-id`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"generic-vnf.vnf-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.vnf-id`\" />\n\n\n<!--key='service-instance.service-instance-id = $service-data.service-information.service-instance-id -->\n<!--key='service-instance.service-instance-id = $service-data.service-instance-id -->\n",
        "comments": "",
        "outputs": 1,
        "x": 709.2486877441406,
        "y": 980.5968494415283,
        "z": "c61f2a05.814fb8",
        "wires": [
            []
        ]
    },
    {
        "id": "b170843d.a81678",
        "type": "set",
        "name": "set vnf-index and vnf-object-path",
        "xml": "<set>\n<parameter name='vnfId' value='`$prop.vnf-id`' />\n<parameter name=\"vnf-object-path\" value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vnf-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $prop.vnf-id  + '/vnf-data/'` \" />",
        "comments": "",
        "x": 700.5819473266602,
        "y": 811.5968751907349,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "f6b30645.aa9bd8",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'VNF id ' + $service-data.vnfs.vnf[$idx].vnf-id\n      + ' already exists, and has order status ' + $service-data.vnfs.vnf[$idx].vnf-data.vnf-level-oper-status.order-status`\" />\n",
        "comments": "",
        "x": 2130.153366088867,
        "y": 377.190616607666,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "18de8cbf.217ba3",
        "type": "save",
        "name": "save AnAI - vnf-instance.orchestration-status",
        "xml": "<save plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\tresource=\"generic-vnf\"   \n\t\tkey=\"generic-vnf.vnf-id = $prop.vnf-id\" >\n<parameter name=\"orchestration-status\" value=\"Created\" />\n<parameter name=\"in-maint\" value = \"true\" />\n<parameter name=\"vnf-type\" value='`$prop.vnfName`' />\n<parameter name=\"vnf-name\" value = \"`$prop.vnfName`\"/>\n<!--parameter name=\"model-invariant-id\" value = \"`$vnf-topology-operation-input.vnf-information.onap-model-information.model-invariant-uuid`\"/>\n<parameter name=\"model-version-id\" value = \"`$vnf-topology-operation-input.vnf-information.onap-model-information.model-uuid`\"/>\n<parameter name=\"model-customization-id\" value = \"`$vnf-topology-operation-input.vnf-information.onap-model-information.model-customization-uuid`\"/-->",
        "comments": "",
        "outputs": 1,
        "x": 755.5562515258789,
        "y": 921.2470922470093,
        "z": "c61f2a05.814fb8",
        "wires": [
            []
        ]
    },
    {
        "id": "9efad4e1.8f5778",
        "type": "comment",
        "name": "TODO: change AAI models",
        "info": "",
        "comments": "",
        "x": 689.192512512207,
        "y": 880.974308013916,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "31e51f70.5022e",
        "type": "execute",
        "name": "execute split parameterName",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1115.75,
        "y": 374.7500078678131,
        "z": "c61f2a05.814fb8",
        "wires": [
            []
        ]
    },
    {
        "id": "6ba5d18a.08f53",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 919.4937973022461,
        "y": 379.00188088417053,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "31e51f70.5022e",
                "9ac10e7c.ea907"
            ]
        ]
    },
    {
        "id": "e184e777.a68468",
        "type": "for",
        "name": "for loop idx - VNF input parameters",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 704.7154541015625,
        "y": 381.4462969303131,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "6ba5d18a.08f53"
            ]
        ]
    },
    {
        "id": "4507139f.07b97c",
        "type": "set",
        "name": "set vnf-request-input.",
        "xml": "<set>\n<parameter name='vnf-request-input.' value='`$vnf-topology-operation-input.vnf-request-input.`' />\n",
        "comments": "",
        "x": 661.715087890625,
        "y": 451.7710039615631,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "9ac10e7c.ea907",
        "type": "set",
        "name": "set parameterName",
        "xml": "<set>\n<parameter name=\"`vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
        "comments": "",
        "x": 1092.75,
        "y": 420.7500078678131,
        "z": "c61f2a05.814fb8",
        "wires": []
    },
    {
        "id": "856b92b5.d6559",
        "type": "for",
        "name": "for each sdwan-get-request-input-param",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param_length`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 717.75,
        "y": 503.7500078678131,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "3840a650.9c2a3a"
            ]
        ]
    },
    {
        "id": "3840a650.9c2a3a",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 943.982666015625,
        "y": 502.0937578678131,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "3c147303.421e4c"
            ]
        ]
    },
    {
        "id": "3c147303.421e4c",
        "type": "switchNode",
        "name": "switch vnf name",
        "xml": "<switch test=\"`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].name == 'name'`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1100.482666015625,
        "y": 500.09381890296936,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "9029ef29.6a469"
            ]
        ]
    },
    {
        "id": "9029ef29.6a469",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1261.4830322265625,
        "y": 500.0938799381256,
        "z": "c61f2a05.814fb8",
        "wires": [
            [
                "ca54d2cd.07dce"
            ]
        ]
    },
    {
        "id": "ca54d2cd.07dce",
        "type": "set",
        "name": "set vnf name",
        "xml": "<set>\n<parameter name='prop.vnfName' value='`$vnf-topology-operation-input.vnf-request-input.vnf-input-parameters.param[$idx].value`' />\n",
        "comments": "",
        "x": 1419.483154296875,
        "y": 498.69391655921936,
        "z": "c61f2a05.814fb8",
        "wires": []
    }
]