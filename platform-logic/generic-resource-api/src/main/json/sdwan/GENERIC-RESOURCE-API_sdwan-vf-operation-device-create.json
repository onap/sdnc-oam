[
    {
        "id": "b9b83207.589ec",
        "type": "switchNode",
        "name": "switch this vnf-id == input vnf-id",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`\">    \n",
        "comments": "",
        "outputs": 1,
        "x": 1124.8294982910156,
        "y": 251.16278839111328,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "8cae152d.7cd218"
            ]
        ]
    },
    {
        "id": "e1800fba.baf5f",
        "type": "service-logic",
        "name": "GENERIC-RESOURCE-API ${project.version}",
        "module": "GENERIC-RESOURCE-API",
        "version": "${project.version}",
        "comments": "",
        "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
        "outputs": 1,
        "x": 414.5,
        "y": 144.99999237060547,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "6d32e66a.a8bcf8"
            ]
        ]
    },
    {
        "id": "6d32e66a.a8bcf8",
        "type": "method",
        "name": "sdwan-vf-operation-device-create",
        "xml": "<method rpc='sdwan-vf-operation-device-create' mode='sync'>\n",
        "comments": "",
        "outputs": 1,
        "x": 413.5,
        "y": 244.99999237060547,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "1cc250f1.53fd7f"
            ]
        ]
    },
    {
        "id": "9c8db0b.eb2055",
        "type": "dgstart",
        "name": "DGSTART",
        "outputs": 1,
        "x": 244,
        "y": 56,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "e1800fba.baf5f"
            ]
        ]
    },
    {
        "id": "1cc250f1.53fd7f",
        "type": "block",
        "name": "block : atomic",
        "xml": "<block atomic=\"true\">\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 572.4999847412109,
        "y": 361.0000009536743,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "3397e2d.64c521e",
                "92ec911d.95b14",
                "fa9c393f.4d0eb8",
                "1192cb09.4cd2d5",
                "3e5eeaad.69c6b6",
                "7e451b6c.fd6624",
                "f6264050.f42d5",
                "9e2c8c11.572dc",
                "407f8a81.546654",
                "f1088162.3598e",
                "4489ad98.445654",
                "860ccaf0.19f1e8"
            ]
        ]
    },
    {
        "id": "3397e2d.64c521e",
        "type": "for",
        "name": "for each vnf",
        "xml": "<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 872.8294067382812,
        "y": 252.49612522125244,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "b9b83207.589ec"
            ]
        ]
    },
    {
        "id": "1913a60e.b7faaa",
        "type": "set",
        "name": "set vnf-index",
        "xml": "<set>\n<parameter name='vnf-index' value='`$idx`' />\n",
        "comments": "",
        "x": 1496.4959869384766,
        "y": 253.16279125213623,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "8cae152d.7cd218",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1343.1628150939941,
        "y": 253.16277027130127,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "1913a60e.b7faaa"
            ]
        ]
    },
    {
        "id": "1192cb09.4cd2d5",
        "type": "for",
        "name": "for loop idx - VF input parameters",
        "xml": "<for index=\"idx\" start=\"0\" end=\"`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param_length`\">\n\n",
        "comments": "",
        "outputs": 1,
        "x": 946.7501907348633,
        "y": 474.66665840148926,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "f80594ca.7a0348"
            ]
        ]
    },
    {
        "id": "f80594ca.7a0348",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1161.5285339355469,
        "y": 472.2222423553467,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "99d262e0.f0c14",
                "9b7ec3.98d4c14"
            ]
        ]
    },
    {
        "id": "99d262e0.f0c14",
        "type": "execute",
        "name": "execute split parameterName",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 1357.7847366333008,
        "y": 449.97038078308105,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            []
        ]
    },
    {
        "id": "9b7ec3.98d4c14",
        "type": "set",
        "name": "set parameterName",
        "xml": "<set>\n<parameter name=\"`vf-module-topology-operation-input.vf-module-request-input.vf-module-input-parameters.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
        "comments": "",
        "x": 1327.2291641235352,
        "y": 486.97049713134766,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "1ce3af0c.391b61",
        "type": "comment",
        "name": "Take the parameter names by removing prefix",
        "info": "",
        "comments": "",
        "x": 1330.7503929138184,
        "y": 409.33332681655884,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "92ec911d.95b14",
        "type": "switchNode",
        "name": "switch vnf_length",
        "xml": "<switch test='`$service-data.vnfs.vnf_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 887.25,
        "y": 207.9999942779541,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "1b06d72a.f85559"
            ]
        ]
    },
    {
        "id": "1b06d72a.f85559",
        "type": "other",
        "name": "NULL",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 1073.9166793823242,
        "y": 207.3332920074463,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "7e3909f0.27dd48"
            ]
        ]
    },
    {
        "id": "7e3909f0.27dd48",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs in MD-SAL\" />\n",
        "comments": "",
        "x": 1255.5833053588867,
        "y": 207.3332920074463,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "fa9c393f.4d0eb8",
        "type": "switchNode",
        "name": "switch vf-modules.vf-module_length",
        "xml": "<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n",
        "comments": "",
        "outputs": 1,
        "x": 928.4999895095825,
        "y": 327.9999952316284,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "fe3884f5.3db408",
                "f43025e1.350458"
            ]
        ]
    },
    {
        "id": "fe3884f5.3db408",
        "type": "other",
        "name": "Null",
        "xml": "<outcome value=''>\n",
        "comments": "",
        "outputs": 1,
        "x": 1159.5,
        "y": 303.99999237060547,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "ec84c7cd.2c42f8"
            ]
        ]
    },
    {
        "id": "f43025e1.350458",
        "type": "other",
        "name": "other",
        "xml": "<outcome value='Other'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1159.5,
        "y": 343.99999237060547,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "3d425c4c.b021a4"
            ]
        ]
    },
    {
        "id": "ec84c7cd.2c42f8",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='0' />\n",
        "comments": "",
        "x": 1302,
        "y": 303.99999237060547,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "3d425c4c.b021a4",
        "type": "block",
        "name": "block",
        "xml": "<block>\n",
        "atomic": "false",
        "comments": "",
        "outputs": 1,
        "x": 1303.8570442199707,
        "y": 343.9365043640137,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "30d4aa0b.cee996",
                "8e933b3.56987c8"
            ]
        ]
    },
    {
        "id": "8e933b3.56987c8",
        "type": "set",
        "name": "set vf-index",
        "xml": "<set>\n<parameter name='vf-index' value='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' />\n\n\n",
        "comments": "",
        "x": 1456.555519104004,
        "y": 313.5556030566804,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "30d4aa0b.cee996",
        "type": "for",
        "name": "for each existing vf-index",
        "xml": "<for index='idx' start='0' end='`$vf-index`' >\n",
        "comments": "",
        "outputs": 1,
        "x": 1512.9840240478516,
        "y": 366.7777328491211,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "40a39312.e2cd5c"
            ]
        ]
    },
    {
        "id": "f966e582.bd5968",
        "type": "comment",
        "name": "make sure this network doesn't exist already",
        "info": "",
        "comments": "",
        "x": 1736.6347541809082,
        "y": 325.03179025650024,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "40a39312.e2cd5c",
        "type": "switchNode",
        "name": "switch vf-module-id found",
        "xml": "<switch test=\"`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`\">\n",
        "comments": "",
        "outputs": 1,
        "x": 1788.2697448730469,
        "y": 366.34923553466797,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "d61c18df.dc4958"
            ]
        ]
    },
    {
        "id": "d61c18df.dc4958",
        "type": "outcomeTrue",
        "name": "true",
        "xml": "<outcome value='true'>\n",
        "comments": "",
        "outputs": 1,
        "x": 1688.999942779541,
        "y": 424.9206666946411,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            [
                "d629e081.56166"
            ]
        ]
    },
    {
        "id": "d629e081.56166",
        "type": "returnFailure",
        "name": "return failure",
        "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id already found in service-data\" />\n",
        "comments": "",
        "x": 1836.7500457763672,
        "y": 424.7778587634675,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "407f8a81.546654",
        "type": "set",
        "name": "copy input data to service data",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-id' value='`$prop.device-vf-index`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.sdnc-request-header.' value='`$vf-module-topology-operation-input.sdnc-request-header.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.request-information.' value='`$vf-module-topology-operation-input.request-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.service-information.' value='`$vf-module-topology-operation-input.service-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vnf-information.' value='`$vf-module-topology-operation-input.vnf-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-information.' value='`$vf-module-topology-operation-input.vf-module-information.`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n\n<!--parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-topology.' value='`$tmp.vf-module-topology.`' /-->\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index+1`' />\n\n",
        "comments": "",
        "x": 940.3531951904297,
        "y": 754.4962153434753,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "9e2c8c11.572dc",
        "type": "execute",
        "name": "execute generate-vf-module-index",
        "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"prop.device-vf-index\"/>\n",
        "comments": "",
        "outputs": 1,
        "x": 948.6866912841797,
        "y": 701.1629481315613,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            []
        ]
    },
    {
        "id": "f6264050.f42d5",
        "type": "set",
        "name": "set new vf-module_length",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length' value='`$vf-index + 1`' />",
        "comments": "",
        "x": 922.6866683959961,
        "y": 647.162841796875,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "3e5eeaad.69c6b6",
        "type": "set",
        "name": "set vf-module-request-input.",
        "xml": "<set>\n<parameter name='vf-module-request-input.' value='`$vf-module-topology-operation-input.vf-module-request-input.`' />\n",
        "comments": "",
        "x": 937.6863288879395,
        "y": 537.1542224884033,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "7e451b6c.fd6624",
        "type": "call",
        "name": "call sdwan-get-vf-module-device-param",
        "xml": "<call module='GENERIC-RESOURCE-API' rpc='sdwan-get-vf-module-device-param' mode='sync' >\n",
        "comments": "",
        "outputs": 1,
        "x": 963.6867065429688,
        "y": 593.1544561386108,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            []
        ]
    },
    {
        "id": "f1088162.3598e",
        "type": "set",
        "name": "set vf-module-object-path",
        "xml": "<set>\n<parameter name='vf-module-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vf-modules/vf-module/'\n + $prop.device-vf-index\n + '/vf-module-data/vf-module-topology/'`\"/>\n<parameter name='vnf-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/vnfs/vnf/'\n + $service-data.vnfs.vnf[$vnf-index].vnf-id\n + '/vnf-data/vnf-topology/'`\"/>\n<parameter name='service-object-path'\n value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $vf-module-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n",
        "comments": "",
        "x": 935.5000877380371,
        "y": 805.0000605583191,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "4489ad98.445654",
        "type": "set",
        "name": "set vf-module-level-oper-status",
        "xml": "<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.order-status'  value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-index].vf-module-data.vf-module-level-oper-status.last-action'  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />\n",
        "comments": "",
        "x": 943.0001907348633,
        "y": 853.0000247955322,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    },
    {
        "id": "a1ffaa29.5bb868",
        "type": "save",
        "name": "save sdwan vpn resource in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource' \n      key='site-resource.site-resource-id = $prop.site-vf-index' >\n<parameter name='site-resource-id' value='`$prop.site-vf-index`' />\n<parameter name='site-resource-name' value='`$prop.site.name`' />\n<parameter name='description' value='`$prop.site.description`' />\n<parameter name='type' value='`$prop.site.type`' />\n<parameter name='role' value='`$prop.site.role`' />\n<parameter name='operational-status' value='Created' />\n<parameter name='model-customization-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`' />\n<parameter name='model-invariant-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-invariant-uuid`' />\n<parameter name='model-version-id' value='`$vf-module-topology-operation-input.vf-module-information.onap-model-information.model-version`' />\n<parameter name='selflink' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'  + $vf-module-topology-operation-input.service-information.service-instance-id  + '/service-data/vnfs/vnf/'  + $service-data.vnfs.vnf[$vnf-index].vnf-id  + '/vnf-data/vf-modules/vf-module/' + $prop.site-vf-index + '/vf-module-data/'` \" />",
        "comments": "",
        "outputs": 1,
        "x": 947.5000419616699,
        "y": 899.4999761581421,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            []
        ]
    },
    {
        "id": "503ce76b.44e798",
        "type": "save",
        "name": "save service relationship in AAI",
        "xml": "<save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='generic-vnf:relationship-list' \n      key='generic-vnf.vnf-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"sdwan-vpn\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/sdwan-vpns/sdwan-vpn/' + $prop.site-vf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"sdwan-vpn.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.site-vf-index`\" />\n\n\n<!--save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='site-resource:relationship-list' \n      key='site-resource.site-resource-id = $service-data.vnfs.vnf[$vnf-index].vnf-id' \n      force=\"true\" pfx=\"tmp.AnAI-data\">\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"sdwan-site\" />\n<parameter name=\"relationship-list.relationship[0].related-link\" value=\"`'/network/sdwan-sites/sdwan-site/' + $prop.site-vf-index`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"sdwan-vpn.id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$prop.site-vf-index`\" /-->\n",
        "comments": "",
        "outputs": 1,
        "x": 946.4999847412109,
        "y": 946.5000238418579,
        "z": "c7d3e3a8.96c6a",
        "wires": [
            []
        ]
    },
    {
        "id": "860ccaf0.19f1e8",
        "type": "returnSuccess",
        "name": "return success",
        "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
        "comments": "",
        "x": 895.2225151062012,
        "y": 992.6738667488098,
        "z": "c7d3e3a8.96c6a",
        "wires": []
    }
]