[{"id":"66490f35.2a2f8","type":"dgstart","name":"DGSTART","outputs":1,"x":142.85714721679688,"y":72.41365623474121,"z":"f7201aa.a856ce8","wires":[["d82e6efe.ed2de"]]},{"id":"d82e6efe.ed2de","type":"service-logic","name":"GENERIC-RESOURCE-API ${project.version}","module":"GENERIC-RESOURCE-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>","outputs":1,"x":256.1428527832031,"y":112.65176773071289,"z":"f7201aa.a856ce8","wires":[["94176197.4fbcd"]]},{"id":"94176197.4fbcd","type":"method","name":"method vf-module-topology-operation-changeassign","xml":"<method rpc='vf-module-topology-operation-changeassign' mode='sync'>\n","comments":"","outputs":1,"x":274.28577423095703,"y":152.4136562347412,"z":"f7201aa.a856ce8","wires":[["1a397f44.2d14c1"]]},{"id":"7aaeccf.66ec034","type":"comment","name":"vf-module-topology-operation-changeassign","info":"","comments":"","x":537.2020034790039,"y":20,"z":"f7201aa.a856ce8","wires":[]},{"id":"78588014.928d5","type":"switchNode","name":"switch request-action","xml":"<switch test='`$vf-module-topology-operation-input.request-information.request-action`'>\n","comments":"","outputs":1,"x":546.3809585571289,"y":251.27079391479492,"z":"f7201aa.a856ce8","wires":[["301e7c80.59e4c4","e5b98d6d.e5d96"]]},{"id":"301e7c80.59e4c4","type":"outcome","name":"CreateVfModuleInstance","xml":"<outcome value='CreateVfModuleInstance'>\n","comments":"","outputs":1,"x":797.4285736083984,"y":228.41368007659912,"z":"f7201aa.a856ce8","wires":[["ba023ff0.a43a6"]]},{"id":"e5b98d6d.e5d96","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":741.0952186584473,"y":273.79466915130615,"z":"f7201aa.a856ce8","wires":[["314b1e69.b3c3b2"]]},{"id":"ba023ff0.a43a6","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":987.285737991333,"y":228.41371154785156,"z":"f7201aa.a856ce8","wires":[[]]},{"id":"314b1e69.b3c3b2","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"If svc-action is 'changeassign' then request-action must be 'CreateVfModuleInstance'\" />\n","comments":"","x":1006.0952262878418,"y":274.12798166275024,"z":"f7201aa.a856ce8","wires":[]},{"id":"1a397f44.2d14c1","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":211.66669464111328,"y":447.41358184814453,"z":"f7201aa.a856ce8","wires":[["78588014.928d5","31e86525.9f0e8a","aa4e4085.c66c4","c9760f9e.f0078","2f8025f9.5e373a","eb8de969.99d1b8","8209ff3.06fd6","5a1cd88a.ad0f48"]]},{"id":"aa4e4085.c66c4","type":"switchNode","name":"switch service-data.vnfs.vnf_length","xml":"<switch test='`$service-data.vnfs.vnf_length`'>\n","comments":"","outputs":1,"x":591.1904754638672,"y":382.4136209487915,"z":"f7201aa.a856ce8","wires":[["1d4e4517.5939bb","b21fdd89.9b71d"]]},{"id":"1d4e4517.5939bb","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":831.9047470092773,"y":359.5563611984253,"z":"f7201aa.a856ce8","wires":[["b34fefc7.e8c47"]]},{"id":"b21fdd89.9b71d","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":831.6665878295898,"y":400.50887966156006,"z":"f7201aa.a856ce8","wires":[["903ff10e.15556"]]},{"id":"b34fefc7.e8c47","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"There are no VNFs defined in MD-SAL\" />\n","comments":"","x":998.571361541748,"y":358.842116355896,"z":"f7201aa.a856ce8","wires":[]},{"id":"903ff10e.15556","type":"for","name":"for each vnf","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf_length`' >\n","comments":"","outputs":1,"x":993.9047317504883,"y":400.175498008728,"z":"f7201aa.a856ce8","wires":[["6a7ebc9a.d78d54"]]},{"id":"6a7ebc9a.d78d54","type":"switchNode","name":"switch service data vnf == input vnf","xml":"<switch test='`$service-data.vnfs.vnf[$idx].vnf-id == $vf-module-topology-operation-input.vnf-information.vnf-id`'>\n","comments":"","outputs":1,"x":1245.237949371338,"y":399.8421850204468,"z":"f7201aa.a856ce8","wires":[["31259bac.59db94"]]},{"id":"31259bac.59db94","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1475.2380409240723,"y":399.17553901672363,"z":"f7201aa.a856ce8","wires":[["2019d570.deed7a"]]},{"id":"31e86525.9f0e8a","type":"set","name":"set vnf-index to -1","xml":"<set>\n<parameter name='vnf-index' value='-1' />\n","comments":"","x":535.2380752563477,"y":320.50879287719727,"z":"f7201aa.a856ce8","wires":[]},{"id":"a442b5af.5d4898","type":"set","name":"set vnf-index to idx","xml":"<set>\n<parameter name='vnf-index' value='`$idx`' />\n","comments":"","x":1796.9046783447266,"y":370.1754970550537,"z":"f7201aa.a856ce8","wires":[]},{"id":"c9760f9e.f0078","type":"switchNode","name":"switch vnf-index","xml":"<switch test='`$vnf-index`'>\n","comments":"","outputs":1,"x":526.9047584533691,"y":447.1754951477051,"z":"f7201aa.a856ce8","wires":[["3158e21.801721e"]]},{"id":"3158e21.801721e","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":705.2381439208984,"y":446.5088710784912,"z":"f7201aa.a856ce8","wires":[["ea5cc8a1.db2ab8"]]},{"id":"ea5cc8a1.db2ab8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find VNF ID ' + $vf-module-topology-operation-input.vnf-information.vnf-id + ' in MD-SAL'`\" />\n","comments":"","x":865.2380523681641,"y":445.8421745300293,"z":"f7201aa.a856ce8","wires":[]},{"id":"2019d570.deed7a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1623.5715026855469,"y":398.0952377319336,"z":"f7201aa.a856ce8","wires":[["a442b5af.5d4898","b7e91f03.a2b6a"]]},{"id":"b7e91f03.a2b6a","type":"break","name":"break","xml":"<break>\n","comments":"","x":1758.5714683532715,"y":419.7618236541748,"z":"f7201aa.a856ce8","wires":[]},{"id":"eb8de969.99d1b8","type":"switchNode","name":"switch service-data...vf-module_length","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`'>\n","comments":"","outputs":1,"x":599.5237884521484,"y":545.746992111206,"z":"f7201aa.a856ce8","wires":[["b5da5af5.664808","57896c99.a5bc74"]]},{"id":"b5da5af5.664808","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":850.2380981445312,"y":524.5563955307007,"z":"f7201aa.a856ce8","wires":[["2bad7927.863b76"]]},{"id":"57896c99.a5bc74","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":849.9999389648438,"y":565.5089139938354,"z":"f7201aa.a856ce8","wires":[["3c8d9a3b.822fc6"]]},{"id":"2bad7927.863b76","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'There are no VF modules defined in MD-SAL for VNF ' + $vf-module-topology-operation-input.vnf-information.vnf-id`\" />\n","comments":"","x":1016.904712677002,"y":523.8421506881714,"z":"f7201aa.a856ce8","wires":[]},{"id":"3c8d9a3b.822fc6","type":"for","name":"for each vf-module","xml":"<for index='idx' start='0' end='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module_length`' >\n","comments":"","outputs":1,"x":1012.2380828857422,"y":565.1755323410034,"z":"f7201aa.a856ce8","wires":[["62d4266a.17a1f8"]]},{"id":"62d4266a.17a1f8","type":"switchNode","name":"switch service data vf-module == input vf-module","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$idx].vf-module-id == $vf-module-topology-operation-input.vf-module-information.vf-module-id`'>\n","comments":"","outputs":1,"x":1318.5712432861328,"y":564.8422679901123,"z":"f7201aa.a856ce8","wires":[["7c70c0da.5034e"]]},{"id":"7c70c0da.5034e","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1588.5712966918945,"y":562.5088729858398,"z":"f7201aa.a856ce8","wires":[["684d4cda.2dbd94"]]},{"id":"2f8025f9.5e373a","type":"set","name":"set vf-module-index to -1","xml":"<set>\n<parameter name='vf-module-index' value='-1' />\n","comments":"","x":555.2380599975586,"y":495.5088310241699,"z":"f7201aa.a856ce8","wires":[]},{"id":"d0d88d4.674af7","type":"set","name":"set vf-module-index to idx","xml":"<set>\n<parameter name='vf-module-index' value='`$idx`' />\n","comments":"","x":1918.571388244629,"y":533.5088520050049,"z":"f7201aa.a856ce8","wires":[]},{"id":"8209ff3.06fd6","type":"switchNode","name":"switch vf-module-index","xml":"<switch test='`$vf-module-index`'>\n","comments":"","outputs":1,"x":551.9047622680664,"y":613.8422508239746,"z":"f7201aa.a856ce8","wires":[["775a1509.e7ed2c"]]},{"id":"775a1509.e7ed2c","type":"outcome","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":730.2381477355957,"y":613.1756267547607,"z":"f7201aa.a856ce8","wires":[["57b9ac1c.784bf4"]]},{"id":"57b9ac1c.784bf4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unable to find VF module ID ' + $vf-module-topology-operation-input.vf-module-information.vf-module-id + ' in MD-SAL'`\" />\n","comments":"","x":890.2380561828613,"y":612.5089302062988,"z":"f7201aa.a856ce8","wires":[]},{"id":"684d4cda.2dbd94","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1721.9048385620117,"y":561.4286127090454,"z":"f7201aa.a856ce8","wires":[["d0d88d4.674af7","32ee2e53.ad6862"]]},{"id":"32ee2e53.ad6862","type":"break","name":"break","xml":"<break>\n","comments":"","x":1856.9048042297363,"y":583.0951986312866,"z":"f7201aa.a856ce8","wires":[]},{"id":"389e7e21.b1d722","type":"set","name":"set order-status to Created","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.order-status'\n  value='Created' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.last-rpc-action'\n  value='`$vf-module-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.last-action'\n  value='`$vf-module-topology-operation-input.sdnc-request-header.request-action`' />\n","comments":"","x":1068.3333930969238,"y":1186.2231769561768,"z":"f7201aa.a856ce8","wires":[]},{"id":"306ed3a5.3a0adc","type":"switchNode","name":"switch order-status","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.order-status`'>\n","comments":"","outputs":1,"x":1044.0000076293945,"y":991.8898601531982,"z":"f7201aa.a856ce8","wires":[["fe4acf16.276a","4e1dea6f.addda4"]]},{"id":"fe4acf16.276a","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1222.0001029968262,"y":1010.6041889190674,"z":"f7201aa.a856ce8","wires":[["f7740c28.2b78f"]]},{"id":"5f2099b.eb89868","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1393.190559387207,"y":962.8899326324463,"z":"f7201aa.a856ce8","wires":[[]]},{"id":"f7740c28.2b78f","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Order status is ' + $service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-level-oper-status.order-status + ' instead of PendingDelete'`\" />\n","comments":"","x":1407.6667594909668,"y":1010.604229927063,"z":"f7201aa.a856ce8","wires":[]},{"id":"b5df0f86.cd001","type":"set","name":"copy ONAP model information","xml":"<set>\n<parameter name='service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-information.onap-model-information.'\n   value='$vf-module-topology-operation-input.vf-module-information.onap-model-information.' />\n\n","comments":"","x":1079.000015258789,"y":1139.5565490722656,"z":"f7201aa.a856ce8","wires":[]},{"id":"cc17efed.d93b8","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1028.3333015441895,"y":1234.5564727783203,"z":"f7201aa.a856ce8","wires":[]},{"id":"4e1dea6f.addda4","type":"outcome","name":"PendingDelete","xml":"<outcome value='PendingDelete'>\n","comments":"","outputs":1,"x":1246.666732788086,"y":962.1428422927856,"z":"f7201aa.a856ce8","wires":[["5f2099b.eb89868"]]},{"id":"fc5ca1dd.b90e4","type":"get-resource","name":"get-resource VF_MODULE_MODEL","xml":"<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from VF_MODULE_MODEL WHERE customization_uuid = $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid'\n  pfx='db.vf-module-model'>\n\n","comments":"","outputs":1,"x":1097.6667022705078,"y":1072.8898029327393,"z":"f7201aa.a856ce8","wires":[["a3e60242.e470d","baeb8d49.57db7"]]},{"id":"c24261ec.55df9","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No model found for VF module customization UUID ' + $vf-module-topology-operation-input.vf-module-information.onap-model-information.model-customization-uuid`\" />\n","comments":"","x":1543.0951232910156,"y":1097.3182754516602,"z":"f7201aa.a856ce8","wires":[]},{"id":"a3e60242.e470d","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1367.452392578125,"y":1053.2706336975098,"z":"f7201aa.a856ce8","wires":[["d5b72b80.003a38"]]},{"id":"baeb8d49.57db7","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1376.0238227844238,"y":1097.5563468933105,"z":"f7201aa.a856ce8","wires":[["c24261ec.55df9"]]},{"id":"d5b72b80.003a38","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading VF_MODULE_MODEL table\" />\n","comments":"","x":1542.4523239135742,"y":1052.4135341644287,"z":"f7201aa.a856ce8","wires":[]},{"id":"8362775b.738408","type":"comment","name":"check removed with US622450","info":"","comments":"","x":1005.7143402099609,"y":952.8571662902832,"z":"f7201aa.a856ce8","wires":[]},{"id":"4aacc14d.e97f1","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":855.035774230957,"y":735.7143287658691,"z":"f7201aa.a856ce8","wires":[["810c4738.433dc8"]]},{"id":"810c4738.433dc8","type":"call","name":"call self-serve-vfmodule-changeassign","xml":"<call module='GENERIC-RESOURCE-API' rpc='self-serve-vfmodule-changeassign' mode='sync' >\n","comments":"","outputs":1,"x":1102.4999313354492,"y":735.8929252624512,"z":"f7201aa.a856ce8","wires":[["9e368f22.93e6e","bdc15fb7.126b2"]]},{"id":"9e368f22.93e6e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1352.2499160766602,"y":736.1429138183594,"z":"f7201aa.a856ce8","wires":[["7c7410c4.5f2cd"]]},{"id":"7c7410c4.5f2cd","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value=\"`'Encountered error while updating self-serve vf-module resources with error: '+ $error-message`\" />\n","comments":"","x":1511.8213424682617,"y":735.7858085632324,"z":"f7201aa.a856ce8","wires":[]},{"id":"d24e3df.ed663c","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":857.1428756713867,"y":779.9999694824219,"z":"f7201aa.a856ce8","wires":[["90e8814a.c278f"]]},{"id":"f86e0f5b.20fd9","type":"comment","name":"self-serve FORKING LOGIC","info":"","comments":"","x":337.14293670654297,"y":691.4285774230957,"z":"f7201aa.a856ce8","wires":[]},{"id":"90e8814a.c278f","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":794.285774230957,"y":1072.8571395874023,"z":"f7201aa.a856ce8","wires":[["fc5ca1dd.b90e4","b5df0f86.cd001","389e7e21.b1d722","cc17efed.d93b8"]]},{"id":"5a1cd88a.ad0f48","type":"switchNode","name":"switch: sdnc-generated-cloud-resources","xml":"<switch test='`$service-data.vnfs.vnf[$vnf-index].vnf-data.vf-modules.vf-module[$vf-module-index].vf-module-data.vf-module-topology.sdnc-generated-cloud-resources`'>\n","comments":"","outputs":1,"x":600.0000305175781,"y":735.7143325805664,"z":"f7201aa.a856ce8","wires":[["4aacc14d.e97f1","d24e3df.ed663c"]]},{"id":"bdc15fb7.126b2","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1358.5713691711426,"y":779.9999866485596,"z":"f7201aa.a856ce8","wires":[["2fd0a76d.ce94c8"]]},{"id":"2fd0a76d.ce94c8","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n","comments":"","x":1515.71435546875,"y":780,"z":"f7201aa.a856ce8","wires":[]}]