[
  {
    "id": "5133686c.68eb98",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 103.01040649414062,
    "y": 42.010414123535156,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "496791b5.8488d"
      ]
    ]
  },
  {
    "id": "496791b5.8488d",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 315.0104103088379,
    "y": 114.01043128967285,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "177388c0.d59117"
      ]
    ]
  },
  {
    "id": "177388c0.d59117",
    "type": "method",
    "name": "sotn-attachment-topology-operation-create",
    "xml": "<method rpc='sotn-attachment-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 303.0105285644531,
    "y": 202.01041412353516,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "f8d7365b.409c58"
      ]
    ]
  },
  {
    "id": "f8d7365b.409c58",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 223.01045989990234,
    "y": 951.0106620788574,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "9bdb10c1.b2c65",
        "64a58452.ad453c",
        "e271b8d5.7f00e8",
        "1b3c993d.53c997",
        "e93d7aa8.8afc58",
        "52397993.71f7e8",
        "e6318980.74cd38",
        "461a26ad.352d08",
        "99015db4.34427",
        "302473e7.2159bc",
        "8e35b842.c7d4f8",
        "88bfb367.64d03",
        "373e7d85.f8d5f2",
        "ab686f72.f6d24",
        "6568c68e.998458",
        "42759b0d.8bfff4",
        "7bc569ba.c7c2a8",
        "aee1a7c1.04af88",
        "c3e71ac5.708158",
        "8031bd9b.aa492",
        "b0b78151.f3bd1",
        "13637009.f57bd",
        "acf4df38.359e8"
      ]
    ]
  },
  {
    "id": "f392c1a2.4633e",
    "type": "comment",
    "name": "Set allotted resource id if not sent by SO",
    "info": "",
    "comments": "",
    "x": 707.087158203125,
    "y": 111.44433307647705,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "9bdb10c1.b2c65",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 653.0104370117188,
    "y": 167.01040649414062,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "61aacc9.ea6e934",
        "1e985c69.1db8d4"
      ]
    ]
  },
  {
    "id": "61aacc9.ea6e934",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 851.0105247497559,
    "y": 137.01039505004883,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "89d751a9.4634e"
      ]
    ]
  },
  {
    "id": "1e985c69.1db8d4",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 850.0104331970215,
    "y": 174.0104055404663,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "2d11e756.388fd8"
      ]
    ]
  },
  {
    "id": "2d11e756.388fd8",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-id",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n",
    "comments": "",
    "x": 1048.0104217529297,
    "y": 171.01042461395264,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "64a58452.ad453c",
    "type": "set",
    "name": "set tmp.ar.self-link",
    "xml": "<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:connection-attachment-allotted-resources/connection-attachment-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/connection-attachment-topology/'` \" />\n\n",
    "comments": "",
    "x": 621.0103607177734,
    "y": 388.01051330566406,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "e271b8d5.7f00e8",
    "type": "execute",
    "name": "execute Properties",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n",
    "comments": "",
    "outputs": 1,
    "x": 621.2722778320312,
    "y": 469.6771945953369,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "1b3c993d.53c997",
    "type": "execute",
    "name": "generate allotted-resource tmp.ar-url",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.connection-attachment-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 674.2723388671875,
    "y": 556.6771125793457,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "89d751a9.4634e",
    "type": "execute",
    "name": "execute tmp.ar.allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"tmp.ar.allotted-resource-id\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1066.0105018615723,
    "y": 138.01040077209473,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "eb62b50e.452978"
      ]
    ]
  },
  {
    "id": "eb62b50e.452978",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1284.0105438232422,
    "y": 138.0103645324707,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "21e39486.41c95c"
      ]
    ]
  },
  {
    "id": "21e39486.41c95c",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value=\"An error occured while generation allotted resource ID\" />\n",
    "comments": "",
    "x": 1450.010498046875,
    "y": 138.01037883758545,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "69607a16.ab23b4",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1180.0106372833252,
    "y": 628.7882852554321,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "5509562b.e7bb48"
      ]
    ]
  },
  {
    "id": "ff29c66f.d0c078",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: Existing connection attachment allotted resource\" />\n    \n",
    "comments": "",
    "x": 1913.529016494751,
    "y": 629.8543567657471,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "988573f5.64b22",
    "type": "comment",
    "name": "Check for non existence of allotted resource",
    "info": "",
    "comments": "",
    "x": 1036.0105590820312,
    "y": 562.7883520126343,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "ae4a4ff0.de2",
    "type": "for",
    "name": "for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]",
    "xml": "<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1556.6771049499512,
    "y": 773.0104644298553,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "79ba7554.7b000c"
      ]
    ]
  },
  {
    "id": "52397993.71f7e8",
    "type": "switchNode",
    "name": "switch service-data.consumed-allotted-resources_length",
    "xml": "<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 738.6764297485352,
    "y": 749.7244968414307,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "ae3cba2c.22d388",
        "70e9802d.1c53d"
      ]
    ]
  },
  {
    "id": "ae3cba2c.22d388",
    "type": "other",
    "name": "outcome Null",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 1042.8193283081055,
    "y": 718.5819339752197,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "b72b861c.815eb8"
      ]
    ]
  },
  {
    "id": "70e9802d.1c53d",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1019.8193778991699,
    "y": 779.5818891525269,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "11ff47a3.643388"
      ]
    ]
  },
  {
    "id": "11ff47a3.643388",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1179.9464683532715,
    "y": 777.7078657150269,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "ae4a4ff0.de2",
        "73e79a71.cfae24",
        "c9aa1cc3.3ec63"
      ]
    ]
  },
  {
    "id": "b72b861c.815eb8",
    "type": "set",
    "name": "set cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n",
    "comments": "",
    "x": 1192.67631149292,
    "y": 716.2959842681885,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "e6318980.74cd38",
    "type": "set",
    "name": "set consumed allotted resources",
    "xml": "<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n",
    "comments": "",
    "x": 667.5337219238281,
    "y": 853.2960615158081,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "73e79a71.cfae24",
    "type": "switchNode",
    "name": "switch tmp.found-cidx",
    "xml": "<switch test='`$tmp.found-cidx`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1369.0615158081055,
    "y": 809.7193884849548,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "c00df3d6.a23ca"
      ]
    ]
  },
  {
    "id": "c00df3d6.a23ca",
    "type": "outcomeTrue",
    "name": "false",
    "xml": "<outcome value='false'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1559.0614700317383,
    "y": 809.71932554245,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "210f1d5f.874d72"
      ]
    ]
  },
  {
    "id": "210f1d5f.874d72",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1725.0614700317383,
    "y": 809.71932554245,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "9f784ab7.a1a108"
      ]
    ]
  },
  {
    "id": "79ba7554.7b000c",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n",
    "comments": "",
    "outputs": 1,
    "x": 1973.7887344360352,
    "y": 770.0104913711548,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "6f5753b3.9563cc"
      ]
    ]
  },
  {
    "id": "6f5753b3.9563cc",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2155.5983085632324,
    "y": 770.4749383926392,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "65ad78ab.417bb8"
      ]
    ]
  },
  {
    "id": "9f784ab7.a1a108",
    "type": "set",
    "name": "set tmp.cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n",
    "comments": "",
    "x": 1886.9348526000977,
    "y": 809.2310266494751,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "829f78ea.771c88",
    "type": "comment",
    "name": "Add to consumed service consumed-allotted-resources in mdsal",
    "info": "Prepare data and add to service-data",
    "comments": "",
    "x": 759.6776428222656,
    "y": 680.0104608535767,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "8b9e14b0.ee2668",
    "type": "comment",
    "name": "This set resource will be added to MDSAL by provider code",
    "info": "Below we add to service-data.consumed-allotted-resource at last index",
    "comments": "",
    "x": 747.0105590820312,
    "y": 818.788553237915,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "13637009.f57bd",
    "type": "update",
    "name": "update AAI allotted-resource",
    "xml": "<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $connection-attachment-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $connection-attachment-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n    <parameter name=\"id\" value=\"`$tmp.ar.allotted-resource-id`\" />\n\t<parameter name=\"name\" value=\"`$prop.connection-attachment.sotnVpnName`\" />\n\t<parameter name=\"access-provider-id\" value=\"`$prop.connection-attachment.access-provider-id`\" />\n\t<parameter name=\"access-client-id\" value=\"`$prop.connection-attachment.access-client-id`\" />\n\t<parameter name=\"access-topology-id\" value=\"`$prop.connection-attachment.access-topology-id`\" />\n\t<parameter name=\"access-node-id\" value=\"`$prop.connection-attachment.access-node-id`\" />\n\t<parameter name=\"access-ltp-id\" value=\"`$prop.connection-attachment.access-ltp-id`\" />\t\n\t<parameter name=\"cvlan\" value=\"`$prop.connection-attachment.cVLAN`\" />\n    <parameter name=\"vpn-name\" value=\"`$prop.connection-attachment.sotnVpnName`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid`\" />\n\t<parameter name=\"operational-status\" value=\"Created\" />\n",
    "comments": "",
    "outputs": 1,
    "x": 652.7012557983398,
    "y": 1868.5423040390015,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "2383f0f.fe77a1",
        "1726f753.540739"
      ]
    ]
  },
  {
    "id": "2383f0f.fe77a1",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 847.463191986084,
    "y": 1859.4949054718018,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "bfb0685f.193b68"
      ]
    ]
  },
  {
    "id": "bfb0685f.193b68",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n",
    "comments": "",
    "x": 1013.9870719909668,
    "y": 1871.1139764785767,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "1726f753.540739",
    "type": "failure",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 854.558479309082,
    "y": 1892.2568731307983,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "bfb0685f.193b68"
      ]
    ]
  },
  {
    "id": "da5dd301.64278",
    "type": "comment",
    "name": "Save Resource to AAI",
    "info": "",
    "comments": "",
    "x": 628.5108871459961,
    "y": 1830.8442754745483,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "d50db86.5001548",
    "type": "comment",
    "name": "Set allotted resource type if not sent by SO",
    "info": "",
    "comments": "",
    "x": 693.0104064941406,
    "y": 220.01041412353516,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "e93d7aa8.8afc58",
    "type": "switchNode",
    "name": "switch allotted-resource-type",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 654.9337158203125,
    "y": 260.57647037506104,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "f6469c6d.d6d7c",
        "6b6259b5.f45218"
      ]
    ]
  },
  {
    "id": "f6469c6d.d6d7c",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 857.9338684082031,
    "y": 245.57647323608398,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "9e957e4b.c63b4"
      ]
    ]
  },
  {
    "id": "6b6259b5.f45218",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 850.9336967468262,
    "y": 285.57649326324463,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "6a7aae3b.c248e"
      ]
    ]
  },
  {
    "id": "6a7aae3b.c248e",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`' />\n",
    "comments": "",
    "x": 1082.933681488037,
    "y": 285.5764980316162,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "9d9d583f.dbc9c8",
    "type": "comment",
    "name": "For storage in AAI connection-attachment-topology",
    "info": "",
    "comments": "",
    "x": 718.010368347168,
    "y": 355.01041412353516,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "2787339d.0e091c",
    "type": "comment",
    "name": "Obtain different URL, template location etc",
    "info": "For saving resource information to MDSAL & for AAI",
    "comments": "",
    "x": 693.0103530883789,
    "y": 436.89932346343994,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "da385e9d.31c6e",
    "type": "comment",
    "name": "Used for Put AR by id to MDSAL",
    "info": "",
    "comments": "",
    "x": 659.0104370117188,
    "y": 525.8993406295776,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "fb746d4c.98d2e",
    "type": "comment",
    "name": "Obtain the last index in services",
    "info": "ServiceData is added by Provider code",
    "comments": "",
    "x": 660.4548797607422,
    "y": 711.8992853164673,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "c3e71ac5.708158",
    "type": "set",
    "name": "set output to api handler",
    "xml": "<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='connection-attachment-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $connection-attachment-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n",
    "comments": "",
    "x": 638.2785415649414,
    "y": 1775.3696031570435,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "8031bd9b.aa492",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 606.6916198730469,
    "y": 1916.9853897094727,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "9e957e4b.c63b4",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value=\"SOTNAttachmentInstance\" />\n",
    "comments": "",
    "x": 1097.010555267334,
    "y": 246.0103998184204,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "31ce0f6c.4be64",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:sotn-get-saved-ar-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='sotn-get-saved-ar-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 940.0045623779297,
    "y": 1624.5041437149048,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "aee1a7c1.04af88",
    "type": "execute",
    "name": "execute RestApiCallNode - PUT AR by id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.sotn-attachment.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 689.0106735229492,
    "y": 1709.0105323791504,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "8776bfe5.59d94",
        "d7639202.15d54",
        "3089b749.6674a8"
      ]
    ]
  },
  {
    "id": "8776bfe5.59d94",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 938.652027130127,
    "y": 1747.3418626785278,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "7514cc17.dfede4"
      ]
    ]
  },
  {
    "id": "d7639202.15d54",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 929.6520767211914,
    "y": 1715.8418884277344,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "7514cc17.dfede4"
      ]
    ]
  },
  {
    "id": "3089b749.6674a8",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 933.4021148681641,
    "y": 1686.1989933028817,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "e2b27745.660088"
      ]
    ]
  },
  {
    "id": "7514cc17.dfede4",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1099.402114868164,
    "y": 1716.5919122695923,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "e2b27745.660088",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1075.0580825805664,
    "y": 1682.3911624923348,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "8e35b842.c7d4f8",
    "type": "execute",
    "name": "execute RestApiCallNode - Update parent provided service AR",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 759.0103607177734,
    "y": 1135.010579109192,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "4a784746.dec008",
        "c64e1e39.2251",
        "be9dd1f.2b8ae3"
      ]
    ]
  },
  {
    "id": "4a784746.dec008",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1067.3184204101562,
    "y": 1167.0088548660278,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "fa176469.0fc3f8"
      ]
    ]
  },
  {
    "id": "c64e1e39.2251",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1058.3184700012207,
    "y": 1135.5088806152344,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "fa176469.0fc3f8"
      ]
    ]
  },
  {
    "id": "be9dd1f.2b8ae3",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1062.0685081481934,
    "y": 1105.8659854903817,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "a7887873.602db8"
      ]
    ]
  },
  {
    "id": "fa176469.0fc3f8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1228.0685081481934,
    "y": 1136.2589044570923,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "a7887873.602db8",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1203.7244758605957,
    "y": 1102.0581546798348,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "21d4e2e4.5ed5fe",
    "type": "comment",
    "name": "Put the parent allotted resource in mdsal",
    "info": "",
    "comments": "",
    "x": 688.0103073120117,
    "y": 1097.010485649109,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "373e7d85.f8d5f2",
    "type": "set",
    "name": "set connection-attachment-ar-identifiers",
    "xml": "<set>\n<parameter name='connection-attachment-ar-identifiers.consuming-service-instance-id' value=\"`$connection-attachment-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n",
    "comments": "",
    "x": 684.3674926757812,
    "y": 1299.5821046829224,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "88bfb367.64d03",
    "type": "set",
    "name": "set ar-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.action' value=\"`$connection-attachment-topology-operation-input.request-information.request-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-name' value=\"connection-attachment-topology-operation\" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-action' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$connection-attachment-topology-operation-input.request-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$connection-attachment-topology-operation-input.service-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.' value=\"`$connection-attachment-topology-operation-input.connection-attachment-request-input.` \" />",
    "comments": "",
    "x": 598.2242736816406,
    "y": 1267.3914613723755,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "ab686f72.f6d24",
    "type": "set",
    "name": "set identifiers in overall structure",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.allotted-resource-identifiers.' \nvalue=\"`$connection-attachment-ar-identifiers.`\" />\n\n\n",
    "comments": "",
    "x": 663.1772918701172,
    "y": 1333.6772899627686,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "6568c68e.998458",
    "type": "execute",
    "name": "execute getTime",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 615.5101318359375,
    "y": 1407.010817527771,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "42759b0d.8bfff4",
    "type": "set",
    "name": "set allotted-resource-oper-status",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Created' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$connection-attachment-topology-operation-input.request-information.request-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n",
    "comments": "",
    "x": 666.4971694946289,
    "y": 1462.9620504379272,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "7bc569ba.c7c2a8",
    "type": "set",
    "name": "set model-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.onap-model-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.` \" />",
    "comments": "",
    "x": 611.065788269043,
    "y": 1368.5661754608154,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "5eda0baa.a6ac24",
    "type": "comment",
    "name": "Prepare data for allotted-resource addition to MDSAL",
    "info": "This will add to allotted-resource which is present inside service.",
    "comments": "",
    "x": 728.3992767333984,
    "y": 1233.5660219192505,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "302473e7.2159bc",
    "type": "execute",
    "name": "generate parent-ar url - replace allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.parent-ar-url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 723.5104217529297,
    "y": 1061.0104246139526,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "99015db4.34427",
    "type": "execute",
    "name": "generate parent-ar url - replace service-instance-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.parent-provided-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 719.5103454589844,
    "y": 1018.0105609893799,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "ac4fa77d.cd6878",
    "type": "comment",
    "name": "Prepare Parent AR URL",
    "info": "Preparation to set provided-allotted-resource in parent service instance",
    "comments": "",
    "x": 637.5108032226562,
    "y": 947.0105142593384,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "461a26ad.352d08",
    "type": "set",
    "name": "set tmp.ar.parent-service-instance-id",
    "xml": "<set>\n<parameter name='tmp.ar.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n\n",
    "comments": "",
    "x": 676.5105972290039,
    "y": 980.5104537010193,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "fc5e8c6b.8fefa",
    "type": "comment",
    "name": "Required for filling template values",
    "info": "This is done because connection-attachment is generic resource and doesn't have specific parameters",
    "comments": "",
    "x": 866.0107650756836,
    "y": 1587.5102167129517,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "65ad78ab.417bb8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource as cosumed allotted resource already exists.\" />\n",
    "comments": "",
    "x": 2233.767379760742,
    "y": 818.6562433242798,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "c9aa1cc3.3ec63",
    "type": "set",
    "name": "set tmp.found-cidx",
    "xml": "<set>\n<parameter name='tmp.found-cidx' value=\"`false`\" />\n\n\n",
    "comments": "",
    "x": 1359.656551361084,
    "y": 730.3229863643646,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "ff67ccb2.50d8",
    "type": "comment",
    "name": "Add to parent services provided-allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 748.2119140625,
    "y": 914.989670753479,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "a5a8871f.3c0658",
    "type": "comment",
    "name": "Add to allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 668.9791030883789,
    "y": 1200.9793510437012,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "5509562b.e7bb48",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1342.0104579925537,
    "y": 628.2881746292114,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "f6f2507e.ba037"
      ]
    ]
  },
  {
    "id": "f6f2507e.ba037",
    "type": "switchNode",
    "name": "switch cr length",
    "xml": "<switch test='`$mdsal-ar.connection-attachment-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1529.8678379058838,
    "y": 628.9073100090027,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "7ebe7287.439dec"
      ]
    ]
  },
  {
    "id": "7ebe7287.439dec",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1729.2009601593018,
    "y": 628.9073886871338,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "ff29c66f.d0c078"
      ]
    ]
  },
  {
    "id": "b0b78151.f3bd1",
    "type": "execute",
    "name": "execute RestApiCallNode - get-resource connection-attachment-allotted-resource",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='GET' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 814.0104598999023,
    "y": 623.0104503631592,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "69607a16.ab23b4",
        "4afffe17.752bc"
      ]
    ]
  },
  {
    "id": "4afffe17.752bc",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1182.0104904174805,
    "y": 593.0104484558105,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "5d7e4f7b.5aaa4"
      ]
    ]
  },
  {
    "id": "5d7e4f7b.5aaa4",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1334.0104904174805,
    "y": 592.0104484558105,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "acf4df38.359e8",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 610.5660171508789,
    "y": 1542.6770677566528,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "e883ed0e.70e5",
        "31ce0f6c.4be64"
      ]
    ]
  },
  {
    "id": "e883ed0e.70e5",
    "type": "for",
    "name": "for each sotn-get-request-input-param",
    "xml": "<for index='i' start='0' end='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 880.5660820007324,
    "y": 1542.6771154403687,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "c8bff3cc.09d2c"
      ]
    ]
  },
  {
    "id": "8e066326.71f27",
    "type": "comment",
    "name": "Take the parameter names by removing prefix",
    "info": "",
    "comments": "",
    "x": 1420.5658645629883,
    "y": 1498.6771488189697,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "a6906228.fcd97",
    "type": "execute",
    "name": "execute split parameterName",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='split' >\n<parameter name=\"original_string\" value='`$connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$i].name`'/>\n<parameter name=\"regex\" value=\"_\"/>\n<parameter name=\"ctx_memory_result_key\" value=\"param-prefix\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1378.6005325317383,
    "y": 1533.65629196167,
    "z": "3425547d.b4704c",
    "wires": [
      []
    ]
  },
  {
    "id": "d3547289.18d19",
    "type": "set",
    "name": "set parameterName",
    "xml": "<set>\n<parameter name=\"`connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.param[$idx].name`\" value='`$param-prefix[$param-prefix_length -1]`'/>\n",
    "comments": "",
    "x": 1349.0450592041016,
    "y": 1566.65629196167,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "80d52421.de6378",
    "type": "comment",
    "name": "Remove VNFC prefix",
    "info": "",
    "comments": "",
    "x": 821.5660095214844,
    "y": 1510.1214294433594,
    "z": "3425547d.b4704c",
    "wires": []
  },
  {
    "id": "c8bff3cc.09d2c",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1127.56591796875,
    "y": 1541.1214599609375,
    "z": "3425547d.b4704c",
    "wires": [
      [
        "a6906228.fcd97",
        "d3547289.18d19"
      ]
    ]
  }
]
