[
  {
    "id": "9d8f9fa5.439ad",
    "type": "dgstart",
    "name": "DGSTART",
    "outputs": 1,
    "x": 134.00390625,
    "y": 59.999999046325684,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "999b7749.bb2828"
      ]
    ]
  },
  {
    "id": "999b7749.bb2828",
    "type": "service-logic",
    "name": "GENERIC-RESOURCE-API ${project.version}",
    "module": "GENERIC-RESOURCE-API",
    "version": "${project.version}",
    "comments": "",
    "xml": "<service-logic xmlns='http://www.onap.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='GENERIC-RESOURCE-API' version='${project.version}'>",
    "outputs": 1,
    "x": 346.00391006469727,
    "y": 132.00001621246338,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "a889b861.30b858"
      ]
    ]
  },
  {
    "id": "a889b861.30b858",
    "type": "method",
    "name": "sotn-attachment-topology-operation-create",
    "xml": "<method rpc='sotn-attachment-topology-operation-create' mode='sync'>\n",
    "comments": "",
    "outputs": 1,
    "x": 334.0040283203125,
    "y": 219.99999904632568,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "a434e8ee.221048"
      ]
    ]
  },
  {
    "id": "a434e8ee.221048",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 254.00395965576172,
    "y": 969.000247001648,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "c342578d.28b708",
        "efa6ad20.d82ee",
        "269c43d6.56387c",
        "3e97601e.a0c21",
        "a1d6ff56.9c99d",
        "1cbd957b.be039b",
        "52744f96.8455f",
        "361e33ee.17369c",
        "8340ac1e.8db72",
        "d5a721b9.32552",
        "908d0f20.3dc3f",
        "e6716760.631bc8",
        "8217a995.1a4f18",
        "272d789b.464298",
        "de9004ee.8e65a8",
        "61510de6.6b5a64",
        "a9832c0c.edf5c",
        "bdd1fffd.ca081",
        "fc645855.78a1f8",
        "e28f7f9f.51996",
        "4298e590.a1603c",
        "b58ada11.db1438",
        "d0bb4427.716f08"
      ]
    ]
  },
  {
    "id": "aad4b525.c81b28",
    "type": "comment",
    "name": "Set allotted resource id if not sent by SO",
    "info": "",
    "comments": "",
    "x": 725.0805969238281,
    "y": 144.43391513824463,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "c342578d.28b708",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 684.0039367675781,
    "y": 184.99999141693115,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "3dca0ad4.c31f16",
        "5f732a2c.880594"
      ]
    ]
  },
  {
    "id": "3dca0ad4.c31f16",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 935.0039863586426,
    "y": 146.9999783039093,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "d23cb383.a5008"
      ]
    ]
  },
  {
    "id": "5f732a2c.880594",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 936.00390625,
    "y": 206.99998688697815,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "e2d02082.677af"
      ]
    ]
  },
  {
    "id": "e2d02082.677af",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-id",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-id' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-id`' />\n",
    "comments": "",
    "x": 1168.003890991211,
    "y": 206.99999165534973,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "efa6ad20.d82ee",
    "type": "set",
    "name": "set tmp.ar.self-link",
    "xml": "<set>\n<parameter name='tmp.ar.self-link' value=\"`'restconf/config/GENERIC-RESOURCE-API:connection-attachment-allotted-resources/connection-attachment-allotted-resource/'\n + $tmp.ar.allotted-resource-id\n + '/allotted-resource-data/connection-attachment-topology/'` \" />\n\n",
    "comments": "",
    "x": 656.0038299560547,
    "y": 420.00005626678467,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "269c43d6.56387c",
    "type": "execute",
    "name": "execute Properties",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.prop.PropertiesNode' method='readProperties' >\n    <parameter name='fileName' value='%SDNC_CONFIG_DIR%/generic-resource-api-dg.properties' />\n    <parameter name='contextPrefix' value='prop' />\n",
    "comments": "",
    "outputs": 1,
    "x": 662.2657508850098,
    "y": 505.66673374176025,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "3e97601e.a0c21",
    "type": "execute",
    "name": "generate allotted-resource tmp.ar-url",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.connection-attachment-allottedresource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 709.2657318115234,
    "y": 589.6667013168335,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "d23cb383.a5008",
    "type": "execute",
    "name": "execute tmp.ar.allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='generateUUID' >\n<parameter name=\"ctx-destination\" value=\"tmp.ar.allotted-resource-id\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 1150.003963470459,
    "y": 147.9999840259552,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "6e27cc35.c13c74"
      ]
    ]
  },
  {
    "id": "6e27cc35.c13c74",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1368.004005432129,
    "y": 147.99994778633118,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "e6eb33a1.9cd3b"
      ]
    ]
  },
  {
    "id": "e6eb33a1.9cd3b",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n<parameter name='error-code' value='' />\n<parameter name='error-message' value=\"An error occured while generation allotted resource ID\" />\n",
    "comments": "",
    "x": 1534.0039596557617,
    "y": 147.99996209144592,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "a1d6ff56.9c99d",
    "type": "get-resource",
    "name": "get-resource connection-attachment-allotted-resource",
    "xml": "<get-resource plugin='org.onap.ccsdk.sli.adaptors.resource.mdsal.ConfigResource' resource='GENERIC-RESOURCE-API' key='connection-attachment-allotted-resources/connection-attachment-allotted-resource/$tmp.ar.allotted-resource-id/' pfx='mdsal-ar' >\n",
    "comments": "",
    "outputs": 1,
    "x": 757.00390625,
    "y": 684.7778043746948,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "69156564.0efd4c"
      ]
    ]
  },
  {
    "id": "69156564.0efd4c",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1077.0039863586426,
    "y": 686.7777614593506,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "852fc020.79a93"
      ]
    ]
  },
  {
    "id": "8474d88f.5c62c8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error: Existing connection attachment allotted resource\" />\n    \n",
    "comments": "",
    "x": 1810.5223655700684,
    "y": 687.8438329696655,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "57300b8d.590704",
    "type": "comment",
    "name": "Check for non existence of allotted resource",
    "info": "",
    "comments": "",
    "x": 721.0039443969727,
    "y": 650.7778549194336,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "d079c407.4d6f78",
    "type": "for",
    "name": "for cidx..service-data.consumed-allotted-resources.consumed-allotted-resource[]",
    "xml": "<for index='cidx' start='0' end='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' >\n",
    "comments": "",
    "outputs": 1,
    "x": 1619.6705627441406,
    "y": 883.0000419616699,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "a651bfa.1352c4"
      ]
    ]
  },
  {
    "id": "52744f96.8455f",
    "type": "switchNode",
    "name": "switch service-data.consumed-allotted-resources_length",
    "xml": "<switch test='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 772.6699485778809,
    "y": 843.71404337883,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "8264b400.beda08",
        "7056a183.5603b"
      ]
    ]
  },
  {
    "id": "8264b400.beda08",
    "type": "other",
    "name": "outcome Null",
    "xml": "<outcome value=''>\n",
    "comments": "",
    "outputs": 1,
    "x": 1094.812831878662,
    "y": 846.57146525383,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "11ae1967.44e4c7"
      ]
    ]
  },
  {
    "id": "7056a183.5603b",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1082.8128356933594,
    "y": 889.5714666843414,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "138cce38.a61662"
      ]
    ]
  },
  {
    "id": "138cce38.a61662",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1242.939926147461,
    "y": 887.6974432468414,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "d079c407.4d6f78",
        "1d2e79f7.7a22f6",
        "caba0b91.36a608"
      ]
    ]
  },
  {
    "id": "11ae1967.44e4c7",
    "type": "set",
    "name": "set cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value=\"`0`\" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value=\"1\" />\n\n\n",
    "comments": "",
    "x": 1253.6698036193848,
    "y": 846.2855279445648,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "361e33ee.17369c",
    "type": "set",
    "name": "set consumed allotted resources",
    "xml": "<set>\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource[$tmp.cidx].allotted-resource-pointer' value=\"`$tmp.ar.self-link` \" />\n<parameter name='service-data.consumed-allotted-resources.consumed-allotted-resource_length' value='`$tmp.cidx + 1`' />\n\n",
    "comments": "",
    "x": 698.527229309082,
    "y": 916.2856435775757,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "1d2e79f7.7a22f6",
    "type": "switchNode",
    "name": "switch tmp.found-cidx",
    "xml": "<switch test='`$tmp.found-cidx`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1432.054973602295,
    "y": 919.7089660167694,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "5635489a.7ffbc8"
      ]
    ]
  },
  {
    "id": "5635489a.7ffbc8",
    "type": "outcomeTrue",
    "name": "false",
    "xml": "<outcome value='false'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1622.0549278259277,
    "y": 919.7089030742645,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "66ad5d1b.da3ab4"
      ]
    ]
  },
  {
    "id": "66ad5d1b.da3ab4",
    "type": "block",
    "name": "block : atomic",
    "xml": "<block atomic=\"true\">",
    "atomic": "true",
    "outputs": 1,
    "x": 1788.0549278259277,
    "y": 919.7089030742645,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "f92757e1.e50008"
      ]
    ]
  },
  {
    "id": "a651bfa.1352c4",
    "type": "switchNode",
    "name": "switch allotted-resource-id",
    "xml": "<switch test=\"`$service-data.consumed-allotted-resources.consumed-allotted-resource[$cidx].allotted-resource-id == $tmp.ar.allotted-resource-id`\">\n\n",
    "comments": "",
    "outputs": 1,
    "x": 2093.7820434570312,
    "y": 883.0000257492065,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "54bb5ed6.70da5"
      ]
    ]
  },
  {
    "id": "54bb5ed6.70da5",
    "type": "outcomeTrue",
    "name": "true",
    "xml": "<outcome value='true'>\n",
    "comments": "",
    "outputs": 1,
    "x": 2318.591772079468,
    "y": 885.4644467830658,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "d7b2b6d3.cadeb8"
      ]
    ]
  },
  {
    "id": "f92757e1.e50008",
    "type": "set",
    "name": "set tmp.cidx",
    "xml": "<set>\n<parameter name='tmp.cidx' value='`$service-data.consumed-allotted-resources.consumed-allotted-resource_length`' />\n",
    "comments": "",
    "x": 2033.928274154663,
    "y": 920.2205998897552,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "57bdcf73.d7aa8",
    "type": "comment",
    "name": "Add to consumed service consumed-allotted-resources in mdsal",
    "info": "Prepare data and add to service-data",
    "comments": "",
    "x": 791.6711463928223,
    "y": 772.9999761581421,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "f0cc7d17.67dd7",
    "type": "comment",
    "name": "This set resource will be added to MDSAL by provider code",
    "info": "Below we add to service-data.consumed-allotted-resource at last index",
    "comments": "",
    "x": 774.0040016174316,
    "y": 880.7781000137329,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "b58ada11.db1438",
    "type": "update",
    "name": "update AAI allotted-resource",
    "xml": "<update plugin=\"org.onap.ccsdk.sli.adaptors.aai.AAIService\" \n\t\tresource=\"allotted-resource\" \n\t\tkey=\"customer.global-customer-id = $connection-attachment-topology-operation-input.service-information.global-customer-id AND\n\t\t\tservice-subscription.service-type = $connection-attachment-topology-operation-input.service-information.subscription-service-type AND\n\t\t\tservice-instance.service-instance-id = $connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id AND\n\t\t\tallotted-resource.id = $tmp.ar.allotted-resource-id\"\n        pfx='pfx' local-only='false' force='false'>\n\t<parameter name=\"name\" value=\"`$prop.connection-attachment.sotnVpnName`\" />\n\t<parameter name=\"access-provider-id\" value=\"`$prop.connection-attachment.access-provider-id`\" />\n\t<parameter name=\"access-client-id\" value=\"`$prop.connection-attachment.access-client-id`\" />\n\t<parameter name=\"access-topology-id\" value=\"`$prop.connection-attachment.access-topology-id`\" />\n\t<parameter name=\"access-node-id\" value=\"`$prop.connection-attachment.access-node-id`\" />\n\t<parameter name=\"access-ltp-id\" value=\"`$prop.connection-attachment.access-ltp-id`\" />\t\n\t<parameter name=\"cvlan-tag-entry\" value=\"`$prop.connection-attachment.cVLAN`\" />\n\t<parameter name=\"selflink\" value=\"`$tmp.ar.self-link`\" />\n\t<parameter name=\"model-invariant-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-invariant-uuid`\" />\n\t<parameter name=\"model-version-id\" value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.model-uuid`\" />\n\t<parameter name=\"operational-status\" value=\"Created\" />\n",
    "comments": "",
    "outputs": 1,
    "x": 674.6947441101074,
    "y": 1909.531907916069,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "a1860cc7.e0b1b",
        "e37a2480.b51108"
      ]
    ]
  },
  {
    "id": "a1860cc7.e0b1b",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 930.4566535949707,
    "y": 1892.484411597252,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "3f25cd5e.443c92"
      ]
    ]
  },
  {
    "id": "3f25cd5e.443c92",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"AAI failed\" />\n",
    "comments": "",
    "x": 1096.9805335998535,
    "y": 1904.1034826040268,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "e37a2480.b51108",
    "type": "failure",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 937.5519409179688,
    "y": 1925.2463792562485,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "3f25cd5e.443c92"
      ]
    ]
  },
  {
    "id": "b9aa3657.c52d58",
    "type": "comment",
    "name": "Save Resource to AAI",
    "info": "",
    "comments": "",
    "x": 649.5043678283691,
    "y": 1874.8337998390198,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "af36f779.0f72d8",
    "type": "comment",
    "name": "Set allotted resource type if not sent by SO",
    "info": "",
    "comments": "",
    "x": 728.0038757324219,
    "y": 263.9999933242798,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "1cbd957b.be039b",
    "type": "switchNode",
    "name": "switch allotted-resource-type",
    "xml": "<switch test='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 688.9271774291992,
    "y": 297.56605434417725,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "51e4f8bb.15fd98",
        "9bc5979.dbcfa68"
      ]
    ]
  },
  {
    "id": "51e4f8bb.15fd98",
    "type": "outcome",
    "name": "NULL",
    "xml": "<outcome value=''>",
    "comments": "",
    "outputs": 1,
    "x": 933.9272804260254,
    "y": 268.56605529785156,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "8d4b5605.e44fb8"
      ]
    ]
  },
  {
    "id": "9bc5979.dbcfa68",
    "type": "other",
    "name": "other",
    "xml": "<outcome value='Other'>\n",
    "comments": "",
    "outputs": 1,
    "x": 934.9272003173828,
    "y": 328.5660638809204,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "8168f22d.0df79"
      ]
    ]
  },
  {
    "id": "8168f22d.0df79",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value='`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type`' />\n",
    "comments": "",
    "x": 1166.9271850585938,
    "y": 328.566068649292,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "965843c3.6889f",
    "type": "comment",
    "name": "For storage in AAI connection-attachment-topology",
    "info": "",
    "comments": "",
    "x": 750.0038604736328,
    "y": 388.00001430511475,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "eb60ce1a.0aef2",
    "type": "comment",
    "name": "Obtain different URL, template location etc",
    "info": "For saving resource information to MDSAL & for AAI",
    "comments": "",
    "x": 728.0038566589355,
    "y": 470.88889503479004,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "ef74607d.036b",
    "type": "comment",
    "name": "Used for Put AR by id to MDSAL",
    "info": "",
    "comments": "",
    "x": 692.0038909912109,
    "y": 554.8888864517212,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "dddb900f.8862d",
    "type": "comment",
    "name": "Obtain the last index in services",
    "info": "ServiceData is added by Provider code",
    "comments": "",
    "x": 690.4483680725098,
    "y": 808.8888585567474,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "65b342f3.64d6cc",
    "type": "comment",
    "name": "TODO: Rework after confirmation from AAI",
    "info": "",
    "comments": "",
    "x": 949.8632774353027,
    "y": 1852.4048385620117,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "4298e590.a1603c",
    "type": "set",
    "name": "set output to api handler",
    "xml": "<set>\n<parameter name='allotted-resource-id' value='`$tmp.ar.allotted-resource-id`' />\n<parameter name='connection-attachment-object-path' value=\"`$tmp.ar.self-link`\"/>\n<parameter name='service-object-path' value=\"`'restconf/config/GENERIC-RESOURCE-API:services/service/'\n + $connection-attachment-topology-operation-input.service-information.service-instance-id\n + '/service-data/service-topology/'`\"/>\n \n",
    "comments": "",
    "x": 663.2720336914062,
    "y": 1822.3591704368591,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "d0bb4427.716f08",
    "type": "returnSuccess",
    "name": "return success",
    "xml": "<return status='success'>\n<parameter name=\"ack-final-indicator\" value=\"Y\" />\n<parameter name=\"error-code\" value=\"200\" />\n<parameter name=\"error-message\" value=\"`$error-message`\" />\n",
    "comments": "",
    "x": 632.6851463317871,
    "y": 1956.9750332832336,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "8d4b5605.e44fb8",
    "type": "set",
    "name": "set tmp.ar.allotted-resource-type",
    "xml": "<set>\n<parameter name='tmp.ar.allotted-resource-type' value=\"SOTNAttachmentInstance\" />\n",
    "comments": "",
    "x": 1173.0039672851562,
    "y": 268.999981880188,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "bdd1fffd.ca081",
    "type": "call",
    "name": "call GENERIC-RESOURCE-API:sotn-get-request-input-param",
    "xml": "<call module='GENERIC-RESOURCE-API' rpc='connection-attachment-get-request-input-param' mode='sync' >\n",
    "comments": "",
    "outputs": 1,
    "x": 787.9980621337891,
    "y": 1653.4938340187073,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "e28f7f9f.51996",
    "type": "execute",
    "name": "execute RestApiCallNode - PUT AR by id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.sotn-attachment.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"mdsal-ar\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 723.0041427612305,
    "y": 1694.0000214576721,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "56bb7e95.f927f",
        "74711000.f0575",
        "579344a.ffcc7bc"
      ]
    ]
  },
  {
    "id": "56bb7e95.f927f",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 991.6455192565918,
    "y": 1745.331433199346,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "e2257359.1b116"
      ]
    ]
  },
  {
    "id": "74711000.f0575",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 982.6455688476562,
    "y": 1713.8314589485526,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "e2257359.1b116"
      ]
    ]
  },
  {
    "id": "579344a.ffcc7bc",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 986.3956069946289,
    "y": 1684.1885638237,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "7d6eb53b.d4c13c"
      ]
    ]
  },
  {
    "id": "e2257359.1b116",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1152.395606994629,
    "y": 1714.5814827904105,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "7d6eb53b.d4c13c",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1128.0515747070312,
    "y": 1680.380733013153,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "e6716760.631bc8",
    "type": "execute",
    "name": "execute RestApiCallNode - Update parent provided service AR",
    "xml": "<execute plugin='org.onap.ccsdk.sli.plugins.restapicall.RestapiCallNode' method='sendRequest' >\n    <parameter name='templateFileName' value=\"`$prop.restapi.templateDir + '/' + $prop.restapi.parentsvc.templatefile`\" />\n    <parameter name='restapiUrl' value='`$prop.controller.url + $tmp.parent-ar-url`' />\n    <parameter name='restapiUser' value='`$prop.controller.user`' />\n    <parameter name='restapiPassword' value='`$prop.controller.pwd`' />\n    <parameter name='format' value='json' />\n    <parameter name='httpMethod' value='PUT' />\n    <parameter name=\"responsePrefix\" value=\"parent\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 788.0038719177246,
    "y": 1214.0001440048218,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "f5b61314.7a9ea",
        "7f95a527.cea04c",
        "6554700.9ffd59"
      ]
    ]
  },
  {
    "id": "f5b61314.7a9ea",
    "type": "not-found",
    "name": "not-found",
    "xml": "<outcome value='not-found'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1110.3118896484375,
    "y": 1258.9983615875244,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "adbe2b8f.bcb438"
      ]
    ]
  },
  {
    "id": "7f95a527.cea04c",
    "type": "failure",
    "name": "failure",
    "xml": "<outcome value='failure'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1101.311939239502,
    "y": 1227.498387336731,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "adbe2b8f.bcb438"
      ]
    ]
  },
  {
    "id": "6554700.9ffd59",
    "type": "success",
    "name": "success",
    "xml": "<outcome value='success'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1105.0619773864746,
    "y": 1197.8554922118783,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "f1effaa7.98cb08"
      ]
    ]
  },
  {
    "id": "adbe2b8f.bcb438",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource\" />\n",
    "comments": "",
    "x": 1271.0619773864746,
    "y": 1228.2484111785889,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "f1effaa7.98cb08",
    "type": "block",
    "name": "block",
    "xml": "<block>\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1246.717945098877,
    "y": 1194.0476614013314,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "8ad1638f.48f57",
    "type": "comment",
    "name": "Put the parent allotted resource in mdsal",
    "info": "",
    "comments": "",
    "x": 712.0038070678711,
    "y": 1182.0000429153442,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "272d789b.464298",
    "type": "set",
    "name": "set connection-attachment-ar-identifiers",
    "xml": "<set>\n<parameter name='connection-attachment-ar-identifiers.consuming-service-instance-id' value=\"`$connection-attachment-topology-operation-input.service-information.service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-type' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.allotted-resource-type` \" />\n<parameter name='connection-attachment-ar-identifiers.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n\n",
    "comments": "",
    "x": 712.3609619140625,
    "y": 1416.5716543197632,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "8217a995.1a4f18",
    "type": "set",
    "name": "set ar-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-id' value=\"`$tmp.ar.allotted-resource-id` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.action' value=\"`$connection-attachment-topology-operation-input.request-information.request-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-name' value=\"connection-attachment-topology-operation\" />\n<parameter name='connection-attachment-ar.allotted-resource-status.rpc-action' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.request-information.' value=\"`$connection-attachment-topology-operation-input.request-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.sdnc-request-header.' value=\"`$connection-attachment-topology-operation-input.sdnc-request-header.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.service-information.' value=\"`$connection-attachment-topology-operation-input.service-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.allotted-resource-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.` \" />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-operation-information.connection-attachment-request-input.' value=\"`$connection-attachment-topology-operation-input.connection-attachment-request-input.` \" />",
    "comments": "",
    "x": 623.2177734375,
    "y": 1375.3809804916382,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "de9004ee.8e65a8",
    "type": "set",
    "name": "set identifiers in overall structure",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.allotted-resource-identifiers.' \nvalue=\"`$connection-attachment-ar-identifiers.`\" />\n\n\n",
    "comments": "",
    "x": 689.1707611083984,
    "y": 1458.6668643951416,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "61510de6.6b5a64",
    "type": "execute",
    "name": "execute getTime",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliPluginUtils' method='setTime' >\n    <parameter name=\"outputPath\" value=\"tmp.current-time\" />\n\n",
    "comments": "",
    "outputs": 1,
    "x": 640.5036277770996,
    "y": 1541.0004243850708,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "a9832c0c.edf5c",
    "type": "set",
    "name": "set allotted-resource-oper-status",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.order-status' value='Created' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-action' value='`$connection-attachment-topology-operation-input.request-information.request-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-rpc-action' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-action`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.last-svc-request-id' value='`$connection-attachment-topology-operation-input.sdnc-request-header.svc-request-id`' />\n<parameter name='connection-attachment-ar.allotted-resource-data.allotted-resource-oper-status.create-timestamp' value='`$tmp.current-time`' />\n",
    "comments": "",
    "x": 691.4906883239746,
    "y": 1576.9515752792358,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "fc645855.78a1f8",
    "type": "set",
    "name": "set model-data",
    "xml": "<set>\n<parameter name='connection-attachment-ar.allotted-resource-data.connection-attachment-topology.onap-model-information.' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.onap-model-information.` \" />",
    "comments": "",
    "x": 633.0592803955078,
    "y": 1495.5557231903076,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "e28fb6e1.570bc8",
    "type": "comment",
    "name": "Prepare data for allotted-resource addition to MDSAL",
    "info": "This will add to allotted-resource which is present inside service.",
    "comments": "",
    "x": 750.3927764892578,
    "y": 1335.555583000183,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "908d0f20.3dc3f",
    "type": "execute",
    "name": "generate parent-ar url - replace allotted-resource-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$tmp.parent-ar-url`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{allotted-resource-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.allotted-resource-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 753.5039024353027,
    "y": 1145.0000400543213,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "d5a721b9.32552",
    "type": "execute",
    "name": "generate parent-ar url - replace service-instance-id",
    "xml": "<execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >\n    <parameter name=\"source\" value=\"`$prop.restapi.parent-provided-resource`\"/>\n    <parameter name=\"outputPath\" value=\"tmp.parent-ar-url\"/>\n    <parameter name=\"target\" value=\"{service-instance-id}\"/>\n    <parameter name=\"replacement\" value=\"`$tmp.ar.parent-service-instance-id`\"/>\n",
    "comments": "",
    "outputs": 1,
    "x": 754.5038414001465,
    "y": 1107.0000896453857,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        
      ]
    ]
  },
  {
    "id": "4df22418.3a53fc",
    "type": "comment",
    "name": "Prepare Parent AR URL",
    "info": "Preparation to set provided-allotted-resource in parent service instance",
    "comments": "",
    "x": 661.5042572021484,
    "y": 1035.0000867843628,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "8340ac1e.8db72",
    "type": "set",
    "name": "set tmp.ar.parent-service-instance-id",
    "xml": "<set>\n<parameter name='tmp.ar.parent-service-instance-id' value=\"`$connection-attachment-topology-operation-input.allotted-resource-information.parent-service-instance-id` \" />\n\n",
    "comments": "",
    "x": 706.5040893554688,
    "y": 1071.4999990463257,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "c17a3b14.014a38",
    "type": "comment",
    "name": "Required for filling template values",
    "info": "This is done because connection-attachment is generic resource and doesn't have specific parameters",
    "comments": "",
    "x": 696.0042877197266,
    "y": 1622.4997611045837,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "d7b2b6d3.cadeb8",
    "type": "returnFailure",
    "name": "return failure",
    "xml": "<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error updating md-sal for connection-attachment-allotted-resource as cosumed allotted resource already exists.\" />\n",
    "comments": "",
    "x": 2506.7607421875,
    "y": 883.6458120346069,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "caba0b91.36a608",
    "type": "set",
    "name": "set tmp.found-cidx",
    "xml": "<set>\n<parameter name='tmp.found-cidx' value=\"`false`\" />\n\n\n",
    "comments": "",
    "x": 1422.6500091552734,
    "y": 840.3125638961792,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "88129b22.08bd88",
    "type": "comment",
    "name": "Add to parent services provided-allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 771.2053833007812,
    "y": 995.9792184829712,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "209aa5b9.f006fa",
    "type": "comment",
    "name": "Add to allotted-resources in mdsal",
    "info": "",
    "comments": "",
    "x": 691.9726028442383,
    "y": 1302.9688847064972,
    "z": "27f64d8c.2cf692",
    "wires": [
      
    ]
  },
  {
    "id": "852fc020.79a93",
    "type": "block",
    "name": "block: atomic",
    "xml": "<block atomic=\"true\">\n",
    "atomic": "false",
    "comments": "",
    "outputs": 1,
    "x": 1239.003807067871,
    "y": 686.2776508331299,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "f33868e5.1acfb8"
      ]
    ]
  },
  {
    "id": "f33868e5.1acfb8",
    "type": "switchNode",
    "name": "switch cr length",
    "xml": "<switch test='`$mdsal-ar.connection-attachment-allotted-resource_length`'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1426.8611869812012,
    "y": 686.8967862129211,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "71e1d814.25e938"
      ]
    ]
  },
  {
    "id": "71e1d814.25e938",
    "type": "other",
    "name": "outcome 1",
    "xml": "<outcome value='1'>\n",
    "comments": "",
    "outputs": 1,
    "x": 1626.1943092346191,
    "y": 686.8968648910522,
    "z": "27f64d8c.2cf692",
    "wires": [
      [
        "8474d88f.5c62c8"
      ]
    ]
  }
]
