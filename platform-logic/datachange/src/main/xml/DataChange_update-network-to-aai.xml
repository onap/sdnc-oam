<service-logic
    xmlns='http://www.onap.org/sdnc/svclogic'
    xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.onap.org/sdnc/svclogic ./svclogic.xsd' module='DataChange' version='${project.version}'>
    <method rpc='update-network-to-aai' mode='sync'>
        <block atomic="true">
            <execute plugin='org.onap.ccsdk.sli.core.slipluginutils.SliStringUtils' method='replace' >
                <parameter name="source" value="`$network.network-id`"/>
                <parameter name="outputPath" value="tmp.network-id"/>
                <parameter name="target" value="/"/>
                <parameter name="replacement" value="-"/>
            </execute>
            <save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='zone' 
      key='zone.zone-id = $tmp.network-id' >
                <parameter name='zone-id' value='`$tmp.network-id`' />
                <parameter name='zone-name' value='`$network.client-id`' />
                <parameter name='design-type' value='`$network.te-topology-id`' />
                <parameter name='zone-context' value='`$network.provider-id`' />
            </save>
            <for index='pidx' start='0' end='`$network.node_length`' >
                <set>
                    <parameter name='node.' value='`$network.node[$pidx].`' />
                </set>
                <save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='pnf' 
      key='pnf.pnf-name = $node.node-id' >
                    <parameter name='pnf-name' value='`$node.node-id`' />
                    <parameter name='pnf-id' value='`$node.node-id`' />
                    <parameter name='in-maint' value='true' />
                </save>
                <save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='pnf:relationship-list' 
      key='pnf.pnf-name = $node.node-id' force="true" pfx="tmp.AnAI-data">
                    <parameter name="relationship-list.relationship[0].related-to" value="zone" />
                    <parameter name="relationship-list.relationship[0].related-link" value="`'/network/zones/zone/' + $tmp.network-id`" />
                    <parameter name="relationship-list.relationship[0].relationship-data[0].relationship-key" value="zone.zone-id" />
                    <parameter name="relationship-list.relationship[0].relationship-data[0].relationship-value" value="`$tmp.network-id`" />
                </save>
                <save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='esr-thirdparty-sdnc:relationship-list' 
      key='esr-thirdparty-sdnc.thirdparty-sdnc-id = $prop.sdncRestApi.thirdpartySdnc.id' 
      force="true" pfx="tmp.AnAI-data">
                    <parameter name="relationship-list.relationship[0].related-to" value="pnf" />
                    <parameter name="relationship-list.relationship[0].related-link" value="`'/network/pnfs/pnf/' + $node.node-id`" />
                    <parameter name="relationship-list.relationship[0].relationship-data[0].relationship-key" value="pnf.pnf-name" />
                    <parameter name="relationship-list.relationship[0].relationship-data[0].relationship-value" value="`$node.node-id`" />
                </save>
                <for index='tidx' start='0' end='`$node.termination-point_length`' >
                    <set>
                        <parameter name='tp.' value='`$node.termination-point[$tidx].`' />
                    </set>
                    <set>
                        <parameter name='unique-ltpId' value="`'nodeId-' + $node.node-id + '-ltpId-' + $tp.te-tp-id`" />
                    </set>
                    <save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='logical-link' 
      key='logical-link.link-name = $unique-ltpId' >
                        <parameter name='link-name' value='`$unique-ltpId`' />
                        <parameter name='link-type' value='VL' />
                        <parameter name='speed-value' value='`$tp.te.interface-switching-capability[0].max-lsp-bandwidth[0].te-bandwidth.eth-bandwidth`' />
                        <parameter name='in-maint' value='`$tp.svc.supported-classification.transparent`' />
                    </save>
                    <save plugin='org.onap.ccsdk.sli.adaptors.aai.AAIService' resource='pnf:relationship-list' 
      key='pnf.pnf-name = $node.node-id' force="true" pfx="tmp.AnAI-data">
                        <parameter name="relationship-list.relationship[0].related-to" value="logical-link" />
                        <parameter name="relationship-list.relationship[0].related-link" value="`'/network/logical-links/logical-link/' + $unique-ltpId`" />
                        <parameter name="relationship-list.relationship[0].relationship-data[0].relationship-key" value="logical-link.link-name" />
                        <parameter name="relationship-list.relationship[0].relationship-data[0].relationship-value" value="`$unique-ltpId`" />
                    </save>
                </for>
            </for>
        </block>
    </method>
</service-logic>