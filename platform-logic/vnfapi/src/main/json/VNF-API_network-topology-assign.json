[{"id":"1be403b7.4c9d8c","type":"method","name":"method network-topology-assign","xml":"<method rpc=\"network-topology-assign\" mode=\"sync\">","comments":"","outputs":1,"x":197,"y":92.33332443237305,"z":"5e7ac753.1a69c8","wires":[["a974251c.997798"]]},{"id":"d58e9633.4a3928","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.openecomp.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.openecomp.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":311.4444351196289,"y":41,"z":"5e7ac753.1a69c8","wires":[["1be403b7.4c9d8c"]]},{"id":"43caf76.439a108","type":"dgstart","name":"DGSTART","outputs":1,"x":108.33332061767578,"y":41,"z":"5e7ac753.1a69c8","wires":[["d58e9633.4a3928"]]},{"id":"a974251c.997798","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":162.76110458374023,"y":164.6419334411621,"z":"5e7ac753.1a69c8","wires":[["4d2c2c90.845934","fccd9689.ff0268","fd2ee761.5f1a48","da88fa3e.84c8b8","d932e749.d786a8","17dd050f.1fbb5b","c3848365.cb915","ae858a23.a208a8","2bd5db00.b0d156","da729a0e.a929f8","ae73e4dd.ad4418","5d005c0c.99adf4","a9d6b895.431c88","80107a7.0a78088","60d4552b.c5febc","3038ec1b.9beaf4","21f3c9ca.dec646","4efca0c0.a0ebc","a3108fe8.a39be"]]},{"id":"4d2c2c90.845934","type":"save","name":"save AnAI - l3-network","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network\" \n\t\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\" >\n<!-- Create l3-network object -->\n<parameter name=\"network-id\" value=\"`$tmp.return.generate-l3network-network-id.uuid`\" />\n<parameter name=\"network-name\" value=\"`$network-topology-operation-input.network-request-information.network-name`\" />\n<parameter name=\"network-type\" value=\"`$network-topology-operation-input.network-request-information.network-type`\" />\n<parameter name=\"network-role\" value=\"`$preload-data.network-topology-information.network-topology-identifier.network-role`\" />\n<parameter name=\"network-technology\" value=\"`$preload-data.network-topology-information.network-topology-identifier.network-technology`\" />\n<parameter name=\"service-id\" value=\"`$network-topology-operation-input.service-information.service-id`\" />\n<parameter name=\"tenant-id\" value=\"`$network-topology-operation-input.network-request-information.tenant`\" />\n<parameter name=\"network-role-instance\" value=\"0\" />\n<parameter name=\"orchestration-status\" value=\"pending-create\" />","comments":"","outputs":1,"x":413.1934051513672,"y":457.95962142944336,"z":"5e7ac753.1a69c8","wires":[["c4cd83b2.34d17","b5aee965.ef24e8"]]},{"id":"fccd9689.ff0268","type":"for","name":"for loop i - PRELOAD subnets","xml":"<for index=\"i\" start=\"0\" end=\"`$preload-data.network-topology-information.subnets_length`\">\n","comments":"","outputs":1,"x":434.9034957885742,"y":644.6417112350464,"z":"5e7ac753.1a69c8","wires":[["6e455ccc.f42704"]]},{"id":"fd2ee761.5f1a48","type":"returnSuccess","name":"return success","xml":"<return status=\"success\">\n\t<parameter name=\"networkId\" value=\"`$tmp.return.generate-l3network-network-id.uuid`\" />\n\t<parameter name=\"error-code\" value=\"200\" />","comments":"","x":352.84381103515625,"y":2474.789029121399,"z":"5e7ac753.1a69c8","wires":[]},{"id":"da88fa3e.84c8b8","type":"set","name":"Set final indicator to Y","xml":"<set>\n<parameter name=\"ack-final\" value=\"Y\"/>","comments":"","x":376.12740325927734,"y":2425.8670349121094,"z":"5e7ac753.1a69c8","wires":[]},{"id":"c4cd83b2.34d17","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":605.4765625,"y":457.9749393463135,"z":"5e7ac753.1a69c8","wires":[["f6f8f24.9e2691"]]},{"id":"6e455ccc.f42704","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":649.9021148681641,"y":644.6507225036621,"z":"5e7ac753.1a69c8","wires":[["77bf2764.5bc988","244a5b12.0a4f84","6c524eae.7f366","a4e09f72.41ba1","bcc155b6.53efe8","de2e2b2c.cf1c38"]]},{"id":"f6f8f24.9e2691","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Failed to save l3-netework in AnAI with network-id = ' + $tmp.return.generate-l3network-network-id.uuid`\"/>","comments":"","x":806.254035949707,"y":457.75272369384766,"z":"5e7ac753.1a69c8","wires":[]},{"id":"8b7bbdb2.3667a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1129.2541790008545,"y":872.6139392852783,"z":"5e7ac753.1a69c8","wires":[["17d54e7b.a3b842"]]},{"id":"f41a48f7.825708","type":"set","name":"set tmp.dhcpEnabled.boolean=false","xml":"<set>\n<parameter name=\"tmp.dhcpEnabled.boolean\" value=\"false\" />\n","comments":"","x":1396.9320831298828,"y":686.0012545585632,"z":"5e7ac753.1a69c8","wires":[]},{"id":"9a755b5e.adccd8","type":"set","name":"set tmp.dhcpEnabled.boolean=true","xml":"<set>\n<parameter name=\"tmp.dhcpEnabled.boolean\" value=\"true\" />\n","comments":"","x":1395.2495880126953,"y":644.9377040863037,"z":"5e7ac753.1a69c8","wires":[]},{"id":"77bf2764.5bc988","type":"switchNode","name":"switch: PRELOAD dhcp-enabled","xml":"<switch test=\"`$preload-data.network-topology-information.subnets[$i].dhcp-enabled`\">","comments":"","outputs":1,"x":921.2495880126953,"y":644.4439296722412,"z":"5e7ac753.1a69c8","wires":[["ef3455ec.64b5b8","850d6626.c25ff8"]]},{"id":"ef3455ec.64b5b8","type":"other","name":"Y","xml":"<outcome value='Y'>","comments":"","outputs":1,"x":1178.4719314575195,"y":644.6662502288818,"z":"5e7ac753.1a69c8","wires":[["9a755b5e.adccd8"]]},{"id":"850d6626.c25ff8","type":"other","name":"N","xml":"<outcome value='N'>","comments":"","outputs":1,"x":1178.3766021728516,"y":686.5074715614319,"z":"5e7ac753.1a69c8","wires":[["f41a48f7.825708"]]},{"id":"d932e749.d786a8","type":"for","name":"for loop i - PRELOAD vpn-bindings","xml":"<for index=\"i\" start=\"0\" end=\"`$preload-data.network-topology-information.vpn-bindings_length`\">\n","comments":"","outputs":1,"x":447.5514221191406,"y":1156.9841957092285,"z":"5e7ac753.1a69c8","wires":[["6ec409d0.f66d58"]]},{"id":"6ec409d0.f66d58","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":689.3292007446289,"y":1157.2341976165771,"z":"5e7ac753.1a69c8","wires":[["94c10e0b.45e07","6bd642fa.ac2a7c","2366054c.d70cba","3f3dcc32.bb7cb4"]]},{"id":"1e9dae26.946722","type":"save","name":"save relationship: vpn_bindings","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network:relationship-list\" \n\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"vpn-binding\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"vpn-binding.vpn-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.vpn-binding-id`\" />","comments":"","outputs":1,"x":1030.856918334961,"y":1382.206425666809,"z":"5e7ac753.1a69c8","wires":[["cf31989.d56ed68","3c2e0d4e.85d0f2","879b64f.533a898"]]},{"id":"2bd5db00.b0d156","type":"call","name":"call: generate-l3network-network-id","xml":"<call module=\"VNF-API\" rpc=\"generate-l3network-network-id\" mode=\"sync\" >\n","comments":"","outputs":1,"x":451.26195526123047,"y":411.5237674713135,"z":"5e7ac753.1a69c8","wires":[["ad56adc4.89ba1"]]},{"id":"ad56adc4.89ba1","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":674.0119400024414,"y":411.7737579345703,"z":"5e7ac753.1a69c8","wires":[["6d605de5.f8ece4"]]},{"id":"6d605de5.f8ece4","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value='Error in generating l3-network.network-id in SDNC'/>","comments":"","x":830.7894134521484,"y":411.5515422821045,"z":"5e7ac753.1a69c8","wires":[]},{"id":"17dd050f.1fbb5b","type":"switchNode","name":"switch ... PRELOAD vpn-bindings[]","xml":"<switch test=\"`$preload-data.network-topology-information.vpn-bindings_length`\">","comments":"","outputs":1,"x":447.92886522081153,"y":1113.5655091603599,"z":"5e7ac753.1a69c8","wires":[["39aa5e22.39cc22"]]},{"id":"39aa5e22.39cc22","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":668.3733155992295,"y":1113.343244870504,"z":"5e7ac753.1a69c8","wires":[["d5662975.895318"]]},{"id":"d5662975.895318","type":"set","name":"set vpn-bindings[] = 0","xml":"<set>\n<parameter name=\"preload-data.network-topology-information.vpn-bindings_length\" value=\"0\" />\n","comments":"","x":862.9289245605469,"y":1113.3432655334473,"z":"5e7ac753.1a69c8","wires":[]},{"id":"ae858a23.a208a8","type":"switchNode","name":"switch ... PRELOAD network-policy[]","xml":"<switch test=\"`$preload-data.network-topology-information.network-policy_length`\">","comments":"","outputs":1,"x":429.0991668701172,"y":1526.8336772918701,"z":"5e7ac753.1a69c8","wires":[["75849b95.f28d94"]]},{"id":"75849b95.f28d94","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":658.5436172485352,"y":1526.6114130020142,"z":"5e7ac753.1a69c8","wires":[["2cae4b3a.39a5d4"]]},{"id":"2cae4b3a.39a5d4","type":"set","name":"set network-policy[] = 0","xml":"<set>\n<parameter name='preload-data.network-topology-information.network-policy_length' value='0' />\n","comments":"","x":853.0992262098525,"y":1526.6114336649575,"z":"5e7ac753.1a69c8","wires":[]},{"id":"244a5b12.0a4f84","type":"switchNode","name":"switch test: PRELOAD gateway-address","xml":"<switch test=\"`$preload-data.network-topology-information.subnets[$i].gateway-address`\">","comments":"","outputs":1,"x":945.646915435791,"y":739.4166431427002,"z":"5e7ac753.1a69c8","wires":[["32f6488c.4831f8"]]},{"id":"32f6488c.4831f8","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":1189.146915435791,"y":739.4166431427002,"z":"5e7ac753.1a69c8","wires":[["eeffe078.a5877"]]},{"id":"eaab7197.47d38","type":"GenericXML","name":"Execute: generate gateway-address","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.ipAddressTools.IpAddressTool\" method=\"getGatewayAddress\">\n\t<parameter name=\"ipAddress\" value=\"`$preload-data.network-topology-information.subnets[$i].start-address`\" />\n\t<parameter name=\"ipVersion\" value=\"`$preload-data.network-topology-information.subnets[$i].ip-version`\" />\n\t<parameter name=\"subnet\" value=\"`$preload-data.network-topology-information.subnets[$i].cidr-mask`\" />\n\t<parameter name=\"ctxVariable\" value=\"tmp.return.generate.gateway-address\" />","comments":"","outputs":1,"x":1586.39693069458,"y":739.1666507720947,"z":"5e7ac753.1a69c8","wires":[[]]},{"id":"eeffe078.a5877","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1339.8969230651855,"y":739.4166536331177,"z":"5e7ac753.1a69c8","wires":[["eaab7197.47d38","10a08514.cbc4fb"]]},{"id":"6c524eae.7f366","type":"set","name":"set tmp.gateway-address","xml":"<set>\n<parameter name=\"tmp.gateway-address\" value=\"`$preload-data.network-topology-information.subnets[$i].gateway-address`\" />\n","comments":"","x":899.1469306945801,"y":692.6666498184204,"z":"5e7ac753.1a69c8","wires":[]},{"id":"10a08514.cbc4fb","type":"set","name":"set tmp.gateway-address","xml":"<set>\n<parameter name=\"tmp.gateway-address\" value=\"`$tmp.return.generate.gateway-address`\" />\n","comments":"","x":1552.89693069458,"y":781.1666526794434,"z":"5e7ac753.1a69c8","wires":[]},{"id":"94c10e0b.45e07","type":"switchNode","name":"switch: PRELOAD route-target != NULL","xml":"<switch test=\"`$preload-data.network-topology-information.vpn-bindings[$i].global-route-target != ''`\" >","comments":"","outputs":1,"x":952.5635833740234,"y":1248.5834999084473,"z":"5e7ac753.1a69c8","wires":[["c43dd87a.b89e88"]]},{"id":"c43dd87a.b89e88","type":"other","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1189.0635833740234,"y":1248.8334999084473,"z":"5e7ac753.1a69c8","wires":[["59402546.79876c"]]},{"id":"59402546.79876c","type":"save","name":"query AnAI - vpn-bindings","xml":"<get-resource plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vpn-binding\" \n\t\tkey=\"vpn-binding.global-route-target = $preload-data.network-topology-information.vpn-bindings[$i].global-route-target\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.AnAI.vpn-binding\">","comments":"","outputs":1,"x":1388.5635795593262,"y":1248.5835008621216,"z":"5e7ac753.1a69c8","wires":[["2d34ec2a.5c1ee4","bca01d00.ffb24","adee1dd3.33618"]]},{"id":"2d34ec2a.5c1ee4","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1598.8135795593262,"y":1328.833501815796,"z":"5e7ac753.1a69c8","wires":[["b115d161.c84b3"]]},{"id":"17d54e7b.a3b842","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1328.6470069885254,"y":872.250057220459,"z":"5e7ac753.1a69c8","wires":[["bb999697.5d1fd8","11afb062.01345"]]},{"id":"bb999697.5d1fd8","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'An error occurred while saving l3-newtork.subnet in AnAI where subnet-id = ' + $tmp.return.generate-subnets-subnet-id.uuid`\"/>","comments":"","x":1530.7465476989746,"y":871.9999561309814,"z":"5e7ac753.1a69c8","wires":[]},{"id":"cfa6c945.5b33f8","type":"delete","name":"delete l3-network","xml":"<delete plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network\" \n\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\">","comments":"","outputs":1,"x":1502.530288696289,"y":2287.7963523864746,"z":"5e7ac753.1a69c8","wires":[[]]},{"id":"be6db5e.3aea048","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Error writing to l3-netework - ' + $tmp.error-message`\"/>","comments":"","x":1489.4676208496094,"y":2330.9923963546753,"z":"5e7ac753.1a69c8","wires":[]},{"id":"bca01d00.ffb24","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1604.3135833740234,"y":1288.3335008621216,"z":"5e7ac753.1a69c8","wires":[["b115d161.c84b3"]]},{"id":"11afb062.01345","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1312.7065505981445,"y":2288.0479412078857,"z":"5e7ac753.1a69c8","wires":[["cfa6c945.5b33f8","be6db5e.3aea048"]]},{"id":"b115d161.c84b3","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1751.8135833740234,"y":1328.5835027694702,"z":"5e7ac753.1a69c8","wires":[["9f92a3f9.4fc9c","11afb062.01345"]]},{"id":"9f92a3f9.4fc9c","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'Failed to query vpn-bindings from AnAI where global-route-target = ' + $preload-data.network-topology-information.vpn-bindings[$i].global-route-target`\"/>","comments":"","x":1973.9131240844727,"y":1328.3334016799927,"z":"5e7ac753.1a69c8","wires":[]},{"id":"6bd642fa.ac2a7c","type":"switchNode","name":"switch: PRELOAD vpn-binding-id","xml":"<switch test=\"`$preload-data.network-topology-information.vpn-bindings[$i].vpn-binding-id`\">","comments":"","outputs":1,"x":932.8135871887207,"y":1204.0834398269653,"z":"5e7ac753.1a69c8","wires":[["d63b81e7.6ddd2"]]},{"id":"d63b81e7.6ddd2","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":1146.3135948181152,"y":1203.8334407806396,"z":"5e7ac753.1a69c8","wires":[["8f15b549.d82488"]]},{"id":"8f15b549.d82488","type":"set","name":"set tmp.vpn-binding-id","xml":"<set>\n<parameter name=\"tmp.vpn-binding-id\" value=\"`$preload-data.network-topology-information.vpn-bindings[$i].vpn-binding-id`\" />\n","comments":"","x":1328.8135948181152,"y":1203.833441734314,"z":"5e7ac753.1a69c8","wires":[]},{"id":"adee1dd3.33618","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1599.8135795593262,"y":1248.5835008621216,"z":"5e7ac753.1a69c8","wires":[["4ea0558a.a0cfec"]]},{"id":"3588708b.50ad8","type":"set","name":"set tmp.vpn-binding-id","xml":"<set>\n<parameter name=\"tmp.vpn-binding-id\" value=\"`$tmp.AnAI.vpn-binding.vpn-id`\" />\n","comments":"","x":2254.0636291503906,"y":1247.3335762023926,"z":"5e7ac753.1a69c8","wires":[]},{"id":"cf31989.d56ed68","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1255.9297943115234,"y":1381.6820125579834,"z":"5e7ac753.1a69c8","wires":[["1123384a.ad6e98"]]},{"id":"1123384a.ad6e98","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1443.8226737976074,"y":1381.3181200027466,"z":"5e7ac753.1a69c8","wires":[["872d7f01.7c137","11afb062.01345"]]},{"id":"872d7f01.7c137","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'An error occurred while saving vpn-binding relationship for l3-network in AnAI where vpn-id = ' + $tmp.vpn-binding-id`\"/>","comments":"","x":1656.9222145080566,"y":1382.068018913269,"z":"5e7ac753.1a69c8","wires":[]},{"id":"c3848365.cb915","type":"for","name":"for loop i - PRELOAD network-policy","xml":"<for index=\"i\" start=\"0\" end=\"`$preload-data.network-topology-information.network-policy_length`\">\n","comments":"","outputs":1,"x":428.45642852783203,"y":1572.405068397522,"z":"5e7ac753.1a69c8","wires":[["a820990b.39f2f8"]]},{"id":"e44f2fb5.002ff","type":"save","name":"save relationship: network-policy","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network:relationship-list\" \n\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\" >\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"network-policy\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"network-policy.network-policy-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.AnAI.network-policy.network-policy-id`\" />","comments":"","outputs":1,"x":2245.0121154785156,"y":1704.8773336410522,"z":"5e7ac753.1a69c8","wires":[["26055fbf.cc62e","b755c526.9a9478"]]},{"id":"a820990b.39f2f8","type":"switchNode","name":"switch: PRELOAD network-policy-fqdn != NULL","xml":"<switch test=\"`$preload-data.network-topology-information.network-policy[$i].network-policy-fqdn != ''`\">","comments":"","outputs":1,"x":784.7186872694228,"y":1572.754326502482,"z":"5e7ac753.1a69c8","wires":[["c422d808.0a38a8"]]},{"id":"c422d808.0a38a8","type":"other","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1050.4686872694228,"y":1573.004326502482,"z":"5e7ac753.1a69c8","wires":[["4a83c0a7.921b4"]]},{"id":"4a83c0a7.921b4","type":"save","name":"query AnAI - network-policy","xml":"<get-resource plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"network-policy\" \n\t\tkey=\"network-policy.network-policy-fqdn = $preload-data.network-topology-information.network-policy[$i].network-policy-fqdn\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.AnAI.network-policy\">","comments":"","outputs":1,"x":1259.71869108412,"y":1573.004326502482,"z":"5e7ac753.1a69c8","wires":[["2acb8dc6.483832","7c26032e.349d9c","de4b860d.f91ff8"]]},{"id":"2acb8dc6.483832","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1467.71877500746,"y":1614.004336039225,"z":"5e7ac753.1a69c8","wires":[["3742003e.1cb29"]]},{"id":"7c26032e.349d9c","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1473.2187788221572,"y":1572.5043350855508,"z":"5e7ac753.1a69c8","wires":[["3742003e.1cb29"]]},{"id":"3742003e.1cb29","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1637.7187788221572,"y":1613.7543369928994,"z":"5e7ac753.1a69c8","wires":[["38034efd.b57de2","11afb062.01345"]]},{"id":"38034efd.b57de2","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'Failed to query network-policy n AnAI where network-policy-fqdn = ' + $preload-data.network-topology-information.network-policy[$i].network-policy-fqdn`\"/>","comments":"","x":1846.8183195326064,"y":1613.5042359034219,"z":"5e7ac753.1a69c8","wires":[]},{"id":"26055fbf.cc62e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2468.084991455078,"y":1704.3529205322266,"z":"5e7ac753.1a69c8","wires":[["6bd3792d.e43d18"]]},{"id":"6bd3792d.e43d18","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2647.977870941162,"y":1703.9890279769897,"z":"5e7ac753.1a69c8","wires":[["58be926b.04054c","11afb062.01345"]]},{"id":"58be926b.04054c","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'An error occurred while saving network-policy relationship for l3-network in AnAI where network-policy-id = ' + $tmp.AnAI.network-policy.network-policy-id`\"/>","comments":"","x":2871.0774116516113,"y":1704.7389268875122,"z":"5e7ac753.1a69c8","wires":[]},{"id":"a4e09f72.41ba1","type":"call","name":"call: generate-subnets-subnet-id","xml":"<call module=\"VNF-API\" rpc=\"generate-subnets-subnet-id\" mode=\"sync\" >\n","comments":"","outputs":1,"x":918.7618713378906,"y":826.2737922668457,"z":"5e7ac753.1a69c8","wires":[["6c3c9e3c.c782d"]]},{"id":"6c3c9e3c.c782d","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1216.5118560791016,"y":826.5237827301025,"z":"5e7ac753.1a69c8","wires":[["11afb062.01345"]]},{"id":"da729a0e.a929f8","type":"save","name":"save relationship: tenant and cloud-region","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network:relationship-list\" \n\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t<!-- create relationship-list -->\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"tenant\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"cloud-region.cloud-owner\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"att-aic\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-key\" value=\"cloud-region.cloud-region-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-value\" value=\"`$network-topology-operation-input.network-request-information.aic-cloud-region`\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-key\" value=\"tenant.tenant-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-value\" value=\"`$network-topology-operation-input.network-request-information.tenant`\" />\n\t<parameter name=\"relationship-list.relationship[1].related-to\" value=\"cloud-region\" />\n\t<parameter name=\"relationship-list.relationship[1].relationship-data[0].relationship-key\" value=\"cloud-region.cloud-owner\" />\n\t<parameter name=\"relationship-list.relationship[1].relationship-data[0].relationship-value\" value=\"att-aic\" />\n\t<parameter name=\"relationship-list.relationship[1].relationship-data[1].relationship-key\" value=\"cloud-region.cloud-region-id\" />\n\t<parameter name=\"relationship-list.relationship[1].relationship-data[1].relationship-value\" value=\"`$network-topology-operation-input.network-request-information.aic-cloud-region`\" />","comments":"","outputs":1,"x":472.5635681152344,"y":957.4999885559082,"z":"5e7ac753.1a69c8","wires":[["638ffd96.c71a54","1bf3566f.f410fa"]]},{"id":"638ffd96.c71a54","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":720.5635681152344,"y":957.4999885559082,"z":"5e7ac753.1a69c8","wires":[["2caa050c.a4381a"]]},{"id":"2caa050c.a4381a","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":908.9563961029053,"y":957.1361064910889,"z":"5e7ac753.1a69c8","wires":[["a77786b2.abde68","11afb062.01345"]]},{"id":"a77786b2.abde68","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'An error occurred while saving tenant and clould-region relationship for l3-network in AnAI where network-id = ' + $tmp.return.generate-l3network-network-id.uuid`\"/>","comments":"","x":1113.0559368133545,"y":956.8860054016113,"z":"5e7ac753.1a69c8","wires":[]},{"id":"2366054c.d70cba","type":"switchNode","name":"switch: tmp.vpn-binding-id != NULL","xml":"<switch test=\"`$tmp.vpn-binding-id != ''`\">","comments":"","outputs":1,"x":939.8135833740234,"y":1295.5000038146973,"z":"5e7ac753.1a69c8","wires":[["c60e2f66.8ca0d"]]},{"id":"c60e2f66.8ca0d","type":"other","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1159.5635681152344,"y":1295.4999885559082,"z":"5e7ac753.1a69c8","wires":[["1e9dae26.946722"]]},{"id":"bcc155b6.53efe8","type":"set","name":"set tmp.local.network-id","xml":"<set>\n<parameter name=\"tmp.local.network-id\" value=\"`$tmp.return.generate-l3network-network-id.uuid`\" />\n","comments":"","x":894.5714569091797,"y":782.7618865966797,"z":"5e7ac753.1a69c8","wires":[]},{"id":"de2e2b2c.cf1c38","type":"save","name":"save AnAI - l3-network.subnets","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"subnet\" \n\t\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid \n\t\t\tAND subnet.subnet-id = $tmp.return.generate-subnets-subnet-id.uuid\" >\n<!-- Create l3-network object -->\n<parameter name=\"network-id\" value=\"`$tmp.return.generate-l3network-network-id.uuid`\" />\n<parameter name=\"subnet-id\" value=\"`$tmp.return.generate-subnets-subnet-id.uuid`\" />\n<parameter name=\"subnet-name\" value=\"`$preload-data.network-topology-information.subnets[$i].subnet-name`\" />\n<parameter name=\"gateway-address\" value=\"`$tmp.gateway-address`\" />\n<parameter name=\"network-start-address\" value=\"`$preload-data.network-topology-information.subnets[$i].start-address`\" />\n<parameter name=\"cidr-mask\" value=\"`$preload-data.network-topology-information.subnets[$i].cidr-mask`\" />\n<parameter name=\"ip-version\" value=\"`$preload-data.network-topology-information.subnets[$i].ip-version`\" />\n<parameter name=\"dhcp-start\" value=\"`$preload-data.network-topology-information.subnets[$i].dhcp-start-address`\" />\n<parameter name=\"dhcp-end\" value=\"`$preload-data.network-topology-information.subnets[$i].dhcp-end-address`\" />\n<parameter name=\"dhcp-enabled\" value=\"`$tmp.dhcpEnabled.boolean`\" />\n\t\t<parameter name=\"orchestration-status\" value=\"pending-create\" />","comments":"","outputs":1,"x":917.6379051208496,"y":872.2654361724854,"z":"5e7ac753.1a69c8","wires":[["8b7bbdb2.3667a","2d4ce6cf.dc6e2a"]]},{"id":"ae73e4dd.ad4418","type":"save","name":"get AnAI - l3-network by name","xml":"<get-resource plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network\" \n\t\tkey=\"l3-network.network-name = $network-topology-operation-input.network-request-information.network-name\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.AnAI.l3network.existed\">\n\n","comments":"","outputs":1,"x":435,"y":258.1904716491699,"z":"5e7ac753.1a69c8","wires":[["8b2db8e.b770448","b371b281.2cbc"]]},{"id":"8b2db8e.b770448","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":661.25,"y":300.4405326843262,"z":"5e7ac753.1a69c8","wires":[["11369d3c.558ad3"]]},{"id":"fdcf1ec5.22c65","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value=\"`'An error occurred while querying whether l3-network with network-name = ' + $network-topology-operation-input.network-request-information.network-name + ' already exists in AnAI'`\"/>\n","comments":"","x":809.7457580566406,"y":258.6586284637451,"z":"5e7ac753.1a69c8","wires":[]},{"id":"b371b281.2cbc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":656.5235358344185,"y":258.6586284637451,"z":"5e7ac753.1a69c8","wires":[["fdcf1ec5.22c65"]]},{"id":"11369d3c.558ad3","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n<parameter name='error-code' value='500' />\n<parameter name='error-message' value=\"`'A l3-network with network-name = ' + $network-topology-operation-input.network-request-information.network-name + ' already existed in AnAI with network-id = ' + $tmp.AnAI.l3network.existed.network-id`\"  />\n","comments":"","x":812.4286193847656,"y":300.1904716491699,"z":"5e7ac753.1a69c8","wires":[]},{"id":"5d005c0c.99adf4","type":"set","name":"set: tmp.error-message to \"\"","xml":"<set>\n\t<parameter name=\"tmp.error-message\" value=\"\"/>","comments":"","x":428.5714111328125,"y":366.4404716491699,"z":"5e7ac753.1a69c8","wires":[]},{"id":"3f3dcc32.bb7cb4","type":"set","name":"unset tmp.vpn-binding-id","xml":"<set>\n<parameter name=\"tmp.vpn-binding-id\" value=\"\" />\n","comments":"","x":906.8888931274414,"y":1157.7777733802795,"z":"5e7ac753.1a69c8","wires":[]},{"id":"de4b860d.f91ff8","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1470.24998304579,"y":1658.3334089914956,"z":"5e7ac753.1a69c8","wires":[["f97a6acb.d31d18"]]},{"id":"3c2e0d4e.85d0f2","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1259.5872650146484,"y":1468.5396785736084,"z":"5e7ac753.1a69c8","wires":[["c7ee4f1e.b938a"]]},{"id":"c7ee4f1e.b938a","type":"set","name":"set tmp.is-bound-to-vpn","xml":"<set>\n<parameter name=\"tmp.is-bound-to-vpn\" value=\"true\" />\n","comments":"","x":1450.0872650146484,"y":1468.5396785736084,"z":"5e7ac753.1a69c8","wires":[]},{"id":"49268281.5989dc","type":"save","name":"update AnAI - l3-network","xml":"<update plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network\" \n\t\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\" >\n<parameter name=\"is-bound-to-vpn\" value=\"true\" />","comments":"","outputs":1,"x":632.3016128540039,"y":1959.9684228897095,"z":"5e7ac753.1a69c8","wires":[["bf0dfb8c.1a3198","71158112.ddc36"]]},{"id":"bf0dfb8c.1a3198","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":828.5847702026367,"y":1959.9837408065796,"z":"5e7ac753.1a69c8","wires":[["61955ec8.f6635"]]},{"id":"a9d6b895.431c88","type":"switchNode","name":"switch ... tmp.is-bound-to-vpn","xml":"<switch test=\"`$tmp.is-bound-to-vpn`\">","comments":"","outputs":1,"x":401.44444274902344,"y":1895.1112651824951,"z":"5e7ac753.1a69c8","wires":[["2c9b879d.728598"]]},{"id":"2c9b879d.728598","type":"outcome","name":"true","xml":"<outcome value=\"true\">","comments":"","outputs":1,"x":620.8888931274414,"y":1894.8890008926392,"z":"5e7ac753.1a69c8","wires":[["49268281.5989dc"]]},{"id":"61955ec8.f6635","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1040.694450378418,"y":1960.3612670898438,"z":"5e7ac753.1a69c8","wires":[["2b231df7.2652d2","11afb062.01345"]]},{"id":"2b231df7.2652d2","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'An error occurred while updating l3-network is-bound-to-vpn in AnAI where network-id = ' + $tmp.return.generate-l3network-network-id.uuid`\"/>","comments":"","x":1259.194435119629,"y":1960.1112451553345,"z":"5e7ac753.1a69c8","wires":[]},{"id":"b5aee965.ef24e8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":613.5714111328125,"y":501.3333110809326,"z":"5e7ac753.1a69c8","wires":[["f6f8f24.9e2691"]]},{"id":"2d4ce6cf.dc6e2a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1137.5714111328125,"y":913.3333110809326,"z":"5e7ac753.1a69c8","wires":[["17d54e7b.a3b842"]]},{"id":"1bf3566f.f410fa","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":728.5714111328125,"y":999.3333110809326,"z":"5e7ac753.1a69c8","wires":[["2caa050c.a4381a"]]},{"id":"879b64f.533a898","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1264.0157318115234,"y":1424.3332843780518,"z":"5e7ac753.1a69c8","wires":[["1123384a.ad6e98"]]},{"id":"71158112.ddc36","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":836.071403503418,"y":2001.0833902359009,"z":"5e7ac753.1a69c8","wires":[["61955ec8.f6635"]]},{"id":"b755c526.9a9478","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2475.8214433458115,"y":1746.8334449132285,"z":"5e7ac753.1a69c8","wires":[["6bd3792d.e43d18"]]},{"id":"4ea0558a.a0cfec","type":"switchNode","name":"switch: tmp.AnAI.vpn-binding.vpn-id","xml":"<switch test=\"`$tmp.AnAI.vpn-binding.vpn-id`\" >","comments":"","outputs":1,"x":1807.8214416503906,"y":1248.0833282470703,"z":"5e7ac753.1a69c8","wires":[["c5076877.da25e8","9fb779d8.46a118"]]},{"id":"9a21ffe3.c74dc","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2230.5714416503906,"y":1287.0833282470703,"z":"5e7ac753.1a69c8","wires":[["1d2af710.f65bd9","11afb062.01345"]]},{"id":"9fb779d8.46a118","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2065.5714416503906,"y":1287.5833282470703,"z":"5e7ac753.1a69c8","wires":[["9a21ffe3.c74dc"]]},{"id":"c5076877.da25e8","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2065.5714111328125,"y":1247.5833110809326,"z":"5e7ac753.1a69c8","wires":[["3588708b.50ad8"]]},{"id":"1d2af710.f65bd9","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'Failed to query vpn-bindings from AnAI where global-route-target = ' + $preload-data.network-topology-information.vpn-bindings[$i].global-route-target + '. It is likely that the same global-route-target points to more than one vpn-binding objects in AnAI.'`\"/>","comments":"","x":2446.0714111328125,"y":1287.0833110809326,"z":"5e7ac753.1a69c8","wires":[]},{"id":"f97a6acb.d31d18","type":"switchNode","name":"switch: tmp.AnAI.network-policy.network-policy-id","xml":"<switch test=\"`$tmp.AnAI.network-policy.network-policy-id`\" >","comments":"","outputs":1,"x":1748.3292541503906,"y":1657.8332662582397,"z":"5e7ac753.1a69c8","wires":[["b115a5ac.642828","8913df90.96a2a"]]},{"id":"b115a5ac.642828","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2022.0792541503906,"y":1657.3332662582397,"z":"5e7ac753.1a69c8","wires":[["259880c.5cc928"]]},{"id":"259880c.5cc928","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2187.0792541503906,"y":1656.8332662582397,"z":"5e7ac753.1a69c8","wires":[["11afb062.01345","9dfb3550.adbb28"]]},{"id":"d25ebc32.47eb5","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'Failed to query route-table-reference from AnAI where route-table-reference-fqdn = ' + $preload-data.network-topology-information.route-table-reference[$i].route-table-reference-fqdn + '. It is likely that the same route-table-reference-fqdn points to more than one route-table-reference objects in AnAI.'`\"/>","comments":"","x":2613.912660386827,"y":1855.1665128072104,"z":"5e7ac753.1a69c8","wires":[]},{"id":"8913df90.96a2a","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2021.5714111328125,"y":1704.5833644866943,"z":"5e7ac753.1a69c8","wires":[["e44f2fb5.002ff"]]},{"id":"80107a7.0a78088","type":"save","name":"update AnAI - l3-network.provider-network-information","xml":"<update plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network\" \n\t\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\" >\n<parameter name=\"physical-network-name\" value=\"`$preload-data.network-topology-information.provider-network-information.physical-network-name`\" />\n<parameter name=\"is-provider-network\" value=\"`$preload-data.network-topology-information.provider-network-information.is-provider-network`\" />\n<parameter name=\"is-shared-network\" value=\"`$preload-data.network-topology-information.provider-network-information.is-shared-network`\" />\n<parameter name=\"is-external-network\" value=\"`$preload-data.network-topology-information.provider-network-information.is-external-network`\" />","comments":"","outputs":1,"x":511.74998474121094,"y":545.0833187103271,"z":"5e7ac753.1a69c8","wires":[["e6669941.ad67f8","27e04ca8.429dc4"]]},{"id":"e6669941.ad67f8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":825.2831344604492,"y":545.0986375808716,"z":"5e7ac753.1a69c8","wires":[["a364ab69.a64d28"]]},{"id":"a364ab69.a64d28","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1037.3928146362305,"y":545.4761638641357,"z":"5e7ac753.1a69c8","wires":[["5f504738.eed7b8","11afb062.01345"]]},{"id":"5f504738.eed7b8","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'An error occurred while updating l3-network with provider-network-information in AnAI where network-id = ' + $tmp.return.generate-l3network-network-id.uuid`\"/>","comments":"","x":1255.8927993774414,"y":545.2261419296265,"z":"5e7ac753.1a69c8","wires":[]},{"id":"27e04ca8.429dc4","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":832.7697677612305,"y":586.1982870101929,"z":"5e7ac753.1a69c8","wires":[["a364ab69.a64d28"]]},{"id":"60d4552b.c5febc","type":"switchNode","name":"switch ... PRELOAD route-table-reference[]","xml":"<switch test=\"`$preload-data.network-topology-information.route-table-reference_length`\">","comments":"","outputs":1,"x":446.74998474121094,"y":1725.3333110809326,"z":"5e7ac753.1a69c8","wires":[["a548d11f.c82b7"]]},{"id":"a548d11f.c82b7","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":702.1944351196289,"y":1725.1110467910767,"z":"5e7ac753.1a69c8","wires":[["c47c86f7.ef2e68"]]},{"id":"c47c86f7.ef2e68","type":"set","name":"set route-table-reference[] = 0","xml":"<set>\n<parameter name='preload-data.network-topology-information.route-table-reference_length' value='0' />\n","comments":"","x":907.7500440809463,"y":1725.11106745402,"z":"5e7ac753.1a69c8","wires":[]},{"id":"3038ec1b.9beaf4","type":"for","name":"for loop i - PRELOAD route-table-reference","xml":"<for index=\"i\" start=\"0\" end=\"`$preload-data.network-topology-information.route-table-reference_length`\">\n","comments":"","outputs":1,"x":445.1072463989258,"y":1772.9047021865845,"z":"5e7ac753.1a69c8","wires":[["716ff972.73e1f8"]]},{"id":"e79b18fb.9cd7e8","type":"save","name":"save relationship: route-table-reference","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network:relationship-list\" \n\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\" >\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"route-table-reference\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"route-table-reference.route-table-reference-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.AnAI.route-table-reference.route-table-reference-id`\" />","comments":"","outputs":1,"x":2431.9962632921006,"y":1904.710291226705,"z":"5e7ac753.1a69c8","wires":[["8d28a854.eb5de8","53e05753.711888"]]},{"id":"716ff972.73e1f8","type":"switchNode","name":"switch: PRELOAD network-policy-fqdn != NULL","xml":"<switch test=\"`$preload-data.network-topology-information.route-table-reference[$i].route-table-reference-fqdn != ''`\">","comments":"","outputs":1,"x":830.7028350830078,"y":1772.5872840881348,"z":"5e7ac753.1a69c8","wires":[["9adf5422.a0dcb8"]]},{"id":"9adf5422.a0dcb8","type":"other","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1096.4528350830078,"y":1772.8372840881348,"z":"5e7ac753.1a69c8","wires":[["3dd549e8.05aa86"]]},{"id":"3dd549e8.05aa86","type":"save","name":"query AnAI - route-table-reference","xml":"<get-resource plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"route-table-reference\" \n\t\tkey=\"route-table-reference.route-table-reference-fqdn = $preload-data.network-topology-information.route-table-reference[$i].route-table-reference-fqdn\" \n\t\tpfx=\"tmp.AnAI.route-table-reference\">","comments":"","outputs":1,"x":1325.702838897705,"y":1772.8372840881348,"z":"5e7ac753.1a69c8","wires":[["e6c0e874.bfaa48","c729dc0.7892828","d2111a55.d55418"]]},{"id":"e6c0e874.bfaa48","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1551.702922821045,"y":1813.837293624878,"z":"5e7ac753.1a69c8","wires":[["a95a9517.ebb038"]]},{"id":"c729dc0.7892828","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1557.2029266357422,"y":1772.3372926712036,"z":"5e7ac753.1a69c8","wires":[["a95a9517.ebb038"]]},{"id":"a95a9517.ebb038","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1721.7029266357422,"y":1813.5872945785522,"z":"5e7ac753.1a69c8","wires":[["df5c0786.7a1598"]]},{"id":"df5c0786.7a1598","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'Failed to query network-policy n AnAI where network-policy-fqdn = ' + $preload-data.network-topology-information.network-policy[$i].network-policy-fqdn`\"/>","comments":"","x":1930.8024673461914,"y":1813.3371934890747,"z":"5e7ac753.1a69c8","wires":[]},{"id":"8d28a854.eb5de8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2687.069139268663,"y":1904.1858781178794,"z":"5e7ac753.1a69c8","wires":[["ec1c3f79.9a318"]]},{"id":"ec1c3f79.9a318","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2866.962018754747,"y":1903.8219855626426,"z":"5e7ac753.1a69c8","wires":[["97f8478c.c02a98","11afb062.01345"]]},{"id":"97f8478c.c02a98","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'An error occurred while saving route-table-reference relationship for l3-network in AnAI where route-table-reference-id = ' + $tmp.AnAI.route-table-reference.route-table-reference-id`\"/>","comments":"","x":3091.061586168077,"y":1903.571908315023,"z":"5e7ac753.1a69c8","wires":[]},{"id":"d2111a55.d55418","type":"success","name":"success","xml":"<outcome value='success'>\n","comments":"","outputs":1,"x":1554.234130859375,"y":1858.1663665771484,"z":"5e7ac753.1a69c8","wires":[["74ec0ddb.f884c4"]]},{"id":"53e05753.711888","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2694.8055911593965,"y":1946.6664024988813,"z":"5e7ac753.1a69c8","wires":[["ec1c3f79.9a318"]]},{"id":"74ec0ddb.f884c4","type":"switchNode","name":"switch: tmp.AnAI.route-table-reference.route-table-reference-id","xml":"<switch test=\"`$tmp.AnAI.route-table-reference.route-table-reference-id`\" >","comments":"","outputs":1,"x":1872.3134019639756,"y":1857.6662238438926,"z":"5e7ac753.1a69c8","wires":[["7f438338.855e6c","dd81f314.94918"]]},{"id":"7f438338.855e6c","type":"other","name":"NULL","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":2199.0634019639756,"y":1857.1662238438926,"z":"5e7ac753.1a69c8","wires":[["3641dbaf.966bc4"]]},{"id":"3641dbaf.966bc4","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":2364.0634019639756,"y":1856.6662238438926,"z":"5e7ac753.1a69c8","wires":[["d25ebc32.47eb5"]]},{"id":"9dfb3550.adbb28","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'Failed to query newtork-policy from AnAI where network-policy-fqdn = ' + $preload-data.network-topology-information.network-policy[$i].network-policy-fqdn + '. It is likely that the same network-policy-fqdn points to more than one network-policy objects in AnAI.'`\"/>","comments":"","x":2432.229965209961,"y":1656.3328227996826,"z":"5e7ac753.1a69c8","wires":[]},{"id":"dd81f314.94918","type":"other","name":"other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2198.5555589463975,"y":1904.4163220723472,"z":"5e7ac753.1a69c8","wires":[["e79b18fb.9cd7e8"]]},{"id":"21f3c9ca.dec646","type":"save","name":"save relationship: service-instance","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"l3-network:relationship-list\" \n\tkey=\"l3-network.network-id = $tmp.return.generate-l3network-network-id.uuid\" >\n<parameter name=\"relationship-list.relationship[0].related-to\" value=\"service-instance\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"customer.global-customer-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$network-topology-operation-input.service-information.subscriber-name`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-key\" value=\"service-subscription.service-type\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[1].relationship-value\" value=\"`$network-topology-operation-input.service-information.service-type`\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-key\" value=\"service-instance.service-instance-id\" />\n<parameter name=\"relationship-list.relationship[0].relationship-data[2].relationship-value\" value=\"`$network-topology-operation-input.service-information.service-instance-id`\" />","comments":"","outputs":1,"x":426.74998474121094,"y":2096.3333110809326,"z":"5e7ac753.1a69c8","wires":[["2b015eb4.9184d2","7f011831.26e6c8"]]},{"id":"2b015eb4.9184d2","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":681.8228607177734,"y":2095.808897972107,"z":"5e7ac753.1a69c8","wires":[["8c0b8508.eb0e48"]]},{"id":"8c0b8508.eb0e48","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":861.7157402038574,"y":2095.44500541687,"z":"5e7ac753.1a69c8","wires":[["e4334b0b.186fd8","11afb062.01345"]]},{"id":"e4334b0b.186fd8","type":"set","name":"set: tmp.error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"tmp.error-message\" value=\"`'An error occurred while saving service-instance relationship for l3-network in AnAI where service-instance-id = ' + $network-topology-operation-input.service-information.service-instance-id`\"/>","comments":"","x":1099.8153076171875,"y":2095.1949281692505,"z":"5e7ac753.1a69c8","wires":[]},{"id":"7f011831.26e6c8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":689.5593126085068,"y":2138.289422353109,"z":"5e7ac753.1a69c8","wires":[["8c0b8508.eb0e48"]]},{"id":"a3108fe8.a39be","type":"switchNode","name":"switch: INPUT service-type","xml":"<switch test=\"`$network-topology-operation-input.service-information.service-type`\">","comments":"","outputs":1,"x":424.75,"y":164.33332443237305,"z":"5e7ac753.1a69c8","wires":[["95125723.f86028"]]},{"id":"95125723.f86028","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":630.75,"y":164.33332443237305,"z":"5e7ac753.1a69c8","wires":[["4587ebb6.834c74"]]},{"id":"4587ebb6.834c74","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value='service-type, aka AnAI subscription-service-type, is required.'/>","comments":"","x":788.75,"y":164.33332443237305,"z":"5e7ac753.1a69c8","wires":[]},{"id":"4efca0c0.a0ebc","type":"switchNode","name":"switch: INPUT subscriber-name","xml":"<switch test=\"`$network-topology-operation-input.service-information.subscriber-name`\">","comments":"","outputs":1,"x":438.75,"y":210.33332443237305,"z":"5e7ac753.1a69c8","wires":[["72610038.0a101"]]},{"id":"72610038.0a101","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":660.75,"y":210.33332443237305,"z":"5e7ac753.1a69c8","wires":[["6557e284.28167c"]]},{"id":"6557e284.28167c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value='subscriber-name, aka AnAI global-customer-id, is required.'/>","comments":"","x":818.75,"y":210.33332443237305,"z":"5e7ac753.1a69c8","wires":[]}]