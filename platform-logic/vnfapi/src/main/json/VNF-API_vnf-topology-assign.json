[{"id":"c959d5b4.c16908","type":"dgstart","name":"DGSTART","outputs":1,"x":93.33333587646484,"y":81.24999809265137,"z":"62eb248d.22b9ac","wires":[["9e40a2a9.87ce1"]]},{"id":"9e40a2a9.87ce1","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.openecomp.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.openecomp.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":303.6666564941406,"y":81.25000381469727,"z":"62eb248d.22b9ac","wires":[["89d9f27a.62c46"]]},{"id":"89d9f27a.62c46","type":"method","name":"method vnf-topology-assign","xml":"<method rpc='vnf-topology-assign' mode='sync'>\n","comments":"","outputs":1,"x":187.83334350585938,"y":146.25,"z":"62eb248d.22b9ac","wires":[["b58ae71b.dd39b8"]]},{"id":"71ad7efe.359f7","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":821.0833587646484,"y":376.60714530944824,"z":"62eb248d.22b9ac","wires":[["40cd1a55.56d044","3f0ca80f.84ec48","22847c32.e15f84","9a13b5f.7c94c48","16daee5e.f1ff02"]]},{"id":"68bf5663.26b918","type":"comment","name":"request-action = VNFActivateRequest","info":"","comments":"","x":177.33333587646484,"y":41.24999809265137,"z":"62eb248d.22b9ac","wires":[]},{"id":"f00bfb49.2b14a8","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1384.083366394043,"y":636.6071462631226,"z":"62eb248d.22b9ac","wires":[["877f4ac4.667118"]]},{"id":"ffe89ed6.ffbdc","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"Encountered error while updating vf-module orchestration-status in AnAI\"/>","comments":"","x":1762.583366394043,"y":636.6071462631226,"z":"62eb248d.22b9ac","wires":[]},{"id":"973c6ef0.18a2a","type":"save","name":"save relationship: l3-network","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id`\" />","comments":"","outputs":1,"x":1412.083366394043,"y":516.6071462631226,"z":"62eb248d.22b9ac","wires":[["23880d8.38edef2"]]},{"id":"23880d8.38edef2","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1384.083366394043,"y":556.6071462631226,"z":"62eb248d.22b9ac","wires":[["ae5dd1f.b4bfb3"]]},{"id":"40cd1a55.56d044","type":"for","name":"for i : SERVICE_DATA vnf-networks","xml":"<for index=\"i\" start=\"0\" end=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":1094.083366394043,"y":516.6071462631226,"z":"62eb248d.22b9ac","wires":[["973c6ef0.18a2a"]]},{"id":"c7a8fedf.81fe","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Encountered error while saving vf-module l3-network relationship in AnAI with network-id = ' + $service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id`\"/>","comments":"","x":1762.583366394043,"y":596.6071462631226,"z":"62eb248d.22b9ac","wires":[]},{"id":"ae5dd1f.b4bfb3","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1546.083366394043,"y":556.6071462631226,"z":"62eb248d.22b9ac","wires":[["5270f231.f242dc","c7a8fedf.81fe"]]},{"id":"5270f231.f242dc","type":"save","name":"delete vf-module: l3-network relationship","xml":"<delete plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id \n\t\tAND related-to = l3-network\" \n\tforce=\"true\" \n\tlocal-only=\"false\">","comments":"","outputs":1,"x":1849.583366394043,"y":556.6071462631226,"z":"62eb248d.22b9ac","wires":[[]]},{"id":"3f0ca80f.84ec48","type":"save","name":"update AnAI - vf-module.orchestration-status","xml":"<update plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" >\n\t<parameter name=\"orchestration-status\" value=\"pending-create\" />","comments":"","outputs":1,"x":1122.583366394043,"y":636.6071462631226,"z":"62eb248d.22b9ac","wires":[["f00bfb49.2b14a8","4cd5a943.0a1f88"]]},{"id":"877f4ac4.667118","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1543.583366394043,"y":636.6071462631226,"z":"62eb248d.22b9ac","wires":[["ffe89ed6.ffbdc","5270f231.f242dc"]]},{"id":"22847c32.e15f84","type":"call","name":"call: vnf-topology-assign-vfmodule","xml":"<call module='VNF-API' rpc='vnf-topology-assign-vfmodule' mode='sync' >","comments":"","outputs":1,"x":1088.583366394043,"y":436.60714626312256,"z":"62eb248d.22b9ac","wires":[[]]},{"id":"9a13b5f.7c94c48","type":"switchNode","name":"switch ...SERVICE-DATA vnf-networks[]","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":1106.583366394043,"y":476.60714626312256,"z":"62eb248d.22b9ac","wires":[["1ce018f9.7b2407"]]},{"id":"1ce018f9.7b2407","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":1344.083366394043,"y":476.60714626312256,"z":"62eb248d.22b9ac","wires":[["2887229.ae37fde"]]},{"id":"2887229.ae37fde","type":"set","name":"set SERVICE-DATA vnf-networks[] = 0","xml":"<set>\n<parameter name='service-data.vnf-topology-information.vnf-assignments.vnf-networks_length' value='0' />\n","comments":"","x":1582.083366394043,"y":476.60714626312256,"z":"62eb248d.22b9ac","wires":[]},{"id":"16daee5e.f1ff02","type":"save","name":"GET AnAI - vf-module","xml":"<get-resource plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.AnAI.vfmodule\" >","comments":"","outputs":1,"x":1051.583366394043,"y":376.60714626312256,"z":"62eb248d.22b9ac","wires":[["fff53f4.b369bc","390bd382.7e8b2c"]]},{"id":"fff53f4.b369bc","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1284.083366394043,"y":356.60714626312256,"z":"62eb248d.22b9ac","wires":[["ce498c47.eaaf8"]]},{"id":"390bd382.7e8b2c","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1292.583366394043,"y":396.60714626312256,"z":"62eb248d.22b9ac","wires":[["d823a091.32962"]]},{"id":"ce498c47.eaaf8","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Encountered error while querying vf-module from AnAI with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\"/>","comments":"","x":1482.583366394043,"y":356.60714626312256,"z":"62eb248d.22b9ac","wires":[]},{"id":"d823a091.32962","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'vf-module not found in AnAI with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\"/>","comments":"","x":1482.583366394043,"y":396.60714626312256,"z":"62eb248d.22b9ac","wires":[]},{"id":"d801828a.169a6","type":"switchNode","name":"switch:vnf-id | config == input","xml":"<switch test=\"`$vnf-topology-operation-input.vnf-request-information.vnf-id == $service-data.vnf-id`\">","comments":"","outputs":1,"x":442.3094940185547,"y":204.1071605682373,"z":"62eb248d.22b9ac","wires":[["96b606fe.6e1e18","f4fc3ea.0faf2c"]]},{"id":"f43fcfd1.a499d","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value='vnf-id is already present in config-tree'/>","comments":"","x":1297.226203918457,"y":203.85715198516846,"z":"62eb248d.22b9ac","wires":[]},{"id":"96b606fe.6e1e18","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":655.4761810302734,"y":204.10714721679688,"z":"62eb248d.22b9ac","wires":[["743cbf1a.5fc23"]]},{"id":"33fc7861.9c1698","type":"other","name":"false","xml":"<outcome value='false'>","comments":"","outputs":1,"x":1130.2261810302734,"y":203.60714721679688,"z":"62eb248d.22b9ac","wires":[["f43fcfd1.a499d"]]},{"id":"743cbf1a.5fc23","type":"switchNode","name":"switch: order-status = PendingDelete","xml":"<switch test=\"`$service-data.oper-status.order-status == PendingDelete`\">","comments":"","outputs":1,"x":890.4090805053711,"y":203.9069480895996,"z":"62eb248d.22b9ac","wires":[["33fc7861.9c1698","1a39df08.fb28f1"]]},{"id":"14cd6eca.4005c1","type":"comment","name":"Soft Delete will have PendingDelete status","info":"","comments":"","x":886.7261962890625,"y":159.10715055465698,"z":"62eb248d.22b9ac","wires":[]},{"id":"1a39df08.fb28f1","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":1132.9761810302734,"y":250.35714721679688,"z":"62eb248d.22b9ac","wires":[["22f347f9.eab868"]]},{"id":"b58ae71b.dd39b8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":196.22618103027344,"y":203.60714721679688,"z":"62eb248d.22b9ac","wires":[["d801828a.169a6","65d7d6d1.202118","609b207e.21dfb","98298e32.46522"]]},{"id":"f4fc3ea.0faf2c","type":"other","name":"false","xml":"<outcome value='false'>","comments":"","outputs":1,"x":655.9761810302734,"y":246.60714721679688,"z":"62eb248d.22b9ac","wires":[["71ad7efe.359f7"]]},{"id":"4cd5a943.0a1f88","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1392.0833435058594,"y":679.1071395874023,"z":"62eb248d.22b9ac","wires":[["877f4ac4.667118"]]},{"id":"cd179f1f.67e9e","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1652.9762115478516,"y":250.35716247558594,"z":"62eb248d.22b9ac","wires":[["a855c507.8700e8"]]},{"id":"f82c8369.2ea55","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"Encountered error while updating vf-module orchestration-status in AnAI during soft delete\"/>","comments":"","x":2003.4762115478516,"y":250.35716247558594,"z":"62eb248d.22b9ac","wires":[]},{"id":"22f347f9.eab868","type":"save","name":"update AnAI - vf-module.orchestration-status","xml":"<update plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" >\n\t<parameter name=\"orchestration-status\" value=\"pending-create\" />","comments":"","outputs":1,"x":1391.4762115478516,"y":250.35716247558594,"z":"62eb248d.22b9ac","wires":[["cd179f1f.67e9e","583609a5.8e5768"]]},{"id":"a855c507.8700e8","type":"block","name":"block: atomic","xml":"<block atomic=\"true\">\n","atomic":"false","comments":"","outputs":1,"x":1832.4762115478516,"y":250.35716247558594,"z":"62eb248d.22b9ac","wires":[["f82c8369.2ea55"]]},{"id":"583609a5.8e5768","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1660.976188659668,"y":292.8571557998657,"z":"62eb248d.22b9ac","wires":[["a855c507.8700e8"]]},{"id":"65d7d6d1.202118","type":"set","name":"set: order-status = PendingCreate","xml":"<set>\n\t<parameter name=\"service-data.oper-status.order-status\" value=\"PendingCreate\"/>","comments":"","x":456.5833435058594,"y":796.4286184310913,"z":"62eb248d.22b9ac","wires":[]},{"id":"98298e32.46522","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"200\" />","comments":"","x":396.5833435058594,"y":876.4286184310913,"z":"62eb248d.22b9ac","wires":[]},{"id":"609b207e.21dfb","type":"set","name":"Set final indicator to Y","xml":"<set>\n<parameter name=\"ack-final\" value=\"Y\"/>","comments":"","x":418.5833435058594,"y":836.4286184310913,"z":"62eb248d.22b9ac","wires":[]}]