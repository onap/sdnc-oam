[{"id":"1fcfd81d.cbf2a8","type":"dgstart","name":"DGSTART","outputs":1,"x":175.71429443359375,"y":51.42857360839844,"z":"8e0bf5da.783678","wires":[["98dec9f9.c3a0e8"]]},{"id":"98dec9f9.c3a0e8","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.openecomp.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.openecomp.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":386.00001525878906,"y":51.607147216796875,"z":"8e0bf5da.783678","wires":[["646940d7.235c8"]]},{"id":"646940d7.235c8","type":"method","name":"method generate-FQPN","xml":"<method rpc='generate-FQPN' mode='sync'>\n","comments":"","outputs":1,"x":242.03571319580078,"y":99.80555534362793,"z":"8e0bf5da.783678","wires":[["becbaa25.ef2478"]]},{"id":"becbaa25.ef2478","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","comments":"","outputs":1,"x":246.10717010498047,"y":151.46431636810303,"z":"8e0bf5da.783678","wires":[["d589d1c5.caf49","4f52e397.0107fc","4dd17123.1daef","3abe12b8.2974be","2f0a99a4.db08e6"]]},{"id":"e580ad14.0bce5","type":"execute","name":"call EIPAM getPlanTopology","xml":"<execute plugin=\"com.att.sdnctl.sli.plugin.eipam.EIPAMPlugin\" method=\"getPlanTopology\">","comments":"","outputs":1,"x":973.7144012451172,"y":996.2222499847412,"z":"8e0bf5da.783678","wires":[["c4572152.7ab64"]]},{"id":"c4572152.7ab64","type":"failure","name":"failure","xml":"<outcome value='failure'>","outputs":1,"x":1189.095458984375,"y":995.9488830566406,"z":"8e0bf5da.783678","wires":[["2ad7117b.f6e14e"]]},{"id":"2ad7117b.f6e14e","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"`'An error occured while getting Keyname and Keyvalue for address plan, '+ $eipam-ip-block.planName + ', from EIPAM'`\" />\n","comments":"","x":1344.9882049560547,"y":996.0561122894287,"z":"8e0bf5da.783678","wires":[]},{"id":"e2fdb772.ac8308","type":"switchNode","name":"switch: TopologyDetails_length","xml":"<switch test='`$eipam-ip-block.getPlanTopologyResponse.TopologyDetails_length`'>\n","comments":"","outputs":1,"x":981.7659759521484,"y":1047.86110496521,"z":"8e0bf5da.783678","wires":[["d412be4d.55601"]]},{"id":"d412be4d.55601","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":1201.0833587646484,"y":1047.861116886139,"z":"8e0bf5da.783678","wires":[["aa6f28b0.046038"]]},{"id":"e7f15e16.18ca4","type":"for","name":"for resp-index: getPlanTopologyResponse.TopologyDetails[]","xml":"<for index=\"resp-index\" start=\"0\" end=\"`$eipam-ip-block.getPlanTopologyResponse.TopologyDetails_length`\">","comments":"","outputs":1,"x":1612.7817459106445,"y":1145.3094692230225,"z":"8e0bf5da.783678","wires":[["8f9774e6.381948"]]},{"id":"831826e4.390168","type":"switchNode","name":"switch: ADDRESS_PLAN_POLICIES.key-value-source","xml":"<switch test='`$db.address-plan-policies.key-value-source`'>\n","comments":"","outputs":1,"x":2316.500160217285,"y":1407.154757976532,"z":"8e0bf5da.783678","wires":[["34d77906.7fe676","e48e8bb9.bff8d8","67a328f3.485f68","2fd02977.ce4296","dc5e9df2.409ab","aa3d8604.9546e8","c7b5b959.ec0218","2acb07cf.ad09e8"]]},{"id":"b9bf31b9.00df3","type":"get-resource","name":"get-resource ADDRESS_PLAN_POLICIES","xml":"<get-resource plugin='org.openecomp.sdnc.sli.resource.sql.SqlResource' resource='SQL'\n  key='SELECT key_value_source from ADDRESS_PLAN_POLICIES WHERE key_name = $eipam-ip-block.getPlanTopologyResponse.TopologyDetails[$resp-index].KeyName '\n  pfx='db.address-plan-policies'>\n\n","comments":"","outputs":1,"x":2275.3653106689453,"y":1256.3810362815857,"z":"8e0bf5da.783678","wires":[["3828438a.28657c","8325f707.9b75c8"]]},{"id":"3b4149e5.9f4586","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No ADDRESS_PLAN_POLICIES entry found for key_name = ' + $eipam-ip-block.getPlanTopologyResponse.TopologyDetails[$key-index].KeyName`\" />\n","comments":"","x":2716.793731689453,"y":1280.8095088005066,"z":"8e0bf5da.783678","wires":[]},{"id":"3828438a.28657c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2541.1510009765625,"y":1236.7618670463562,"z":"8e0bf5da.783678","wires":[["32ec0231.bb6ebe"]]},{"id":"8325f707.9b75c8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2549.7224311828613,"y":1281.047580242157,"z":"8e0bf5da.783678","wires":[["3b4149e5.9f4586"]]},{"id":"32ec0231.bb6ebe","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading ADDRESS_PLAN_POLICIES table\" />\n","comments":"","x":2716.1509323120117,"y":1235.9047675132751,"z":"8e0bf5da.783678","wires":[]},{"id":"34d77906.7fe676","type":"outcome","name":"AddressPlanPolicyDG-Routing_Characteristic","xml":"<outcome value='AddressPlanPolicyDG-Routing_Characteristic'>\n","comments":"","outputs":1,"x":2743.250129699707,"y":1407.1547560691833,"z":"8e0bf5da.783678","wires":[["314b7457.c23fbc"]]},{"id":"e48e8bb9.bff8d8","type":"outcome","name":"AddressPlanPolicyDG-Location_Clli8","xml":"<outcome value='AddressPlanPolicyDG-Location_Clli8'>\n","comments":"","outputs":1,"x":2718.50008392334,"y":1726.793595790863,"z":"8e0bf5da.783678","wires":[["b23801bc.a2068"]]},{"id":"aa3d8604.9546e8","type":"outcome","name":"AddressPlanPolicyDG-Complex_region","xml":"<outcome value='AddressPlanPolicyDG-Complex_region'>\n","comments":"","outputs":1,"x":2723.97225189209,"y":1954.349148273468,"z":"8e0bf5da.783678","wires":[["44e59f53.ac28"]]},{"id":"67a328f3.485f68","type":"outcome","name":"AddressPlanPolicyDG-Vrf_Name","xml":"<outcome value='AddressPlanPolicyDG-Vrf_Name'>\n","comments":"","outputs":1,"x":2704.3888931274414,"y":1832.73806142807,"z":"8e0bf5da.783678","wires":[["312506a7.37958a"]]},{"id":"dc5e9df2.409ab","type":"outcome","name":"AddressPlanPolicyDG-Network_Name","xml":"<outcome value='AddressPlanPolicyDG-Network_Name'>\n","comments":"","outputs":1,"x":2721.972267150879,"y":2012.599148273468,"z":"8e0bf5da.783678","wires":[["e4c41a1d.72f548"]]},{"id":"2fd02977.ce4296","type":"outcome","name":"vnf-topology-operation-input.vnf-request-information.aic-cloud-region","xml":"<outcome value='vnf-topology-operation-input.vnf-request-information.aic-cloud-region'>\n","comments":"","outputs":1,"x":2815.472267150879,"y":1897.0991463661194,"z":"8e0bf5da.783678","wires":[["6c28119e.837a8"]]},{"id":"8aadd854.3594b8","type":"get-resource","name":"get-resource ROUTING_CHARACTERISTIC_MAPPING","xml":"<get-resource plugin='org.openecomp.sdnc.sli.resource.sql.SqlResource' resource='SQL'\n  key='SELECT * from ROUTING_CHARACTERISTIC_MAPPING WHERE network_role = $eipam-ip-block.plans[$plan-index].network-role '\n  pfx='db.routing-characteristic_mapping[]'>\n\n","comments":"","outputs":1,"x":3362.833564758301,"y":1407.0714058876038,"z":"8e0bf5da.783678","wires":[["2774b3fc.e29d3c","17b95b59.2532e5"]]},{"id":"b4f1b593.627a38","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'No ROUTING_CHARACTERISTIC_MAPPING entry found for network_role = ' + $generate-fqpn-input.network-role`\" />\n","comments":"","x":3845.5119705200195,"y":1430.2498707771301,"z":"8e0bf5da.783678","wires":[]},{"id":"2774b3fc.e29d3c","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":3669.869239807129,"y":1386.2022290229797,"z":"8e0bf5da.783678","wires":[["788b2d1c.4be054"]]},{"id":"17b95b59.2532e5","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":3678.4406700134277,"y":1430.4879422187805,"z":"8e0bf5da.783678","wires":[["b4f1b593.627a38"]]},{"id":"788b2d1c.4be054","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error reading ROUTING_CHARACTERISTIC_MAPPING table\" />\n","comments":"","x":3844.869171142578,"y":1386.3451294898987,"z":"8e0bf5da.783678","wires":[]},{"id":"9fc2a582.2b11d8","type":"switchNode","name":"switch: db.routing-characteristic_mapping_length > 1","xml":"<switch test='`$db.routing-characteristic_mapping_length &gt; 1`'>\n","comments":"","outputs":1,"x":3351.5835189819336,"y":1481.5714058876038,"z":"8e0bf5da.783678","wires":[["ed6fbcc1.814fd","10a8f584.5b564a"]]},{"id":"859944b9.374468","type":"switchNode","name":"switch: db | input - vrf-name","xml":"<switch test='`$db.routing-characteristic_mapping[$routing-index].vrf-name == $eipam-ip-block.plans[$plan-index].vrf-name`'>\n","comments":"","outputs":1,"x":4355.583595275879,"y":1482.071427822113,"z":"8e0bf5da.783678","wires":[["46275f9.12904a"]]},{"id":"959f9053.77a9d","type":"for","name":"for : db.routing-characteristic_mapping[]","xml":"<for index=\"routing-index\" start=\"0\" end=\"`$db.routing-characteristic_mapping_length`\">","comments":"","outputs":1,"x":4043.3335876464844,"y":1482.3214221000671,"z":"8e0bf5da.783678","wires":[["859944b9.374468"]]},{"id":"e63907a9.e64748","type":"comment","name":"Required INPUTS","info":"generate-FQPN-input.vf-module-name\n - to build client-key\ngenerate-FQPN-input.aic-cloud-region\n - to get aic-clli and complex.region from AAI\neipam-ip-block.plans_length\neipam-ip-block.plans[].plan-name\neipam-ip-block.plans[].address-family\neipam-ip-block.plans[].requests_length\neipam-ip-block.plans[].vm-type\neipam-ip-block.plans[].network-role\neipam-ip-block.plans[].l3-network.","comments":"","x":660.6627349853516,"y":56.90480899810791,"z":"8e0bf5da.783678","wires":[]},{"id":"ed6fbcc1.814fd","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":3650.3335342407227,"y":1482.0714077949524,"z":"8e0bf5da.783678","wires":[["d110ecd0.69bff"]]},{"id":"46275f9.12904a","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>\n","comments":"","outputs":1,"x":4567.083572387695,"y":1482.0714201927185,"z":"8e0bf5da.783678","wires":[["a8365f78.742e7"]]},{"id":"8a1ac713.4bd018","type":"set","name":"set tmp.key-value = -1","xml":"<set>\n<parameter name='tmp.key-value' value='-1' />\n","comments":"","x":3256.5597381591797,"y":1351.452389240265,"z":"8e0bf5da.783678","wires":[]},{"id":"212530be.34aca","type":"set","name":"set tmp.key-value","xml":"<set>\n<parameter name='tmp.key-value' value='`$db.routing-characteristic_mapping[$routing-index].routing-characteristic`' />\n","comments":"","x":4932.278018951416,"y":1481.5713478194343,"z":"8e0bf5da.783678","wires":[]},{"id":"313dd6cf.a70f7a","type":"switchNode","name":"switch: tmp.key-value","xml":"<switch test='`$tmp.key-value`'>\n","comments":"","outputs":1,"x":3252.119384765625,"y":1638.6863751411438,"z":"8e0bf5da.783678","wires":[["f475d6bc.dad188"]]},{"id":"f475d6bc.dad188","type":"outcomeTrue","name":"-1","xml":"<outcome value='-1'>\n","comments":"","outputs":1,"x":3474.869384765625,"y":1638.9363751411438,"z":"8e0bf5da.783678","wires":[["8cf463ab.8fe61"]]},{"id":"8cf463ab.8fe61","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"No matching ROUTING_CHARACTERISTIC_MAPPING.vrf-name found\" />\n","comments":"","x":3634.369384765625,"y":1638.6863751411438,"z":"8e0bf5da.783678","wires":[]},{"id":"49fa72d8.e5689c","type":"comment","name":"db.address-plan-policies","info":"","comments":"","x":1915.1153717041016,"y":1262.519937992096,"z":"8e0bf5da.783678","wires":[]},{"id":"314b7457.c23fbc","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":3022.0002670288086,"y":1407.3214039802551,"z":"8e0bf5da.783678","wires":[["8aadd854.3594b8","9fc2a582.2b11d8","313dd6cf.a70f7a","8a1ac713.4bd018"]]},{"id":"4f180cea.c45c74","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1502.1985664367676,"y":487.4007959365845,"z":"8e0bf5da.783678","wires":[["95d8e315.01191"]]},{"id":"95d8e315.01191","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving cloud region from AAI\" />\n","comments":"","x":1677.1985397338867,"y":487.4008321762085,"z":"8e0bf5da.783678","wires":[]},{"id":"3b4ad59d.1bf8ea","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1511.1271629333496,"y":438.6865291595459,"z":"8e0bf5da.783678","wires":[["15c284ea.7478bb"]]},{"id":"15c284ea.7478bb","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"404\" />\n    <parameter name=\"error-message\" value=\"`'aic-cloud-region, '+ $generate-fqpn-input.aic-cloud-region + ' not found in AAI'`\" />\n","comments":"","x":1677.4764404296875,"y":437.9921064376831,"z":"8e0bf5da.783678","wires":[]},{"id":"b0674fac.2f0be","type":"for","name":"for relationship list","xml":"<for index='ridx' start='0' end='`$aai.cloud-region.relationship-list.relationship_length`' >\n","comments":"","outputs":1,"x":1242.928581237793,"y":678.5070552825928,"z":"8e0bf5da.783678","wires":[["b3389bd9.e9f258"]]},{"id":"118fa4e3.dbc59b","type":"get-resource","name":"get-resource: AAI cloud region","xml":"<get-resource plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"cloud-region\" \n\t\tkey=\"cloud-region.cloud-owner = 'att-aic' AND \n\t\t     cloud-region.cloud-region-id = $generate-FQPN-input.aic-cloud-region \n\t\t     AND depth = '0'\"\n        pfx='aai.cloud-region' >\n\n","comments":"","outputs":1,"x":1282.7023582458496,"y":461.4999485015869,"z":"8e0bf5da.783678","wires":[["3b4ad59d.1bf8ea","4f180cea.c45c74"]]},{"id":"a88778c0.f5fb88","type":"execute","name":"substring aic-clli to 8 chars","xml":"<execute plugin='org.openecomp.sdnc.sli.SliPluginUtils.SliStringUtils' method='substring'>\n   <parameter name='result' value='tmp.truncated.clli8' />\n   <parameter name='string' value='`$tmp.aic-clli`' />\n   <parameter name='begin-index' value='0' />\n   <parameter name='end-index' value='8' />\n","comments":"","outputs":1,"x":3180.694534301758,"y":1725.7659249305725,"z":"8e0bf5da.783678","wires":[[]]},{"id":"aa6f28b0.046038","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"eipam-ip-block.getPlanTopologyResponse.TopologyDetails is null\" />\n","comments":"","x":1361.0000305175781,"y":1047.9722156524658,"z":"8e0bf5da.783678","wires":[]},{"id":"4dd17123.1daef","type":"switchNode","name":"switch: generate-FQPN-input.vf-module-id","xml":"<switch test='`$generate-FQPN-input.vf-module-id`'>\n","comments":"","outputs":1,"x":561.4643402099609,"y":243.46427059173584,"z":"8e0bf5da.783678","wires":[["b6dcee5.eaec01"]]},{"id":"b6dcee5.eaec01","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":848.9643478393555,"y":242.96427059173584,"z":"8e0bf5da.783678","wires":[["de000e37.3e3cb"]]},{"id":"de000e37.3e3cb","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"generate-FQPN-input.vf-module-id is null\" />\n","comments":"","x":1010.8810195922852,"y":243.07536935806274,"z":"8e0bf5da.783678","wires":[]},{"id":"b23801bc.a2068","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":2960.944534301758,"y":1726.5159249305725,"z":"8e0bf5da.783678","wires":[["a88778c0.f5fb88","e8bc2120.720bf"]]},{"id":"982a81a8.78a65","type":"set","name":"set pool-index","xml":"<set>\n<parameter name='pool-index'\n   value='`$eipam-ip-block.getPlanTopologyResponse.TopologyDetails[$resp-index].Level - 1`' />\n","comments":"","x":2189.9762649536133,"y":1201.575562953949,"z":"8e0bf5da.783678","wires":[]},{"id":"a8365f78.742e7","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":4731.472339630127,"y":1482.0159001350403,"z":"8e0bf5da.783678","wires":[["212530be.34aca","e7834444.eed428"]]},{"id":"7689f34b.377f0c","type":"set","name":"set tmp.key-value","xml":"<set>\n<parameter name='tmp.key-value' value='`$db.routing-characteristic_mapping[0].routing-characteristic`' />\n","comments":"","x":3822.968204498291,"y":1581.3572669029236,"z":"8e0bf5da.783678","wires":[]},{"id":"10a8f584.5b564a","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":3648.8847732543945,"y":1581.5397191047668,"z":"8e0bf5da.783678","wires":[["7689f34b.377f0c"]]},{"id":"e8bc2120.720bf","type":"set","name":"set tmp.key-value","xml":"<set>\n<parameter name='tmp.key-value' value='`$tmp.truncated.clli8`' />\n","comments":"","x":3152.7500381469727,"y":1774.7657685279846,"z":"8e0bf5da.783678","wires":[]},{"id":"312506a7.37958a","type":"set","name":"set tmp.key-value","xml":"<set>\n<parameter name='tmp.key-value' value='`$eipam-ip-block.plans[$plan-index].vrf-name`' />\n","comments":"","x":2958.139114379883,"y":1832.904770374298,"z":"8e0bf5da.783678","wires":[]},{"id":"81a6cdd0.b7686","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2610.730442047119,"y":726.5714476108551,"z":"8e0bf5da.783678","wires":[["11cf7886.3fb187"]]},{"id":"11cf7886.3fb187","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Error retrieving complex from AAI\" />\n","comments":"","x":2779.266086578369,"y":726.0714876651764,"z":"8e0bf5da.783678","wires":[]},{"id":"a6e703a9.6916a","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2619.230438232422,"y":682.5715086460114,"z":"8e0bf5da.783678","wires":[["277ca6d7.0c48ca"]]},{"id":"277ca6d7.0c48ca","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"Complex not found in AAI\" />\n","comments":"","x":2787.0083656311035,"y":682.8768560886383,"z":"8e0bf5da.783678","wires":[]},{"id":"77a6059d.ad309c","type":"get-resource","name":"get-resource complex","xml":"<get-resource plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"complex\" \n\t\tkey=\"complex.physical-location-id = $aai.cloud-region.relationship-list.relationship[$ridx].relationship-data[$rdidx].relationship-value\"\n    pfx='aai.complex' >\n        \n\n\n","comments":"","outputs":1,"x":2411.3769149780273,"y":704.5280516147614,"z":"8e0bf5da.783678","wires":[["a6e703a9.6916a","81a6cdd0.b7686"]]},{"id":"33e8f1be.28ab3e","type":"switchNode","name":"switch: relationship-key","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship[$ridx].relationship-data[$rdidx].relationship-key`'>\n","comments":"","outputs":1,"x":1692.8452987670898,"y":678.293919801712,"z":"8e0bf5da.783678","wires":[["bdffabec.e6bb68"]]},{"id":"bdffabec.e6bb68","type":"other","name":"complex.physical-location-id","xml":"<outcome value='complex.physical-location-id'>\n","comments":"","outputs":1,"x":1948.774040222168,"y":678.5677149295807,"z":"8e0bf5da.783678","wires":[["64fbd352.401d5c"]]},{"id":"64fbd352.401d5c","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":2180.475914001465,"y":678.8892576694489,"z":"8e0bf5da.783678","wires":[["77a6059d.ad309c","be3ee036.f440a"]]},{"id":"be3ee036.f440a","type":"set","name":"set tmp.aic-clli","xml":"<set>\n<parameter name='tmp.aic-clli' value='`$aai.cloud-region.relationship-list.relationship[$ridx].relationship-data[$rdidx].relationship-value`' />\n\n","comments":"","x":2390.119468688965,"y":655.5836851596832,"z":"8e0bf5da.783678","wires":[]},{"id":"e9feb0e3.f2da8","type":"switchNode","name":"switch cloud-region.relationship_length","xml":"<switch test='`$aai.cloud-region.relationship-list.relationship_length`'>\n","comments":"","outputs":1,"x":1307.5356407165527,"y":564.9999485015869,"z":"8e0bf5da.783678","wires":[["e2154ef9.da521","18d70e46.074242"]]},{"id":"e2154ef9.da521","type":"other","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":1557.7857127719453,"y":541.5000353919136,"z":"8e0bf5da.783678","wires":[["99abcf3f.b67c3"]]},{"id":"18d70e46.074242","type":"other","name":"null","xml":"<outcome value=''>\n","comments":"","outputs":1,"x":1561.0357093811035,"y":590.5000705718994,"z":"8e0bf5da.783678","wires":[["99abcf3f.b67c3"]]},{"id":"99abcf3f.b67c3","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"cloud-region missing relationships in AAI\" />\n","comments":"","x":1732.535717010498,"y":561.5000696182251,"z":"8e0bf5da.783678","wires":[]},{"id":"b3389bd9.e9f258","type":"for","name":"for relationship data","xml":"<for silentFailure='false' index='rdidx' start='0' end=\"`$aai.cloud-region.relationship-list.relationship[$ridx].relationship-data_length`\" >\n","comments":"","outputs":1,"x":1467.7499771118164,"y":678.4166271686554,"z":"8e0bf5da.783678","wires":[["33e8f1be.28ab3e"]]},{"id":"4b365b55.5fa544","type":"set","name":"set eipam-ip-block.plan-name","xml":"<set>\n<parameter name='eipam-ip-block.plan-name' value='`$eipam-ip-block.plans[$plan-index].plan-name`' />\n","comments":"","x":976.8888702392578,"y":945.2381200790405,"z":"8e0bf5da.783678","wires":[]},{"id":"3abe12b8.2974be","type":"for","name":"for eipam-ip-block.plans[]","xml":"<for index='plan-index' start='0' end='`$eipam-ip-block.plans_length`' >\n","comments":"","outputs":1,"x":486.50000762939453,"y":945.904806137085,"z":"8e0bf5da.783678","wires":[["375e284e.3643a8"]]},{"id":"375e284e.3643a8","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":701.7500076293945,"y":945.9048089981079,"z":"8e0bf5da.783678","wires":[["4b365b55.5fa544","e580ad14.0bce5","e2fdb772.ac8308","ce736664.6d0948"]]},{"id":"8f9774e6.381948","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1973.6071853637695,"y":1145.642963886261,"z":"8e0bf5da.783678","wires":[["53cec72.ff1ae38","982a81a8.78a65","b9bf31b9.00df3","831826e4.390168","2f55418b.7fd42e"]]},{"id":"53cec72.ff1ae38","type":"switchNode","name":"switch: Response.planName vs eipam-ip-block..plan-name","xml":"<switch test='`$eipam-ip-block.plan-name == $eipam-ip-block.getPlanTopologyResponse.PlanName`'>\n","comments":"","outputs":1,"x":2328.0358123779297,"y":1146.0715317726135,"z":"8e0bf5da.783678","wires":[["29e18a93.d51726"]]},{"id":"29e18a93.d51726","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":2638.321544647217,"y":1146.50004529953,"z":"8e0bf5da.783678","wires":[["fa64a79e.c78cb8"]]},{"id":"fa64a79e.c78cb8","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"`'eipam response plan-name ['+ $eipam-ip-block.getPlanTopologyResponse.PlanName + ' is not the same as input '+$eipam-ip-block.planName`\" />\n","comments":"","x":2799.750099182129,"y":1146.5000386238098,"z":"8e0bf5da.783678","wires":[]},{"id":"6d318eaf.b3d61","type":"comment","name":"eipam-ip-block.getPlanTopologyResponse.TopologyDetails[]","info":"eipam-ip-block.getPlanTopologyResponse.TopologyDetails[0].KeyName = CLLI_CLOUD_REGION\neipam-ip-block.getPlanTopologyResponse.TopologyDetails[0].Level = 1\neipam-ip-block.getPlanTopologyResponse.TopologyDetails[1].Level = 2\neipam-ip-block.getPlanTopologyResponse.TopologyDetails[1].KeyName = NETWORK_ROLE_NETWORK_ID\n\n","comments":"","x":1179.6666793823242,"y":1095.488124847412,"z":"8e0bf5da.783678","wires":[]},{"id":"ce736664.6d0948","type":"for","name":"for eipam-ip-block.plans[].requests[]","xml":"<for index='request-index' start='0' end='`$eipam-ip-block.plans[$plan-index].requests_length`' >\n","comments":"","outputs":1,"x":993.1389465332031,"y":1144.7936630249023,"z":"8e0bf5da.783678","wires":[["748b329.0d162cc"]]},{"id":"6c28119e.837a8","type":"set","name":"set tmp.key-value","xml":"<set>\n<parameter name='tmp.key-value' value='`$generate-FQPN-input.aic-cloud-region`' />\n","comments":"","x":3184.5000228881836,"y":1896.571409702301,"z":"8e0bf5da.783678","wires":[]},{"id":"44e59f53.ac28","type":"set","name":"set tmp.key-value","xml":"<set>\n<parameter name='tmp.key-value' value='`$aai.complex.region`' />\n","comments":"","x":3012.0000228881836,"y":1953.821409702301,"z":"8e0bf5da.783678","wires":[]},{"id":"e4c41a1d.72f548","type":"set","name":"set tmp.key-value","xml":"<set>\n<parameter name='tmp.key-value' \n\tvalue='`$eipam-ip-block.plans[$plan-index].l3-network.network-name`' />\n","comments":"","x":3012.857223510742,"y":2012.7857947349548,"z":"8e0bf5da.783678","wires":[]},{"id":"c7b5b959.ec0218","type":"other","name":"Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":2624.1071657453263,"y":2171.1428382737295,"z":"8e0bf5da.783678","wires":[["ee483015.7b69b"]]},{"id":"ee483015.7b69b","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`'Unknown ADDRESS_PLAN_POLICIES: ' + $db.address-plan-policies.key-value-source`\" />\n","comments":"","x":2792.535789489746,"y":2171.1428208351135,"z":"8e0bf5da.783678","wires":[]},{"id":"2f0a99a4.db08e6","type":"switchNode","name":"switch: generate-FQPN-input.vf-module-name","xml":"<switch test='`$generate-FQPN-input.vf-module-name`'>\n","comments":"","outputs":1,"x":578.0119476318359,"y":188.49998474121094,"z":"8e0bf5da.783678","wires":[["9ae57650.d38aa8"]]},{"id":"9ae57650.d38aa8","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":850.5119552612305,"y":187.99998474121094,"z":"8e0bf5da.783678","wires":[["529165c2.5bcb3c"]]},{"id":"529165c2.5bcb3c","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"generate-FQPN-input.vf-module-name is null\" />\n","comments":"","x":1012.4286270141602,"y":188.11108350753784,"z":"8e0bf5da.783678","wires":[]},{"id":"d589d1c5.caf49","type":"switchNode","name":"switch: eipam-ip-block.plans_length ","xml":"<switch test='`$eipam-ip-block.plans_length`'>\n","comments":"","outputs":1,"x":540.2500610351562,"y":360.4999694824219,"z":"8e0bf5da.783678","wires":[["3372aae0.34bce6","ff01129a.14889","88d9dddd.664eb"]]},{"id":"3372aae0.34bce6","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":815.7500915527344,"y":360.14282417297363,"z":"8e0bf5da.783678","wires":[["d13e0834.fef808"]]},{"id":"e7834444.eed428","type":"returnFailure","name":"BREAK","xml":"<return status='failure'>\n","comments":"","x":4904.3928298950195,"y":1526.8572239875793,"z":"8e0bf5da.783678","wires":[]},{"id":"64f76de8.a03834","type":"returnSuccess","name":"CATCH BREAK","xml":"<return status='success'>","comments":"","x":3970.2499465942383,"y":1528.000042438507,"z":"8e0bf5da.783678","wires":[]},{"id":"d110ecd0.69bff","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":3799.2500915527344,"y":1482.000063419342,"z":"8e0bf5da.783678","wires":[["959f9053.77a9d","64f76de8.a03834"]]},{"id":"2f55418b.7fd42e","type":"set","name":"set eipam-ip-block - key-name/key-value","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plan-index].requests[$request-index].pools[$pool-index].key-name'\n   value='`$eipam-ip-block.getPlanTopologyResponse.TopologyDetails[$resp-index].KeyName`' />\n<parameter name='eipam-ip-block.plans[$plan-index].requests[$request-index].pools[$pool-index].key-value'\n      value='`$tmp.key-value`' />\n","comments":"","x":2269.9643020629883,"y":2235.4284958839417,"z":"8e0bf5da.783678","wires":[]},{"id":"132c7d65.bbc803","type":"set","name":"set variables for generating unique name","xml":"<set>\n<parameter name='generate-unique-name-input.index-table-name' value='EIPAM_CLIENT_KEY_INDEX' />\n<parameter name='generate-unique-name-input.index-table-prefix-column' value='vnf_name_prefix' />\n<parameter name='generate-unique-name-input.name-table-type' value='VNFAPI_CLIENT_KEY' />\n<parameter name='generate-unique-name-input.prefix'\n\tvalue=\"`$generate-FQPN-input.vf-module-name + ':' +\n\t\t$eipam-ip-block.plans[$plan-index].vm-type + ':' +\n\t\t$eipam-ip-block.plans[$plan-index].network-role + ':'`\" />\n<parameter name='generate-unique-name-input.index-length' value='2' />\n\n<!-- zrdm3mmex57_vlc:vlc:sctp_a:01 -->","comments":"","x":1743.3572082519531,"y":2326.6069688796997,"z":"8e0bf5da.783678","wires":[]},{"id":"c96ec273.31566","type":"call","name":"call GENERIC-RESOURCE-API:generate-unique-name","xml":"<call module='GENERIC-RESOURCE-API' rpc='generate-unique-name' mode='sync' >\n","comments":"","outputs":1,"x":1791.7379760742188,"y":2385.6074600219727,"z":"8e0bf5da.783678","wires":[["cf9b1fad.1acde"]]},{"id":"d13e0834.fef808","type":"set","name":"set eipam-ip-block.plans_length=0","xml":"<set>\n<parameter name='eipam-ip-block.plans_length' value='0' />","comments":"","x":1055.8454055786133,"y":359.99266624450684,"z":"8e0bf5da.783678","wires":[]},{"id":"cf9b1fad.1acde","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2099.654926300049,"y":2385.3577041625977,"z":"8e0bf5da.783678","wires":[["d3f1ac4b.c6131"]]},{"id":"d3f1ac4b.c6131","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='ack-final' value='Y'/>\n\t<parameter name=\"error-code\" value=\"500\" />\n    <parameter name=\"error-message\" value=\"`$generate-unique-name-output.error-message`\" />\n","comments":"","x":2256.083354949951,"y":2385.2147426605225,"z":"8e0bf5da.783678","wires":[]},{"id":"4f52e397.0107fc","type":"switchNode","name":"switch: generate-FQPN-input.aic-cloud-region","xml":"<switch test='`$generate-FQPN-input.aic-cloud-region`'>\n","comments":"","outputs":1,"x":572.2500152587891,"y":300.78569984436035,"z":"8e0bf5da.783678","wires":[["c5c045a1.242e58"]]},{"id":"c5c045a1.242e58","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":844.7500228881836,"y":300.28569984436035,"z":"8e0bf5da.783678","wires":[["7d8976c2.307de8"]]},{"id":"7d8976c2.307de8","type":"returnFailure","name":"return failure","xml":"<return status=\"failure\">\n\t<parameter name=\"ack-final\" value=\"Y\" />\n\t<parameter name=\"error-code\" value=\"500\"/>\n\t<parameter name=\"error-message\" value=\"generate-FQPN-input.aic-cloud-region is null\" />\n","comments":"","x":1006.6666946411133,"y":300.39679861068726,"z":"8e0bf5da.783678","wires":[]},{"id":"abb6ce18.81978","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1447.5000305175781,"y":2326.5713243484497,"z":"8e0bf5da.783678","wires":[["132c7d65.bbc803","c96ec273.31566","44925832.be4578","f646992d.2f4da8"]]},{"id":"44925832.be4578","type":"set","name":"set client-key,  info","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plan-index].requests[$request-index].client-key'\n   value='`$generate-unique-name-output.generated-name`' />\n<parameter name='eipam-ip-block.plans[$plan-index].requests[$request-index].info'\n   value='`$generate-FQPN-input.vf-module-id`' />\n","comments":"","x":1676.500015258789,"y":2445.8215713500977,"z":"8e0bf5da.783678","wires":[]},{"id":"748b329.0d162cc","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1260.0833358764648,"y":1145.0714168548584,"z":"8e0bf5da.783678","wires":[["e7f15e16.18ca4","abb6ce18.81978"]]},{"id":"b8f3cc1f.a2197","type":"set","name":"set Input for TESTING","xml":"<set>\n<parameter name='generate-FQPN-input.vf-module-name' value='XXYYZZ' />\n<parameter name='generate-FQPN-input.aic-cloud-region' value='mtn6' />\n\n<parameter name='eipam-ip-block.plans_length' value='2' />\n<parameter name='eipam-ip-block.plans[0].plan-name' value='ABC_PLAN_1' />\n<parameter name='eipam-ip-block.plans[0].address-family' value='ipv4' />\n<parameter name='eipam-ip-block.plans[0].requests_length' value='3' />\n<parameter name='eipam-ip-block.plans[0].vm-type' value='vlc' />\n<parameter name='eipam-ip-block.plans[0].network-role' value='oam' />\n<parameter name='eipam-ip-block.plans[1].plan-name' value='XYZ_PLAN_2' />\n<parameter name='eipam-ip-block.plans[1].address-family' value='ipv6' />\n<parameter name='eipam-ip-block.plans[1].requests_length' value='4' />\n<parameter name='eipam-ip-block.plans[1].vm-type' value='pd' />\n<parameter name='eipam-ip-block.plans[1].network-role' value='direct' />","comments":"","x":904.5000228881836,"y":60.07142925262451,"z":"8e0bf5da.783678","wires":[]},{"id":"2acb07cf.ad09e8","type":"other","name":"STATIC","xml":"<outcome value='STATIC'>\n","comments":"","outputs":1,"x":2633.2500228881836,"y":2107.571409702301,"z":"8e0bf5da.783678","wires":[["57aff14b.e379f"]]},{"id":"57aff14b.e379f","type":"set","name":"set tmp.key-value","xml":"<set>\n<parameter name='tmp.key-value' value='STATIC' />\n","comments":"","x":2825.7500228881836,"y":2107.571409702301,"z":"8e0bf5da.783678","wires":[]},{"id":"881532bf.310d7","type":"comment","name":"Change History","info":"1.2.4.1.test \n- remove service-instance-id validation\n1.2.4.2.test \n- fixed aic-cloud-region variable type in get-resource\n- node 24, 33 changed var eipam-ip-block.plan-name from eipam-ip-block.planName\n- node 36 use underscore in key_name on sql query\n- node 41, 53 use tmp.key-value instead of tmp.routing-characteristic\n- node 29, fixed request-index typo in for loop\n- node 58, set value to tmp.truncated.clli8 instead of result\n- node 36 outcome, appended _Name to AddressPlanPolicyDG-Vrf_Name and fixed node 59 set node param name\n- node 67, fixed eipam-ip-block.plans typo\n- node 63, change subnet-role value to STATIC from DEFAULT\n9/12/17 E2E Testing\ncheck eipam-ip-block.plans_length and get AAI cloud region if plans_length not null\nnode 67, instead of setting value of key-value to key-name, set eipam-ip-block key-name and key-value separately and explicitly\n","comments":"","x":1162.8571319580078,"y":64.28571510314941,"z":"8e0bf5da.783678","wires":[]},{"id":"ff01129a.14889","type":"other","name":"Other","xml":"<outcome value='Other'>\n","comments":"","outputs":1,"x":814.3333282470703,"y":461.6666374206543,"z":"8e0bf5da.783678","wires":[["faaafb9e.176138"]]},{"id":"88d9dddd.664eb","type":"other","name":"0","xml":"<outcome value='0'>\n","comments":"","outputs":1,"x":814.9999237060547,"y":408.99998664855957,"z":"8e0bf5da.783678","wires":[["b1b53d99.9e91a"]]},{"id":"b1b53d99.9e91a","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":968.3333587646484,"y":408.66666889190674,"z":"8e0bf5da.783678","wires":[[]]},{"id":"faaafb9e.176138","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":1006.6666259765625,"y":461.99998474121094,"z":"8e0bf5da.783678","wires":[["118fa4e3.dbc59b","e9feb0e3.f2da8","b0674fac.2f0be"]]},{"id":"f646992d.2f4da8","type":"set","name":"set pools_length","xml":"<set>\n<parameter name='eipam-ip-block.plans[$plan-index].requests[$request-index].pools_length'\n   value='`$pool-index + 1`' />\n","comments":"","x":1672.7143630981445,"y":2498.571523666382,"z":"8e0bf5da.783678","wires":[]}]