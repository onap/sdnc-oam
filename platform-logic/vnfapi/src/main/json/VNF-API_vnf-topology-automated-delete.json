[{"id":"b6a16bd6.e7b308","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":235.00001525878906,"y":215.0000057220459,"z":"18e3ea4b.46ba36","wires":[["d8b24ce.a8272b","a7e1cb27.021828","d6e27419.5f5bb8","1bb58087.9d783f","218564bc.1b95dc","70ef5cfe.3fb324","ca8babe.2a01458"]]},{"id":"c9737847.c8c4c8","type":"method","name":"method vnf-topology-automated-delete","xml":"<method rpc='vnf-topology-automated-delete' mode='sync'>\n","comments":"","outputs":1,"x":228.09530639648438,"y":134.1666555404663,"z":"18e3ea4b.46ba36","wires":[["b6a16bd6.e7b308"]]},{"id":"d0deb082.f3385","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.openecomp.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.openecomp.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":310.4762268066406,"y":53.59523677825928,"z":"18e3ea4b.46ba36","wires":[["c9737847.c8c4c8"]]},{"id":"c19ff671.750248","type":"dgstart","name":"DGSTART","outputs":1,"x":100.64290618896484,"y":53.42856216430664,"z":"18e3ea4b.46ba36","wires":[["d0deb082.f3385"]]},{"id":"be1e6659.0f3248","type":"other","name":"false","xml":"<outcome value='false'>","comments":"","outputs":1,"x":690.210075378418,"y":270.17641830444336,"z":"18e3ea4b.46ba36","wires":[["fbec7c10.e02e7"]]},{"id":"fbec7c10.e02e7","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='400'/>\n\t<parameter name='error-message' value='Invalid order-status'/>","comments":"","x":842.5432052612305,"y":270.1764793395996,"z":"18e3ea4b.46ba36","wires":[]},{"id":"a7e1cb27.021828","type":"set","name":"set: last-action ","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-action\" value=\"`$service-data.request-information.request-action`\"/>","comments":"","x":445.9363021850586,"y":369.85521125793457,"z":"18e3ea4b.46ba36","wires":[]},{"id":"d8b24ce.a8272b","type":"set","name":"set: last-order-status = order-status","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-order-status\" value=\"`$service-data.oper-status.order-status`\"/>","comments":"","x":511.3226547241211,"y":322.19004917144775,"z":"18e3ea4b.46ba36","wires":[]},{"id":"740c6430.f21e1c","type":"set","name":"Clear vnf topology","xml":"<set>\n\t<parameter name=\"service-data.\" value=\"\" /> \n","comments":"","x":1092.965431213379,"y":964.1900024414062,"z":"18e3ea4b.46ba36","wires":[]},{"id":"1bb58087.9d783f","type":"switchNode","name":"switch: order-status = Active","xml":"<switch test=\"`$service-data.oper-status.order-status == Active`\">","comments":"","outputs":1,"x":488.3929748535156,"y":270.4762191772461,"z":"18e3ea4b.46ba36","wires":[["be1e6659.0f3248"]]},{"id":"d6e27419.5f5bb8","type":"set","name":"Set final indicator to Y","xml":"<set>\n<parameter name=\"ack-final\" value=\"Y\"/>","comments":"","x":460.28590393066406,"y":844.0001077651978,"z":"18e3ea4b.46ba36","wires":[]},{"id":"218564bc.1b95dc","type":"switchNode","name":"switch:vnf-id   config == input","xml":"<switch test=\"`$vnf-topology-operation-input.vnf-request-information.vnf-id == $service-data.vnf-id`\">","comments":"","outputs":1,"x":488.28580474853516,"y":215.28572273254395,"z":"18e3ea4b.46ba36","wires":[["c4a7387.44b2dc8"]]},{"id":"c4a7387.44b2dc8","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":689.740364074707,"y":215.46755027770996,"z":"18e3ea4b.46ba36","wires":[["26c31f86.4c7b3"]]},{"id":"26c31f86.4c7b3","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='404'/>\n\t<parameter name='error-message' value='vnf-id not found'/>","comments":"","x":853.3312835693359,"y":215.6266508102417,"z":"18e3ea4b.46ba36","wires":[]},{"id":"eddeb3df.433ab","type":"call","name":"call: rollback-eipam-ip-assignment","xml":"<call module='VNF-API' rpc='rollback-eipam-ip-assignment' mode='sync' >","comments":"","outputs":1,"x":1142.785873413086,"y":629.7143421173096,"z":"18e3ea4b.46ba36","wires":[[]]},{"id":"e155340a.1cfea8","type":"set","name":"set: order-status = Deleted","xml":"<set>\n\t<parameter name=\"service-data.oper-status.order-status\" value=\"Deleted\"/>","comments":"","x":1118.2500457763672,"y":582.9285621643066,"z":"18e3ea4b.46ba36","wires":[]},{"id":"70ef5cfe.3fb324","type":"switchNode","name":"switch: request-sub-action","xml":"<switch test=\"`$vnf-topology-operation-input.request-information.request-sub-action`\">\n<!--\nleaf request-sub-action {\n\ttype enumeration {\n\t\tenum \"SUPP\";\n        enum \"CANCEL\";\n        enum \"RetainResource\";\n\t}\n}\n-->\n\n","comments":"","outputs":1,"x":480.7500534057617,"y":505.51182079315186,"z":"18e3ea4b.46ba36","wires":[["f81d8ef7.b9f65","457abc5a.a6bb44","436c2a91.4d4394"]]},{"id":"f81d8ef7.b9f65","type":"other","name":"RetainResource","xml":"<outcome value='RetainResource'>","comments":"","outputs":1,"x":731.7500419616699,"y":448.01180839538574,"z":"18e3ea4b.46ba36","wires":[["c801d1f8.e45d8"]]},{"id":"353912aa.9ac30e","type":"set","name":"set: order-status = PendingDelete","xml":"<set>\n\t<parameter name=\"service-data.oper-status.order-status\" value=\"PendingDelete\"/>","comments":"","x":1196.7500495910645,"y":447.7618103027344,"z":"18e3ea4b.46ba36","wires":[]},{"id":"bc1eef08.01c9b","type":"save","name":"update AnAI - vf-module.orchestration-status","xml":"<update plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" >\n\t<parameter name=\"orchestration-status\" value=\"pending-delete\" />","comments":"","outputs":1,"x":1225.5000495910645,"y":495.511812210083,"z":"18e3ea4b.46ba36","wires":[["681b5d40.40a754"]]},{"id":"681b5d40.40a754","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1490.0239067077637,"y":495.5003147125244,"z":"18e3ea4b.46ba36","wires":[["7b2d6359.41387c"]]},{"id":"7b2d6359.41387c","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Encountered error while updating vf-module orchestration-status in AnAI with vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\"/>","comments":"","x":1658.166835784912,"y":495.5003852844238,"z":"18e3ea4b.46ba36","wires":[]},{"id":"457abc5a.a6bb44","type":"other","name":"null","xml":"<outcome value=''>","comments":"","outputs":1,"x":704.2500419616699,"y":583.011812210083,"z":"18e3ea4b.46ba36","wires":[["50547e8f.4d0ba"]]},{"id":"c801d1f8.e45d8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":932.7500495910645,"y":448.2618103027344,"z":"18e3ea4b.46ba36","wires":[["353912aa.9ac30e","bc1eef08.01c9b"]]},{"id":"50547e8f.4d0ba","type":"block","name":"block : atomic","xml":"<block atomic='true'>","atomic":"true","comments":"","outputs":1,"x":874.7500381469727,"y":583.011812210083,"z":"18e3ea4b.46ba36","wires":[["e155340a.1cfea8","eddeb3df.433ab","740c6430.f21e1c","dc8d2048.32938","fc78815c.a1036"]]},{"id":"436c2a91.4d4394","type":"other","name":"other","xml":"<outcome value='other'>","comments":"","outputs":1,"x":704.2500381469727,"y":633.0118007659912,"z":"18e3ea4b.46ba36","wires":[["50547e8f.4d0ba"]]},{"id":"ca8babe.2a01458","type":"set","name":"set: service-data = input","xml":"<set>\n\t<parameter name=\"service-data.\" value=\"vnf-topology-operation-input.\" />","comments":"","x":468.75001525878906,"y":795.9285621643066,"z":"18e3ea4b.46ba36","wires":[]},{"id":"fc78815c.a1036","type":"for","name":"for i in vnf-vms[]","xml":"<for index='i' start='0' end='`$service-data.vnf-topology-information.vnf-assignments.vnf-vms_length`' >","comments":"","outputs":1,"x":1087.8572235107422,"y":739.1428833007812,"z":"18e3ea4b.46ba36","wires":[["2ffda8c0.7c85a8"]]},{"id":"a47df3f1.c9a8","type":"for","name":"for j in vnf-vms[].vm-names[]","xml":"<for index='j' start='0' end='`$service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names_length`' >","comments":"","outputs":1,"x":1543.5714492797852,"y":800.4286680221558,"z":"18e3ea4b.46ba36","wires":[["aeefbc51.a0d77"]]},{"id":"5357108a.b4293","type":"for","name":"for k in vnf-vms[].vm-names[].vnfc-names[]","xml":"<for index='k' start='0' end='`$service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names_length`' >","comments":"","outputs":1,"x":2069.28572845459,"y":869.8572158813477,"z":"18e3ea4b.46ba36","wires":[["cbd1e411.9edff8"]]},{"id":"cbd1e411.9edff8","type":"save","name":"delete AAI: vnfc","xml":"<delete plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vnfc\" \n\t\tkey=\"vnfc.vnfc-name = $service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names[$k].vnfc-name\" > ","comments":"","outputs":1,"x":2356.428680419922,"y":869.8572874069214,"z":"18e3ea4b.46ba36","wires":[["c1b37a4a.238198"]]},{"id":"c1b37a4a.238198","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2527.857234954834,"y":869.5716686248779,"z":"18e3ea4b.46ba36","wires":[["bd86256f.ac3c38"]]},{"id":"bd86256f.ac3c38","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Encountered error while rolling back vnfc object' + $service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names[$k].vnfc-name + ' from AnAI. MANUAL rollback is required!'`\"/>","comments":"","x":2688.1426734924316,"y":870.0002012252808,"z":"18e3ea4b.46ba36","wires":[]},{"id":"dc8d2048.32938","type":"switchNode","name":"switch:SERVICE-DATA vnf-vms_length","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-vms_length`\">\n","comments":"","outputs":1,"x":1160.1429061889648,"y":687.5715503692627,"z":"18e3ea4b.46ba36","wires":[["1739801d.c0ec6"]]},{"id":"1739801d.c0ec6","type":"other","name":"null","xml":"<outcome value=''>","comments":"","outputs":1,"x":1407.1428756713867,"y":687.714437007904,"z":"18e3ea4b.46ba36","wires":[["49f403ee.10150c"]]},{"id":"49f403ee.10150c","type":"set","name":"set: SERVICE-DATA vnf-vms_length","xml":"<set>\n\t<parameter name=\"service-data.vnf-topology-information.vnf-assignments.vnf-vms_length\" value=\"0\" />","comments":"","x":1654.9999771118164,"y":688.2858715057373,"z":"18e3ea4b.46ba36","wires":[]},{"id":"960eb53f.19d6b8","type":"switchNode","name":"switch:SERVICE-DATA vnf-vms[].vm-names_length","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names_length`\">\n","comments":"","outputs":1,"x":1608.7144393920898,"y":739.000114440918,"z":"18e3ea4b.46ba36","wires":[["ace2c73b.97d0d8"]]},{"id":"ace2c73b.97d0d8","type":"other","name":"null","xml":"<outcome value=''>","comments":"","outputs":1,"x":1886.7144088745117,"y":739.1430010795593,"z":"18e3ea4b.46ba36","wires":[["b8b70146.b7f74"]]},{"id":"b8b70146.b7f74","type":"set","name":"set: SERVICE-DATA vnf-vms[].vm-names_length","xml":"<set>\n\t<parameter name=\"service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names_length\" value=\"0\" />","comments":"","x":2161.5715103149414,"y":738.7144355773926,"z":"18e3ea4b.46ba36","wires":[]},{"id":"2ffda8c0.7c85a8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1275.8572006225586,"y":739.5715503692627,"z":"18e3ea4b.46ba36","wires":[["a47df3f1.c9a8","960eb53f.19d6b8"]]},{"id":"aeefbc51.a0d77","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1775.8572616577148,"y":800.0001087188721,"z":"18e3ea4b.46ba36","wires":[["49e1236f.e482ac","5357108a.b4293"]]},{"id":"49e1236f.e482ac","type":"switchNode","name":"switch:SERVICE-DATA vnf-vms[].vm-names[].vnfc-names_length","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names_length`\">\n","comments":"","outputs":1,"x":2134.4287490844727,"y":799.0001039505005,"z":"18e3ea4b.46ba36","wires":[["a1d096c9.794528"]]},{"id":"a1d096c9.794528","type":"other","name":"null","xml":"<outcome value=''>","comments":"","outputs":1,"x":2472.5715713500977,"y":799.1429772377014,"z":"18e3ea4b.46ba36","wires":[["de5316f3.41cff8"]]},{"id":"de5316f3.41cff8","type":"set","name":"set: SERVICE-DATA vnf-vms[].vm-names[].vnfc-names_length","xml":"<set>\n\t<parameter name=\"service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names_length\" value=\"0\" />","comments":"","x":2795.4286727905273,"y":798.7144117355347,"z":"18e3ea4b.46ba36","wires":[]}]