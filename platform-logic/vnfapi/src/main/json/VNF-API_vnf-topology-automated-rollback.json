[{"id":"74c6ab10.408244","type":"comment","name":"vnf-topology-automated-rollback","info":"","comments":"","x":830,"y":67.50001430511475,"z":"8ab09618.0ca008","wires":[]},{"id":"26682e15.0c4442","type":"method","name":"method vnf-topology-automated-rollback","xml":"<method rpc='vnf-topology-automated-rollback' mode='sync'>\n","comments":"","outputs":1,"x":266.3334274291992,"y":126.22223281860352,"z":"8ab09618.0ca008","wires":[["26f46dd2.d37072"]]},{"id":"a6fdd7a8.447258","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.openecomp.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.openecomp.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":332.19061279296875,"y":50.96827507019043,"z":"8ab09618.0ca008","wires":[["26682e15.0c4442"]]},{"id":"15f5d0e9.8984af","type":"dgstart","name":"DGSTART","outputs":1,"x":129.02388763427734,"y":50.91271209716797,"z":"8ab09618.0ca008","wires":[["a6fdd7a8.447258"]]},{"id":"8b0bd9ab.4c26a8","type":"set","name":"set: order-status = Deleted","xml":"<set>\n\t<parameter name=\"service-data.oper-status.order-status\" value=\"Deleted\"/>","comments":"","x":603.345329284668,"y":664.2196500301361,"z":"8ab09618.0ca008","wires":[]},{"id":"88cd97f5.148b88","type":"switchNode","name":"switch: order-status = PendingCreate","xml":"<switch test=\"`$service-data.oper-status.order-status == PendingCreate`\">","comments":"","outputs":1,"x":644.7577743530273,"y":233.34836673736572,"z":"8ab09618.0ca008","wires":[["d48c5079.bc3d9"]]},{"id":"d48c5079.bc3d9","type":"other","name":"false","xml":"<outcome value='false'>","comments":"","outputs":1,"x":876.3411560058594,"y":233.18167877197266,"z":"8ab09618.0ca008","wires":[["e42e71b1.29e03"]]},{"id":"e42e71b1.29e03","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='400'/>\n\t<parameter name='error-message' value='Invalid order-status'/>","comments":"","x":1028.6742858886719,"y":233.1817398071289,"z":"8ab09618.0ca008","wires":[]},{"id":"2b73b041.991b6","type":"set","name":"set: last-action ","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-action\" value=\"`$service-data.request-information.request-action`\"/>","comments":"","x":567.1030426025391,"y":711.8009650707245,"z":"8ab09618.0ca008","wires":[]},{"id":"732e62ec.2f9aac","type":"outcomeFalse","name":"false","xml":"<outcome value='false'>\n","comments":"","outputs":1,"x":865.0153503417969,"y":186.13892364501953,"z":"8ab09618.0ca008","wires":[["3fcc2c3d.fb5164"]]},{"id":"3fcc2c3d.fb5164","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='400'/>\n\t<parameter name='error-message' value=\"`'vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' not found in config tree'`\"/>","comments":"","x":1028.1061706542969,"y":186.54802703857422,"z":"8ab09618.0ca008","wires":[]},{"id":"7786886.974a278","type":"set","name":"set: last-order-status = order-status","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-order-status\" value=\"`$service-data.oper-status.order-status`\"/>","comments":"","x":629.9893646240234,"y":614.7786214351654,"z":"8ab09618.0ca008","wires":[]},{"id":"c80231f8.332b3","type":"set","name":"Clear vnf topology","xml":"<set>\n\t<parameter name=\"service-data.\" value=\"\" /> \n","comments":"","x":576.3783416748047,"y":759.7786726951599,"z":"8ab09618.0ca008","wires":[]},{"id":"4a616f0f.c5b15","type":"switchNode","name":"switch:CONFIG == INPUT - vnf-id","xml":"<switch test=\"`$vnf-topology-operation-input.vnf-request-information.vnf-id == $service-data.vnf-id`\">","comments":"","outputs":1,"x":634.1668319702148,"y":186.13892364501953,"z":"8ab09618.0ca008","wires":[["732e62ec.2f9aac"]]},{"id":"26f46dd2.d37072","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":343.66680908203125,"y":185.38892078399658,"z":"8ab09618.0ca008","wires":[["4a616f0f.c5b15","88cd97f5.148b88","7786886.974a278","8b0bd9ab.4c26a8","2b73b041.991b6","c80231f8.332b3","15252886.399047","f51ec2c7.b35de","113cecb0.d4cef3"]]},{"id":"7cec1540.6c4d4c","type":"comment","name":"Only valid to rollback assigned vf-module with Orchestration status = PendingCreate","info":"","comments":"","x":841.416748046875,"y":103.50001621246338,"z":"8ab09618.0ca008","wires":[]},{"id":"15252886.399047","type":"call","name":"call: rollback-eipam-ip-assignment","xml":"<call module='VNF-API' rpc='rollback-eipam-ip-assignment' mode='sync' >","comments":"","outputs":1,"x":634.9762344360352,"y":282.50001430511475,"z":"8ab09618.0ca008","wires":[[]]},{"id":"f51ec2c7.b35de","type":"for","name":"for i in vnf-vms[]","xml":"<for index='i' start='0' end='`$service-data.vnf-topology-information.vnf-assignments.vnf-vms_length`' >","comments":"","outputs":1,"x":577.7143173217773,"y":382.4840543270111,"z":"8ab09618.0ca008","wires":[["9c23a2ff.3884f"]]},{"id":"c05d2243.6f02f","type":"for","name":"for j in vnf-vms[].vm-names[]","xml":"<for index='j' start='0' end='`$service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names_length`' >","comments":"","outputs":1,"x":1033.4285430908203,"y":443.7698390483856,"z":"8ab09618.0ca008","wires":[["a3a0594c.b61258"]]},{"id":"d2649fed.ae908","type":"for","name":"for k in vnf-vms[].vm-names[].vnfc-names[]","xml":"<for index='k' start='0' end='`$service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names_length`' >","comments":"","outputs":1,"x":1559.142822265625,"y":513.1983869075775,"z":"8ab09618.0ca008","wires":[["a5d7e148.62ec"]]},{"id":"a5d7e148.62ec","type":"save","name":"delete AAI: vnfc","xml":"<delete plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vnfc\" \n\t\tkey=\"vnfc.vnfc-name = $service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names[$k].vnfc-name\" > ","comments":"","outputs":1,"x":1846.285774230957,"y":513.1984584331512,"z":"8ab09618.0ca008","wires":[["88d40d5e.528d"]]},{"id":"88d40d5e.528d","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2017.7143287658691,"y":512.9128396511078,"z":"8ab09618.0ca008","wires":[["5606ece8.e71084"]]},{"id":"5606ece8.e71084","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Encountered error while rolling back vnfc object' + $service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names[$k].vnfc-name + ' from AnAI. MANUAL rollback is required!'`\"/>","comments":"","x":2177.999767303467,"y":513.3413722515106,"z":"8ab09618.0ca008","wires":[]},{"id":"113cecb0.d4cef3","type":"switchNode","name":"switch:SERVICE-DATA vnf-vms_length","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-vms_length`\">\n","comments":"","outputs":1,"x":650,"y":330.91272139549255,"z":"8ab09618.0ca008","wires":[["c7698c27.2819f"]]},{"id":"c7698c27.2819f","type":"other","name":"null","xml":"<outcome value=''>","comments":"","outputs":1,"x":896.9999694824219,"y":331.0556080341339,"z":"8ab09618.0ca008","wires":[["381068fe.277718"]]},{"id":"381068fe.277718","type":"set","name":"set: SERVICE-DATA vnf-vms_length","xml":"<set>\n\t<parameter name=\"service-data.vnf-topology-information.vnf-assignments.vnf-vms_length\" value=\"0\" />","comments":"","x":1144.8570709228516,"y":331.62704253196716,"z":"8ab09618.0ca008","wires":[]},{"id":"ef96c4fc.0b4638","type":"switchNode","name":"switch:SERVICE-DATA vnf-vms[].vm-names_length","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names_length`\">\n","comments":"","outputs":1,"x":1098.571533203125,"y":382.3412854671478,"z":"8ab09618.0ca008","wires":[["8b604196.40647"]]},{"id":"8b604196.40647","type":"other","name":"null","xml":"<outcome value=''>","comments":"","outputs":1,"x":1376.5715026855469,"y":382.4841721057892,"z":"8ab09618.0ca008","wires":[["a3f185c8.b616c8"]]},{"id":"a3f185c8.b616c8","type":"set","name":"set: SERVICE-DATA vnf-vms[].vm-names_length","xml":"<set>\n\t<parameter name=\"service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names_length\" value=\"0\" />","comments":"","x":1651.4286041259766,"y":382.05560660362244,"z":"8ab09618.0ca008","wires":[]},{"id":"9c23a2ff.3884f","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":765.7142944335938,"y":382.91272139549255,"z":"8ab09618.0ca008","wires":[["c05d2243.6f02f","ef96c4fc.0b4638"]]},{"id":"a3a0594c.b61258","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":1265.71435546875,"y":443.34127974510193,"z":"8ab09618.0ca008","wires":[["3fd64a81.5c5b36","d2649fed.ae908"]]},{"id":"3fd64a81.5c5b36","type":"switchNode","name":"switch:SERVICE-DATA vnf-vms[].vm-names[].vnfc-names_length","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names_length`\">\n","comments":"","outputs":1,"x":1624.2858428955078,"y":442.34127497673035,"z":"8ab09618.0ca008","wires":[["83f08a22.937938"]]},{"id":"83f08a22.937938","type":"other","name":"null","xml":"<outcome value=''>","comments":"","outputs":1,"x":1962.4286651611328,"y":442.4841482639313,"z":"8ab09618.0ca008","wires":[["75fd6153.6d81d"]]},{"id":"75fd6153.6d81d","type":"set","name":"set: SERVICE-DATA vnf-vms[].vm-names[].vnfc-names_length","xml":"<set>\n\t<parameter name=\"service-data.vnf-topology-information.vnf-assignments.vnf-vms[$i].vm-names[$j].vnfc-names_length\" value=\"0\" />","comments":"","x":2285.2857666015625,"y":442.0555827617645,"z":"8ab09618.0ca008","wires":[]}]