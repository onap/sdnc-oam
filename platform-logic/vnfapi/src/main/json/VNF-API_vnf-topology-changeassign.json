


[{"id":"31d117bd.10a048","type":"dgstart","name":"DGSTART","outputs":1,"x":126.25,"y":58.75,"z":"a5fb464c.c71c28","wires":[["2d3833.abbcb7ce"]]},{"id":"2d3833.abbcb7ce","type":"service-logic","name":"VNF-API 2.1.0","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.att.com/sdnctl/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.att.com/sdnctl/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":291.4166564941406,"y":58.91667175292969,"z":"a5fb464c.c71c28","wires":[["a102d673.d7f388"]]},{"id":"efb068cd.5823f8","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":203.75000762939453,"y":161.75,"z":"a5fb464c.c71c28","wires":[["f8ca55f5.34b0b8","af9ec214.64e7a","e2492eda.02325","2abf740c.cd838c","c7d8c86f.119978","7e665123.21b8b","59d37872.b8ce68","7c97e6ef.65e338","be63322a.38b31","eb3fccd4.5ce26"]]},{"id":"f8ca55f5.34b0b8","type":"set","name":"set: order-status = PendingUpdate","xml":"<set>\n\t<parameter name=\"service-data.oper-status.order-status\" value=\"PendingUpdate\"/>","comments":"","outputs":1,"x":499.1948776245117,"y":886.2110958099365,"z":"a5fb464c.c71c28","wires":[[]]},{"id":"af9ec214.64e7a","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"200\" />","comments":"","x":437.4646911621094,"y":1021.0109748840332,"z":"a5fb464c.c71c28","wires":[]},{"id":"e2492eda.02325","type":"switchNode","name":"switch: service-data order-status = Active","xml":"<switch test=\"`$service-data.oper-status.order-status == Active`\">\n<!--\nleaf order-status {\n\ttype enumeration {\n\t\tenum \"Active\";\n\t\tenum \"PendingAssignment\";\n\t\tenum \"PendingCreate\";\n\t\tenum \"PendingUpdate\";\n\t\tenum \"Deleted\";\n\t}\n}\n-->","comments":"","outputs":1,"x":522.25,"y":205.75,"z":"a5fb464c.c71c28","wires":[["b2a5f07c.04d7d"]]},{"id":"26a5b9af.94f946","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='400'/>\n\t<parameter name='error-message' value='Invalid service-data order status'/>","comments":"","x":926.9998168945312,"y":205.5833740234375,"z":"a5fb464c.c71c28","wires":[]},{"id":"b2a5f07c.04d7d","type":"other","name":"false","xml":"<outcome value='false'>","comments":"","outputs":1,"x":768.4166259765625,"y":205.333251953125,"z":"a5fb464c.c71c28","wires":[["26a5b9af.94f946"]]},{"id":"a102d673.d7f388","type":"method","name":"method vnf-topology-changeassign","xml":"<method rpc='vnf-topology-changeassign' mode='sync'>\n","comments":"","outputs":1,"x":226.25,"y":109.75,"z":"a5fb464c.c71c28","wires":[["efb068cd.5823f8"]]},{"id":"2abf740c.cd838c","type":"set","name":"set: last-action ","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-action\" value=\"`$service-data.request-information.request-action`\"/>","comments":"","outputs":1,"x":437.20243072509766,"y":932.226110458374,"z":"a5fb464c.c71c28","wires":[[]]},{"id":"c7d8c86f.119978","type":"set","name":"set: last-order-status = order-status","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-order-status\" value=\"`$service-data.oper-status.order-status`\"/>","comments":"","outputs":1,"x":501.20243072509766,"y":840.226110458374,"z":"a5fb464c.c71c28","wires":[[]]},{"id":"7e665123.21b8b","type":"call","name":"call: vnf-topology-assign-vfmodule","xml":"<call module='VNF-API' rpc='vnf-topology-assign-vfmodule' mode='sync' >","comments":"","outputs":1,"x":500.25,"y":250.75,"z":"a5fb464c.c71c28","wires":[[]]},{"id":"7c97e6ef.65e338","type":"save","name":"delete relationship: vf-module","xml":"<delete plugin=\"com.att.sdnctl.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id \n\t\t\tAND related-to = l3-network\" \n\tforce=\"true\" \n\tlocal-only=\"false\">","comments":"","outputs":1,"x":484.39288330078125,"y":395.3216552734375,"z":"a5fb464c.c71c28","wires":[["7cf8a075.0c7b6"]]},{"id":"71ebaa69.659a44","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'An error occurred while deleting existing vf-module l3-network relationship in AnAI with with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id + ' vf-module update FAILED.'`\"/>","comments":"","x":886.2498779296875,"y":395.6070251464844,"z":"a5fb464c.c71c28","wires":[]},{"id":"59d37872.b8ce68","type":"save","name":"get AnAI - vf-module","xml":"<get-resource plugin=\"com.att.sdnctl.sli.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.AnAI.vfmodule\">","comments":"","outputs":1,"x":458.25,"y":296.75,"z":"a5fb464c.c71c28","wires":[["70f5df5a.ae288","da907bbd.1df408"]]},{"id":"42a2f99d.70da88","type":"save","name":"save vf-module relationship: l3-network","xml":"<save plugin=\"com.att.sdnctl.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id`\" />","comments":"","outputs":1,"x":826.5554656982422,"y":484.6502323150635,"z":"a5fb464c.c71c28","wires":[["34aa2d4f.eeba12"]]},{"id":"34aa2d4f.eeba12","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1069.69970703125,"y":484.6972646713257,"z":"a5fb464c.c71c28","wires":[["d4b975b3.5b0b68"]]},{"id":"be63322a.38b31","type":"for","name":"for i : SERVICE_DATA vnf-networks","xml":"<for index=\"i\" start=\"0\" end=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":504.2022705078125,"y":484.61871337890625,"z":"a5fb464c.c71c28","wires":[["42a2f99d.70da88"]]},{"id":"62d9f13e.cced9","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Failed to update vf-module l3-network relationship in AnAI. ' + $error-message`\"/>","comments":"","x":1396.6425323486328,"y":764.8921175003052,"z":"a5fb464c.c71c28","wires":[]},{"id":"d4b975b3.5b0b68","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1215.6784591674805,"y":484.9280080795288,"z":"a5fb464c.c71c28","wires":[["62d9f13e.cced9","9440d75c.a932c8","4db9652d.ed131c","28a4b739.327c78"]]},{"id":"4db9652d.ed131c","type":"save","name":"delete relationship: vf-module","xml":"<delete plugin=\"com.att.sdnctl.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id \n\t\t\tAND related-to = l3-network\" \n\tforce=\"true\" \n\tlocal-only=\"false\">","comments":"","outputs":1,"x":1456.6070709228516,"y":532.8567838668823,"z":"a5fb464c.c71c28","wires":[[]]},{"id":"9447b7ff.c2b628","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'An error occurred while querying vf-module from AnAI with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\"/>","comments":"","x":839.5355834960938,"y":297.4641418457031,"z":"a5fb464c.c71c28","wires":[]},{"id":"7cf8a075.0c7b6","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":700.25,"y":395.75,"z":"a5fb464c.c71c28","wires":[["71ebaa69.659a44"]]},{"id":"eb3fccd4.5ce26","type":"set","name":"Set final indicator to Y","xml":"<set>\n<parameter name=\"ack-final\" value=\"Y\"/>","comments":"","outputs":1,"x":458.8214645385742,"y":978.1786098480225,"z":"a5fb464c.c71c28","wires":[[]]},{"id":"28a4b739.327c78","type":"for","name":"for i : tmp.AnAI.vfmodule.relationship","xml":"<for index=\"i\" start=\"0\" end=\"`$tmp.AnAI.vfmodule.relationship-list.relationship_length`\">","comments":"","outputs":1,"x":1476.1428756713867,"y":582.321457862854,"z":"a5fb464c.c71c28","wires":[["cab01870.1f3998"]]},{"id":"cab01870.1f3998","type":"switchNode","name":"switch: relationship.related-to","xml":"<switch test=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].related-to`\">","comments":"","outputs":1,"x":1785.1428451538086,"y":583.0357780456543,"z":"a5fb464c.c71c28","wires":[["8c96096.770f9f8"]]},{"id":"8c96096.770f9f8","type":"other","name":"l3-network","xml":"<outcome value='l3-network'>","comments":"","outputs":1,"x":2008.1428451538086,"y":583.0357780456543,"z":"a5fb464c.c71c28","wires":[["32c23b53.ebdd34"]]},{"id":"32c23b53.ebdd34","type":"for","name":"for j : tmp.AnAI.vfmodule.relationship-data","xml":"<for index=\"j\" start=\"0\" end=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].relationship-data_length`\">","comments":"","outputs":1,"x":1603.142837524414,"y":665.6786203384399,"z":"a5fb464c.c71c28","wires":[["62acd50c.89a44c"]]},{"id":"62acd50c.89a44c","type":"save","name":"save vf-module relationship: l3-network","xml":"<save plugin=\"com.att.sdnctl.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].relationship-data[$j].relationship-value`\" />","comments":"","outputs":1,"x":1960.7142944335938,"y":665.8215036392212,"z":"a5fb464c.c71c28","wires":[["4d56aed6.76e2d","145c425.478d3be"]]},{"id":"4d56aed6.76e2d","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2218.7142944335938,"y":665.8215036392212,"z":"a5fb464c.c71c28","wires":[["5961586a.d170d8"]]},{"id":"70f5df5a.ae288","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":648.1071739196777,"y":296.8928680419922,"z":"a5fb464c.c71c28","wires":[["9447b7ff.c2b628"]]},{"id":"9440d75c.a932c8","type":"set","name":"set error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\" />\n\t<parameter name=\"error-message\" value=\"`' | An error occurred while saving l3-network relationship with network-id = ' + $service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id + ' for vf-module with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\" />\n","comments":"","outputs":1,"x":1420.178596496582,"y":484.85717582702637,"z":"a5fb464c.c71c28","wires":[[]]},{"id":"5961586a.d170d8","type":"set","name":"set error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\" />\n\t<parameter name=\"error-message\" value=\"`$error-message + ' | An error occurred while during rollback of l3-network relationship for vf-module with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\" />\n","comments":"","outputs":1,"x":2416.678611755371,"y":665.3571481704712,"z":"a5fb464c.c71c28","wires":[[]]},{"id":"da907bbd.1df408","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":655,"y":339.33331298828125,"z":"a5fb464c.c71c28","wires":[["9447b7ff.c2b628"]]},{"id":"145c425.478d3be","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2229,"y":707,"z":"a5fb464c.c71c28","wires":[["5961586a.d170d8"]]}]
