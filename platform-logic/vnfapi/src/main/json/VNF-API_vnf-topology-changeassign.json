[{"id":"e4c8a81f.42b668","type":"dgstart","name":"DGSTART","outputs":1,"x":171.66665649414062,"y":66.66666507720947,"z":"649657bf.810a08","wires":[["83cb6fa.aa0dd9"]]},{"id":"83cb6fa.aa0dd9","type":"service-logic","name":"VNF-API ${project.version}","module":"VNF-API","version":"${project.version}","comments":"","xml":"<service-logic xmlns='http://www.openecomp.org/sdnc/svclogic' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.openecomp.org/sdnc/svclogic ./svclogic.xsd' module='VNF-API' version='${project.version}'>","outputs":1,"x":393.4999694824219,"y":66.83334398269653,"z":"649657bf.810a08","wires":[["ee3dd629.1e0618"]]},{"id":"332241ad.8933fe","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":707.1666564941406,"y":383.66668701171875,"z":"649657bf.810a08","wires":[["71881a1e.60fb94","11f11730.4ab009","23e99f24.8582e","d484b5d4.be1a58","67679186.748aa"]]},{"id":"4fec02c6.9ca65c","type":"set","name":"set: order-status = PendingUpdate","xml":"<set>\n\t<parameter name=\"service-data.oper-status.order-status\" value=\"PendingUpdate\"/>","comments":"","x":546.6114883422852,"y":1056.1277084350586,"z":"649657bf.810a08","wires":[]},{"id":"8258f7ee.066158","type":"returnSuccess","name":"return success","xml":"<return status='success'>\n\t<parameter name=\"error-code\" value=\"200\" />","comments":"","x":484.8813018798828,"y":1190.9275875091553,"z":"649657bf.810a08","wires":[]},{"id":"6f0bd180.1cfc9","type":"switchNode","name":"switch: service-data order-status = Active","xml":"<switch test=\"`$service-data.oper-status.order-status == Active`\">\n<!--\nleaf order-status {\n\ttype enumeration {\n\t\tenum \"Active\";\n\t\tenum \"PendingAssignment\";\n\t\tenum \"PendingCreate\";\n\t\tenum \"PendingUpdate\";\n\t\tenum \"Deleted\";\n\t}\n}\n-->","comments":"","outputs":1,"x":567.6666564941406,"y":213.66666507720947,"z":"649657bf.810a08","wires":[["c096a928.2c38c8","7b15904e.95d82"]]},{"id":"c096a928.2c38c8","type":"other","name":"false","xml":"<outcome value='false'>","comments":"","outputs":1,"x":813.8332824707031,"y":213.24991703033447,"z":"649657bf.810a08","wires":[["9af460e9.89728"]]},{"id":"ee3dd629.1e0618","type":"method","name":"method vnf-topology-changeassign","xml":"<method rpc='vnf-topology-changeassign' mode='sync'>\n","comments":"","outputs":1,"x":274.99998474121094,"y":134.33333492279053,"z":"649657bf.810a08","wires":[["9477eb64.b0e578"]]},{"id":"94acb2fb.b3f92","type":"set","name":"set: last-action ","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-action\" value=\"`$service-data.request-information.request-action`\"/>","comments":"","x":484.6190414428711,"y":1102.142723083496,"z":"649657bf.810a08","wires":[]},{"id":"d27d1828.1ce2f8","type":"set","name":"set: last-order-status = order-status","xml":"<set>\n\t<parameter name=\"service-data.oper-status.last-order-status\" value=\"`$service-data.oper-status.order-status`\"/>","comments":"","x":548.9524536132812,"y":1008.4761352539062,"z":"649657bf.810a08","wires":[]},{"id":"71881a1e.60fb94","type":"call","name":"call: vnf-topology-assign-vfmodule","xml":"<call module='VNF-API' rpc='vnf-topology-assign-vfmodule' mode='sync' >","comments":"","outputs":1,"x":1003.6666412353516,"y":385.0000171661377,"z":"649657bf.810a08","wires":[[]]},{"id":"23e99f24.8582e","type":"save","name":"delete relationship: vf-module","xml":"<delete plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id \n\t\t\tAND related-to = l3-network\" \n\tforce=\"true\" \n\tlocal-only=\"false\">","comments":"","outputs":1,"x":987.8095245361328,"y":529.5716724395752,"z":"649657bf.810a08","wires":[["2268008d.ae65a"]]},{"id":"378f16e3.56947a","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'An error occurred while deleting existing vf-module l3-network relationship in AnAI with with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id + ' vf-module update FAILED.'`\"/>","comments":"","x":1389.666519165039,"y":529.8570423126221,"z":"649657bf.810a08","wires":[]},{"id":"11f11730.4ab009","type":"save","name":"get AnAI - vf-module","xml":"<get-resource plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tand generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\t\tlocal-only=\"false\" \n\t\tpfx=\"tmp.AnAI.vfmodule\">","comments":"","outputs":1,"x":961.6666412353516,"y":431.0000171661377,"z":"649657bf.810a08","wires":[["a2951e55.91468","888fdd16.a516"]]},{"id":"d37c6419.122148","type":"save","name":"save vf-module relationship: l3-network","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id`\" />","comments":"","outputs":1,"x":1326.6388092041016,"y":655.5669107437134,"z":"649657bf.810a08","wires":[["af713861.d76438"]]},{"id":"af713861.d76438","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1569.7830505371094,"y":655.6139430999756,"z":"649657bf.810a08","wires":[["4ebae940.0fc3d8"]]},{"id":"d484b5d4.be1a58","type":"for","name":"for i : SERVICE_DATA vnf-networks","xml":"<for index=\"i\" start=\"0\" end=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":1004.2856140136719,"y":655.5353918075562,"z":"649657bf.810a08","wires":[["d37c6419.122148"]]},{"id":"c4307dc0.f57e3","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'Failed to update vf-module l3-network relationship in AnAI. ' + $error-message`\"/>","comments":"","x":1900.725830078125,"y":923.8087768554688,"z":"649657bf.810a08","wires":[]},{"id":"4ebae940.0fc3d8","type":"block","name":"block","xml":"<block>\n","atomic":"false","comments":"","outputs":1,"x":1715.7618026733398,"y":655.8446865081787,"z":"649657bf.810a08","wires":[["c4307dc0.f57e3","cb453314.82906","5a30b49f.92bb7c","c3415c9.8ab45a"]]},{"id":"5a30b49f.92bb7c","type":"save","name":"delete relationship: vf-module","xml":"<delete plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id \n\t\t\tAND related-to = l3-network\" \n\tforce=\"true\" \n\tlocal-only=\"false\">","comments":"","outputs":1,"x":1950.6904296875,"y":705.7734375,"z":"649657bf.810a08","wires":[[]]},{"id":"43b4e1ad.1f07e","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='500'/>\n\t<parameter name='error-message' value=\"`'An error occurred while querying vf-module from AnAI with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\"/>","comments":"","x":1342.9522247314453,"y":431.7141590118408,"z":"649657bf.810a08","wires":[]},{"id":"2268008d.ae65a","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1203.6666412353516,"y":530.0000171661377,"z":"649657bf.810a08","wires":[["378f16e3.56947a"]]},{"id":"307c9b58.b37964","type":"set","name":"Set final indicator to Y","xml":"<set>\n<parameter name=\"ack-final\" value=\"Y\"/>","comments":"","x":506.23807525634766,"y":1148.0952224731445,"z":"649657bf.810a08","wires":[]},{"id":"c3415c9.8ab45a","type":"for","name":"for i : tmp.AnAI.vfmodule.relationship","xml":"<for index=\"i\" start=\"0\" end=\"`$tmp.AnAI.vfmodule.relationship-list.relationship_length`\">","comments":"","outputs":1,"x":1976.226219177246,"y":753.2381362915039,"z":"649657bf.810a08","wires":[["4a87d316.944c2c"]]},{"id":"4a87d316.944c2c","type":"switchNode","name":"switch: relationship.related-to","xml":"<switch test=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].related-to`\">","comments":"","outputs":1,"x":2285.226188659668,"y":753.9524564743042,"z":"649657bf.810a08","wires":[["ae0eb61.00cea48"]]},{"id":"ae0eb61.00cea48","type":"other","name":"l3-network","xml":"<outcome value='l3-network'>","comments":"","outputs":1,"x":2508.226188659668,"y":753.9524564743042,"z":"649657bf.810a08","wires":[["47c28300.f7f7ec"]]},{"id":"47c28300.f7f7ec","type":"for","name":"for j : tmp.AnAI.vfmodule.relationship-data","xml":"<for index=\"j\" start=\"0\" end=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].relationship-data_length`\">","comments":"","outputs":1,"x":2103.2261810302734,"y":836.5952987670898,"z":"649657bf.810a08","wires":[["d5bc0923.9d7448"]]},{"id":"d5bc0923.9d7448","type":"save","name":"save vf-module relationship: l3-network","xml":"<save plugin=\"org.openecomp.sdnc.sli.aai.AAIService\" \n\tresource=\"vf-module:relationship-list\" \n\t\tkey=\"vf-module.vf-module-id = $vnf-topology-operation-input.vnf-request-information.vnf-id \n\t\t\tAND generic-vnf.vnf-id = $vnf-topology-operation-input.vnf-request-information.generic-vnf-id\" \n\tforce=\"true\" \n\tlocal-only=\"false\">\n\t\n\t<parameter name=\"relationship-list.relationship[0].related-to\" value=\"l3-network\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-key\" value=\"l3-network.network-id\" />\n\t<parameter name=\"relationship-list.relationship[0].relationship-data[0].relationship-value\" value=\"`$tmp.AnAI.vfmodule.relationship-list.relationship[$i].relationship-data[$j].relationship-value`\" />","comments":"","outputs":1,"x":2460.797637939453,"y":836.7381820678711,"z":"649657bf.810a08","wires":[["60521a4e.d86c24","31576715.e12cb8"]]},{"id":"60521a4e.d86c24","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":2718.797637939453,"y":836.7381820678711,"z":"649657bf.810a08","wires":[["df885b9a.d50d48"]]},{"id":"a2951e55.91468","type":"failure","name":"failure","xml":"<outcome value='failure'>\n","comments":"","outputs":1,"x":1151.5238151550293,"y":431.1428852081299,"z":"649657bf.810a08","wires":[["43b4e1ad.1f07e"]]},{"id":"cb453314.82906","type":"set","name":"set error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\" />\n\t<parameter name=\"error-message\" value=\"`' | An error occurred while saving l3-network relationship with network-id = ' + $service-data.vnf-topology-information.vnf-assignments.vnf-networks[$i].network-id + ' for vf-module with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\" />\n","comments":"","x":1916.261962890625,"y":654.7738647460938,"z":"649657bf.810a08","wires":[]},{"id":"df885b9a.d50d48","type":"set","name":"set error-message","xml":"<set>\n\t<parameter name=\"error-code\" value=\"500\" />\n\t<parameter name=\"error-message\" value=\"`$error-message + ' | An error occurred while during rollback of l3-network relationship for vf-module with vf-module-id = ' + $vnf-topology-operation-input.vnf-request-information.vnf-id + ' and generic-vnf-id = ' + $vnf-topology-operation-input.vnf-request-information.generic-vnf-id`\" />\n","comments":"","x":2916.7619552612305,"y":836.2738265991211,"z":"649657bf.810a08","wires":[]},{"id":"888fdd16.a516","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":1158.4166412353516,"y":473.58333015441895,"z":"649657bf.810a08","wires":[["43b4e1ad.1f07e"]]},{"id":"31576715.e12cb8","type":"not-found","name":"not-found","xml":"<outcome value='not-found'>\n","comments":"","outputs":1,"x":2729.0833435058594,"y":877.9166784286499,"z":"649657bf.810a08","wires":[["df885b9a.d50d48"]]},{"id":"67679186.748aa","type":"switchNode","name":"switch ...service-data vnf-networks[]","xml":"<switch test=\"`$service-data.vnf-topology-information.vnf-assignments.vnf-networks_length`\">","comments":"","outputs":1,"x":1004.9048004150391,"y":593.9524188041687,"z":"649657bf.810a08","wires":[["1c428b92.af7ed4"]]},{"id":"1c428b92.af7ed4","type":"outcome","name":"NULL","xml":"<outcome value=''>","outputs":1,"x":1232.3492736816406,"y":593.4801287651062,"z":"649657bf.810a08","wires":[["318a4c8c.11ec54"]]},{"id":"318a4c8c.11ec54","type":"set","name":"set service-data vnf-networks[] = 0","xml":"<set>\n<parameter name = \"service-data.vnf-topology-information.vnf-assignments.vnf-networks_length\" value=\"0\" />\n","comments":"","x":1453.904882642958,"y":593.4801494280496,"z":"649657bf.810a08","wires":[]},{"id":"9af460e9.89728","type":"switchNode","name":"switch: service-data order-status = PendingUpdate","xml":"<switch test=\"`$service-data.oper-status.order-status == PendingUpdate`\">\n<!--\nleaf order-status {\n\ttype enumeration {\n\t\tenum \"Active\";\n\t\tenum \"PendingAssignment\";\n\t\tenum \"PendingCreate\";\n\t\tenum \"PendingUpdate\";\n\t\tenum \"Deleted\";\n\t}\n}\n-->","comments":"","outputs":1,"x":1099.000015258789,"y":213.666654586792,"z":"649657bf.810a08","wires":[["9453f20a.26253"]]},{"id":"1068f4d1.0204fb","type":"returnFailure","name":"return failure","xml":"<return status='failure'>\n\t<parameter name='error-code' value='400'/>\n\t<parameter name='error-message' value='Invalid service-data order status'/>","comments":"","x":1535.7498321533203,"y":213.5000286102295,"z":"649657bf.810a08","wires":[]},{"id":"9453f20a.26253","type":"other","name":"false","xml":"<outcome value='false'>","comments":"","outputs":1,"x":1377.1666412353516,"y":213.249906539917,"z":"649657bf.810a08","wires":[["1068f4d1.0204fb"]]},{"id":"7b15904e.95d82","type":"outcomeTrue","name":"true","xml":"<outcome value='true'>","comments":"","outputs":1,"x":812.6666259765625,"y":256.6666564941406,"z":"649657bf.810a08","wires":[["332241ad.8933fe"]]},{"id":"9477eb64.b0e578","type":"block","name":"block : atomic","xml":"<block atomic=\"true\">","atomic":"true","outputs":1,"x":281.6666564941406,"y":213.66665649414062,"z":"649657bf.810a08","wires":[["6f0bd180.1cfc9","d27d1828.1ce2f8","4fec02c6.9ca65c","94acb2fb.b3f92","307c9b58.b37964","8258f7ee.066158"]]}]